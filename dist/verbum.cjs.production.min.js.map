{"version":3,"file":"verbum.cjs.production.min.js","sources":["../src/nodes/EmojiNode.tsx","../src/nodes/ImageNode.tsx","../src/nodes/KeywordNode.ts","../src/nodes/MentionNode.ts","../node_modules/style-inject/dist/style-inject.es.js","../src/utils/join-classes.ts","../src/ui/Button.tsx","../src/nodes/PollNode.tsx","../src/shared/src/canUseDOM.ts","../src/shared/src/useLayoutEffect.ts","../src/collaboration.ts","../src/context/SharedHistoryContext.tsx","../src/themes/PlaygroundEditorTheme.ts","../src/themes/StickyEditorTheme.ts","../src/ui/ContentEditable.tsx","../src/ui/Placeholder.tsx","../src/nodes/StickyNode.tsx","../src/nodes/TweetNode.tsx","../src/nodes/TypeaheadNode.ts","../src/nodes/YouTubeNode.tsx","../src/nodes/CustomFieldNode.ts","../src/nodes/PlaygroundNodes.ts","../src/locale/index.tsx","../src/appSettings.ts","../src/context/SettingsContext.tsx","../src/ui/Modal.tsx","../src/hooks/useModal.tsx","../src/plugins/MarkdownTransformers.ts","../src/hooks/useReport.ts","../src/plugins/SpeechToTextPlugin.ts","../src/plugins/ActionsPlugin.tsx","../src/plugins/AutoLinkPlugin.tsx","../src/plugins/CommentPlugin.tsx","../src/plugins/CharacterStylesPopupPlugin.tsx","../src/plugins/ClickableLinkPlugin.ts","../src/plugins/CodeHighlightPlugin.ts","../src/plugins/EmojisPlugin.ts","../src/plugins/KeywordsPlugin.ts","../src/plugins/ListMaxIndentLevelPlugin.ts","../src/plugins/MarkdownShortcutPlugin.tsx","../src/plugins/TabFocusPlugin.tsx","../src/context/EditorContext.tsx","../src/ui/FileInput.tsx","../src/ui/TextInput.tsx","../src/plugins/ImagesPlugin.tsx","../src/plugins/DragDropPastePlugin.tsx","../src/utils/node.util.ts","../src/context/ToolbarContext.tsx","../src/ui/DropDown.tsx","../src/plugins/ToolbarPlugin/components/AlignDropdown.tsx","../src/plugins/PollPlugin.ts","../src/plugins/TwitterPlugin.ts","../src/plugins/YouTubePlugin.ts","../src/plugins/TableCellResizer.tsx","../src/plugins/TableActionMenuPlugin.tsx","../src/plugins/HorizontalRulePlugin.ts","../src/plugins/ToolbarPlugin/components/InsertDropdown.tsx","../src/shared/src/environment.ts","../src/plugins/ToolbarPlugin/components/UndoButton.tsx","../src/plugins/ToolbarPlugin/components/RedoButton.tsx","../src/ui/Select.tsx","../src/plugins/ToolbarPlugin/components/CodeLanguageDropdown.tsx","../src/plugins/ToolbarPlugin/components/BlockFormatDropdown.tsx","../src/ui/Divider.tsx","../src/plugins/ToolbarPlugin/ToolbarPlugin.tsx","../src/plugins/MentionsPlugin.tsx","../src/ui/ColorPicker.tsx","../src/ui/LinkPreview.tsx","../src/plugins/ToolbarPlugin/components/FloatingLinkEditor.tsx","../src/plugins/ToolbarPlugin/components/FontFamilyDropdown.tsx","../src/plugins/ToolbarPlugin/components/FontSizeDropdown.tsx","../src/plugins/CustomFieldPlugin.tsx","../src/nodes/ImageComponent.tsx","../src/plugins/ToolbarPlugin/components/BackgroundColorPicker.tsx","../src/plugins/ToolbarPlugin/components/BoldButton.tsx","../src/plugins/ToolbarPlugin/components/CodeFormatButton.tsx","../src/Editor.tsx","../src/EditorComposer.tsx","../src/plugins/ToolbarPlugin/components/InsertLinkButton.tsx","../src/plugins/ToolbarPlugin/components/ItalicButton.tsx","../src/plugins/ToolbarPlugin/components/TextColorPicker.tsx","../src/plugins/ToolbarPlugin/components/TextFormatDropdown.tsx","../src/plugins/ToolbarPlugin/components/UnderlineButton.tsx"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport React from 'react';\n\nimport type { EditorConfig, LexicalNode, NodeKey } from 'lexical';\n\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedEmojiNode = Spread<\n  {\n    className: string;\n    type: 'emoji';\n  },\n  typeof SerializedTextNode\n>;\n\nlet __className: string = 'EmojiNode';\nexport class EmojiNode extends TextNode {\n  static getType(): string {\n    return 'emoji';\n  }\n\n  static clone(node: EmojiNode): EmojiNode {\n    return new EmojiNode(__className, node.__text, node.__key);\n  }\n\n  constructor(className: string, text: string, key?: NodeKey) {\n    super(text, key);\n    __className = className;\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = document.createElement('span');\n    const inner = super.createDOM(config);\n    dom.className = __className;\n    inner.className = 'emoji-inner';\n    dom.appendChild(inner);\n    return dom;\n  }\n\n  updateDOM(\n    prevNode: TextNode,\n    dom: HTMLElement,\n    config: EditorConfig\n  ): boolean {\n    const inner = dom.firstChild;\n    if (inner === null) {\n      return true;\n    }\n    super.updateDOM(prevNode, inner as HTMLElement, config);\n    return false;\n  }\n\n  static importJSON(serializedNode: SerializedEmojiNode): EmojiNode {\n    const node = $createEmojiNode(\n      serializedNode.className,\n      serializedNode.text\n    );\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedEmojiNode {\n    return {\n      ...super.exportJSON(),\n      className: this.getClassName(),\n      type: 'emoji',\n    };\n  }\n\n  getClassName(): string {\n    const self = this.getLatest();\n    return self.__className;\n  }\n}\n\nexport function $isEmojiNode(\n  node: LexicalNode | null | undefined\n): node is EmojiNode {\n  return node instanceof EmojiNode;\n}\n\nexport function $createEmojiNode(\n  className: string,\n  emojiText: string\n): EmojiNode {\n  return new EmojiNode(className, emojiText).setMode('token');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  EditorConfig,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  SerializedEditor,\n  SerializedLexicalNode,\n  Spread,\n} from 'lexical';\n\nimport { $applyNodeReplacement, createEditor, DecoratorNode } from 'lexical';\nimport * as React from 'react';\nimport { Suspense } from 'react';\n\nconst ImageComponent = React.lazy(\n  // @ts-ignore\n  () => import('./ImageComponent')\n);\n\nexport interface ImagePayload {\n  altText: string;\n  caption?: LexicalEditor;\n  height?: number;\n  key?: NodeKey;\n  maxWidth?: number;\n  showCaption?: boolean;\n  src: string;\n  width?: number;\n  captionsEnabled?: boolean;\n}\n\nfunction convertImageElement(domNode: Node): null | DOMConversionOutput {\n  if (domNode instanceof HTMLImageElement) {\n    const { alt: altText, src, width, height } = domNode;\n    const node = $createImageNode({ altText, height, src, width });\n    return { node };\n  }\n  return null;\n}\n\nexport type SerializedImageNode = Spread<\n  {\n    altText: string;\n    caption: SerializedEditor;\n    height?: number;\n    maxWidth: number;\n    showCaption: boolean;\n    src: string;\n    width?: number;\n  },\n  SerializedLexicalNode\n>;\n\nexport class ImageNode extends DecoratorNode<JSX.Element> {\n  __src: string;\n  __altText: string;\n  __width: 'inherit' | number;\n  __height: 'inherit' | number;\n  __maxWidth: number;\n  __showCaption: boolean;\n  __caption: LexicalEditor;\n  // Captions cannot yet be used within editor cells\n  __captionsEnabled: boolean;\n\n  static getType(): string {\n    return 'image';\n  }\n\n  static clone(node: ImageNode): ImageNode {\n    return new ImageNode(\n      node.__src,\n      node.__altText,\n      node.__maxWidth,\n      node.__width,\n      node.__height,\n      node.__showCaption,\n      node.__caption,\n      node.__captionsEnabled,\n      node.__key\n    );\n  }\n\n  static importJSON(serializedNode: SerializedImageNode): ImageNode {\n    const { altText, height, width, maxWidth, caption, src, showCaption } =\n      serializedNode;\n    const node = $createImageNode({\n      altText,\n      height,\n      maxWidth,\n      showCaption,\n      src,\n      width,\n    });\n    const nestedEditor = node.__caption;\n    const editorState = nestedEditor.parseEditorState(caption.editorState);\n    if (!editorState.isEmpty()) {\n      nestedEditor.setEditorState(editorState);\n    }\n    return node;\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement('img');\n    element.setAttribute('src', this.__src);\n    element.setAttribute('alt', this.__altText);\n    element.setAttribute('width', this.__width.toString());\n    element.setAttribute('height', this.__height.toString());\n    return { element };\n  }\n\n  static importDOM(): DOMConversionMap | null {\n    return {\n      img: (node: Node) => ({\n        conversion: convertImageElement,\n        priority: 0,\n      }),\n    };\n  }\n\n  constructor(\n    src: string,\n    altText: string,\n    maxWidth: number,\n    width?: 'inherit' | number,\n    height?: 'inherit' | number,\n    showCaption?: boolean,\n    caption?: LexicalEditor,\n    captionsEnabled?: boolean,\n    key?: NodeKey\n  ) {\n    super(key);\n    this.__src = src;\n    this.__altText = altText;\n    this.__maxWidth = maxWidth;\n    this.__width = width || 'inherit';\n    this.__height = height || 'inherit';\n    this.__showCaption = showCaption || false;\n    this.__caption = caption || createEditor();\n    this.__captionsEnabled = captionsEnabled || captionsEnabled === undefined;\n  }\n\n  exportJSON(): SerializedImageNode {\n    return {\n      altText: this.getAltText(),\n      caption: this.__caption.toJSON(),\n      height: this.__height === 'inherit' ? 0 : this.__height,\n      maxWidth: this.__maxWidth,\n      showCaption: this.__showCaption,\n      src: this.getSrc(),\n      type: 'image',\n      version: 1,\n      width: this.__width === 'inherit' ? 0 : this.__width,\n    };\n  }\n\n  setWidthAndHeight(\n    width: 'inherit' | number,\n    height: 'inherit' | number\n  ): void {\n    const writable = this.getWritable();\n    writable.__width = width;\n    writable.__height = height;\n  }\n\n  setShowCaption(showCaption: boolean): void {\n    const writable = this.getWritable();\n    writable.__showCaption = showCaption;\n  }\n\n  // View\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const span = document.createElement('span');\n    const theme = config.theme;\n    const className = theme.image;\n    if (className !== undefined) {\n      span.className = className;\n    }\n    return span;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  getSrc(): string {\n    return this.__src;\n  }\n\n  getAltText(): string {\n    return this.__altText;\n  }\n\n  decorate(): JSX.Element {\n    return (\n      <Suspense fallback={null}>\n        <ImageComponent\n          src={this.__src}\n          altText={this.__altText}\n          width={this.__width}\n          height={this.__height}\n          maxWidth={this.__maxWidth}\n          nodeKey={this.getKey()}\n          showCaption={this.__showCaption}\n          caption={this.__caption}\n          captionsEnabled={this.__captionsEnabled}\n          resizable={true}\n        />\n      </Suspense>\n    );\n  }\n}\n\nexport function $createImageNode({\n  altText,\n  height,\n  maxWidth = 500,\n  captionsEnabled,\n  src,\n  width,\n  showCaption,\n  caption,\n  key,\n}: ImagePayload): ImageNode {\n  return $applyNodeReplacement(\n    new ImageNode(\n      src,\n      altText,\n      maxWidth,\n      width,\n      height,\n      showCaption,\n      caption,\n      captionsEnabled,\n      key\n    )\n  );\n}\n\nexport function $isImageNode(\n  node: LexicalNode | null | undefined\n): node is ImageNode {\n  return node instanceof ImageNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorConfig, LexicalNode } from 'lexical';\n\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedKeywordNode = Spread<\n  {\n    type: 'keyword';\n    version: 1;\n  },\n  typeof SerializedTextNode\n>;\n\nexport class KeywordNode extends TextNode {\n  static getType(): string {\n    return 'keyword';\n  }\n\n  static clone(node: KeywordNode): KeywordNode {\n    return new KeywordNode(node.__text, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedKeywordNode): KeywordNode {\n    const node = $createKeywordNode(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedKeywordNode {\n    return {\n      ...super.exportJSON(),\n      type: 'keyword',\n      version: 1,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cursor = 'default';\n    dom.className = 'keyword';\n    return dom;\n  }\n\n  canInsertTextBefore(): boolean {\n    return false;\n  }\n\n  canInsertTextAfter(): boolean {\n    return false;\n  }\n\n  isTextEntity(): true {\n    return true;\n  }\n}\n\nexport function $createKeywordNode(keyword: string): KeywordNode {\n  return new KeywordNode(keyword);\n}\n\nexport function $isKeywordNode(\n  node: LexicalNode | null | undefined | undefined\n): boolean {\n  return node instanceof KeywordNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorConfig, LexicalNode, NodeKey } from 'lexical';\n\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedMentionNode = Spread<\n  {\n    mentionName: string;\n    type: 'mention';\n    version: 1;\n  },\n  typeof SerializedTextNode\n>;\n\ntype PopoverCard = {\n  card: HTMLElement;\n  leftOffset: number;\n  topOffset: number;\n};\n\nconst mentionStyle = 'background-color: rgba(24, 119, 232, 0.2)';\n\nexport class MentionNode extends TextNode {\n  __mention: string;\n  __popoverCard: PopoverCard;\n\n  static getType(): string {\n    return 'mention';\n  }\n\n  static clone(node: MentionNode): MentionNode {\n    return new MentionNode(node.__mention, undefined, node.__text, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedMentionNode): MentionNode {\n    const node = $createMentionNode(serializedNode.mentionName);\n    node.setTextContent(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  constructor(\n    mentionName: string,\n    popover?: PopoverCard,\n    text?: string,\n    key?: NodeKey\n  ) {\n    super(text ?? mentionName, key);\n    this.__mention = mentionName;\n    if (popover !== undefined) {\n      this.__popoverCard = popover;\n      this.__popoverCard.card.id = 'verbum-mention-popover';\n      this.__popoverCard.card.style.position = 'absolute';\n      this.removePopover();\n    }\n  }\n\n  exportJSON(): SerializedMentionNode {\n    return {\n      ...super.exportJSON(),\n      mentionName: this.__mention,\n      type: 'mention',\n      version: 1,\n    };\n  }\n\n  removePopover = () => {\n    const existingPopover = document.getElementById(this.__popoverCard.card.id);\n    if (existingPopover && existingPopover.parentElement) {\n      existingPopover.parentElement.removeChild(existingPopover);\n    }\n  };\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cssText = mentionStyle;\n    dom.className = 'mention';\n\n    dom.addEventListener('pointerover', (event) => {\n      const { left, top } = dom.getBoundingClientRect();\n      this.__popoverCard.card.style.left = `${left - this.__popoverCard.leftOffset}px`;\n      this.__popoverCard.card.style.top = `${top - this.__popoverCard.topOffset}px`;\n      document.body.appendChild(this.__popoverCard.card);\n    });\n\n    dom.addEventListener('pointerout', (event) => {\n      this.removePopover();\n    });\n\n    return dom;\n  }\n\n  isTextEntity(): true {\n    return true;\n  }\n}\n\nexport function $createMentionNode(\n  mentionName: string,\n  popover?: PopoverCard\n): MentionNode {\n  const mentionNode = new MentionNode(mentionName, popover);\n  mentionNode.setMode('segmented').toggleDirectionless();\n  return mentionNode;\n}\n\nexport function $isMentionNode(\n  node: LexicalNode | null | undefined\n): node is MentionNode {\n  return node instanceof MentionNode;\n}\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nexport default function joinClasses(...args) {\n  return args.filter(Boolean).join(' ');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Button.css';\n\nimport * as React from 'react';\n\nimport joinClasses from '../utils/join-classes';\n\nexport default function Button({\n  'data-test-id': dataTestId,\n  children,\n  className,\n  onClick,\n  disabled,\n  small,\n  title,\n}: {\n  'data-test-id'?: string;\n  children: JSX.Element | string | (JSX.Element | string)[];\n  className?: string;\n  disabled?: boolean;\n  onClick: () => void;\n  small?: boolean;\n  title?: string;\n}): JSX.Element {\n  return (\n    <button\n      disabled={disabled}\n      className={joinClasses(\n        'Button__root',\n        disabled && 'Button__disabled',\n        small && 'Button__small',\n        className\n      )}\n      onClick={onClick}\n      title={title}\n      aria-label={title}\n      {...(dataTestId && { 'data-test-id': dataTestId })}\n    >\n      {children}\n    </button>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  LexicalNode,\n  NodeKey,\n  SerializedLexicalNode,\n} from 'lexical';\n\nimport './PollNode.css';\n\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $getNodeByKey, DecoratorNode } from 'lexical';\nimport { Spread } from 'libdefs/globals';\nimport * as React from 'react';\nimport { useMemo, useRef } from 'react';\n\nimport Button from '../ui/Button';\nimport joinClasses from '../utils/join-classes';\n\ntype Options = ReadonlyArray<Option>;\n\ntype Option = Readonly<{\n  text: string;\n  uid: string;\n  votes: Array<number>;\n}>;\n\nfunction createUID(): string {\n  return Math.random()\n    .toString(36)\n    .replace(/[^a-z]+/g, '')\n    .substr(0, 5);\n}\n\nfunction createPollOption(text = ''): Option {\n  return {\n    text,\n    uid: createUID(),\n    votes: [],\n  };\n}\n\nfunction cloneOption(\n  option: Option,\n  text: string,\n  votes?: Array<number>\n): Option {\n  return {\n    text,\n    uid: option.uid,\n    votes: votes || Array.from(option.votes),\n  };\n}\n\nfunction getTotalVotes(options: Options): number {\n  return options.reduce((totalVotes, next) => {\n    return totalVotes + next.votes.length;\n  }, 0);\n}\n\nfunction PollOptionComponent({\n  option,\n  index,\n  options,\n  totalVotes,\n  withPollNode,\n}: {\n  index: number;\n  option: Option;\n  options: Options;\n  totalVotes: number;\n  withPollNode: (cb: (PollNode) => void) => void;\n}): JSX.Element {\n  const { clientID } = useCollaborationContext();\n  const checkboxRef = useRef(null);\n  const votesArray = option.votes;\n  const checkedIndex = votesArray.indexOf(clientID);\n  const checked = checkedIndex !== -1;\n  const votes = votesArray.length;\n  const text = option.text;\n\n  return (\n    <div className=\"PollNode__optionContainer\">\n      <div\n        className={joinClasses(\n          'PollNode__optionCheckboxWrapper',\n          checked && 'PollNode__optionCheckboxChecked'\n        )}\n      >\n        <input\n          ref={checkboxRef}\n          className=\"PollNode__optionCheckbox\"\n          type=\"checkbox\"\n          onChange={(e) => {\n            withPollNode((node) => {\n              node.toggleVote(option, clientID);\n            });\n          }}\n          checked={checked}\n        />\n      </div>\n      <div className=\"PollNode__optionInputWrapper\">\n        <div\n          className=\"PollNode__optionInputVotes\"\n          style={{ width: `${votes === 0 ? 0 : (votes / totalVotes) * 100}%` }}\n        />\n        <span className=\"PollNode__optionInputVotesCount\">\n          {votes > 0 && (votes === 1 ? '1 vote' : `${votes} votes`)}\n        </span>\n        <input\n          className=\"PollNode__optionInput\"\n          type=\"text\"\n          value={text}\n          onChange={(e) => {\n            withPollNode((node) => {\n              node.setOptionText(option, e.target.value);\n            });\n          }}\n          placeholder={`Option ${index + 1}`}\n        />\n      </div>\n      <button\n        disabled={options.length < 3}\n        className={joinClasses(\n          'PollNode__optionDelete',\n          options.length < 3 && 'PollNode__optionDeleteDisabled'\n        )}\n        arial-label=\"Remove\"\n        onClick={() => {\n          withPollNode((node) => {\n            node.deleteOption(option);\n          });\n        }}\n      />\n    </div>\n  );\n}\n\nfunction PollComponent({\n  question,\n  options,\n  nodeKey,\n}: {\n  nodeKey: NodeKey;\n  options: Options;\n  question: string;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const totalVotes = useMemo(() => getTotalVotes(options), [options]);\n\n  const withPollNode = (cb: (node: PollNode) => void): void => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isPollNode(node)) {\n        cb(node);\n      }\n    });\n  };\n\n  const addOption = () => {\n    withPollNode((node) => {\n      node.addOption(createPollOption());\n    });\n  };\n\n  return (\n    <div className=\"PollNode__container\">\n      <h2 className=\"PollNode__heading\">{question}</h2>\n      {options.map((option, index) => {\n        const key = option.uid;\n        return (\n          <PollOptionComponent\n            key={key}\n            withPollNode={withPollNode}\n            option={option}\n            index={index}\n            options={options}\n            totalVotes={totalVotes}\n          />\n        );\n      })}\n      <div className=\"PollNode__footer\">\n        <Button onClick={addOption} small={true}>\n          Add Option\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nexport type SerializedPollNode = Spread<\n  {\n    question: string;\n    options: Options;\n    type: 'poll';\n    version: 1;\n  },\n  SerializedLexicalNode\n>;\n\nfunction convertPollElement(domNode: HTMLElement): DOMConversionOutput {\n  const question = domNode.getAttribute('data-lexical-poll-question');\n  const node = $createPollNode(question);\n  return { node };\n}\n\nexport class PollNode extends DecoratorNode<JSX.Element> {\n  __question: string;\n  __options: Options;\n\n  static getType(): string {\n    return 'poll';\n  }\n\n  static clone(node: PollNode): PollNode {\n    return new PollNode(node.__question, node.__options, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedPollNode): PollNode {\n    const node = $createPollNode(serializedNode.question);\n    serializedNode.options.forEach(node.addOption);\n    return node;\n  }\n\n  constructor(question: string, options?: Options, key?: NodeKey) {\n    super(key);\n    this.__question = question;\n    this.__options = options || [createPollOption(), createPollOption()];\n  }\n\n  exportJSON(): SerializedPollNode {\n    return {\n      options: this.__options,\n      question: this.__question,\n      type: 'poll',\n      version: 1,\n    };\n  }\n\n  addOption(option: Option): void {\n    const self = this.getWritable();\n    const options = Array.from(self.__options);\n    options.push(option);\n    self.__options = options;\n  }\n\n  deleteOption(option: Option): void {\n    const self = this.getWritable();\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options.splice(index, 1);\n    self.__options = options;\n  }\n\n  setOptionText(option: Option, text: string): void {\n    const self = this.getWritable();\n    const clonedOption = cloneOption(option, text);\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options[index] = clonedOption;\n    self.__options = options;\n  }\n\n  toggleVote(option: Option, clientID: number): void {\n    const self = this.getWritable();\n    const votes = option.votes;\n    const votesClone = Array.from(votes);\n    const voteIndex = votes.indexOf(clientID);\n    if (voteIndex === -1) {\n      votesClone.push(clientID);\n    } else {\n      votesClone.splice(voteIndex, 1);\n    }\n    const clonedOption = cloneOption(option, option.text, votesClone);\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options[index] = clonedOption;\n    self.__options = options;\n  }\n\n  static importDOM(): DOMConversionMap | null {\n    return {\n      span: (domNode: HTMLElement) => {\n        if (!domNode.hasAttribute('data-lexical-poll-question')) {\n          return null;\n        }\n        return {\n          conversion: convertPollElement,\n          priority: 2,\n        };\n      },\n    };\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement('span');\n    element.setAttribute('data-lexical-poll-question', this.__question);\n    return { element };\n  }\n\n  createDOM(): HTMLElement {\n    const elem = document.createElement('span');\n    elem.style.display = 'inline-block';\n    return elem;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  decorate(): JSX.Element {\n    return (\n      <PollComponent\n        question={this.__question}\n        options={this.__options}\n        nodeKey={this.__key}\n      />\n    );\n  }\n}\n\nexport function $createPollNode(question: string): PollNode {\n  return new PollNode(question);\n}\n\nexport function $isPollNode(\n  node: LexicalNode | null | undefined\n): node is PollNode {\n  return node instanceof PollNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict\n */\n\nexport const CAN_USE_DOM: boolean =\n  typeof window !== 'undefined' &&\n  typeof window.document !== 'undefined' &&\n  typeof window.document.createElement !== 'undefined';\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict\n */\n\nimport { useEffect, useLayoutEffect } from 'react';\nimport { CAN_USE_DOM } from './canUseDOM';\n\nconst useLayoutEffectImpl: typeof useLayoutEffect = CAN_USE_DOM\n  ? useLayoutEffect\n  : useEffect;\n\nexport default useLayoutEffectImpl;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {Provider} from '@lexical/yjs';\nimport { WebsocketProvider } from 'y-websocket';\nimport { Doc } from 'yjs';\n\nconst url = new URL(window.location.href);\nconst params = new URLSearchParams(url.search);\nconst WEBSOCKET_ENDPOINT = 'ws://localhost:1234';\nconst WEBSOCKET_SLUG = 'playground';\nconst WEBSOCKET_ID = params.get('collabId') || '0';\n\n// parent dom -> child doc\nexport function createWebsocketProvider(\n  id: string,\n  yjsDocMap: Map<string, Doc>\n): Provider {\n  let doc = yjsDocMap.get(id);\n\n  if (doc === undefined) {\n    doc = new Doc();\n    yjsDocMap.set(id, doc);\n  } else {\n    doc.load();\n  }\n\n  \n  // @ts-ignore\n  return new WebsocketProvider(\n    WEBSOCKET_ENDPOINT,\n    WEBSOCKET_SLUG + '/' + WEBSOCKET_ID + '/' + id,\n    doc,\n    {\n      connect: false,\n    }\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { HistoryState } from '@lexical/react/LexicalHistoryPlugin';\n\nimport { createEmptyHistoryState } from '@lexical/react/LexicalHistoryPlugin';\nimport * as React from 'react';\nimport { createContext, useContext, useMemo } from 'react';\n\ntype ContextShape = {\n  historyState: HistoryState;\n};\n\nconst Context: React.Context<ContextShape> = createContext({\n  historyState: { current: null, redoStack: [], undoStack: [] },\n});\n\nexport const SharedHistoryContext = ({\n  children,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n}): JSX.Element => {\n  const historyContext = useMemo(\n    () => ({ historyState: createEmptyHistoryState() }),\n    []\n  );\n  return <Context.Provider value={historyContext}>{children}</Context.Provider>;\n};\n\nexport const useSharedHistoryContext = (): ContextShape => {\n  return useContext(Context);\n};\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorThemeClasses } from 'lexical';\n\nimport './PlaygroundEditorTheme.css';\n\nconst theme: EditorThemeClasses = {\n  characterLimit: 'PlaygroundEditorTheme__characterLimit',\n  code: 'PlaygroundEditorTheme__code',\n  codeHighlight: {\n    atrule: 'PlaygroundEditorTheme__tokenAttr',\n    attr: 'PlaygroundEditorTheme__tokenAttr',\n    boolean: 'PlaygroundEditorTheme__tokenProperty',\n    builtin: 'PlaygroundEditorTheme__tokenSelector',\n    cdata: 'PlaygroundEditorTheme__tokenComment',\n    char: 'PlaygroundEditorTheme__tokenSelector',\n    class: 'PlaygroundEditorTheme__tokenFunction',\n    'class-name': 'PlaygroundEditorTheme__tokenFunction',\n    comment: 'PlaygroundEditorTheme__tokenComment',\n    constant: 'PlaygroundEditorTheme__tokenProperty',\n    deleted: 'PlaygroundEditorTheme__tokenProperty',\n    doctype: 'PlaygroundEditorTheme__tokenComment',\n    entity: 'PlaygroundEditorTheme__tokenOperator',\n    function: 'PlaygroundEditorTheme__tokenFunction',\n    important: 'PlaygroundEditorTheme__tokenVariable',\n    inserted: 'PlaygroundEditorTheme__tokenSelector',\n    keyword: 'PlaygroundEditorTheme__tokenAttr',\n    namespace: 'PlaygroundEditorTheme__tokenVariable',\n    number: 'PlaygroundEditorTheme__tokenProperty',\n    operator: 'PlaygroundEditorTheme__tokenOperator',\n    prolog: 'PlaygroundEditorTheme__tokenComment',\n    property: 'PlaygroundEditorTheme__tokenProperty',\n    punctuation: 'PlaygroundEditorTheme__tokenPunctuation',\n    regex: 'PlaygroundEditorTheme__tokenVariable',\n    selector: 'PlaygroundEditorTheme__tokenSelector',\n    string: 'PlaygroundEditorTheme__tokenSelector',\n    symbol: 'PlaygroundEditorTheme__tokenProperty',\n    tag: 'PlaygroundEditorTheme__tokenProperty',\n    url: 'PlaygroundEditorTheme__tokenOperator',\n    variable: 'PlaygroundEditorTheme__tokenVariable',\n  },\n  hashtag: 'PlaygroundEditorTheme__hashtag',\n  heading: {\n    h1: 'PlaygroundEditorTheme__h1',\n    h2: 'PlaygroundEditorTheme__h2',\n    h3: 'PlaygroundEditorTheme__h3',\n    h4: 'PlaygroundEditorTheme__h4',\n    h5: 'PlaygroundEditorTheme__h5',\n  },\n  image: 'editor-image',\n  link: 'PlaygroundEditorTheme__link',\n  list: {\n    listitem: 'PlaygroundEditorTheme__listItem',\n    listitemChecked: 'PlaygroundEditorTheme__listItemChecked',\n    listitemUnchecked: 'PlaygroundEditorTheme__listItemUnchecked',\n    nested: {\n      listitem: 'PlaygroundEditorTheme__nestedListItem',\n    },\n    olDepth: [\n      'PlaygroundEditorTheme__ol1',\n      'PlaygroundEditorTheme__ol2',\n      'PlaygroundEditorTheme__ol3',\n      'PlaygroundEditorTheme__ol4',\n      'PlaygroundEditorTheme__ol5',\n    ],\n    ul: 'PlaygroundEditorTheme__ul',\n  },\n  ltr: 'PlaygroundEditorTheme__ltr',\n  mark: 'PlaygroundEditorTheme__mark',\n  markOverlap: 'PlaygroundEditorTheme__markOverlap',\n  paragraph: 'PlaygroundEditorTheme__paragraph',\n  quote: 'PlaygroundEditorTheme__quote',\n  rtl: 'PlaygroundEditorTheme__rtl',\n  table: 'PlaygroundEditorTheme__table',\n  tableCell: 'PlaygroundEditorTheme__tableCell',\n  tableCellHeader: 'PlaygroundEditorTheme__tableCellHeader',\n  text: {\n    bold: 'PlaygroundEditorTheme__textBold',\n    code: 'PlaygroundEditorTheme__textCode',\n    italic: 'PlaygroundEditorTheme__textItalic',\n    strikethrough: 'PlaygroundEditorTheme__textStrikethrough',\n    subscript: 'PlaygroundEditorTheme__textSubscript',\n    superscript: 'PlaygroundEditorTheme__textSuperscript',\n    underline: 'PlaygroundEditorTheme__textUnderline',\n    underlineStrikethrough: 'PlaygroundEditorTheme__textUnderlineStrikethrough',\n  },\n};\n\nexport default theme;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorThemeClasses } from 'lexical';\n\nimport './StickyEditorTheme.css';\n\nimport baseTheme from './PlaygroundEditorTheme';\n\nconst theme: EditorThemeClasses = {\n  ...baseTheme,\n  paragraph: 'StickyEditorTheme__paragraph',\n};\n\nexport default theme;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './ContentEditable.css';\n\nimport { ContentEditable } from '@lexical/react/LexicalContentEditable';\nimport * as React from 'react';\n\nexport default function LexicalContentEditable({\n  className,\n}: {\n  className?: string;\n}): JSX.Element {\n  return <ContentEditable className={className || 'ContentEditable__root'} />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Placeholder.css';\n\nimport * as React from 'react';\n\nexport default function Placeholder({\n  children,\n  className,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n  className?: string;\n}): JSX.Element {\n  return <div className={className || 'Placeholder__root'}>{children}</div>;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  EditorConfig,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  SerializedLexicalNode,\n} from 'lexical';\n\nimport './StickyNode.css';\n\nimport { CollaborationPlugin } from '@lexical/react/LexicalCollaborationPlugin';\n\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport { LexicalNestedComposer } from '@lexical/react/LexicalNestedComposer';\nimport { PlainTextPlugin } from '@lexical/react/LexicalPlainTextPlugin';\nimport LexicalErrorBoundary from '@lexical/react/LexicalErrorBoundary';\nimport {\n  $getNodeByKey,\n  $setSelection,\n  createEditor,\n  DecoratorNode,\n} from 'lexical';\nimport { Spread } from 'libdefs/globals';\nimport * as React from 'react';\nimport { useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport useLayoutEffect from '../shared/src/useLayoutEffect';\n\nimport { createWebsocketProvider } from '../collaboration';\nimport { useSharedHistoryContext } from '../context/SharedHistoryContext';\nimport StickyEditorTheme from '../themes/StickyEditorTheme';\nimport ContentEditable from '../ui/ContentEditable';\nimport Placeholder from '../ui/Placeholder';\n\nfunction positionSticky(stickyElem: HTMLElement, positioning): void {\n  const style = stickyElem.style;\n  const rootElementRect = positioning.rootElementRect;\n  const rectLeft = rootElementRect !== null ? rootElementRect.left : 0;\n  const rectTop = rootElementRect !== null ? rootElementRect.top : 0;\n  style.top = rectTop + positioning.y + 'px';\n  style.left = rectLeft + positioning.x + 'px';\n}\n\nfunction StickyComponent({\n  x,\n  y,\n  nodeKey,\n  color,\n  caption,\n}: {\n  caption: LexicalEditor;\n  color: 'pink' | 'yellow';\n  nodeKey: NodeKey;\n  x: number;\n  y: number;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const stickyContainerRef = useRef<null | HTMLDivElement>(null);\n  const positioningRef = useRef<{\n    isDragging: boolean;\n    offsetX: number;\n    offsetY: number;\n    rootElementRect: null | ClientRect;\n    x: number;\n    y: number;\n  }>({\n    isDragging: false,\n    offsetX: 0,\n    offsetY: 0,\n    rootElementRect: null,\n    x: 0,\n    y: 0,\n  });\n  const { yjsDocMap } = useCollaborationContext();\n  const isCollab = yjsDocMap.get('main') !== undefined;\n\n  useEffect(() => {\n    const position = positioningRef.current;\n    position.x = x;\n    position.y = y;\n\n    const stickyContainer = stickyContainerRef.current;\n    if (stickyContainer !== null) {\n      positionSticky(stickyContainer, position);\n    }\n  }, [x, y]);\n\n  useLayoutEffect(() => {\n    const position = positioningRef.current;\n    const resizeObserver = new ResizeObserver((entries) => {\n      for (let i = 0; i < entries.length; i++) {\n        const entry = entries[i];\n        const { target } = entry;\n        position.rootElementRect = target.getBoundingClientRect();\n        const stickyContainer = stickyContainerRef.current;\n        if (stickyContainer !== null) {\n          positionSticky(stickyContainer, position);\n        }\n      }\n    });\n\n    const removeRootListener = editor.registerRootListener(\n      (nextRootElem, prevRootElem) => {\n        if (prevRootElem !== null) {\n          resizeObserver.unobserve(prevRootElem);\n        }\n        if (nextRootElem !== null) {\n          resizeObserver.observe(nextRootElem);\n        }\n      }\n    );\n\n    const handleWindowResize = () => {\n      const rootElement = editor.getRootElement();\n      const stickyContainer = stickyContainerRef.current;\n      if (rootElement !== null && stickyContainer !== null) {\n        position.rootElementRect = rootElement.getBoundingClientRect();\n        positionSticky(stickyContainer, position);\n      }\n    };\n\n    window.addEventListener('resize', handleWindowResize);\n\n    return () => {\n      window.removeEventListener('resize', handleWindowResize);\n      removeRootListener();\n    };\n  }, [editor]);\n\n  useEffect(() => {\n    const stickyContainer = stickyContainerRef.current;\n    if (stickyContainer !== null) {\n      // Delay adding transition so we don't trigger the\n      // transition on load of the sticky.\n      setTimeout(() => {\n        stickyContainer.style.setProperty(\n          'transition',\n          'top 0.3s ease 0s, left 0.3s ease 0s'\n        );\n      }, 500);\n    }\n  }, []);\n\n  const handlePointerMove = (event: PointerEvent) => {\n    const stickyContainer = stickyContainerRef.current;\n    const positioning = positioningRef.current;\n    const rootElementRect = positioning.rootElementRect;\n    if (\n      stickyContainer !== null &&\n      positioning.isDragging &&\n      rootElementRect !== null\n    ) {\n      positioning.x = event.pageX - positioning.offsetX - rootElementRect.left;\n      positioning.y = event.pageY - positioning.offsetY - rootElementRect.top;\n      positionSticky(stickyContainer, positioning);\n    }\n  };\n\n  const handlePointerUp = (event: PointerEvent) => {\n    const stickyContainer = stickyContainerRef.current;\n    const positioning = positioningRef.current;\n    if (stickyContainer !== null) {\n      positioning.isDragging = false;\n      stickyContainer.classList.remove('dragging');\n      editor.update(() => {\n        const node = $getNodeByKey(nodeKey);\n        if ($isStickyNode(node)) {\n          node.setPosition(positioning.x, positioning.y);\n        }\n      });\n    }\n    document.removeEventListener('pointermove', handlePointerMove);\n    document.removeEventListener('pointerup', handlePointerUp);\n  };\n\n  const handleDelete = () => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isStickyNode(node)) {\n        node.remove();\n      }\n    });\n  };\n\n  const handleColorChange = () => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isStickyNode(node)) {\n        node.toggleColor();\n      }\n    });\n  };\n\n  const { historyState } = useSharedHistoryContext();\n\n  return (\n    <div ref={stickyContainerRef} className=\"sticky-note-container\">\n      <div\n        className={`sticky-note ${color}`}\n        onPointerDown={(event) => {\n          const stickyContainer = stickyContainerRef.current;\n          if (\n            stickyContainer == null ||\n            event.button === 2 ||\n            event.target !== stickyContainer.firstChild\n          ) {\n            // Right click or click on editor should not work\n            return;\n          }\n          const stickContainer = stickyContainer;\n          const positioning = positioningRef.current;\n          if (stickContainer !== null) {\n            const { top, left } = stickContainer.getBoundingClientRect();\n            positioning.offsetX = event.clientX - left;\n            positioning.offsetY = event.clientY - top;\n            positioning.isDragging = true;\n            stickContainer.classList.add('dragging');\n            document.addEventListener('pointermove', handlePointerMove);\n            document.addEventListener('pointerup', handlePointerUp);\n            event.preventDefault();\n          }\n        }}\n      >\n        <button\n          onClick={handleDelete}\n          className=\"delete\"\n          aria-label=\"Delete sticky note\"\n          title=\"Delete\"\n        >\n          X\n        </button>\n        <button\n          onClick={handleColorChange}\n          className=\"color\"\n          aria-label=\"Change sticky note color\"\n          title=\"Color\"\n        >\n          <i className=\"bucket\" />\n        </button>\n        <LexicalNestedComposer\n          initialEditor={caption}\n          initialTheme={StickyEditorTheme}\n        >\n          {isCollab ? (\n            <CollaborationPlugin\n              id={caption.getKey()}\n              providerFactory={createWebsocketProvider}\n              shouldBootstrap={true}\n            />\n          ) : (\n            <HistoryPlugin externalHistoryState={historyState} />\n          )}\n          <PlainTextPlugin\n            contentEditable={\n              <ContentEditable className=\"StickyNode__contentEditable\" />\n            }\n            placeholder={\n              <Placeholder className=\"StickyNode__placeholder\">\n                What's up?\n              </Placeholder>\n            }\n            ErrorBoundary={LexicalErrorBoundary}\n          />\n        </LexicalNestedComposer>\n      </div>\n    </div>\n  );\n}\n\ntype StickyNoteColor = 'pink' | 'yellow';\n\nexport type SerializedStickyNode = Spread<\n  {\n    xOffset: number;\n    yOffset: number;\n    color: StickyNoteColor;\n    caption: LexicalEditor;\n    type: 'sticky';\n    version: 1;\n  },\n  SerializedLexicalNode\n>;\n\nexport class StickyNode extends DecoratorNode<JSX.Element> {\n  __x: number;\n  __y: number;\n  __color: StickyNoteColor;\n  __caption: LexicalEditor;\n\n  static getType(): string {\n    return 'sticky';\n  }\n\n  static clone(node: StickyNode): StickyNode {\n    return new StickyNode(\n      node.__x,\n      node.__y,\n      node.__color,\n      node.__caption,\n      node.__key\n    );\n  }\n  static importJSON(serializedNode: SerializedStickyNode): StickyNode {\n    return new StickyNode(\n      serializedNode.xOffset,\n      serializedNode.yOffset,\n      serializedNode.color,\n      serializedNode.caption\n    );\n  }\n\n  constructor(\n    x: number,\n    y: number,\n    color: 'pink' | 'yellow',\n    caption?: LexicalEditor,\n    key?: NodeKey\n  ) {\n    super(key);\n    this.__x = x;\n    this.__y = y;\n    this.__caption = caption || createEditor();\n    this.__color = color;\n  }\n\n  exportJSON(): SerializedStickyNode {\n    return {\n      caption: this.__caption,\n      color: this.__color,\n      type: 'sticky',\n      version: 1,\n      xOffset: this.__x,\n      yOffset: this.__y,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const div = document.createElement('div');\n    div.style.display = 'contents';\n    return div;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  setPosition(x: number, y: number): void {\n    const writable = this.getWritable();\n    writable.__x = x;\n    writable.__y = y;\n    $setSelection(null);\n  }\n\n  toggleColor(): void {\n    const writable = this.getWritable();\n    writable.__color = writable.__color === 'pink' ? 'yellow' : 'pink';\n  }\n\n  decorate(editor: LexicalEditor): JSX.Element {\n    return createPortal(\n      <StickyComponent\n        color={this.__color}\n        x={this.__x}\n        y={this.__y}\n        nodeKey={this.getKey()}\n        caption={this.__caption}\n      />,\n      document.body\n    );\n  }\n\n  isIsolated(): true {\n    return true;\n  }\n}\n\nexport function $isStickyNode(\n  node: LexicalNode | null | undefined\n): node is StickyNode {\n  return node instanceof StickyNode;\n}\n\nexport function $createStickyNode(\n  xOffset: number,\n  yOffset: number\n): StickyNode {\n  return new StickyNode(xOffset, yOffset, 'yellow');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  EditorConfig,\n  ElementFormatType,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  Spread,\n} from 'lexical';\n\nimport { BlockWithAlignableContents } from '@lexical/react/LexicalBlockWithAlignableContents';\nimport {\n  DecoratorBlockNode,\n  SerializedDecoratorBlockNode,\n} from '@lexical/react/LexicalDecoratorBlockNode';\nimport * as React from 'react';\nimport { useCallback, useEffect, useRef, useState } from 'react';\n\nconst WIDGET_SCRIPT_URL = 'https://platform.twitter.com/widgets.js';\n\ntype TweetComponentProps = Readonly<{\n  className: Readonly<{\n    base: string;\n    focus: string;\n  }>;\n  format: ElementFormatType | null;\n  loadingComponent?: JSX.Element | string;\n  nodeKey: NodeKey;\n  onError?: (error: string) => void;\n  onLoad?: () => void;\n  tweetID: string;\n}>;\n\nfunction convertTweetElement(\n  domNode: HTMLDivElement\n): DOMConversionOutput | null {\n  const id = domNode.getAttribute('data-lexical-tweet-id');\n  if (id) {\n    const node = $createTweetNode(id);\n    return { node };\n  }\n  return null;\n}\n\nlet isTwitterScriptLoading = true;\n\nfunction TweetComponent({\n  className,\n  format,\n  loadingComponent,\n  nodeKey,\n  onError,\n  onLoad,\n  tweetID,\n}: TweetComponentProps) {\n  const containerRef = useRef<HTMLDivElement | null>(null);\n\n  const previousTweetIDRef = useRef<string>('');\n  const [isTweetLoading, setIsTweetLoading] = useState(false);\n\n  const createTweet = useCallback(async () => {\n    try {\n      // @ts-expect-error Twitter is attached to the window.\n      await window.twttr.widgets.createTweet(tweetID, containerRef.current);\n\n      setIsTweetLoading(false);\n      isTwitterScriptLoading = false;\n\n      if (onLoad) {\n        onLoad();\n      }\n    } catch (error) {\n      if (onError) {\n        onError(String(error));\n      }\n    }\n  }, [onError, onLoad, tweetID]);\n\n  useEffect(() => {\n    if (tweetID !== previousTweetIDRef.current) {\n      setIsTweetLoading(true);\n\n      if (isTwitterScriptLoading) {\n        const script = document.createElement('script');\n        script.src = WIDGET_SCRIPT_URL;\n        script.async = true;\n        document.body?.appendChild(script);\n        script.onload = createTweet;\n        if (onError) {\n          script.onerror = onError as OnErrorEventHandler;\n        }\n      } else {\n        createTweet();\n      }\n\n      if (previousTweetIDRef) {\n        previousTweetIDRef.current = tweetID;\n      }\n    }\n  }, [createTweet, onError, tweetID]);\n\n  return (\n    <BlockWithAlignableContents\n      className={className}\n      format={format}\n      nodeKey={nodeKey}\n    >\n      {isTweetLoading ? loadingComponent : null}\n      <div\n        style={{ display: 'inline-block', width: '550px' }}\n        ref={containerRef}\n      />\n    </BlockWithAlignableContents>\n  );\n}\n\nexport type SerializedTweetNode = Spread<\n  {\n    id: string;\n    type: 'tweet';\n    version: 1;\n  },\n  SerializedDecoratorBlockNode\n>;\n\nexport class TweetNode extends DecoratorBlockNode {\n  __id: string;\n\n  static getType(): string {\n    return 'tweet';\n  }\n\n  static clone(node: TweetNode): TweetNode {\n    return new TweetNode(node.__id, node.__format, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedTweetNode): TweetNode {\n    const node = $createTweetNode(serializedNode.id);\n    node.setFormat(serializedNode.format);\n    return node;\n  }\n\n  exportJSON(): SerializedTweetNode {\n    return {\n      ...super.exportJSON(),\n      id: this.getId(),\n      type: 'tweet',\n      version: 1,\n    };\n  }\n\n  static importDOM(): DOMConversionMap<HTMLDivElement> | null {\n    return {\n      div: (domNode: HTMLDivElement) => {\n        if (!domNode.hasAttribute('data-lexical-tweet-id')) {\n          return null;\n        }\n        return {\n          conversion: convertTweetElement,\n          priority: 2,\n        };\n      },\n    };\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement('div');\n    element.setAttribute('data-lexical-tweet-id', this.__id);\n    return { element };\n  }\n\n  constructor(id: string, format?: ElementFormatType, key?: NodeKey) {\n    super(format, key);\n    this.__id = id;\n  }\n\n  getId(): string {\n    return this.__id;\n  }\n\n  decorate(editor: LexicalEditor, config: EditorConfig): JSX.Element {\n    const embedBlockTheme = config.theme.embedBlock || {};\n    const className = {\n      base: embedBlockTheme.base || '',\n      focus: embedBlockTheme.focus || '',\n    };\n    return (\n      <TweetComponent\n        className={className}\n        format={this.__format}\n        loadingComponent=\"Loading...\"\n        nodeKey={this.getKey()}\n        tweetID={this.__id}\n      />\n    );\n  }\n\n  isTopLevel(): true {\n    return true;\n  }\n}\n\nexport function $createTweetNode(tweetID: string): TweetNode {\n  return new TweetNode(tweetID);\n}\n\nexport function $isTweetNode(\n  node: TweetNode | LexicalNode | null | undefined\n): node is TweetNode {\n  return node instanceof TweetNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorConfig } from 'lexical';\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedTypeaheadNode = Spread<\n  {\n    type: 'typeahead';\n    version: 1;\n  },\n  typeof SerializedTextNode\n>;\n\nexport class TypeaheadNode extends TextNode {\n  static clone(node: TypeaheadNode): TypeaheadNode {\n    return new TypeaheadNode(node.__text, node.__key);\n  }\n\n  static getType(): 'typeahead' {\n    return 'typeahead';\n  }\n\n  static importJSON(serializedNode: SerializedTypeaheadNode): TypeaheadNode {\n    const node = $createTypeaheadNode(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedTypeaheadNode {\n    return {\n      ...super.exportJSON(),\n      type: 'typeahead',\n      version: 1,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cssText = 'color: #ccc;';\n    return dom;\n  }\n}\n\nexport function $createTypeaheadNode(text: string): TypeaheadNode {\n  return new TypeaheadNode(text).setMode('token');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  EditorConfig,\n  ElementFormatType,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  Spread,\n} from 'lexical';\n\nimport { BlockWithAlignableContents } from '@lexical/react/LexicalBlockWithAlignableContents';\nimport {\n  DecoratorBlockNode,\n  SerializedDecoratorBlockNode,\n} from '@lexical/react/LexicalDecoratorBlockNode';\nimport * as React from 'react';\n\ntype YouTubeComponentProps = Readonly<{\n  className: Readonly<{\n    base: string;\n    focus: string;\n  }>;\n  format: ElementFormatType | null;\n  nodeKey: NodeKey;\n  videoID: string;\n}>;\n\nfunction YouTubeComponent({\n  className,\n  format,\n  nodeKey,\n  videoID,\n}: YouTubeComponentProps) {\n  return (\n    <BlockWithAlignableContents\n      className={className}\n      format={format}\n      nodeKey={nodeKey}\n    >\n      <iframe\n        width=\"560\"\n        height=\"315\"\n        src={`https://www.youtube.com/embed/${videoID}`}\n        frameBorder=\"0\"\n        allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n        allowFullScreen={true}\n        title=\"YouTube video\"\n      />\n    </BlockWithAlignableContents>\n  );\n}\n\nexport type SerializedYouTubeNode = Spread<\n  {\n    videoID: string;\n    type: 'youtube';\n    version: 1;\n  },\n  SerializedDecoratorBlockNode\n>;\n\nexport class YouTubeNode extends DecoratorBlockNode {\n  __id: string;\n\n  static getType(): string {\n    return 'youtube';\n  }\n\n  static clone(node: YouTubeNode): YouTubeNode {\n    return new YouTubeNode(node.__id, node.__format, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedYouTubeNode): YouTubeNode {\n    const node = $createYouTubeNode(serializedNode.videoID);\n    node.setFormat(serializedNode.format);\n    return node;\n  }\n\n  exportJSON(): SerializedYouTubeNode {\n    return {\n      ...super.exportJSON(),\n      type: 'youtube',\n      version: 1,\n      videoID: this.__id,\n    };\n  }\n\n  constructor(id: string, format?: ElementFormatType, key?: NodeKey) {\n    super(format, key);\n    this.__id = id;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  getId(): string {\n    return this.__id;\n  }\n\n  decorate(_editor: LexicalEditor, config: EditorConfig): JSX.Element {\n    const embedBlockTheme = config.theme.embedBlock || {};\n    const className = {\n      base: embedBlockTheme.base || '',\n      focus: embedBlockTheme.focus || '',\n    };\n    return (\n      <YouTubeComponent\n        className={className}\n        format={this.__format}\n        nodeKey={this.getKey()}\n        videoID={this.__id}\n      />\n    );\n  }\n\n  isTopLevel(): true {\n    return true;\n  }\n}\n\nexport function $createYouTubeNode(videoID: string): YouTubeNode {\n  return new YouTubeNode(videoID);\n}\n\nexport function $isYouTubeNode(\n  node: YouTubeNode | LexicalNode | null | undefined\n): node is YouTubeNode {\n  return node instanceof YouTubeNode;\n}\n","import { EditorConfig, TextNode, LexicalNode, NodeKey } from 'lexical';\nimport SerializedTextNode from 'lexical';\nimport { Spread } from 'globals';\n\nexport type SerializedCustomFieldNode = Spread<\n    {\n        text: string;\n        id: string;\n        className: string;\n        type: 'custom-field';\n        version: 1;\n    },\n    typeof SerializedTextNode\n>;\n\nexport class CustomFieldNode extends TextNode {\n    __id: string;\n\n    static getType(): string {\n        return 'custom-field';\n    }\n\n    static clone(node: CustomFieldNode): CustomFieldNode {\n        return new CustomFieldNode(node.__text, node.__id, node.__key);\n    }\n\n    constructor(text: string, id?: string, key?: NodeKey) {\n        super(text, key);\n        this.__id = id;\n    }\n\n    createDOM(config: EditorConfig): HTMLElement {\n        // Define the DOM element here\n        const dom = document.createElement('p');\n        dom.className = 'custom-field';\n\n        const self = this.getLatest();\n        dom.innerHTML = self.__text;\n        dom.id = self.__id;\n        return dom;\n    }\n\n    updateDOM(prevNode: CustomFieldNode, dom: HTMLElement): boolean {\n        // Returning false tells Lexical that this node does not need its\n        // DOM element replacing with a new copy from createDOM.\n        return false;\n    }\n\n    getClassName(): string {\n        const self = this.getLatest();\n        return self.__className;\n    }\n\n    getId(): string {\n        const self = this.getLatest();\n        return self.__id;\n    }\n\n    getText(): string {\n        const self = this.getLatest();\n        return self.__text;\n    }\n\n\n    static importJSON(serializedNode: SerializedCustomFieldNode): CustomFieldNode {\n        const node = $createCustomFieldNode(\n            serializedNode.text,\n            serializedNode.id,\n        );\n        return node;\n    }\n\n    exportJSON(): SerializedCustomFieldNode {\n        return {\n            ...super.exportJSON(),\n            id: this.getId(),\n            text: this.getText(),\n            className: this.getClassName(),\n            type: CustomFieldNode.getType(),\n            version: 1,\n        };\n    }\n}\n\nexport function $createCustomFieldNode(text: string, id?: string, key?: string): CustomFieldNode {\n    return new CustomFieldNode(text, id, key);\n}\n\nexport function $isCustomFieldNodeNode(node: LexicalNode | null | undefined): node is CustomFieldNode {\n    return node instanceof CustomFieldNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalNode } from 'lexical';\n\nimport { CodeHighlightNode, CodeNode } from '@lexical/code';\nimport { HashtagNode } from '@lexical/hashtag';\nimport { AutoLinkNode, LinkNode } from '@lexical/link';\nimport { ListItemNode, ListNode } from '@lexical/list';\nimport { MarkNode } from '@lexical/mark';\nimport { OverflowNode } from '@lexical/overflow';\nimport { HorizontalRuleNode } from '@lexical/react/LexicalHorizontalRuleNode';\nimport { HeadingNode, QuoteNode } from '@lexical/rich-text';\nimport { TableCellNode, TableNode, TableRowNode } from '@lexical/table';\nimport { Class } from 'utility-types';\n\nimport { EmojiNode } from './EmojiNode';\nimport { ImageNode } from './ImageNode';\nimport { KeywordNode } from './KeywordNode';\nimport { MentionNode } from './MentionNode';\nimport { PollNode } from './PollNode';\nimport { StickyNode } from './StickyNode';\nimport { TweetNode } from './TweetNode';\nimport { TypeaheadNode } from './TypeaheadNode';\nimport { YouTubeNode } from './YouTubeNode';\nimport { CustomFieldNode } from './CustomFieldNode';\n\nconst PlaygroundNodes: Array<Class<LexicalNode>> = [\n  HeadingNode,\n  ListNode,\n  ListItemNode,\n  QuoteNode,\n  CodeNode,\n  TableNode,\n  TableCellNode,\n  TableRowNode,\n  HashtagNode,\n  CodeHighlightNode,\n  AutoLinkNode,\n  LinkNode,\n  OverflowNode,\n  PollNode,\n  StickyNode,\n  ImageNode,\n  MentionNode,\n  EmojiNode,\n  TypeaheadNode,\n  KeywordNode,\n  HorizontalRuleNode,\n  TweetNode,\n  YouTubeNode,\n  MarkNode,\n  CustomFieldNode,\n];\n\nexport default PlaygroundNodes;\n","import * as i18next from 'i18next';\nimport EN from './languages/en.json';\nimport FR from './languages/fr.json';\nimport PTBR from './languages/ptBr.json';\nimport RU from './languages/ru.json';\n\nexport const resources = {\n  ar: {},\n  de: {},\n  en: EN,\n  es: {},\n  fr: FR,\n  it: {},\n  ja: {},\n  nl: {},\n  pl: {},\n  pt: {},\n  ptBr: PTBR,\n  ru: RU,\n  ukr: {},\n  zh: {},\n} as const;\n\nexport const languageDetector = {\n  type: 'languageDetector',\n  async: true,\n  detect: (callback) => {\n    const language = navigator.language;\n    callback(language.substring(0, 2));\n  },\n  init: () => {},\n  cacheUserLanguage: () => {},\n};\n\nconst i18n = i18next\n  .createInstance(\n    {\n      ns: ['toolbar', 'action'],\n      resources,\n      fallbackLng: 'en',\n      debug: true,\n      interpolation: {\n        escapeValue: false,\n      },\n    },\n    // We must provide a function as second parameter, otherwise i18next errors\n    (err, t) => {}\n  )\n  .use(languageDetector as i18next.Module);\n\nexport default i18n;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nexport type SettingName =\n  | 'disableBeforeInput'\n  | 'measureTypingPerf'\n  | 'isRichText'\n  | 'isCollab'\n  | 'isCharLimit'\n  | 'isCharLimitUtf8'\n  | 'isAutocomplete'\n  | 'showTreeView'\n  | 'showNestedEditorTreeView'\n  | 'emptyEditor';\n\nexport type Settings = Record<SettingName, boolean>;\n\nconst hostName = window.location.hostname;\nexport const isDevPlayground: boolean =\n  hostName !== 'playground.lexical.dev' &&\n  hostName !== 'lexical-playground.vercel.app';\n\nexport const DEFAULT_SETTINGS: Settings = {\n  disableBeforeInput: false,\n  emptyEditor: isDevPlayground,\n  isAutocomplete: false,\n  isCharLimit: false,\n  isCharLimitUtf8: false,\n  isCollab: false,\n  isRichText: true,\n  measureTypingPerf: false,\n  showNestedEditorTreeView: false,\n  showTreeView: true,\n};\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { SettingName } from '../appSettings';\n\nimport * as React from 'react';\nimport {\n  createContext,\n  useCallback,\n  useContext,\n  useMemo,\n  useState,\n} from 'react';\n\nimport { DEFAULT_SETTINGS } from '../appSettings';\n\ntype SettingsContextShape = {\n  setOption: (name: SettingName, value: boolean) => void;\n  settings: Record<SettingName, boolean>;\n};\n\nconst Context: React.Context<SettingsContextShape> = createContext({\n  setOption: (name: SettingName, value: boolean) => {\n    return;\n  },\n  settings: DEFAULT_SETTINGS,\n});\n\nexport const SettingsContext = ({\n  children,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n}): JSX.Element => {\n  const [settings, setSettings] = useState(DEFAULT_SETTINGS);\n  const setOption = useCallback((setting: SettingName, value: boolean) => {\n    setSettings((options) => ({\n      ...options,\n      [setting as string]: value,\n    }));\n    if (DEFAULT_SETTINGS[setting] === value) {\n      setURLParam(setting, null);\n    } else {\n      setURLParam(setting, value);\n    }\n  }, []);\n  const contextValue = useMemo(() => {\n    return { setOption, settings };\n  }, [setOption, settings]);\n  return <Context.Provider value={contextValue}>{children}</Context.Provider>;\n};\n\nexport const useSettings = (): SettingsContextShape => {\n  return useContext(Context);\n};\n\nfunction setURLParam(param: SettingName, value: null | boolean) {\n  const url = new URL(window.location.href);\n  const params = new URLSearchParams(url.search);\n  if (value !== null) {\n    if (params.has(param)) {\n      params.set(param, String(value));\n    } else {\n      params.append(param, String(value));\n    }\n  } else {\n    if (params.has(param)) {\n      params.delete(param);\n    }\n  }\n  url.search = params.toString();\n  window.history.pushState(null, '', url.toString());\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Modal.css';\n\nimport * as React from 'react';\nimport { useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\n\nfunction PortalImpl({\n  onClose,\n  children,\n  title,\n  closeOnClickOutside,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n  closeOnClickOutside: boolean;\n  onClose: () => void;\n  title: string;\n}) {\n  const modalRef = useRef<HTMLDivElement>();\n\n  useEffect(() => {\n    if (modalRef.current !== null) {\n      modalRef.current.focus();\n    }\n  }, []);\n\n  useEffect(() => {\n    let modalOverlayElement = null;\n    const handler = (event) => {\n      if (event.keyCode === 27) {\n        onClose();\n      }\n    };\n    const clickOutsideHandler = (event: MouseEvent) => {\n      const target = event.target;\n      if (\n        modalRef.current !== null &&\n        !modalRef.current.contains(target as Node) &&\n        closeOnClickOutside\n      ) {\n        onClose();\n      }\n    };\n    if (modalRef.current !== null) {\n      modalOverlayElement = modalRef.current?.parentElement;\n      if (modalOverlayElement !== null) {\n        modalOverlayElement?.addEventListener('click', clickOutsideHandler);\n      }\n    }\n\n    window.addEventListener('keydown', handler);\n\n    return () => {\n      window.removeEventListener('keydown', handler);\n      if (modalOverlayElement !== null) {\n        modalOverlayElement?.removeEventListener('click', clickOutsideHandler);\n      }\n    };\n  }, [closeOnClickOutside, onClose]);\n\n  return (\n    <div className=\"Modal__overlay\" role=\"dialog\">\n      <div className=\"Modal__modal\" tabIndex={-1} ref={modalRef}>\n        <h2 className=\"Modal__title\">{title}</h2>\n        <button\n          className=\"Modal__closeButton\"\n          aria-label=\"Close modal\"\n          type=\"button\"\n          onClick={onClose}\n        >\n          X\n        </button>\n        <div className=\"Modal__content\">{children}</div>\n      </div>\n    </div>\n  );\n}\n\nexport default function Modal({\n  onClose,\n  children,\n  title,\n  closeOnClickOutside = false,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n  closeOnClickOutside?: boolean;\n  onClose: () => void;\n  title: string;\n}): JSX.Element {\n  return createPortal(\n    <PortalImpl\n      onClose={onClose}\n      title={title}\n      closeOnClickOutside={closeOnClickOutside}\n    >\n      {children}\n    </PortalImpl>,\n    document.body\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useCallback, useMemo, useState } from 'react';\nimport * as React from 'react';\n\nimport Modal from '../ui/Modal';\n\nexport default function useModal(): [\n  JSX.Element,\n  (title: string, showModal: (onClose: () => void) => JSX.Element) => void\n] {\n  const [modalContent, setModalContent] = useState<null | {\n    closeOnClickOutside: boolean;\n    content: JSX.Element;\n    title: string;\n  }>(null);\n\n  const onClose = useCallback(() => {\n    setModalContent(null);\n  }, []);\n\n  const modal = useMemo(() => {\n    if (modalContent === null) {\n      return null;\n    }\n    const { title, content, closeOnClickOutside } = modalContent;\n    return (\n      <Modal\n        onClose={onClose}\n        title={title}\n        closeOnClickOutside={closeOnClickOutside}\n      >\n        {content}\n      </Modal>\n    );\n  }, [modalContent, onClose]);\n\n  const showModal = useCallback(\n    (\n      title,\n      // eslint-disable-next-line no-shadow\n      getContent: (onClose: () => void) => JSX.Element,\n      closeOnClickOutside = false\n    ) => {\n      setModalContent({\n        closeOnClickOutside,\n        content: getContent(onClose),\n        title,\n      });\n    },\n    [onClose]\n  );\n\n  return [modal, showModal];\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  ElementTransformer,\n  TextMatchTransformer,\n  Transformer,\n} from '@lexical/markdown';\nimport type { ElementNode, LexicalNode } from 'lexical';\n\nimport {\n  CHECK_LIST,\n  ELEMENT_TRANSFORMERS,\n  TEXT_FORMAT_TRANSFORMERS,\n  TEXT_MATCH_TRANSFORMERS,\n} from '@lexical/markdown';\nimport {\n  $createHorizontalRuleNode,\n  $isHorizontalRuleNode,\n  HorizontalRuleNode,\n} from '@lexical/react/LexicalHorizontalRuleNode';\nimport {\n  $createTableCellNode,\n  $createTableNode,\n  $createTableRowNode,\n  $isTableNode,\n  $isTableRowNode,\n  TableCellHeaderStates,\n  TableCellNode,\n  TableNode,\n  TableRowNode,\n} from '@lexical/table';\nimport {\n  $createParagraphNode,\n  $createTextNode,\n  $isElementNode,\n  $isParagraphNode,\n  $isTextNode,\n} from 'lexical';\n\nimport { $createImageNode, $isImageNode, ImageNode } from '../nodes/ImageNode';\nimport { $createTweetNode, $isTweetNode, TweetNode } from '../nodes/TweetNode';\n\nexport const HR: ElementTransformer = {\n  dependencies: [HorizontalRuleNode],\n  export: (node: LexicalNode) => {\n    return $isHorizontalRuleNode(node) ? '***' : null;\n  },\n  regExp: /^(---|\\*\\*\\*|___)\\s?$/,\n  replace: (parentNode, _1, _2, isImport) => {\n    const line = $createHorizontalRuleNode();\n\n    // TODO: Get rid of isImport flag\n    if (isImport || parentNode.getNextSibling() != null) {\n      parentNode.replace(line);\n    } else {\n      parentNode.insertBefore(line);\n    }\n\n    line.selectNext();\n  },\n  type: 'element',\n};\n\nexport const IMAGE: TextMatchTransformer = {\n  dependencies: [ImageNode],\n  export: (node, exportChildren, exportFormat) => {\n    if (!$isImageNode(node)) {\n      return null;\n    }\n\n    return `![${node.getAltText()}](${node.getSrc()})`;\n  },\n  importRegExp: /!(?:\\[([^[]*)\\])(?:\\(([^(]+)\\))/,\n  regExp: /!(?:\\[([^[]*)\\])(?:\\(([^(]+)\\))$/,\n  replace: (textNode, match) => {\n    const [, altText, src] = match;\n    const imageNode = $createImageNode({\n      altText,\n      maxWidth: 800,\n      src,\n    });\n    textNode.replace(imageNode);\n  },\n  trigger: ')',\n  type: 'text-match',\n};\n\nexport const TWEET: ElementTransformer = {\n  dependencies: [TweetNode],\n  export: (node) => {\n    if (!$isTweetNode(node)) {\n      return null;\n    }\n\n    return `<tweet id=\"${node.getId()}\" />`;\n  },\n  regExp: /<tweet id=\"([^\"]+?)\"\\s?\\/>\\s?$/,\n  replace: (textNode, _1, match) => {\n    const [, id] = match;\n    const tweetNode = $createTweetNode(id);\n    textNode.replace(tweetNode);\n  },\n  type: 'element',\n};\n\n// Very primitive table setup\nconst TABLE_ROW_REG_EXP = /^(?:\\|)(.+)(?:\\|)\\s?$/;\n\nexport const TABLE: ElementTransformer = {\n  dependencies: [TableNode, TableRowNode, TableCellNode],\n  export: (\n    node: LexicalNode,\n    exportChildren: (elementNode: ElementNode) => string\n  ) => {\n    if (!$isTableNode(node)) {\n      return null;\n    }\n\n    const output = [];\n\n    for (const row of node.getChildren()) {\n      const rowOutput = [];\n\n      if ($isTableRowNode(row)) {\n        for (const cell of row.getChildren()) {\n          // It's TableCellNode (hence ElementNode) so it's just to make flow happy\n          if ($isElementNode(cell)) {\n            rowOutput.push(exportChildren(cell));\n          }\n        }\n      }\n\n      output.push(`| ${rowOutput.join(' | ')} |`);\n    }\n\n    return output.join('\\n');\n  },\n  regExp: TABLE_ROW_REG_EXP,\n  replace: (parentNode, _1, match) => {\n    const matchCells = mapToTableCells(match[0]);\n\n    if (matchCells == null) {\n      return;\n    }\n\n    const rows = [matchCells];\n    let sibling = parentNode.getPreviousSibling();\n    let maxCells = matchCells.length;\n\n    while (sibling) {\n      if (!$isParagraphNode(sibling)) {\n        break;\n      }\n\n      if (sibling.getChildrenSize() !== 1) {\n        break;\n      }\n\n      const firstChild = sibling.getFirstChild();\n\n      if (!$isTextNode(firstChild)) {\n        break;\n      }\n\n      const cells = mapToTableCells(firstChild.getTextContent());\n\n      if (cells == null) {\n        break;\n      }\n\n      maxCells = Math.max(maxCells, cells.length);\n      rows.unshift(cells);\n      const previousSibling = sibling.getPreviousSibling();\n      sibling.remove();\n      sibling = previousSibling;\n    }\n\n    const table = $createTableNode();\n\n    for (const cells of rows) {\n      const tableRow = $createTableRowNode();\n      table.append(tableRow);\n\n      for (let i = 0; i < maxCells; i++) {\n        tableRow.append(i < cells.length ? cells[i] : createTableCell(null));\n      }\n    }\n\n    const previousSibling = parentNode.getPreviousSibling();\n    if (\n      $isTableNode(previousSibling) &&\n      getTableColumnsSize(previousSibling) === maxCells\n    ) {\n      previousSibling.append(...table.getChildren());\n      parentNode.remove();\n    } else {\n      parentNode.replace(table);\n    }\n\n    table.selectEnd();\n  },\n  type: 'element',\n};\n\nfunction getTableColumnsSize(table: TableNode) {\n  const row = table.getFirstChild();\n  return $isTableRowNode(row) ? row.getChildrenSize() : 0;\n}\n\nconst createTableCell = (\n  textContent: string | null | undefined\n): TableCellNode => {\n  const cell = $createTableCellNode(TableCellHeaderStates.NO_STATUS);\n  const paragraph = $createParagraphNode();\n\n  if (textContent != null) {\n    paragraph.append($createTextNode(textContent.trim()));\n  }\n\n  cell.append(paragraph);\n  return cell;\n};\n\nconst mapToTableCells = (textContent: string): Array<TableCellNode> | null => {\n  // TODO:\n  // For now plain text, single node. Can be expanded to more complex content\n  // including formatted text\n  const match = textContent.match(TABLE_ROW_REG_EXP);\n\n  if (!match || !match[1]) {\n    return null;\n  }\n\n  return match[1].split('|').map((text) => createTableCell(text));\n};\n\nexport const PLAYGROUND_TRANSFORMERS: Array<Transformer> = [\n  TABLE,\n  HR,\n  IMAGE,\n  TWEET,\n  CHECK_LIST,\n  ...ELEMENT_TRANSFORMERS,\n  ...TEXT_FORMAT_TRANSFORMERS,\n  ...TEXT_MATCH_TRANSFORMERS,\n];\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useCallback, useEffect, useRef } from 'react';\n\nconst getElement = (): HTMLElement => {\n  let element = document.getElementById('report-container');\n\n  if (element === null) {\n    element = document.createElement('div');\n    element.id = 'report-container';\n    element.style.position = 'fixed';\n    element.style.top = '50%';\n    element.style.left = '50%';\n    element.style.fontSize = '32px';\n    element.style.transform = 'translate(-50%, -50px)';\n    element.style.padding = '20px';\n    element.style.background = 'rgba(240, 240, 240, 0.4)';\n    element.style.borderRadius = '20px';\n\n    if (document.body) {\n      document.body.appendChild(element);\n    }\n  }\n\n  return element;\n};\n\nexport default function useReport(): (arg0: string) => NodeJS.Timeout {\n  const timer = useRef<NodeJS.Timeout | null>(null);\n  const cleanup = useCallback(() => {\n    clearTimeout(timer.current);\n\n    if (document.body) {\n      document.body.removeChild(getElement());\n    }\n  }, []);\n\n  useEffect(() => {\n    return cleanup;\n  }, [cleanup]);\n\n  return useCallback(\n    (content) => {\n      // eslint-disable-next-line no-console\n      console.log(content);\n      const element = getElement();\n      clearTimeout(timer.current);\n      element.innerHTML = content;\n      timer.current = setTimeout(cleanup, 1000);\n      return timer.current;\n    },\n    [cleanup]\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand, LexicalEditor, RangeSelection } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n  REDO_COMMAND,\n  UNDO_COMMAND,\n} from 'lexical';\nimport { useEffect, useRef, useState } from 'react';\n\nimport useReport from '../hooks/useReport';\n\nexport const SPEECH_TO_TEXT_COMMAND: LexicalCommand<boolean> = createCommand();\n\nconst VOICE_COMMANDS: Readonly<\n  Record<\n    string,\n    (arg0: { editor: LexicalEditor; selection: RangeSelection }) => void\n  >\n> = {\n  '\\n': ({ selection }) => {\n    selection.insertParagraph();\n  },\n  redo: ({ editor }) => {\n    editor.dispatchCommand(REDO_COMMAND, undefined);\n  },\n  undo: ({ editor }) => {\n    editor.dispatchCommand(UNDO_COMMAND, undefined);\n  },\n};\n\nexport const SUPPORT_SPEECH_RECOGNITION: boolean =\n  'SpeechRecognition' in window || 'webkitSpeechRecognition' in window;\n\nfunction SpeechToTextPlugin(): null {\n  const [editor] = useLexicalComposerContext();\n  const [isEnabled, setIsEnabled] = useState<boolean>(false);\n  const SpeechRecognition =\n    // @ts-ignore\n    window.SpeechRecognition || window.webkitSpeechRecognition;\n  const recognition = useRef<typeof SpeechRecognition | null>(null);\n  const report = useReport();\n\n  useEffect(() => {\n    if (isEnabled && recognition.current === null) {\n      recognition.current = new SpeechRecognition();\n      recognition.current.continuous = true;\n      recognition.current.interimResults = true;\n      recognition.current.addEventListener(\n        'result',\n        (event: typeof SpeechRecognition) => {\n          const resultItem = event.results.item(event.resultIndex);\n          const { transcript } = resultItem.item(0);\n          report(transcript);\n\n          if (!resultItem.isFinal) {\n            return;\n          }\n\n          editor.update(() => {\n            const selection = $getSelection();\n\n            if ($isRangeSelection(selection)) {\n              const command = VOICE_COMMANDS[transcript.toLowerCase().trim()];\n\n              if (command) {\n                command({\n                  editor,\n                  selection,\n                });\n              } else if (transcript.match(/\\s*\\n\\s*/)) {\n                selection.insertParagraph();\n              } else {\n                selection.insertText(transcript);\n              }\n            }\n          });\n        }\n      );\n    }\n\n    if (recognition.current) {\n      if (isEnabled) {\n        recognition.current.start();\n      } else {\n        recognition.current.stop();\n      }\n    }\n\n    return () => {\n      if (recognition.current !== null) {\n        recognition.current.stop();\n      }\n    };\n  }, [SpeechRecognition, editor, isEnabled, report]);\n  useEffect(() => {\n    return editor.registerCommand(\n      SPEECH_TO_TEXT_COMMAND,\n      (_isEnabled: boolean) => {\n        setIsEnabled(_isEnabled);\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n\nexport default (SUPPORT_SPEECH_RECOGNITION\n  ? SpeechToTextPlugin\n  : () => null) as () => null;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalEditor } from 'lexical';\n\nimport { $createCodeNode, $isCodeNode } from '@lexical/code';\nimport { exportFile, importFile } from '@lexical/file';\nimport {\n  $convertFromMarkdownString,\n  $convertToMarkdownString,\n} from '@lexical/markdown';\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { mergeRegister } from '@lexical/utils';\nimport { CONNECTED_COMMAND, TOGGLE_CONNECT_COMMAND } from '@lexical/yjs';\nimport {\n  $createTextNode,\n  $getRoot,\n  $isParagraphNode,\n  CLEAR_EDITOR_COMMAND,\n  COMMAND_PRIORITY_EDITOR,\n} from 'lexical';\nimport * as React from 'react';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport useModal from '../hooks/useModal';\nimport Button from '../ui/Button';\nimport { PLAYGROUND_TRANSFORMERS } from './MarkdownTransformers';\nimport {\n  SPEECH_TO_TEXT_COMMAND,\n  SUPPORT_SPEECH_RECOGNITION,\n} from './SpeechToTextPlugin';\nimport { useTranslation } from 'react-i18next';\nimport { TFunction } from 'i18next';\n\nexport default function ActionsPlugin({\n  isRichText,\n}: {\n  isRichText: boolean;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const [isEditable, setIsEditable] = useState(() => editor.isEditable());\n  const [isSpeechToText, setIsSpeechToText] = useState(false);\n  const [connected, setConnected] = useState(false);\n  const [isEditorEmpty, setIsEditorEmpty] = useState(true);\n  const [modal, showModal] = useModal();\n  const { yjsDocMap } = useCollaborationContext();\n  const isCollab = yjsDocMap.get('main') !== undefined;\n  const { t } = useTranslation(['action']);\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerEditableListener((editable) => {\n        setIsEditable(editable);\n      }),\n      editor.registerCommand<boolean>(\n        CONNECTED_COMMAND,\n        (payload) => {\n          const isConnected = payload;\n          setConnected(isConnected);\n          return false;\n        },\n        COMMAND_PRIORITY_EDITOR\n      )\n    );\n  }, [editor]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      editor.getEditorState().read(() => {\n        const root = $getRoot();\n        const children = root.getChildren();\n\n        if (children.length > 1) {\n          setIsEditorEmpty(false);\n        } else {\n          if ($isParagraphNode(children[0])) {\n            const paragraphChildren = children[0].getChildren();\n            setIsEditorEmpty(paragraphChildren.length === 0);\n          } else {\n            setIsEditorEmpty(false);\n          }\n        }\n      });\n    });\n  }, [editor]);\n\n  const handleMarkdownToggle = useCallback(() => {\n    editor.update(() => {\n      const root = $getRoot();\n      const firstChild = root.getFirstChild();\n      if ($isCodeNode(firstChild) && firstChild.getLanguage() === 'markdown') {\n        $convertFromMarkdownString(\n          firstChild.getTextContent(),\n          PLAYGROUND_TRANSFORMERS\n        );\n      } else {\n        const markdown = $convertToMarkdownString(PLAYGROUND_TRANSFORMERS);\n        root\n          .clear()\n          .append(\n            $createCodeNode('markdown').append($createTextNode(markdown))\n          );\n      }\n      root.selectEnd();\n    });\n  }, [editor]);\n\n  return (\n    <div className=\"actions\">\n      {SUPPORT_SPEECH_RECOGNITION && (\n        <button\n          onClick={() => {\n            editor.dispatchCommand(SPEECH_TO_TEXT_COMMAND, !isSpeechToText);\n            setIsSpeechToText(!isSpeechToText);\n          }}\n          className={\n            'action-button action-button-mic ' +\n            (isSpeechToText ? 'active' : '')\n          }\n          title={t('action:Speech_To_Text')}\n          aria-label={`${\n            isSpeechToText ? t('action:Enable') : t('action:Disable')\n          } ${t('action:speech_To_Text')}`}\n          type=\"button\"\n        >\n          <i className=\"mic\" />\n        </button>\n      )}\n      <button\n        className=\"action-button import\"\n        onClick={() => importFile(editor)}\n        title={t('action:Import')}\n        aria-label={t('action:Import_Description')}\n        type=\"button\"\n      >\n        <i className=\"import\" />\n      </button>\n      <button\n        className=\"action-button export\"\n        onClick={() =>\n          exportFile(editor, {\n            fileName: `Playground ${new Date().toISOString()}`,\n            source: 'Playground',\n          })\n        }\n        title={t('action:Export')}\n        aria-label={t('action:Export_Description')}\n        type=\"button\"\n      >\n        <i className=\"export\" />\n      </button>\n      <button\n        className=\"action-button clear\"\n        disabled={isEditorEmpty}\n        onClick={() => {\n          showModal(t('action:Clear_Editor'), (onClose) => (\n            <ShowClearDialog editor={editor} onClose={onClose} t={t} />\n          ));\n        }}\n        title={t('action:Clear')}\n        aria-label={t('action:Clear_Description')}\n        type=\"button\"\n      >\n        <i className=\"clear\" />\n      </button>\n      <button\n        className={`action-button ${isEditable ? 'unlock' : 'lock'}`}\n        onClick={() => {\n          editor.setEditable(!editor.isEditable());\n        }}\n        title={t('action:Read-Only_Mode')}\n        aria-label={`${isEditable ? t('action:Unlock') : t('action:Lock')} ${t(\n          'action:Read-Only_Mode'\n        )}`}\n        type=\"button\"\n      >\n        <i className={isEditable ? 'unlock' : 'lock'} />\n      </button>\n      <button\n        className=\"action-button\"\n        onClick={handleMarkdownToggle}\n        title={t('action:Convert_From_Markdown')}\n        aria-label={t('action:Convert_From_Markdown_Description')}\n        type=\"button\"\n      >\n        <i className=\"markdown\" />\n      </button>\n      {isCollab && (\n        <button\n          className=\"action-button connect\"\n          onClick={() => {\n            editor.dispatchCommand(TOGGLE_CONNECT_COMMAND, !connected);\n          }}\n          title={`${\n            connected ? t('action:Disconnect') : t('action:Connect')\n          } ${t('action:Collaborative')}`}\n          aria-label={`${\n            connected ? t('action:Disconnect_From') : t('action:Connect_To')\n          } ${t('action:Server')}`}\n          type=\"button\"\n        >\n          <i\n            className={connected ? t('action:disconnect') : t('action:connect')}\n          />\n        </button>\n      )}\n      {modal}\n    </div>\n  );\n}\n\nfunction ShowClearDialog({\n  editor,\n  onClose,\n  t,\n}: {\n  editor: LexicalEditor;\n  onClose: () => void;\n  t: TFunction;\n}): JSX.Element {\n  return (\n    <>\n      {t('action:Confirm_Clear')}\n      <div className=\"Modal__content\">\n        <Button\n          onClick={() => {\n            editor.dispatchCommand(CLEAR_EDITOR_COMMAND, undefined);\n            editor.focus();\n            onClose();\n          }}\n        >\n          {t('action:Clear')}\n        </Button>{' '}\n        <Button\n          onClick={() => {\n            editor.focus();\n            onClose();\n          }}\n        >\n          {t('action:Cancel')}\n        </Button>\n      </div>\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { AutoLinkPlugin } from '@lexical/react/LexicalAutoLinkPlugin';\nimport * as React from 'react';\n\nconst URL_MATCHER =\n  /((https?:\\/\\/(www\\.)?)|(www\\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/;\n\nconst EMAIL_MATCHER =\n  /(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))/;\n\nconst MATCHERS = [\n  (text) => {\n    const match = URL_MATCHER.exec(text);\n    return (\n      match && {\n        index: match.index,\n        length: match[0].length,\n        text: match[0],\n        url: match[0],\n      }\n    );\n  },\n  (text) => {\n    const match = EMAIL_MATCHER.exec(text);\n    return (\n      match && {\n        index: match.index,\n        length: match[0].length,\n        text: match[0],\n        url: `mailto:${match[0]}`,\n      }\n    );\n  },\n];\n\nexport default function LexicalAutoLinkPlugin(): JSX.Element {\n  return <AutoLinkPlugin matchers={MATCHERS} />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {\n  Comment,\n  Comments,\n  CommentStore,\n  createComment,\n  createThread,\n  Thread,\n  useCommentStore,\n} from '../commenting';\nimport type {\n  EditorState,\n  LexicalCommand,\n  LexicalEditor,\n  NodeKey,\n} from 'lexical';\n\nimport './CommentPlugin.css';\n\nimport {\n  $createMarkNode,\n  $getMarkIDs,\n  $isMarkNode,\n  $unwrapMarkNode,\n  $wrapSelectionInMarkNode,\n  MarkNode,\n} from '@lexical/mark';\nimport { AutoFocusPlugin } from '@lexical/react/LexicalAutoFocusPlugin';\nimport { ClearEditorPlugin } from '@lexical/react/LexicalClearEditorPlugin';\nimport { LexicalComposer } from '@lexical/react/LexicalComposer';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport { OnChangePlugin } from '@lexical/react/LexicalOnChangePlugin';\nimport { PlainTextPlugin } from '@lexical/react/LexicalPlainTextPlugin';\nimport LexicalErrorBoundary from '@lexical/react/LexicalErrorBoundary';\nimport { createDOMRange, createRectsFromDOMRange } from '@lexical/selection';\nimport { $isRootTextContentEmpty, $rootTextContent } from '@lexical/text';\nimport { mergeRegister, registerNestedElementResolver } from '@lexical/utils';\nimport {\n  $getNodeByKey,\n  $getSelection,\n  $isRangeSelection,\n  $isTextNode,\n  CLEAR_EDITOR_COMMAND,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n  KEY_ESCAPE_COMMAND,\n} from 'lexical';\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport useLayoutEffect from '../shared/src/useLayoutEffect';\n\nimport useModal from '../hooks/useModal';\nimport CommentEditorTheme from '../themes/CommentEditorTheme';\nimport Button from '../ui/Button';\nimport ContentEditable from '../ui/ContentEditable';\nimport Placeholder from '../ui/Placeholder';\nimport type { Doc } from 'yjs';\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { WebsocketProvider } from 'y-websocket';\nimport { useTranslation } from 'react-i18next';\nimport { TFunction } from 'i18next';\n\nexport const INSERT_INLINE_COMMAND: LexicalCommand<void> = createCommand();\n\nfunction AddCommentBox({\n  anchorKey,\n  editor,\n  onAddComment,\n}: {\n  anchorKey: NodeKey;\n  editor: LexicalEditor;\n  onAddComment: () => void;\n}): JSX.Element {\n  const boxRef = useRef<HTMLDivElement>(null);\n\n  const updatePosition = useCallback(() => {\n    const boxElem = boxRef.current;\n    const rootElement = editor.getRootElement();\n    const anchorElement = editor.getElementByKey(anchorKey);\n\n    if (boxElem !== null && rootElement !== null && anchorElement !== null) {\n      const { right } = rootElement.getBoundingClientRect();\n      const { top } = anchorElement.getBoundingClientRect();\n      boxElem.style.left = `${right - 20}px`;\n      boxElem.style.top = `${top - 30}px`;\n    }\n  }, [anchorKey, editor]);\n\n  useEffect(() => {\n    window.addEventListener('resize', updatePosition);\n\n    return () => {\n      window.removeEventListener('resize', updatePosition);\n    };\n  }, [editor, updatePosition]);\n\n  useLayoutEffect(() => {\n    updatePosition();\n  }, [anchorKey, editor, updatePosition]);\n\n  return (\n    <div className=\"CommentPlugin_AddCommentBox\" ref={boxRef}>\n      <button\n        className=\"CommentPlugin_AddCommentBox_button\"\n        onClick={onAddComment}\n        type=\"button\"\n      >\n        <i className=\"icon add-comment\" />\n      </button>\n    </div>\n  );\n}\n\nfunction EditorRefPlugin({\n  editorRef,\n}: {\n  editorRef: { current: null | LexicalEditor };\n}): null {\n  const [editor] = useLexicalComposerContext();\n\n  useLayoutEffect(() => {\n    editorRef.current = editor;\n    return () => {\n      editorRef.current = null;\n    };\n  }, [editor, editorRef]);\n\n  return null;\n}\n\nfunction EscapeHandlerPlugin({\n  onEscape,\n}: {\n  onEscape: (e: KeyboardEvent) => boolean;\n}): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      KEY_ESCAPE_COMMAND,\n      (event: KeyboardEvent) => {\n        return onEscape(event);\n      },\n      2\n    );\n  }, [editor, onEscape]);\n\n  return null;\n}\n\nfunction PlainTextEditor({\n  className,\n  autoFocus,\n  onEscape,\n  onChange,\n  editorRef,\n  placeholder = 'Type a comment...',\n}: {\n  autoFocus?: boolean;\n  className?: string;\n  editorRef?: { current: null | LexicalEditor };\n  onChange: (editorState: EditorState, editor: LexicalEditor) => void;\n  onEscape: (e: KeyboardEvent) => boolean;\n  placeholder?: string;\n}) {\n  const initialConfig = {\n    namespace: 'Commenting',\n    nodes: [],\n    onError: (error: Error) => {\n      throw error;\n    },\n    theme: CommentEditorTheme,\n  };\n\n  return (\n    <LexicalComposer initialConfig={initialConfig}>\n      <div className=\"CommentPlugin_CommentInputBox_EditorContainer\">\n        <PlainTextPlugin\n          contentEditable={<ContentEditable className={className} />}\n          placeholder={<Placeholder>{placeholder}</Placeholder>}\n          ErrorBoundary={LexicalErrorBoundary}\n        />\n        <OnChangePlugin onChange={onChange} />\n        <HistoryPlugin />\n        {autoFocus !== false && <AutoFocusPlugin />}\n        <EscapeHandlerPlugin onEscape={onEscape} />\n        <ClearEditorPlugin />\n        {editorRef !== undefined && <EditorRefPlugin editorRef={editorRef} />}\n      </div>\n    </LexicalComposer>\n  );\n}\n\nfunction useOnChange(\n  setContent: (text: string) => void,\n  setCanSubmit: (canSubmit: boolean) => void\n) {\n  return useCallback(\n    (editorState: EditorState, _editor: LexicalEditor) => {\n      editorState.read(() => {\n        setContent($rootTextContent());\n        setCanSubmit(!$isRootTextContentEmpty(_editor.isComposing(), true));\n      });\n    },\n    [setCanSubmit, setContent]\n  );\n}\n\nfunction CommentInputBox({\n  editor,\n  cancelAddComment,\n  submitAddComment,\n  t,\n}: {\n  cancelAddComment: () => void;\n  editor: LexicalEditor;\n  submitAddComment: (\n    commentOrThread: Comment | Thread,\n    isInlineComment: boolean\n  ) => void;\n  t: TFunction;\n}) {\n  const [content, setContent] = useState('');\n  const [canSubmit, setCanSubmit] = useState(false);\n  const boxRef = useRef<HTMLDivElement>(null);\n  const selectionState = useMemo(\n    () => ({\n      container: document.createElement('div'),\n      elements: [],\n    }),\n    []\n  );\n  const author = useCollabAuthorName();\n\n  const updateLocation = useCallback(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n\n      if ($isRangeSelection(selection)) {\n        const anchor = selection.anchor;\n        const focus = selection.focus;\n        const range = createDOMRange(\n          editor,\n          anchor.getNode(),\n          anchor.offset,\n          focus.getNode(),\n          focus.offset\n        );\n        const boxElem = boxRef.current;\n        if (range !== null && boxElem !== null) {\n          const { left, bottom, width } = range.getBoundingClientRect();\n          const selectionRects = createRectsFromDOMRange(editor, range);\n          let correctedLeft =\n            selectionRects.length === 1 ? left + width / 2 - 125 : left - 125;\n          if (correctedLeft < 10) {\n            correctedLeft = 10;\n          }\n          boxElem.style.left = `${correctedLeft}px`;\n          boxElem.style.top = `${bottom + 20}px`;\n          const selectionRectsLength = selectionRects.length;\n          const { container } = selectionState;\n          const elements: Array<HTMLSpanElement> = selectionState.elements;\n          const elementsLength = elements.length;\n\n          for (let i = 0; i < selectionRectsLength; i++) {\n            const selectionRect = selectionRects[i];\n            let elem: HTMLSpanElement = elements[i];\n            if (elem === undefined) {\n              elem = document.createElement('span');\n              elements[i] = elem;\n              container.appendChild(elem);\n            }\n            const color = '255, 212, 0';\n            const style = `position:absolute;top:${selectionRect.top}px;left:${selectionRect.left}px;height:${selectionRect.height}px;width:${selectionRect.width}px;background-color:rgba(${color}, 0.3);pointer-events:none;z-index:5;`;\n            elem.style.cssText = style;\n          }\n          for (let i = elementsLength - 1; i >= selectionRectsLength; i--) {\n            const elem = elements[i];\n            container.removeChild(elem);\n            elements.pop();\n          }\n        }\n      }\n    });\n  }, [editor, selectionState]);\n\n  useLayoutEffect(() => {\n    updateLocation();\n    const container = selectionState.container;\n    const body = document.body;\n    if (body !== null) {\n      body.appendChild(container);\n      return () => {\n        body.removeChild(container);\n      };\n    }\n  }, [selectionState.container, updateLocation]);\n\n  useEffect(() => {\n    window.addEventListener('resize', updateLocation);\n\n    return () => {\n      window.removeEventListener('resize', updateLocation);\n    };\n  }, [updateLocation]);\n\n  const onEscape = (event: KeyboardEvent): boolean => {\n    event.preventDefault();\n    cancelAddComment();\n    return true;\n  };\n\n  const submitComment = () => {\n    if (canSubmit) {\n      let quote = editor.getEditorState().read(() => {\n        const selection = $getSelection();\n        return selection !== null ? selection.getTextContent() : '';\n      });\n      if (quote.length > 100) {\n        quote = quote.slice(0, 99) + '…';\n      }\n      submitAddComment(\n        createThread(quote, [createComment(content, author)]),\n        true\n      );\n    }\n  };\n\n  const onChange = useOnChange(setContent, setCanSubmit);\n\n  return (\n    <div className=\"CommentPlugin_CommentInputBox\" ref={boxRef}>\n      <PlainTextEditor\n        className=\"CommentPlugin_CommentInputBox_Editor\"\n        onEscape={onEscape}\n        onChange={onChange}\n      />\n      <div className=\"CommentPlugin_CommentInputBox_Buttons\">\n        <Button\n          onClick={cancelAddComment}\n          className=\"CommentPlugin_CommentInputBox_Button\"\n        >\n          {t('action:Cancel')}\n        </Button>\n        <Button\n          onClick={submitComment}\n          disabled={!canSubmit}\n          className=\"CommentPlugin_CommentInputBox_Button primary\"\n        >\n          {t('action:Comment')}\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nfunction CommentsComposer({\n  submitAddComment,\n  thread,\n  placeholder,\n}: {\n  placeholder?: string;\n  submitAddComment: (\n    commentOrThread: Comment,\n    isInlineComment: boolean,\n    // eslint-disable-next-line no-shadow\n    thread?: Thread\n  ) => void;\n  thread?: Thread;\n}) {\n  const [content, setContent] = useState('');\n  const [canSubmit, setCanSubmit] = useState(false);\n  const editorRef = useRef<LexicalEditor>(null);\n  const author = useCollabAuthorName();\n\n  const onChange = useOnChange(setContent, setCanSubmit);\n\n  const submitComment = () => {\n    if (canSubmit) {\n      submitAddComment(createComment(content, author), false, thread);\n      const editor = editorRef.current;\n      if (editor !== null) {\n        editor.dispatchCommand(CLEAR_EDITOR_COMMAND, undefined);\n      }\n    }\n  };\n\n  return (\n    <>\n      <PlainTextEditor\n        className=\"CommentPlugin_CommentsPanel_Editor\"\n        autoFocus={false}\n        onEscape={() => {\n          return true;\n        }}\n        onChange={onChange}\n        editorRef={editorRef}\n        placeholder={placeholder}\n      />\n      <Button\n        className=\"CommentPlugin_CommentsPanel_SendButton\"\n        onClick={submitComment}\n        disabled={!canSubmit}\n      >\n        <i className=\"send\" />\n      </Button>\n    </>\n  );\n}\n\nfunction ShowDeleteCommentOrThreadDialog({\n  commentOrThread,\n  deleteCommentOrThread,\n  onClose,\n  thread = undefined,\n  t,\n}: {\n  commentOrThread: Comment | Thread;\n\n  deleteCommentOrThread: (\n    comment: Comment | Thread,\n    // eslint-disable-next-line no-shadow\n    thread?: Thread\n  ) => void;\n  onClose: () => void;\n  thread?: Thread;\n  t: TFunction;\n}): JSX.Element {\n  return (\n    <>\n      {`${t('toolbar:commentPlugin.Delete_Comment_Description')} ${\n        commentOrThread.type\n      }?`}\n      <div className=\"Modal__content\">\n        <Button\n          onClick={() => {\n            deleteCommentOrThread(commentOrThread, thread);\n            onClose();\n          }}\n        >\n          {t('action:Delete')}\n        </Button>{' '}\n        <Button\n          onClick={() => {\n            onClose();\n          }}\n        >\n          {t('action:Cancel')}\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction CommentsPanelListComment({\n  comment,\n  deleteComment,\n  thread,\n  rtf,\n  t,\n}: {\n  comment: Comment;\n  deleteComment: (\n    commentOrThread: Comment | Thread,\n    // eslint-disable-next-line no-shadow\n    thread?: Thread\n  ) => void;\n  thread?: Thread;\n  rtf: null; //FIXME: Intl.RelativeTimeFormat gives build error;\n  t: TFunction;\n}): JSX.Element {\n  const seconds = Math.round((comment.timeStamp - performance.now()) / 1000);\n  const minutes = Math.round(seconds / 60);\n  const [modal, showModal] = useModal();\n\n  return (\n    <li className=\"CommentPlugin_CommentsPanel_List_Comment\">\n      <div className=\"CommentPlugin_CommentsPanel_List_Details\">\n        <span className=\"CommentPlugin_CommentsPanel_List_Comment_Author\">\n          {comment.author}\n        </span>\n        <span className=\"CommentPlugin_CommentsPanel_List_Comment_Time\">\n          {/* · {seconds > -10 ? 'Just now' : rtf.format(minutes, 'minute')} */}\n        </span>\n      </div>\n      <p\n        className={\n          comment.deleted ? 'CommentPlugin_CommentsPanel_DeletedComment' : ''\n        }\n      >\n        {comment.content}\n      </p>\n      {!comment.deleted && (\n        <>\n          <Button\n            onClick={() => {\n              showModal(\n                t('toolbar:commentPlugin.Delete_Comment'),\n                (onClose) => (\n                  <ShowDeleteCommentOrThreadDialog\n                    commentOrThread={comment}\n                    deleteCommentOrThread={deleteComment}\n                    thread={thread}\n                    onClose={onClose}\n                    t={t}\n                  />\n                )\n              );\n            }}\n            className=\"CommentPlugin_CommentsPanel_List_DeleteButton\"\n          >\n            <i className=\"delete\" />\n          </Button>\n          {modal}\n        </>\n      )}\n    </li>\n  );\n}\n\nfunction CommentsPanelList({\n  activeIDs,\n  comments,\n  deleteCommentOrThread,\n  listRef,\n  markNodeMap,\n  submitAddComment,\n  t,\n}: {\n  activeIDs: Array<string>;\n  comments: Comments;\n  deleteCommentOrThread: (\n    commentOrThread: Comment | Thread,\n    thread?: Thread\n  ) => void;\n  listRef: { current: null | HTMLUListElement };\n  markNodeMap: Map<string, Set<NodeKey>>;\n  submitAddComment: (\n    commentOrThread: Comment | Thread,\n    isInlineComment: boolean,\n    thread?: Thread\n  ) => void;\n  t: TFunction;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const [counter, setCounter] = useState(0);\n  const [modal, showModal] = useModal();\n  // const rtf = useMemo(\n  //   () =>\n  //     new Intl.RelativeTimeFormat('en', {\n  //       localeMatcher: 'best fit',\n  //       numeric: 'auto',\n  //       style: 'short',\n  //     }),\n  //   []\n  // ); //FIXME: it is closed to fix a build error\n  const rtf = null;\n\n  useEffect(() => {\n    // Used to keep the time stamp up to date\n    const id = setTimeout(() => {\n      setCounter(counter + 1);\n    }, 10000);\n\n    return () => {\n      clearTimeout(id);\n    };\n  }, [counter]);\n\n  return (\n    <ul className=\"CommentPlugin_CommentsPanel_List\" ref={listRef}>\n      {comments.map((commentOrThread) => {\n        const id = commentOrThread.id;\n        if (commentOrThread.type === 'thread') {\n          const handleClickThread = () => {\n            const markNodeKeys = markNodeMap.get(id);\n            if (\n              markNodeKeys !== undefined &&\n              (activeIDs === null || activeIDs.indexOf(id) === -1)\n            ) {\n              const activeElement = document.activeElement;\n              // Move selection to the start of the mark, so that we\n              // update the UI with the selected thread.\n              editor.update(\n                () => {\n                  const markNodeKey = Array.from(markNodeKeys)[0];\n                  const markNode = $getNodeByKey<MarkNode>(markNodeKey);\n                  if ($isMarkNode(markNode)) {\n                    markNode.selectStart();\n                  }\n                },\n                {\n                  onUpdate() {\n                    // Restore selection to the previous element\n                    if (activeElement !== null) {\n                      (activeElement as HTMLElement).focus();\n                    }\n                  },\n                }\n              );\n            }\n          };\n\n          return (\n            // eslint-disable-next-line jsx-a11y/no-noninteractive-element-interactions\n            <li\n              key={id}\n              onClick={handleClickThread}\n              className={`CommentPlugin_CommentsPanel_List_Thread ${\n                markNodeMap.has(id) ? 'interactive' : ''\n              } ${activeIDs.indexOf(id) === -1 ? '' : 'active'}`}\n            >\n              <div className=\"CommentPlugin_CommentsPanel_List_Thread_QuoteBox\">\n                <blockquote className=\"CommentPlugin_CommentsPanel_List_Thread_Quote\">\n                  {'> '}\n                  <span>{commentOrThread.quote}</span>\n                </blockquote>\n                {/* INTRODUCE DELETE THREAD HERE*/}\n                <Button\n                  onClick={() => {\n                    showModal(\n                      t('toolbar:commentPlugin.Delete_Thread'),\n                      (onClose) => (\n                        <ShowDeleteCommentOrThreadDialog\n                          commentOrThread={commentOrThread}\n                          deleteCommentOrThread={deleteCommentOrThread}\n                          onClose={onClose}\n                          t={t}\n                        />\n                      )\n                    );\n                  }}\n                  className=\"CommentPlugin_CommentsPanel_List_DeleteButton\"\n                >\n                  <i className=\"delete\" />\n                </Button>\n                {modal}\n              </div>\n              <ul className=\"CommentPlugin_CommentsPanel_List_Thread_Comments\">\n                {commentOrThread.comments.map((comment) => (\n                  <CommentsPanelListComment\n                    key={comment.id}\n                    comment={comment}\n                    deleteComment={deleteCommentOrThread}\n                    thread={commentOrThread}\n                    rtf={rtf}\n                    t={t}\n                  />\n                ))}\n              </ul>\n              <div className=\"CommentPlugin_CommentsPanel_List_Thread_Editor\">\n                <CommentsComposer\n                  submitAddComment={submitAddComment}\n                  thread={commentOrThread}\n                  placeholder={t('toolbar:commentPlugin.Reply_to_comment')}\n                />\n              </div>\n            </li>\n          );\n        }\n        return (\n          <CommentsPanelListComment\n            key={id}\n            comment={commentOrThread}\n            deleteComment={deleteCommentOrThread}\n            rtf={rtf}\n            t={t}\n          />\n        );\n      })}\n    </ul>\n  );\n}\n\nfunction CommentsPanel({\n  activeIDs,\n  deleteCommentOrThread,\n  comments,\n  markNodeMap,\n  submitAddComment,\n  t,\n}: {\n  activeIDs: Array<string>;\n  comments: Comments;\n  deleteCommentOrThread: (\n    commentOrThread: Comment | Thread,\n    thread?: Thread\n  ) => void;\n  markNodeMap: Map<string, Set<NodeKey>>;\n  submitAddComment: (\n    commentOrThread: Comment | Thread,\n    isInlineComment: boolean,\n    thread?: Thread\n  ) => void;\n  t: TFunction;\n}): JSX.Element {\n  const listRef = useRef<HTMLUListElement>(null);\n  const isEmpty = comments.length === 0;\n\n  return (\n    <div className=\"CommentPlugin_CommentsPanel\">\n      <h2 className=\"CommentPlugin_CommentsPanel_Heading\">\n        {t('toolbar:commentPlugin.Comments')}\n      </h2>\n      {isEmpty ? (\n        <div className=\"CommentPlugin_CommentsPanel_Empty\">\n          {t('toolbar:commentPlugin.No_Comments')}\n        </div>\n      ) : (\n        <CommentsPanelList\n          activeIDs={activeIDs}\n          comments={comments}\n          deleteCommentOrThread={deleteCommentOrThread}\n          listRef={listRef}\n          submitAddComment={submitAddComment}\n          markNodeMap={markNodeMap}\n          t={t}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction useCollabAuthorName(): string {\n  const collabContext = useCollaborationContext();\n  const { yjsDocMap, name } = collabContext;\n  return yjsDocMap.has('comments') ? name : 'Playground User';\n}\n\nexport default function CommentPlugin({\n  providerFactory,\n}: {\n  providerFactory?: (\n    id: string,\n    yjsDocMap: Map<string, Doc>\n  ) => WebsocketProvider;\n}): JSX.Element {\n  const collabContext = useCollaborationContext();\n  const [editor] = useLexicalComposerContext();\n  const commentStore = useMemo(() => new CommentStore(editor), [editor]);\n  const comments = useCommentStore(commentStore);\n  const markNodeMap = useMemo<Map<string, Set<NodeKey>>>(() => {\n    return new Map();\n  }, []);\n  const [activeAnchorKey, setActiveAnchorKey] = useState<NodeKey | null>();\n  const [activeIDs, setActiveIDs] = useState<Array<string>>([]);\n  const [showCommentInput, setShowCommentInput] = useState(false);\n  const [showComments, setShowComments] = useState(false);\n  const { yjsDocMap } = collabContext;\n  const { t } = useTranslation(['toolbar']);\n\n  useEffect(() => {\n    if (providerFactory) {\n      const provider = providerFactory('comments', yjsDocMap);\n      return commentStore.registerCollaboration(provider);\n    }\n  }, [commentStore, providerFactory, yjsDocMap]);\n\n  const cancelAddComment = useCallback(() => {\n    editor.update(() => {\n      const selection = $getSelection();\n      // Restore selection\n      if (selection !== null) {\n        selection.dirty = true;\n      }\n    });\n    setShowCommentInput(false);\n  }, [editor]);\n\n  const deleteCommentOrThread = useCallback(\n    (comment: Comment | Thread, thread?: Thread) => {\n      if (comment.type === 'comment') {\n        const deletionInfo = commentStore.deleteCommentOrThread(\n          comment,\n          thread\n        );\n        if (!deletionInfo) return;\n        const { markedComment, index } = deletionInfo;\n        commentStore.addComment(markedComment, thread, index);\n      } else {\n        commentStore.deleteCommentOrThread(comment);\n        // Remove ids from associated marks\n        const id = thread !== undefined ? thread.id : comment.id;\n        const markNodeKeys = markNodeMap.get(id);\n        if (markNodeKeys !== undefined) {\n          // Do async to avoid causing a React infinite loop\n          setTimeout(() => {\n            editor.update(() => {\n              for (const key of markNodeKeys) {\n                const node: null | MarkNode = $getNodeByKey(key);\n                if ($isMarkNode(node)) {\n                  node.deleteID(id);\n                  if (node.getIDs().length === 0) {\n                    $unwrapMarkNode(node);\n                  }\n                }\n              }\n            });\n          });\n        }\n      }\n    },\n    [commentStore, editor, markNodeMap]\n  );\n\n  const submitAddComment = useCallback(\n    (\n      commentOrThread: Comment | Thread,\n      isInlineComment: boolean,\n      thread?: Thread\n    ) => {\n      commentStore.addComment(commentOrThread, thread);\n      if (isInlineComment) {\n        editor.update(() => {\n          const selection = $getSelection();\n          if ($isRangeSelection(selection)) {\n            const focus = selection.focus;\n            const anchor = selection.anchor;\n            const isBackward = selection.isBackward();\n            const id = commentOrThread.id;\n\n            // Wrap content in a MarkNode\n            $wrapSelectionInMarkNode(selection, isBackward, id);\n\n            // Make selection collapsed at the end\n            if (isBackward) {\n              focus.set(anchor.key, anchor.offset, anchor.type);\n            } else {\n              anchor.set(focus.key, focus.offset, focus.type);\n            }\n          }\n        });\n        setShowCommentInput(false);\n      }\n    },\n    [commentStore, editor]\n  );\n\n  useEffect(() => {\n    const changedElems: Array<HTMLElement> = [];\n    for (let i = 0; i < activeIDs.length; i++) {\n      const id = activeIDs[i];\n      const keys = markNodeMap.get(id);\n      if (keys !== undefined) {\n        for (const key of keys) {\n          const elem = editor.getElementByKey(key);\n          if (elem !== null) {\n            elem.classList.add('selected');\n            changedElems.push(elem);\n            setShowComments(true);\n          }\n        }\n      }\n    }\n    return () => {\n      for (let i = 0; i < changedElems.length; i++) {\n        const changedElem = changedElems[i];\n        changedElem.classList.remove('selected');\n      }\n    };\n  }, [activeIDs, editor, markNodeMap]);\n\n  useEffect(() => {\n    const markNodeKeysToIDs: Map<NodeKey, Array<string>> = new Map();\n\n    return mergeRegister(\n      registerNestedElementResolver<MarkNode>(\n        editor,\n        MarkNode,\n        (from: MarkNode) => {\n          return $createMarkNode(from.getIDs());\n        },\n        (from: MarkNode, to: MarkNode) => {\n          // Merge the IDs\n          const ids = from.getIDs();\n          ids.forEach((id) => {\n            to.addID(id);\n          });\n        }\n      ),\n      editor.registerMutationListener(MarkNode, (mutations) => {\n        editor.getEditorState().read(() => {\n          for (const [key, mutation] of mutations) {\n            const node: null | MarkNode = $getNodeByKey(key);\n            let ids: NodeKey[] = [];\n\n            if (mutation === 'destroyed') {\n              ids = markNodeKeysToIDs.get(key) || [];\n            } else if ($isMarkNode(node)) {\n              ids = node.getIDs();\n            }\n\n            for (let i = 0; i < ids.length; i++) {\n              const id = ids[i];\n              let markNodeKeys = markNodeMap.get(id);\n              markNodeKeysToIDs.set(key, ids);\n\n              if (mutation === 'destroyed') {\n                if (markNodeKeys !== undefined) {\n                  markNodeKeys.delete(key);\n                  if (markNodeKeys.size === 0) {\n                    markNodeMap.delete(id);\n                  }\n                }\n              } else {\n                if (markNodeKeys === undefined) {\n                  markNodeKeys = new Set();\n                  markNodeMap.set(id, markNodeKeys);\n                }\n                if (!markNodeKeys.has(key)) {\n                  markNodeKeys.add(key);\n                }\n              }\n            }\n          }\n        });\n      }),\n      editor.registerUpdateListener(({ editorState, tags }) => {\n        editorState.read(() => {\n          const selection = $getSelection();\n          let hasActiveIds = false;\n          let hasAnchorKey = false;\n\n          if ($isRangeSelection(selection)) {\n            const anchorNode = selection.anchor.getNode();\n\n            if ($isTextNode(anchorNode)) {\n              const commentIDs = $getMarkIDs(\n                anchorNode,\n                selection.anchor.offset\n              );\n              if (commentIDs !== null) {\n                setActiveIDs(commentIDs);\n                hasActiveIds = true;\n              }\n              if (!selection.isCollapsed()) {\n                setActiveAnchorKey(anchorNode.getKey());\n                hasAnchorKey = true;\n              }\n            }\n          }\n          if (!hasActiveIds) {\n            setActiveIDs((_activeIds) =>\n              _activeIds.length === 0 ? _activeIds : []\n            );\n          }\n          if (!hasAnchorKey) {\n            setActiveAnchorKey(null);\n          }\n        });\n        if (!tags.has('collaboration')) {\n          setShowCommentInput(false);\n        }\n      }),\n      editor.registerCommand(\n        INSERT_INLINE_COMMAND,\n        () => {\n          const domSelection = window.getSelection();\n          if (domSelection !== null) {\n            domSelection.removeAllRanges();\n          }\n          setShowCommentInput(true);\n          return true;\n        },\n        COMMAND_PRIORITY_EDITOR\n      )\n    );\n  }, [editor, markNodeMap]);\n\n  const onAddComment = () => {\n    editor.dispatchCommand(INSERT_INLINE_COMMAND, undefined);\n  };\n\n  return (\n    <>\n      {showCommentInput &&\n        createPortal(\n          <CommentInputBox\n            editor={editor}\n            cancelAddComment={cancelAddComment}\n            submitAddComment={submitAddComment}\n            t={t}\n          />,\n          document.body\n        )}\n      {activeAnchorKey !== null &&\n        activeAnchorKey !== undefined &&\n        !showCommentInput &&\n        createPortal(\n          <AddCommentBox\n            anchorKey={activeAnchorKey}\n            editor={editor}\n            onAddComment={onAddComment}\n          />,\n          document.body\n        )}\n      {createPortal(\n        <Button\n          className={`CommentPlugin_ShowCommentsButton ${\n            showComments ? 'active' : ''\n          }`}\n          onClick={() => setShowComments(!showComments)}\n          title={\n            showComments\n              ? t('toolbar:commentPlugin.Hide_Comments')\n              : t('toolbar:commentPlugin.Show_Comments')\n          }\n        >\n          <i className=\"comments\" />\n        </Button>,\n        document.body\n      )}\n      {showComments &&\n        createPortal(\n          <CommentsPanel\n            comments={comments}\n            submitAddComment={submitAddComment}\n            deleteCommentOrThread={deleteCommentOrThread}\n            activeIDs={activeIDs}\n            markNodeMap={markNodeMap}\n            t={t}\n          />,\n          document.body\n        )}\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { $isCodeHighlightNode } from '@lexical/code';\nimport { $isLinkNode, TOGGLE_LINK_COMMAND } from '@lexical/link';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $isAtNodeEnd } from '@lexical/selection';\nimport { mergeRegister } from '@lexical/utils';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $isTextNode,\n  COMMAND_PRIORITY_LOW,\n  ElementNode,\n  FORMAT_TEXT_COMMAND,\n  LexicalEditor,\n  RangeSelection,\n  SELECTION_CHANGE_COMMAND,\n  TextNode,\n} from 'lexical';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\n\nimport { INSERT_INLINE_COMMAND } from './CommentPlugin';\nimport { useTranslation } from 'react-i18next';\nimport { TFunction } from 'i18next';\n\nfunction setPopupPosition(\n  editor: HTMLElement,\n  rect: ClientRect,\n  rootElementRect: ClientRect\n): void {\n  let top = rect.top - 8 + window.pageYOffset;\n  let left =\n    rect.left + 340 + window.pageXOffset - editor.offsetWidth + rect.width;\n  if (\n    rect.width >= rootElementRect.width - 20 ||\n    left > rootElementRect.width - 150\n  ) {\n    left = rect.left;\n    top = rect.top - 50 + window.pageYOffset;\n  }\n  if (top < rootElementRect.top) {\n    top = rect.bottom + 20;\n  }\n  editor.style.opacity = '1';\n  editor.style.top = `${top}px`;\n  editor.style.left = `${left}px`;\n}\n\nfunction FloatingCharacterStylesEditor({\n  editor,\n  isLink,\n  isBold,\n  isItalic,\n  isUnderline,\n  isCode,\n  isStrikethrough,\n  isSubscript,\n  isSuperscript,\n  t,\n}: {\n  editor: LexicalEditor;\n  isBold: boolean;\n  isCode: boolean;\n  isItalic: boolean;\n  isLink: boolean;\n  isStrikethrough: boolean;\n  isSubscript: boolean;\n  isSuperscript: boolean;\n  isUnderline: boolean;\n  t: TFunction;\n}): JSX.Element {\n  const popupCharStylesEditorRef = useRef<HTMLDivElement | null>(null);\n  const mouseDownRef = useRef(false);\n\n  const insertLink = useCallback(() => {\n    if (!isLink) {\n      editor.dispatchCommand(TOGGLE_LINK_COMMAND, 'https://');\n    } else {\n      editor.dispatchCommand(TOGGLE_LINK_COMMAND, null);\n    }\n  }, [editor, isLink]);\n\n  const insertComment = () => {\n    editor.dispatchCommand(INSERT_INLINE_COMMAND, null);\n  };\n\n  const updateCharacterStylesEditor = useCallback(() => {\n    const selection = $getSelection();\n\n    const popupCharStylesEditorElem = popupCharStylesEditorRef.current;\n    const nativeSelection = window.getSelection();\n\n    if (popupCharStylesEditorElem === null) {\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n    if (\n      selection !== null &&\n      nativeSelection !== null &&\n      !nativeSelection.isCollapsed &&\n      rootElement !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const domRange = nativeSelection.getRangeAt(0);\n      const rootElementRect = rootElement.getBoundingClientRect();\n      let rect;\n\n      if (nativeSelection.anchorNode === rootElement) {\n        let inner = rootElement;\n        while (inner.firstElementChild != null) {\n          inner = inner.firstElementChild as HTMLElement;\n        }\n        rect = inner.getBoundingClientRect();\n      } else {\n        rect = domRange.getBoundingClientRect();\n      }\n\n      if (!mouseDownRef.current) {\n        setPopupPosition(popupCharStylesEditorElem, rect, rootElementRect);\n      }\n    }\n  }, [editor]);\n\n  useEffect(() => {\n    const onResize = () => {\n      editor.getEditorState().read(() => {\n        updateCharacterStylesEditor();\n      });\n    };\n    window.addEventListener('resize', onResize);\n\n    return () => {\n      window.removeEventListener('resize', onResize);\n    };\n  }, [editor, updateCharacterStylesEditor]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      updateCharacterStylesEditor();\n    });\n    return mergeRegister(\n      editor.registerUpdateListener(({ editorState }) => {\n        editorState.read(() => {\n          updateCharacterStylesEditor();\n        });\n      }),\n\n      editor.registerCommand(\n        SELECTION_CHANGE_COMMAND,\n        () => {\n          updateCharacterStylesEditor();\n          return false;\n        },\n        COMMAND_PRIORITY_LOW\n      )\n    );\n  }, [editor, updateCharacterStylesEditor]);\n\n  return (\n    <div ref={popupCharStylesEditorRef} className=\"character-style-popup\">\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'bold');\n        }}\n        className={'popup-item spaced ' + (isBold ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Format_text_as_bold')}\n        type=\"button\"\n      >\n        <i className=\"format bold\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'italic');\n        }}\n        className={'popup-item spaced ' + (isItalic ? 'active' : '')}\n        aria-label={t(\n          'toolbar:characterStylesPopupPlugin.Format_text_as_italics'\n        )}\n        type=\"button\"\n      >\n        <i className=\"format italic\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'underline');\n        }}\n        className={'popup-item spaced ' + (isUnderline ? 'active' : '')}\n        aria-label={t(\n          'toolbar:characterStylesPopupPlugin.Format_text_to_underlined'\n        )}\n        type=\"button\"\n      >\n        <i className=\"format underline\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'strikethrough');\n        }}\n        className={'popup-item spaced ' + (isStrikethrough ? 'active' : '')}\n        aria-label={t(\n          'toolbar:characterStylesPopupPlugin.Format_text_with_a_strikethrough'\n        )}\n        type=\"button\"\n      >\n        <i className=\"format strikethrough\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'subscript');\n        }}\n        className={'popup-item spaced ' + (isSubscript ? 'active' : '')}\n        title=\"Subscript\"\n        aria-label={t('toolbar:characterStylesPopupPlugin.Format_Subscript')}\n        type=\"button\"\n      >\n        <i className=\"format subscript\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'superscript');\n        }}\n        className={'popup-item spaced ' + (isSuperscript ? 'active' : '')}\n        title=\"Superscript\"\n        aria-label={t('toolbar:characterStylesPopupPlugin.Format_Superscript')}\n        type=\"button\"\n      >\n        <i className=\"format superscript\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'code');\n        }}\n        className={'popup-item spaced ' + (isCode ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Insert_code_block')}\n        type=\"button\"\n      >\n        <i className=\"format code\" />\n      </button>\n      <button\n        onClick={insertLink}\n        className={'popup-item spaced ' + (isLink ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Insert_link')}\n        type=\"button\"\n      >\n        <i className=\"format link\" />\n      </button>\n      <button\n        onClick={insertComment}\n        className={'popup-item spaced ' + (isLink ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Add_comment')}\n        type=\"button\"\n      >\n        <i className=\"format add-comment\" />\n      </button>\n    </div>\n  );\n}\n\nfunction getSelectedNode(selection: RangeSelection): TextNode | ElementNode {\n  const anchor = selection.anchor;\n  const focus = selection.focus;\n  const anchorNode = selection.anchor.getNode();\n  const focusNode = selection.focus.getNode();\n  if (anchorNode === focusNode) {\n    return anchorNode;\n  }\n  const isBackward = selection.isBackward();\n  if (isBackward) {\n    return $isAtNodeEnd(focus) ? anchorNode : focusNode;\n  } else {\n    return $isAtNodeEnd(anchor) ? focusNode : anchorNode;\n  }\n}\n\nfunction useCharacterStylesPopup(editor: LexicalEditor): JSX.Element | null {\n  const [isText, setIsText] = useState(false);\n  const [isLink, setIsLink] = useState(false);\n  const [isBold, setIsBold] = useState(false);\n  const [isItalic, setIsItalic] = useState(false);\n  const [isUnderline, setIsUnderline] = useState(false);\n  const [isStrikethrough, setIsStrikethrough] = useState(false);\n  const [isSubscript, setIsSubscript] = useState(false);\n  const [isSuperscript, setIsSuperscript] = useState(false);\n  const [isCode, setIsCode] = useState(false);\n  const { t } = useTranslation(['toolbar']);\n\n  const updatePopup = useCallback(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n      const nativeSelection = window.getSelection();\n      const rootElement = editor.getRootElement();\n\n      if (\n        nativeSelection !== null &&\n        (!$isRangeSelection(selection) ||\n          rootElement === null ||\n          !rootElement.contains(nativeSelection.anchorNode))\n      ) {\n        setIsText(false);\n        return;\n      }\n\n      if (!$isRangeSelection(selection)) {\n        return;\n      }\n\n      const node = getSelectedNode(selection);\n\n      // Update text format\n      setIsBold(selection.hasFormat('bold'));\n      setIsItalic(selection.hasFormat('italic'));\n      setIsUnderline(selection.hasFormat('underline'));\n      setIsStrikethrough(selection.hasFormat('strikethrough'));\n      setIsSubscript(selection.hasFormat('subscript'));\n      setIsSuperscript(selection.hasFormat('superscript'));\n      setIsCode(selection.hasFormat('code'));\n\n      // Update links\n      const parent = node.getParent();\n      if ($isLinkNode(parent) || $isLinkNode(node)) {\n        setIsLink(true);\n      } else {\n        setIsLink(false);\n      }\n\n      if (\n        !$isCodeHighlightNode(selection.anchor.getNode()) &&\n        selection.getTextContent() !== ''\n      ) {\n        setIsText($isTextNode(node));\n      } else {\n        setIsText(false);\n      }\n    });\n  }, [editor]);\n\n  useEffect(() => {\n    document.addEventListener('selectionchange', updatePopup);\n    return () => {\n      document.removeEventListener('selectionchange', updatePopup);\n    };\n  }, [updatePopup]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      updatePopup();\n    });\n  }, [editor, updatePopup]);\n\n  if (!isText || isLink) {\n    return null;\n  }\n\n  return createPortal(\n    <FloatingCharacterStylesEditor\n      editor={editor}\n      isLink={isLink}\n      isBold={isBold}\n      isItalic={isItalic}\n      isStrikethrough={isStrikethrough}\n      isSubscript={isSubscript}\n      isSuperscript={isSuperscript}\n      isUnderline={isUnderline}\n      isCode={isCode}\n      t={t}\n    />,\n    document.body\n  );\n}\n\nexport default function CharacterStylesPopupPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n  return useCharacterStylesPopup(editor);\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LinkNode } from '@lexical/link';\nimport type { LexicalEditor } from 'lexical';\n\nimport { $isLinkNode } from '@lexical/link';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $getNearestNodeFromDOMNode } from 'lexical';\nimport { useEffect, useRef } from 'react';\n\ntype LinkFilter = (event: MouseEvent, linkNode: LinkNode) => boolean;\nexport default function ClickableLinkPlugin({\n  filter,\n  newTab = true,\n}: {\n  filter?: LinkFilter;\n  newTab?: boolean;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const hasMoved = useRef(false);\n  useEffect(() => {\n    let prevOffsetX;\n    let prevOffsetY;\n\n    function onPointerDown(event: PointerEvent) {\n      prevOffsetX = event.offsetX;\n      prevOffsetY = event.offsetY;\n    }\n\n    function onPointerUp(event: PointerEvent) {\n      hasMoved.current =\n        event.offsetX !== prevOffsetX || event.offsetY !== prevOffsetY;\n    }\n\n    function onClick(e: Event) {\n      // Based on pointerdown/up we can check if cursor moved during click event,\n      // and ignore clicks with moves (to allow link text selection)\n      const hasMovedDuringClick = hasMoved.current;\n      hasMoved.current = false;\n      // $FlowExpectedError[incompatible-cast] onClick handler will get MouseEvent, safe to cast\n      const event = e as MouseEvent;\n      const linkDomNode = getLinkDomNode(event, editor);\n\n      if (linkDomNode === null) {\n        return;\n      }\n\n      const href = linkDomNode.getAttribute('href');\n\n      if (\n        linkDomNode.getAttribute('contenteditable') === 'false' ||\n        href === undefined\n      ) {\n        return;\n      }\n\n      let linkNode = null;\n      editor.update(() => {\n        const maybeLinkNode = $getNearestNodeFromDOMNode(linkDomNode);\n\n        if ($isLinkNode(maybeLinkNode)) {\n          linkNode = maybeLinkNode;\n        }\n      });\n\n      if (\n        linkNode === null ||\n        (filter !== undefined && !filter(event, linkNode))\n      ) {\n        return;\n      }\n\n      if (hasMovedDuringClick) {\n        return;\n      }\n\n      try {\n        window.open(\n          href,\n          newTab || event.metaKey || event.ctrlKey ? '_blank' : '_self'\n        );\n      } catch {\n        // It didn't work, which is better than throwing an exception!\n      }\n    }\n\n    return editor.registerRootListener(\n      (\n        rootElement: null | HTMLElement,\n        prevRootElement: null | HTMLElement\n      ) => {\n        if (prevRootElement !== null) {\n          prevRootElement.removeEventListener('pointerdown', onPointerDown);\n          prevRootElement.removeEventListener('pointerup', onPointerUp);\n          prevRootElement.removeEventListener('click', onClick);\n        }\n\n        if (rootElement !== null) {\n          rootElement.addEventListener('click', onClick);\n          rootElement.addEventListener('pointerdown', onPointerDown);\n          rootElement.addEventListener('pointerup', onPointerUp);\n        }\n      }\n    );\n  }, [editor, filter, newTab]);\n  return null;\n}\n\nfunction isLinkDomNode(domNode: Node): boolean {\n  return domNode.nodeName.toLowerCase() === 'a';\n}\n\nfunction getLinkDomNode(\n  event: MouseEvent,\n  editor: LexicalEditor\n): HTMLAnchorElement | null {\n  return editor.getEditorState().read(() => {\n    // $FlowExpectedError[incompatible-cast]\n    const domNode = event.target as Node;\n\n    if (isLinkDomNode(domNode)) {\n      // $FlowExpectedError[incompatible-cast]\n      return domNode as HTMLAnchorElement;\n    }\n\n    if (domNode.parentNode && isLinkDomNode(domNode.parentNode)) {\n      // $FlowExpectedError[incompatible-cast]\n      return domNode.parentNode as HTMLAnchorElement;\n    }\n\n    return null;\n  });\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { registerCodeHighlighting } from '@lexical/code';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { useEffect } from 'react';\n\nexport default function CodeHighlightPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return registerCodeHighlighting(editor);\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalEditor } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { TextNode } from 'lexical';\nimport { useEffect } from 'react';\n\nimport { $createEmojiNode, EmojiNode } from '../nodes/EmojiNode';\n\nconst emojis: Map<string, [string, string]> = new Map([\n  [':)', ['emoji happysmile', '🙂']],\n  [':D', ['emoji veryhappysmile', '😀']],\n  [':(', ['emoji unhappysmile', '🙁']],\n  ['<3', ['emoji heart', '❤']],\n  ['🙂', ['emoji happysmile', '🙂']],\n  ['😀', ['emoji veryhappysmile', '😀']],\n  ['🙁', ['emoji unhappysmile', '🙁']],\n  ['❤', ['emoji heart', '❤']],\n]);\n\nfunction findAndTransformEmoji(node: TextNode): null | TextNode {\n  const text = node.getTextContent();\n\n  for (let i = 0; i < text.length; i++) {\n    const emojiData = emojis.get(text[i]) || emojis.get(text.slice(i, i + 2));\n\n    if (emojiData !== undefined) {\n      const [emojiStyle, emojiText] = emojiData;\n      let targetNode;\n\n      if (i === 0) {\n        [targetNode] = node.splitText(i + 2);\n      } else {\n        [, targetNode] = node.splitText(i, i + 2);\n      }\n\n      const emojiNode = $createEmojiNode(emojiStyle, emojiText);\n      targetNode.replace(emojiNode);\n      return emojiNode;\n    }\n  }\n\n  return null;\n}\n\nfunction textNodeTransform(node: TextNode): void {\n  let targetNode = node;\n\n  while (targetNode !== null) {\n    if (!targetNode.isSimpleText()) {\n      return;\n    }\n\n    targetNode = findAndTransformEmoji(targetNode);\n  }\n}\n\nfunction useEmojis(editor: LexicalEditor): void {\n  useEffect(() => {\n    if (!editor.hasNodes([EmojiNode])) {\n      throw new Error('EmojisPlugin: EmojiNode not registered on editor');\n    }\n\n    return editor.registerNodeTransform(TextNode, textNodeTransform);\n  }, [editor]);\n}\n\nexport default function EmojisPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  useEmojis(editor);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { TextNode } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { useLexicalTextEntity } from '@lexical/react/useLexicalTextEntity';\nimport { useCallback, useEffect } from 'react';\n\nimport { $createKeywordNode, KeywordNode } from '../nodes/KeywordNode';\n\nconst KEYWORDS_REGEX =\n  /(^|$|[^A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ])(congrats|congratulations|gratuluju|gratuluji|gratulujeme|blahopřeju|blahopřeji|blahopřejeme|Til lykke|Tillykke|Glückwunsch|Gratuliere|felicitaciones|enhorabuena|paljon onnea|onnittelut|Félicitations|gratula|gratulálok|gratulálunk|congratulazioni|complimenti|おめでとう|おめでとうございます|축하해|축하해요|gratulerer|Gefeliciteerd|gratulacje|Parabéns|parabéns|felicitações|felicitări|мои поздравления|поздравляем|поздравляю|gratulujem|blahoželám|ยินดีด้วย|ขอแสดงความยินดี|tebrikler|tebrik ederim|恭喜|祝贺你|恭喜你|恭喜|恭喜|baie geluk|veels geluk|অভিনন্দন|Čestitam|Čestitke|Čestitamo|Συγχαρητήρια|Μπράβο|અભિનંદન|badhai|बधाई|अभिनंदन|Честитам|Свака част|hongera|வாழ்த்துகள்|வாழ்த்துக்கள்|అభినందనలు|അഭിനന്ദനങ്ങൾ|Chúc mừng|מזל טוב|mazel tov|mazal tov)(^|$|[^A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ])/i;\n\nexport default function KeywordsPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([KeywordNode])) {\n      throw new Error('KeywordsPlugin: KeywordNode not registered on editor');\n    }\n  }, [editor]);\n\n  const createKeywordNode = useCallback((textNode: TextNode): KeywordNode => {\n    return $createKeywordNode(textNode.getTextContent());\n  }, []);\n\n  const getKeywordMatch = useCallback((text: string) => {\n    const matchArr = KEYWORDS_REGEX.exec(text);\n\n    if (matchArr === null) {\n      return null;\n    }\n\n    const hashtagLength = matchArr[2].length;\n    const startOffset = matchArr.index + matchArr[1].length;\n    const endOffset = startOffset + hashtagLength;\n    return {\n      end: endOffset,\n      start: startOffset,\n    };\n  }, []);\n\n  useLexicalTextEntity<KeywordNode>(\n    getKeywordMatch,\n    KeywordNode,\n    createKeywordNode\n  );\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { RangeSelection } from 'lexical';\n\nimport { $getListDepth, $isListItemNode, $isListNode } from '@lexical/list';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isElementNode,\n  $isRangeSelection,\n  COMMAND_PRIORITY_CRITICAL,\n  ElementNode,\n  INDENT_CONTENT_COMMAND,\n} from 'lexical';\nimport { useEffect } from 'react';\n\ntype Props = Readonly<{\n  maxDepth: number | null | undefined;\n}>;\n\nfunction getElementNodesInSelection(\n  selection: RangeSelection\n): Set<ElementNode> {\n  const nodesInSelection = selection.getNodes();\n\n  if (nodesInSelection.length === 0) {\n    return new Set([\n      selection.anchor.getNode().getParentOrThrow(),\n      selection.focus.getNode().getParentOrThrow(),\n    ]);\n  }\n\n  return new Set(\n    nodesInSelection.map((n) => ($isElementNode(n) ? n : n.getParentOrThrow()))\n  );\n}\n\nfunction isIndentPermitted(maxDepth: number): boolean {\n  const selection = $getSelection();\n\n  if (!$isRangeSelection(selection)) {\n    return false;\n  }\n\n  const elementNodesInSelection: Set<ElementNode> =\n    getElementNodesInSelection(selection);\n\n  let totalDepth = 0;\n\n  for (const elementNode of elementNodesInSelection) {\n    if ($isListNode(elementNode)) {\n      totalDepth = Math.max($getListDepth(elementNode) + 1, totalDepth);\n    } else if ($isListItemNode(elementNode)) {\n      const parent = elementNode.getParent();\n\n      if (!$isListNode(parent)) {\n        throw new Error(\n          'ListMaxIndentLevelPlugin: A ListItemNode must have a ListNode for a parent.'\n        );\n      }\n\n      totalDepth = Math.max($getListDepth(parent) + 1, totalDepth);\n    }\n  }\n\n  return totalDepth <= maxDepth;\n}\n\nexport default function ListMaxIndentLevelPlugin({ maxDepth }: Props): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      INDENT_CONTENT_COMMAND,\n      () => !isIndentPermitted(maxDepth ?? 7),\n      COMMAND_PRIORITY_CRITICAL\n    );\n  }, [editor, maxDepth]);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n *\n */\n\nimport { MarkdownShortcutPlugin } from '@lexical/react/LexicalMarkdownShortcutPlugin';\nimport * as React from 'react';\n\nimport { PLAYGROUND_TRANSFORMERS } from './MarkdownTransformers';\n\nexport default function MarkdownPlugin(): JSX.Element {\n  return <MarkdownShortcutPlugin transformers={PLAYGROUND_TRANSFORMERS} />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $setSelection,\n  FOCUS_COMMAND,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nconst COMMAND_PRIORITY_LOW = 1;\nconst TAB_TO_FOCUS_INTERVAL = 100;\n\nlet lastTabKeyDownTimestamp = 0;\nlet hasRegisteredKeyDownListener = false;\n\nfunction registerKeyTimeStampTracker() {\n  window.addEventListener(\n    'keydown',\n    (event: KeyboardEvent) => {\n      // Tab\n      if (event.keyCode === 9) {\n        lastTabKeyDownTimestamp = event.timeStamp;\n      }\n    },\n    true\n  );\n}\n\nexport default function TabFocusPlugin(): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!hasRegisteredKeyDownListener) {\n      registerKeyTimeStampTracker();\n      hasRegisteredKeyDownListener = true;\n    }\n\n    return editor.registerCommand(\n      FOCUS_COMMAND,\n      (event: FocusEvent) => {\n        const selection = $getSelection();\n        if ($isRangeSelection(selection)) {\n          if (\n            lastTabKeyDownTimestamp + TAB_TO_FOCUS_INTERVAL >\n            event.timeStamp\n          ) {\n            $setSelection(selection.clone());\n          }\n        }\n        return false;\n      },\n      COMMAND_PRIORITY_LOW\n    );\n  }, [editor]);\n\n  return null;\n}\n","import { LexicalEditor } from 'lexical';\nimport React, { createContext } from 'react';\n\ninterface IEditorContext {\n  initialEditor: LexicalEditor;\n  activeEditor: LexicalEditor;\n  setActiveEditor: React.Dispatch<React.SetStateAction<LexicalEditor>>;\n}\n\nconst EditorContext = createContext<IEditorContext | null>(null);\n\nexport default EditorContext;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Input.css';\n\nimport * as React from 'react';\n\ntype Props = Readonly<{\n  'data-test-id'?: string;\n  accept?: string;\n  label: string;\n  onChange: (files: FileList) => void;\n}>;\n\nexport default function FileInput({\n  accept,\n  label,\n  onChange,\n  'data-test-id': dataTestId,\n}: Props): JSX.Element {\n  return (\n    <div className=\"Input__wrapper\">\n      <label className=\"Input__label\">{label}</label>\n      <input\n        type=\"file\"\n        accept={accept}\n        className=\"Input__input\"\n        onChange={(e) => onChange(e.target.files)}\n        data-test-id={dataTestId}\n      />\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Input.css';\n\nimport * as React from 'react';\n\ntype Props = Readonly<{\n  'data-test-id'?: string;\n  label: string;\n  onChange: (string) => void;\n  placeholder?: string;\n  value: string;\n}>;\n\nexport default function TextInput({\n  label,\n  value,\n  onChange,\n  placeholder = '',\n  'data-test-id': dataTestId,\n}: Props): JSX.Element {\n  return (\n    <div className=\"Input__wrapper\">\n      <label className=\"Input__label\">{label}</label>\n      <input\n        type=\"text\"\n        className=\"Input__input\"\n        placeholder={placeholder}\n        value={value}\n        onChange={(e) => {\n          onChange(e.target.value);\n        }}\n        data-test-id={dataTestId}\n      />\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $wrapNodeInElement, mergeRegister } from '@lexical/utils';\nimport {\n  $createParagraphNode,\n  $createRangeSelection,\n  $getSelection,\n  $insertNodes,\n  $isNodeSelection,\n  $isRootOrShadowRoot,\n  $setSelection,\n  COMMAND_PRIORITY_EDITOR,\n  COMMAND_PRIORITY_HIGH,\n  COMMAND_PRIORITY_LOW,\n  createCommand,\n  DRAGOVER_COMMAND,\n  DRAGSTART_COMMAND,\n  DROP_COMMAND,\n  LexicalCommand,\n  LexicalEditor,\n} from 'lexical';\nimport { useEffect, useRef, useState } from 'react';\nimport * as React from 'react';\n\nimport {\n  $createImageNode,\n  $isImageNode,\n  ImageNode,\n  ImagePayload,\n} from '../nodes/ImageNode';\nimport Button from '../ui/Button';\nimport { DialogActions, DialogButtonsList } from '../ui/Dialog';\nimport FileInput from '../ui/FileInput';\nimport TextInput from '../ui/TextInput';\n\nexport type InsertImagePayload = Readonly<ImagePayload>;\n\nexport const CAN_USE_DOM: boolean =\n  typeof window !== 'undefined' &&\n  typeof window.document !== 'undefined' &&\n  typeof window.document.createElement !== 'undefined';\n\nconst getDOMSelection = (targetWindow: Window | null): Selection | null =>\n  CAN_USE_DOM ? (targetWindow || window).getSelection() : null;\n\nexport const INSERT_IMAGE_COMMAND: LexicalCommand<InsertImagePayload> =\n  createCommand('INSERT_IMAGE_COMMAND');\n\nexport function InsertImageUriDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  return (\n    <>\n      <TextInput\n        label=\"Image URL\"\n        placeholder=\"i.e. https://source.unsplash.com/random\"\n        onChange={setSrc}\n        value={src}\n        data-test-id=\"image-modal-url-input\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Random unsplash image\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <DialogActions>\n        <Button\n          data-test-id=\"image-modal-confirm-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </DialogActions>\n    </>\n  );\n}\n\nexport function InsertImageUploadedDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  const loadImage = (files: FileList | null) => {\n    const reader = new FileReader();\n    reader.onload = function () {\n      if (typeof reader.result === 'string') {\n        setSrc(reader.result);\n      }\n      return '';\n    };\n    if (files !== null) {\n      reader.readAsDataURL(files[0]);\n    }\n  };\n\n  return (\n    <>\n      <FileInput\n        label=\"Image Upload\"\n        onChange={loadImage}\n        accept=\"image/*\"\n        data-test-id=\"image-modal-file-upload\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Descriptive alternative text\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <DialogActions>\n        <Button\n          data-test-id=\"image-modal-file-upload-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </DialogActions>\n    </>\n  );\n}\n\nexport function InsertImageDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [mode, setMode] = useState<null | 'url' | 'file'>(null);\n  const hasModifier = useRef(false);\n\n  useEffect(() => {\n    hasModifier.current = false;\n    const handler = (e: KeyboardEvent) => {\n      hasModifier.current = e.altKey;\n    };\n    document.addEventListener('keydown', handler);\n    return () => {\n      document.removeEventListener('keydown', handler);\n    };\n  }, [activeEditor]);\n\n  const onClick = (payload: InsertImagePayload) => {\n    activeEditor.dispatchCommand(INSERT_IMAGE_COMMAND, payload);\n    onClose();\n  };\n\n  return (\n    <>\n      {!mode && (\n        <DialogButtonsList>\n          <Button\n            data-test-id=\"image-modal-option-sample\"\n            onClick={() =>\n              onClick(\n                hasModifier.current\n                  ? {\n                      altText:\n                        'Daylight fir trees forest glacier green high ice landscape',\n                      src: '../images/landscape.jpg',\n                    }\n                  : {\n                      altText: 'Yellow flower in tilt shift lens',\n                      src: '../images/yellow-flower.jpg',\n                    }\n              )\n            }\n          >\n            Sample\n          </Button>\n          <Button\n            data-test-id=\"image-modal-option-url\"\n            onClick={() => setMode('url')}\n          >\n            URL\n          </Button>\n          <Button\n            data-test-id=\"image-modal-option-file\"\n            onClick={() => setMode('file')}\n          >\n            File\n          </Button>\n        </DialogButtonsList>\n      )}\n      {mode === 'url' && <InsertImageUriDialogBody onClick={onClick} />}\n      {mode === 'file' && <InsertImageUploadedDialogBody onClick={onClick} />}\n    </>\n  );\n}\n\nexport default function ImagesPlugin({\n  captionsEnabled,\n  maxWidth,\n}: {\n  captionsEnabled?: boolean;\n  maxWidth?: number;\n}): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([ImageNode])) {\n      throw new Error('ImagesPlugin: ImageNode not registered on editor');\n    }\n\n    return mergeRegister(\n      editor.registerCommand<InsertImagePayload>(\n        INSERT_IMAGE_COMMAND,\n        (payload) => {\n          const imageNode = $createImageNode({\n            ...payload,\n            maxWidth: maxWidth,\n          });\n          $insertNodes([imageNode]);\n          if ($isRootOrShadowRoot(imageNode.getParentOrThrow())) {\n            $wrapNodeInElement(imageNode, $createParagraphNode).selectEnd();\n          }\n\n          return true;\n        },\n        COMMAND_PRIORITY_EDITOR\n      ),\n      editor.registerCommand<DragEvent>(\n        DRAGSTART_COMMAND,\n        (event) => {\n          return onDragStart(event);\n        },\n        COMMAND_PRIORITY_HIGH\n      ),\n      editor.registerCommand<DragEvent>(\n        DRAGOVER_COMMAND,\n        (event) => {\n          return onDragover(event);\n        },\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand<DragEvent>(\n        DROP_COMMAND,\n        (event) => {\n          return onDrop(event, editor);\n        },\n        COMMAND_PRIORITY_HIGH\n      )\n    );\n  }, [captionsEnabled, editor]);\n\n  return null;\n}\n\nconst TRANSPARENT_IMAGE =\n  'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\nconst img = document.createElement('img');\nimg.src = TRANSPARENT_IMAGE;\n\nfunction onDragStart(event: DragEvent): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  const dataTransfer = event.dataTransfer;\n  if (!dataTransfer) {\n    return false;\n  }\n  dataTransfer.setData('text/plain', '_');\n  dataTransfer.setDragImage(img, 0, 0);\n  dataTransfer.setData(\n    'application/x-lexical-drag',\n    JSON.stringify({\n      data: {\n        altText: node.__altText,\n        caption: node.__caption,\n        height: node.__height,\n        key: node.getKey(),\n        maxWidth: node.__maxWidth,\n        showCaption: node.__showCaption,\n        src: node.__src,\n        width: node.__width,\n      },\n      type: 'image',\n    })\n  );\n\n  return true;\n}\n\nfunction onDragover(event: DragEvent): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  if (!canDropImage(event)) {\n    event.preventDefault();\n  }\n  return true;\n}\n\nfunction onDrop(event: DragEvent, editor: LexicalEditor): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  const data = getDragImageData(event);\n  if (!data) {\n    return false;\n  }\n  event.preventDefault();\n  if (canDropImage(event)) {\n    const range = getDragSelection(event);\n    node.remove();\n    const rangeSelection = $createRangeSelection();\n    if (range !== null && range !== undefined) {\n      rangeSelection.applyDOMRange(range);\n    }\n    $setSelection(rangeSelection);\n    editor.dispatchCommand(INSERT_IMAGE_COMMAND, data);\n  }\n  return true;\n}\n\nfunction getImageNodeInSelection(): ImageNode | null {\n  const selection = $getSelection();\n  if (!$isNodeSelection(selection)) {\n    return null;\n  }\n  const nodes = selection.getNodes();\n  const node = nodes[0];\n  return $isImageNode(node) ? node : null;\n}\n\nfunction getDragImageData(event: DragEvent): null | InsertImagePayload {\n  const dragData = event.dataTransfer?.getData('application/x-lexical-drag');\n  if (!dragData) {\n    return null;\n  }\n  const { type, data } = JSON.parse(dragData);\n  if (type !== 'image') {\n    return null;\n  }\n\n  return data;\n}\n\ndeclare global {\n  interface DragEvent {\n    rangeOffset?: number;\n    rangeParent?: Node;\n  }\n}\n\nfunction canDropImage(event: DragEvent): boolean {\n  const target = event.target;\n  return !!(\n    target &&\n    target instanceof HTMLElement &&\n    !target.closest('code, span.editor-image') &&\n    target.parentElement &&\n    target.parentElement.closest('div.ContentEditable__root')\n  );\n}\n\nfunction getDragSelection(event: DragEvent): Range | null | undefined {\n  let range;\n  const target = event.target as null | Element | Document;\n  const targetWindow =\n    target == null\n      ? null\n      : target.nodeType === 9\n      ? (target as Document).defaultView\n      : (target as Element).ownerDocument.defaultView;\n  const domSelection = getDOMSelection(targetWindow);\n  if (document.caretRangeFromPoint) {\n    range = document.caretRangeFromPoint(event.clientX, event.clientY);\n  } else if (event.rangeParent && domSelection !== null) {\n    domSelection.collapse(event.rangeParent, event.rangeOffset || 0);\n    range = domSelection.getRangeAt(0);\n  } else {\n    throw Error(`Cannot get the selection when dragging`);\n  }\n\n  return range;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { DRAG_DROP_PASTE } from '@lexical/rich-text';\nimport { isMimeType, mediaFileReader } from '@lexical/utils';\nimport { COMMAND_PRIORITY_LOW } from 'lexical';\nimport { useEffect } from 'react';\n\nimport { INSERT_IMAGE_COMMAND } from './ImagesPlugin';\n\nconst ACCEPTABLE_IMAGE_TYPES = [\n  'image/',\n  'image/heic',\n  'image/heif',\n  'image/gif',\n  'image/webp',\n];\n\nexport default function DragDropPaste(): null {\n  const [editor] = useLexicalComposerContext();\n  useEffect(() => {\n    return editor.registerCommand(\n      DRAG_DROP_PASTE,\n      (files) => {\n        (async () => {\n          const filesResult = await mediaFileReader(\n            files,\n            [ACCEPTABLE_IMAGE_TYPES].flatMap((x) => x)\n          );\n          for (const { file, result } of filesResult) {\n            if (isMimeType(file, ACCEPTABLE_IMAGE_TYPES)) {\n              editor.dispatchCommand(INSERT_IMAGE_COMMAND, {\n                altText: file.name,\n                src: result,\n              });\n            }\n          }\n        })();\n        return true;\n      },\n      COMMAND_PRIORITY_LOW\n    );\n  }, [editor]);\n  return null;\n}\n","import { $isAtNodeEnd } from '@lexical/selection';\nimport { ElementNode, RangeSelection, TextNode } from 'lexical';\n\nexport function getSelectedNode(\n  selection: RangeSelection\n): TextNode | ElementNode {\n  const anchor = selection.anchor;\n  const focus = selection.focus;\n  const anchorNode = selection.anchor.getNode();\n  const focusNode = selection.focus.getNode();\n  if (anchorNode === focusNode) {\n    return anchorNode;\n  }\n  const isBackward = selection.isBackward();\n  if (isBackward) {\n    return $isAtNodeEnd(focus) ? anchorNode : focusNode;\n  } else {\n    return $isAtNodeEnd(anchor) ? focusNode : anchorNode;\n  }\n}\n","import { LexicalEditor } from 'lexical';\nimport React, { createContext } from 'react';\n\ninterface IToolbarContext {\n  isRTL: boolean;\n  isBold: boolean;\n  isItalic: boolean;\n  isUnderline: boolean;\n  isCode: boolean;\n  isLink: boolean;\n  isStrikethrough: boolean;\n  isSubscript: boolean;\n  isSuperscript: boolean;\n  canUndo: boolean;\n  canRedo: boolean;\n  fontFamily: string;\n  fontSize: string;\n  fontColor: string;\n  bgColor: string;\n  blockType: string;\n  codeLanguage: string;\n  selectedElementKey: string;\n  applyStyleText: (styles: Record<string, string>) => void;\n  insertLink: () => void;\n}\n\nconst ToolbarContext = createContext<IToolbarContext | null>(null);\n\nexport default ToolbarContext;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useEffect, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\n\nexport default function DropDown({\n  buttonLabel,\n  buttonAriaLabel,\n  buttonClassName,\n  buttonIconClassName,\n  children,\n  stopCloseOnClickSelf,\n}: {\n  buttonAriaLabel?: string;\n  buttonClassName: string;\n  buttonIconClassName?: string;\n  buttonLabel?: string;\n  children: JSX.Element | string | (JSX.Element | string)[];\n  stopCloseOnClickSelf?: boolean;\n}): JSX.Element {\n  const dropDownRef = useRef<HTMLDivElement | null>(null);\n  const buttonRef = useRef<HTMLButtonElement | null>(null);\n  const [showDropDown, setShowDropDown] = useState(false);\n\n  useEffect(() => {\n    const button = buttonRef.current;\n    const dropDown = dropDownRef.current;\n\n    if (showDropDown && button !== null && dropDown !== null) {\n      const { top, left } = button.getBoundingClientRect();\n      dropDown.style.top = `${top + 40}px`;\n      dropDown.style.left = `${Math.min(\n        left,\n        window.innerWidth - dropDown.offsetWidth - 20\n      )}px`;\n    }\n  }, [dropDownRef, buttonRef, showDropDown]);\n\n  useEffect(() => {\n    const button = buttonRef.current;\n\n    if (button !== null && showDropDown) {\n      const handle = (event: MouseEvent) => {\n        const target = event.target;\n        if (stopCloseOnClickSelf) {\n          if (dropDownRef.current.contains(target as Node)) return;\n        }\n        if (!button.contains(target as Node)) {\n          setShowDropDown(false);\n        }\n      };\n      document.addEventListener('click', handle);\n\n      return () => {\n        document.removeEventListener('click', handle);\n      };\n    }\n  }, [dropDownRef, buttonRef, showDropDown, stopCloseOnClickSelf]);\n\n  return (\n    <>\n      <button\n        aria-label={buttonAriaLabel || buttonLabel}\n        className={buttonClassName}\n        onClick={() => setShowDropDown(!showDropDown)}\n        ref={buttonRef}\n        type=\"button\"\n      >\n        {buttonIconClassName && <span className={buttonIconClassName} />}\n        {buttonLabel && (\n          <span className=\"text dropdown-button-text\">{buttonLabel}</span>\n        )}\n        <i className=\"chevron-down\" />\n      </button>\n\n      {showDropDown &&\n        createPortal(\n          <div className=\"dropdown\" ref={dropDownRef}>\n            {children}\n          </div>,\n          document.body\n        )}\n    </>\n  );\n}\n","import React, { useContext } from 'react';\nimport DropDown from '../../../ui/DropDown';\n\nimport {\n  FORMAT_ELEMENT_COMMAND,\n  INDENT_CONTENT_COMMAND,\n  LexicalEditor,\n  OUTDENT_CONTENT_COMMAND,\n} from 'lexical';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nfunction Divider(): JSX.Element {\n  return <div className=\"divider\" />;\n}\n\nconst AlignDropdown = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isRTL } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <DropDown\n      buttonLabel={t('toolbar:alignDropdown.Title')}\n      buttonAriaLabel={t('toolbar:alignDropdown.Description')}\n      buttonClassName=\"toolbar-item spaced alignment\"\n      buttonIconClassName=\"icon left-align\"\n    >\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'left');\n        }}\n        className=\"item\"\n        type=\"button\"\n      >\n        <i className=\"icon left-align\" />\n        <span className=\"text\">{t('toolbar:alignDropdown.LeftAlign')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'center');\n        }}\n        className=\"item\"\n        type=\"button\"\n      >\n        <i className=\"icon center-align\" />\n        <span className=\"text\">{t('toolbar:alignDropdown.CenterAlign')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'right');\n        }}\n        className=\"item\"\n        type=\"button\"\n      >\n        <i className=\"icon right-align\" />\n        <span className=\"text\">{t('toolbar:alignDropdown.RightAlign')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'justify');\n        }}\n        className=\"item\"\n        type=\"button\"\n      >\n        <i className=\"icon justify-align\" />\n        <span className=\"text\">{t('toolbar:alignDropdown.JustifyAlign')}</span>\n      </button>\n      <Divider />\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(OUTDENT_CONTENT_COMMAND, undefined);\n        }}\n        className=\"item\"\n        type=\"button\"\n      >\n        <i className={'icon ' + (isRTL ? 'indent' : 'outdent')} />\n        <span className=\"text\">{t('toolbar:alignDropdown.Outdent')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(INDENT_CONTENT_COMMAND, undefined);\n        }}\n        className=\"item\"\n        type=\"button\"\n      >\n        <i className={'icon ' + (isRTL ? 'outdent' : 'indent')} />\n        <span className=\"text\">{t('toolbar:alignDropdown.Indent')}</span>\n      </button>\n    </DropDown>\n  );\n};\n\nexport default AlignDropdown;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $isRootNode,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nimport { $createPollNode, PollNode } from '../nodes/PollNode';\n\nexport const INSERT_POLL_COMMAND: LexicalCommand<string> = createCommand();\n\nexport default function PollPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  useEffect(() => {\n    if (!editor.hasNodes([PollNode])) {\n      throw new Error('PollPlugin: PollNode not registered on editor');\n    }\n\n    return editor.registerCommand<string>(\n      INSERT_POLL_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          const question = payload;\n          const pollNode = $createPollNode(question);\n\n          if ($isRootNode(selection.anchor.getNode())) {\n            selection.insertParagraph();\n          }\n\n          selection.insertNodes([pollNode]);\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $createParagraphNode,\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nimport { $createTweetNode, TweetNode } from '../nodes/TweetNode';\n\nexport const INSERT_TWEET_COMMAND: LexicalCommand<string> = createCommand();\n\nexport default function TwitterPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([TweetNode])) {\n      throw new Error('TwitterPlugin: TweetNode not registered on editor');\n    }\n\n    return editor.registerCommand<string>(\n      INSERT_TWEET_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          const focusNode = selection.focus.getNode();\n\n          if (focusNode !== null) {\n            const tweetNode = $createTweetNode(payload);\n            selection.focus\n              .getNode()\n              .getTopLevelElementOrThrow()\n              .insertAfter(tweetNode);\n            const paragraphNode = $createParagraphNode();\n            tweetNode.insertAfter(paragraphNode);\n            paragraphNode.select();\n          }\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $createParagraphNode,\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nimport { $createYouTubeNode, YouTubeNode } from '../nodes/YouTubeNode';\n\nexport const INSERT_YOUTUBE_COMMAND: LexicalCommand<string> = createCommand();\n\nexport default function YouTubePlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([YouTubeNode])) {\n      throw new Error('YouTubePlugin: YouTubeNode not registered on editor');\n    }\n\n    return editor.registerCommand<string>(\n      INSERT_YOUTUBE_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          const focusNode = selection.focus.getNode();\n\n          if (focusNode !== null) {\n            const youTubeNode = $createYouTubeNode(payload);\n            selection.focus\n              .getNode()\n              .getTopLevelElementOrThrow()\n              .insertAfter(youTubeNode);\n            const paragraphNode = $createParagraphNode();\n            youTubeNode.insertAfter(paragraphNode);\n            paragraphNode.select();\n          }\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nimport type { Cell } from '@lexical/table';\nimport type { LexicalEditor } from 'lexical';\n\nimport './TableCellResizer.css';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getTableColumnIndexFromTableCellNode,\n  $getTableNodeFromLexicalNodeOrThrow,\n  $getTableRowIndexFromTableCellNode,\n  $isTableCellNode,\n  $isTableRowNode,\n  getCellFromTarget,\n} from '@lexical/table';\nimport {\n  $getNearestNodeFromDOMNode,\n  $getSelection,\n  DEPRECATED_$isGridSelection,\n  COMMAND_PRIORITY_HIGH,\n  SELECTION_CHANGE_COMMAND,\n} from 'lexical';\nimport * as React from 'react';\nimport {\n  ReactPortal,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { createPortal } from 'react-dom';\n\ntype MousePosition = {\n  x: number;\n  y: number;\n};\n\ntype MouseDraggingDirection = 'right' | 'bottom';\n\nconst MIN_ROW_HEIGHT = 33;\nconst MIN_COLUMN_WIDTH = 50;\n\nfunction TableCellResizer({ editor }: { editor: LexicalEditor }): JSX.Element {\n  const targetRef = useRef<HTMLElement | null>(null);\n  const resizerRef = useRef<HTMLDivElement | null>(null);\n  const tableRectRef = useRef<ClientRect | null>(null);\n\n  const mouseStartPosRef = useRef<MousePosition | null>(null);\n  const [mouseCurrentPos, updateMouseCurrentPos] =\n    useState<MousePosition | null>(null);\n\n  const [activeCell, updateActiveCell] = useState<Cell | null>(null);\n  const [isSelectingGrid, updateIsSelectingGrid] = useState<boolean>(false);\n  const [draggingDirection, updateDraggingDirection] =\n    useState<MouseDraggingDirection | null>(null);\n\n  useEffect(() => {\n    return editor.registerCommand(\n      SELECTION_CHANGE_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n        const isGridSelection = DEPRECATED_$isGridSelection(selection);\n\n        if (isSelectingGrid !== isGridSelection) {\n          updateIsSelectingGrid(isGridSelection);\n        }\n\n        return false;\n      },\n      COMMAND_PRIORITY_HIGH\n    );\n  });\n\n  const resetState = useCallback(() => {\n    updateActiveCell(null);\n    targetRef.current = null;\n    updateDraggingDirection(null);\n    mouseStartPosRef.current = null;\n    tableRectRef.current = null;\n  }, []);\n\n  useEffect(() => {\n    const onMouseMove = (event: MouseEvent) => {\n      setTimeout(() => {\n        const target = event.target;\n\n        if (draggingDirection) {\n          updateMouseCurrentPos({\n            x: event.clientX,\n            y: event.clientY,\n          });\n          return;\n        }\n\n        if (resizerRef.current && resizerRef.current.contains(target as Node)) {\n          return;\n        }\n\n        if (targetRef.current !== target) {\n          targetRef.current = target as HTMLElement;\n          const cell = getCellFromTarget(target as HTMLElement);\n\n          if (cell && activeCell !== cell) {\n            editor.update(() => {\n              const tableCellNode = $getNearestNodeFromDOMNode(cell.elem);\n              if (!tableCellNode) {\n                throw new Error('TableCellResizer: Table cell node not found.');\n              }\n\n              const tableNode =\n                $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n              const tableElement = editor.getElementByKey(tableNode.getKey());\n\n              if (!tableElement) {\n                throw new Error('TableCellResizer: Table element not found.');\n              }\n\n              targetRef.current = target as HTMLElement;\n              tableRectRef.current = tableElement.getBoundingClientRect();\n              updateActiveCell(cell);\n            });\n          } else if (cell == null) {\n            resetState();\n          }\n        }\n      }, 0);\n    };\n\n    document.addEventListener('mousemove', onMouseMove);\n\n    return () => {\n      document.removeEventListener('mousemove', onMouseMove);\n    };\n  }, [activeCell, draggingDirection, editor, resetState]);\n\n  const isHeightChanging = (direction: MouseDraggingDirection) => {\n    if (direction === 'bottom') return true;\n    return false;\n  };\n\n  const updateRowHeight = useCallback(\n    (newHeight: number) => {\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n\n      editor.update(() => {\n        const tableCellNode = $getNearestNodeFromDOMNode(activeCell.elem);\n        if (!$isTableCellNode(tableCellNode)) {\n          throw new Error('TableCellResizer: Table cell node not found.');\n        }\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n        const tableRows = tableNode.getChildren();\n\n        if (tableRowIndex >= tableRows.length || tableRowIndex < 0) {\n          throw new Error('Expected table cell to be inside of table row.');\n        }\n\n        const tableRow = tableRows[tableRowIndex];\n\n        if (!$isTableRowNode(tableRow)) {\n          throw new Error('Expected table row');\n        }\n\n        tableRow.setHeight(newHeight);\n      });\n    },\n    [activeCell, editor]\n  );\n\n  const updateColumnWidth = useCallback(\n    (newWidth: number) => {\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n      editor.update(() => {\n        const tableCellNode = $getNearestNodeFromDOMNode(activeCell.elem);\n        if (!$isTableCellNode(tableCellNode)) {\n          throw new Error('TableCellResizer: Table cell node not found.');\n        }\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        const tableColumnIndex =\n          $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n        const tableRows = tableNode.getChildren();\n\n        for (let r = 0; r < tableRows.length; r++) {\n          const tableRow = tableRows[r];\n\n          if (!$isTableRowNode(tableRow)) {\n            throw new Error('Expected table row');\n          }\n\n          const tableCells = tableRow.getChildren();\n\n          if (tableColumnIndex >= tableCells.length || tableColumnIndex < 0) {\n            throw new Error('Expected table cell to be inside of table row.');\n          }\n\n          const tableCell = tableCells[tableColumnIndex];\n\n          if (!$isTableCellNode(tableCell)) {\n            throw new Error('Expected table cell');\n          }\n\n          tableCell.setWidth(newWidth);\n        }\n      });\n    },\n    [activeCell, editor]\n  );\n\n  const toggleResize = useCallback(\n    (direction) => (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n\n      if (draggingDirection === direction && mouseStartPosRef.current) {\n        const { x, y } = mouseStartPosRef.current;\n\n        if (!activeCell) {\n          return;\n        }\n\n        const { height, width } = activeCell.elem.getBoundingClientRect();\n\n        if (isHeightChanging(direction)) {\n          const heightChange = Math.abs(event.clientY - y);\n\n          const isShrinking = direction === 'bottom' && y > event.clientY;\n\n          updateRowHeight(\n            Math.max(\n              isShrinking ? height - heightChange : heightChange + height,\n              MIN_ROW_HEIGHT\n            )\n          );\n        } else {\n          const widthChange = Math.abs(event.clientX - x);\n\n          const isShrinking = direction === 'right' && x > event.clientX;\n\n          updateColumnWidth(\n            Math.max(\n              isShrinking ? width - widthChange : widthChange + width,\n              MIN_COLUMN_WIDTH\n            )\n          );\n        }\n\n        resetState();\n      } else {\n        mouseStartPosRef.current = {\n          x: event.clientX,\n          y: event.clientY,\n        };\n        updateMouseCurrentPos(mouseStartPosRef.current);\n        updateDraggingDirection(direction);\n      }\n    },\n    [\n      activeCell,\n      draggingDirection,\n      resetState,\n      updateColumnWidth,\n      updateRowHeight,\n    ]\n  );\n\n  const getResizers = useCallback(() => {\n    if (activeCell) {\n      const { height, width, top, left } =\n        activeCell.elem.getBoundingClientRect();\n\n      const styles = {\n        bottom: {\n          backgroundColor: 'none',\n          cursor: 'row-resize',\n          height: '10px',\n          left: `${window.pageXOffset + left}px`,\n          top: `${window.pageYOffset + top + height}px`,\n          width: `${width}px`,\n        },\n        right: {\n          backgroundColor: 'none',\n          cursor: 'col-resize',\n          height: `${height}px`,\n          left: `${window.pageXOffset + left + width}px`,\n          top: `${window.pageYOffset + top}px`,\n          width: '10px',\n        },\n      };\n\n      const tableRect = tableRectRef.current;\n\n      if (draggingDirection && mouseCurrentPos && tableRect) {\n        if (isHeightChanging(draggingDirection)) {\n          styles[draggingDirection].left = `${\n            window.pageXOffset + tableRect.left\n          }px`;\n          styles[draggingDirection].top = `${\n            window.pageYOffset + mouseCurrentPos.y\n          }px`;\n          styles[draggingDirection].height = '3px';\n          styles[draggingDirection].width = `${tableRect.width}px`;\n        } else {\n          styles[draggingDirection].top = `${\n            window.pageYOffset + tableRect.top\n          }px`;\n          styles[draggingDirection].left = `${\n            window.pageXOffset + mouseCurrentPos.x\n          }px`;\n          styles[draggingDirection].width = '3px';\n          styles[draggingDirection].height = `${tableRect.height}px`;\n        }\n\n        styles[draggingDirection].backgroundColor = '#adf';\n      }\n\n      return styles;\n    }\n\n    return {\n      bottom: null,\n      left: null,\n      right: null,\n      top: null,\n    };\n  }, [activeCell, draggingDirection, mouseCurrentPos]);\n\n  const resizerStyles = getResizers();\n\n  return (\n    <div ref={resizerRef}>\n      {activeCell != null && !isSelectingGrid && (\n        <>\n          <div\n            className=\"TableCellResizer__resizer TableCellResizer__ui\"\n            style={resizerStyles.right}\n            onMouseDown={toggleResize('right')}\n            onMouseUp={toggleResize('right')}\n          />\n          <div\n            className=\"TableCellResizer__resizer TableCellResizer__ui\"\n            style={resizerStyles.bottom}\n            onMouseDown={toggleResize('bottom')}\n            onMouseUp={toggleResize('bottom')}\n          />\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default function TableCellResizerPlugin(): ReactPortal {\n  const [editor] = useLexicalComposerContext();\n\n  return useMemo(\n    () => createPortal(<TableCellResizer editor={editor} />, document.body),\n    [editor]\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $deleteTableColumn,\n  $getElementGridForTableNode,\n  $getTableCellNodeFromLexicalNode,\n  $getTableColumnIndexFromTableCellNode,\n  $getTableNodeFromLexicalNodeOrThrow,\n  $getTableRowIndexFromTableCellNode,\n  $insertTableColumn,\n  $insertTableRow,\n  $isTableCellNode,\n  $isTableRowNode,\n  $removeTableRowAtIndex,\n  getTableSelectionFromTableElement,\n  HTMLTableElementWithWithTableSelectionState,\n  TableCellHeaderStates,\n  TableCellNode,\n} from '@lexical/table';\nimport { TFunction } from 'i18next';\nimport {\n  $getSelection,\n  DEPRECATED_$isGridSelection,\n  $isRangeSelection,\n  $setSelection,\n} from 'lexical';\nimport * as React from 'react';\nimport { ReactPortal, useCallback, useEffect, useRef, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport { useTranslation } from 'react-i18next';\n\ntype TableCellActionMenuProps = Readonly<{\n  contextRef: { current: null | HTMLElement };\n  onClose: () => void;\n  setIsMenuOpen: (isOpen: boolean) => void;\n  tableCellNode: TableCellNode;\n  t: TFunction;\n}>;\n\nfunction TableActionMenu({\n  onClose,\n  tableCellNode: _tableCellNode,\n  setIsMenuOpen,\n  contextRef,\n  t,\n}: TableCellActionMenuProps) {\n  const [editor] = useLexicalComposerContext();\n  const dropDownRef = useRef<HTMLDivElement | null>(null);\n  const [tableCellNode, updateTableCellNode] = useState(_tableCellNode);\n  const [selectionCounts, updateSelectionCounts] = useState({\n    columns: 1,\n    rows: 1,\n  });\n\n  useEffect(() => {\n    return editor.registerMutationListener(TableCellNode, (nodeMutations) => {\n      const nodeUpdated =\n        nodeMutations.get(tableCellNode.getKey()) === 'updated';\n\n      if (nodeUpdated) {\n        editor.getEditorState().read(() => {\n          updateTableCellNode(tableCellNode.getLatest());\n        });\n      }\n    });\n  }, [editor, tableCellNode]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n\n      if (DEPRECATED_$isGridSelection(selection)) {\n        const selectionShape = selection.getShape();\n\n        updateSelectionCounts({\n          columns: selectionShape.toX - selectionShape.fromX + 1,\n          rows: selectionShape.toY - selectionShape.fromY + 1,\n        });\n      }\n    });\n  }, [editor]);\n\n  useEffect(() => {\n    const menuButtonElement = contextRef.current;\n    const dropDownElement = dropDownRef.current;\n\n    if (menuButtonElement != null && dropDownElement != null) {\n      const menuButtonRect = menuButtonElement.getBoundingClientRect();\n\n      dropDownElement.style.opacity = '1';\n\n      dropDownElement.style.left = `${\n        menuButtonRect.left + menuButtonRect.width + window.pageXOffset + 5\n      }px`;\n\n      dropDownElement.style.top = `${\n        menuButtonRect.top + window.pageYOffset\n      }px`;\n    }\n  }, [contextRef, dropDownRef]);\n\n  useEffect(() => {\n    function handleClickOutside(event: MouseEvent) {\n      if (\n        dropDownRef.current != null &&\n        contextRef.current != null &&\n        !dropDownRef.current.contains(event.target as Node) &&\n        !contextRef.current.contains(event.target as Node)\n      ) {\n        setIsMenuOpen(false);\n      }\n    }\n\n    window.addEventListener('click', handleClickOutside);\n\n    return () => window.removeEventListener('click', handleClickOutside);\n  }, [setIsMenuOpen, contextRef]);\n\n  const clearTableSelection = useCallback(() => {\n    editor.update(() => {\n      if (tableCellNode.isAttached()) {\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n        const tableElement = editor.getElementByKey(\n          tableNode.getKey()\n        ) as HTMLTableElementWithWithTableSelectionState;\n\n        if (!tableElement) {\n          throw new Error('Expected to find tableElement in DOM');\n        }\n\n        const tableSelection = getTableSelectionFromTableElement(tableElement);\n        if (tableSelection !== null) {\n          tableSelection.clearHighlight();\n        }\n\n        tableNode.markDirty();\n        updateTableCellNode(tableCellNode.getLatest());\n      }\n\n      $setSelection(null);\n    });\n  }, [editor, tableCellNode]);\n\n  const insertTableRowAtSelection = useCallback(\n    (shouldInsertAfter: boolean) => {\n      editor.update(() => {\n        const selection = $getSelection();\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        let tableRowIndex;\n\n        if (DEPRECATED_$isGridSelection(selection)) {\n          const selectionShape = selection.getShape();\n          tableRowIndex = shouldInsertAfter\n            ? selectionShape.toY\n            : selectionShape.fromY;\n        } else {\n          tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n        }\n\n        const grid = $getElementGridForTableNode(editor, tableNode);\n\n        $insertTableRow(\n          tableNode,\n          tableRowIndex,\n          shouldInsertAfter,\n          selectionCounts.rows,\n          grid\n        );\n\n        clearTableSelection();\n\n        onClose();\n      });\n    },\n    [editor, tableCellNode, selectionCounts.rows, clearTableSelection, onClose]\n  );\n\n  const insertTableColumnAtSelection = useCallback(\n    (shouldInsertAfter: boolean) => {\n      editor.update(() => {\n        const selection = $getSelection();\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        let tableColumnIndex;\n\n        if (DEPRECATED_$isGridSelection(selection)) {\n          const selectionShape = selection.getShape();\n          tableColumnIndex = shouldInsertAfter\n            ? selectionShape.toX\n            : selectionShape.fromX;\n        } else {\n          tableColumnIndex =\n            $getTableColumnIndexFromTableCellNode(tableCellNode);\n        }\n\n        const grid = $getElementGridForTableNode(editor, tableNode);\n\n        $insertTableColumn(\n          tableNode,\n          tableColumnIndex,\n          shouldInsertAfter,\n          selectionCounts.columns,\n          grid\n        );\n\n        clearTableSelection();\n\n        onClose();\n      });\n    },\n    [\n      editor,\n      tableCellNode,\n      selectionCounts.columns,\n      clearTableSelection,\n      onClose,\n    ]\n  );\n\n  const deleteTableRowAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n      const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n      $removeTableRowAtIndex(tableNode, tableRowIndex);\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const deleteTableAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n      tableNode.remove();\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const deleteTableColumnAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableColumnIndex =\n        $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n      $deleteTableColumn(tableNode, tableColumnIndex);\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const toggleTableRowIsHeader = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n      const tableRows = tableNode.getChildren();\n\n      if (tableRowIndex >= tableRows.length || tableRowIndex < 0) {\n        throw new Error('Expected table cell to be inside of table row.');\n      }\n\n      const tableRow = tableRows[tableRowIndex];\n\n      if (!$isTableRowNode(tableRow)) {\n        throw new Error('Expected table row');\n      }\n\n      tableRow.getChildren().forEach((tableCell) => {\n        if (!$isTableCellNode(tableCell)) {\n          throw new Error('Expected table cell');\n        }\n\n        tableCell.toggleHeaderStyle(TableCellHeaderStates.ROW);\n      });\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const toggleTableColumnIsHeader = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableColumnIndex =\n        $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n      const tableRows = tableNode.getChildren();\n\n      for (let r = 0; r < tableRows.length; r++) {\n        const tableRow = tableRows[r];\n\n        if (!$isTableRowNode(tableRow)) {\n          throw new Error('Expected table row');\n        }\n\n        const tableCells = tableRow.getChildren();\n\n        if (tableColumnIndex >= tableCells.length || tableColumnIndex < 0) {\n          throw new Error('Expected table cell to be inside of table row.');\n        }\n\n        const tableCell = tableCells[tableColumnIndex];\n\n        if (!$isTableCellNode(tableCell)) {\n          throw new Error('Expected table cell');\n        }\n\n        tableCell.toggleHeaderStyle(TableCellHeaderStates.COLUMN);\n      }\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  return createPortal(\n    // eslint-disable-next-line jsx-a11y/no-static-element-interactions\n    <div\n      className=\"dropdown\"\n      ref={dropDownRef}\n      onClick={(e) => {\n        e.stopPropagation();\n      }}\n    >\n      <button\n        className=\"item\"\n        onClick={() => insertTableRowAtSelection(false)}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.rows === 1\n            ? t('toolbar:tableActionMenuPlugin.row')\n            : `${selectionCounts.rows} ${t(\n                'toolbar:tableActionMenuPlugin.rows'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.above')}\n        </span>\n      </button>\n      <button\n        className=\"item\"\n        onClick={() => insertTableRowAtSelection(true)}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.rows === 1\n            ? t('toolbar:tableActionMenuPlugin.row')\n            : `${selectionCounts.rows} ${t(\n                'toolbar:tableActionMenuPlugin.rows'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.below')}\n        </span>\n      </button>\n      <hr />\n      <button\n        className=\"item\"\n        onClick={() => insertTableColumnAtSelection(false)}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.columns === 1\n            ? t('toolbar:tableActionMenuPlugin.column')\n            : `${selectionCounts.columns} ${t(\n                'toolbar:tableActionMenuPlugin.columns'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.left')}\n        </span>\n      </button>\n      <button\n        className=\"item\"\n        onClick={() => insertTableColumnAtSelection(true)}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.columns === 1\n            ? t('toolbar:tableActionMenuPlugin.column')\n            : `${selectionCounts.columns} ${t(\n                'toolbar:tableActionMenuPlugin.columns'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.right')}\n        </span>\n      </button>\n      <hr />\n      <button\n        className=\"item\"\n        onClick={() => deleteTableColumnAtSelection()}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          {t('toolbar:tableActionMenuPlugin.Delete_column')}\n        </span>\n      </button>\n      <button\n        className=\"item\"\n        onClick={() => deleteTableRowAtSelection()}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          {t('toolbar:tableActionMenuPlugin.Delete_row')}\n        </span>\n      </button>\n      <button\n        className=\"item\"\n        onClick={() => deleteTableAtSelection()}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          {t('toolbar:tableActionMenuPlugin.Delete_table')}\n        </span>\n      </button>\n      <hr />\n      <button\n        className=\"item\"\n        onClick={() => toggleTableRowIsHeader()}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          {(tableCellNode.__headerState & TableCellHeaderStates.ROW) ===\n          TableCellHeaderStates.ROW\n            ? t('action:Remove')\n            : t('action:Add')}{' '}\n          {t('toolbar:tableActionMenuPlugin.row_header')}\n        </span>\n      </button>\n      <button\n        className=\"item\"\n        onClick={() => toggleTableColumnIsHeader()}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          {(tableCellNode.__headerState & TableCellHeaderStates.COLUMN) ===\n          TableCellHeaderStates.COLUMN\n            ? t('action:Remove')\n            : t('action:Add ')}{' '}\n          {t('toolbar:tableActionMenuPlugin.column_header')}\n        </span>\n      </button>\n    </div>,\n    document.body\n  );\n}\n\nfunction TableCellActionMenuContainer(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  const menuButtonRef = useRef(null);\n  const menuRootRef = useRef(null);\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n\n  const [tableCellNode, setTableMenuCellNode] = useState<TableCellNode | null>(\n    null\n  );\n  const { t } = useTranslation(['toolbar', 'action']);\n\n  const moveMenu = useCallback(() => {\n    const menu = menuButtonRef.current;\n    const selection = $getSelection();\n    const nativeSelection = window.getSelection();\n    const activeElement = document.activeElement;\n\n    if (selection == null || menu == null) {\n      setTableMenuCellNode(null);\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n\n    if (\n      $isRangeSelection(selection) &&\n      rootElement !== null &&\n      nativeSelection !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const tableCellNodeFromSelection = $getTableCellNodeFromLexicalNode(\n        selection.anchor.getNode()\n      );\n\n      if (tableCellNodeFromSelection == null) {\n        setTableMenuCellNode(null);\n        return;\n      }\n\n      const tableCellParentNodeDOM = editor.getElementByKey(\n        tableCellNodeFromSelection.getKey()\n      );\n\n      if (tableCellParentNodeDOM == null) {\n        setTableMenuCellNode(null);\n        return;\n      }\n\n      setTableMenuCellNode(tableCellNodeFromSelection);\n    } else if (!activeElement) {\n      setTableMenuCellNode(null);\n    }\n  }, [editor]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      editor.getEditorState().read(() => {\n        moveMenu();\n      });\n    });\n  });\n\n  useEffect(() => {\n    const menuButtonDOM = menuButtonRef.current as HTMLButtonElement | null;\n\n    if (menuButtonDOM != null && tableCellNode != null) {\n      const tableCellNodeDOM = editor.getElementByKey(tableCellNode.getKey());\n\n      if (tableCellNodeDOM != null) {\n        const tableCellRect = tableCellNodeDOM.getBoundingClientRect();\n        const menuRect = menuButtonDOM.getBoundingClientRect();\n\n        menuButtonDOM.style.opacity = '1';\n\n        menuButtonDOM.style.left = `${\n          tableCellRect.left +\n          window.pageXOffset -\n          menuRect.width +\n          tableCellRect.width -\n          10\n        }px`;\n\n        menuButtonDOM.style.top = `${\n          tableCellRect.top + window.pageYOffset + 5\n        }px`;\n      } else {\n        menuButtonDOM.style.opacity = '0';\n      }\n    }\n  }, [menuButtonRef, tableCellNode, editor]);\n\n  const prevTableCellDOM = useRef(tableCellNode);\n\n  useEffect(() => {\n    if (prevTableCellDOM.current !== tableCellNode) {\n      setIsMenuOpen(false);\n    }\n\n    prevTableCellDOM.current = tableCellNode;\n  }, [prevTableCellDOM, tableCellNode]);\n\n  return (\n    <div className=\"table-cell-action-button-container\" ref={menuButtonRef}>\n      {tableCellNode != null && (\n        <>\n          <button\n            className=\"table-cell-action-button chevron-down\"\n            onClick={(e) => {\n              e.stopPropagation();\n              setIsMenuOpen(!isMenuOpen);\n            }}\n            ref={menuRootRef}\n            type=\"button\"\n          >\n            <i className=\"chevron-down\" />\n          </button>\n          {isMenuOpen && (\n            <TableActionMenu\n              contextRef={menuRootRef}\n              setIsMenuOpen={setIsMenuOpen}\n              onClose={() => setIsMenuOpen(false)}\n              tableCellNode={tableCellNode}\n              t={t}\n            />\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default function TableActionMenuPlugin(): ReactPortal {\n  return createPortal(<TableCellActionMenuContainer />, document.body);\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $createHorizontalRuleNode,\n  INSERT_HORIZONTAL_RULE_COMMAND,\n} from '@lexical/react/LexicalHorizontalRuleNode';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nexport default function HorizontalRulePlugin(): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      INSERT_HORIZONTAL_RULE_COMMAND,\n      (type) => {\n        const selection = $getSelection();\n\n        if (!$isRangeSelection(selection)) {\n          return false;\n        }\n\n        const focusNode = selection.focus.getNode();\n\n        if (focusNode !== null) {\n          const horizontalRuleNode = $createHorizontalRuleNode();\n          selection.insertParagraph();\n          selection.focus\n            .getNode()\n            .getTopLevelElementOrThrow()\n            .insertBefore(horizontalRuleNode);\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n","import React, { useState, useCallback, useContext } from 'react';\nimport { $getRoot, LexicalEditor, RangeSelection } from 'lexical';\nimport DropDown from '../../../ui/DropDown';\nimport Button from '../../../ui/Button';\nimport TextInput from '../../../ui/TextInput';\nimport FileInput from '../../../ui/FileInput';\nimport ImagesPlugin, {\n  INSERT_IMAGE_COMMAND,\n  InsertImagePayload,\n} from '../../ImagesPlugin';\nimport { INSERT_TABLE_COMMAND } from '@lexical/table';\nimport { INSERT_HORIZONTAL_RULE_COMMAND } from '@lexical/react/LexicalHorizontalRuleNode';\nimport PollPlugin, { INSERT_POLL_COMMAND } from '../../PollPlugin';\nimport TwitterPlugin, { INSERT_TWEET_COMMAND } from '../../TwitterPlugin';\nimport YouTubePlugin, { INSERT_YOUTUBE_COMMAND } from '../../YouTubePlugin';\nimport { $createStickyNode } from '../../../nodes/StickyNode';\nimport useModal from '../../../hooks/useModal';\nimport TableCellResizer from '../../TableCellResizer';\nimport { TablePlugin } from '@lexical/react/LexicalTablePlugin';\nimport TableCellActionMenuPlugin from '../../TableActionMenuPlugin';\nimport HorizontalRulePlugin from '../../HorizontalRulePlugin';\nimport EditorContext from '../../../context/EditorContext';\n\n// Taken from https://stackoverflow.com/a/9102270\nconst YOUTUBE_ID_PARSER =\n  /^.*(youtu\\.be\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=|&v=)([^#&?]*).*/;\n\nconst parseYouTubeVideoID = (url: string) => {\n  const urlMatches = url.match(YOUTUBE_ID_PARSER);\n\n  return urlMatches?.[2].length === 11 ? urlMatches[2] : null;\n};\n\n//#region Inserting different modules\nfunction InsertImageDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [mode, setMode] = useState<null | 'url' | 'file'>(null);\n\n  const onClick = (payload: InsertImagePayload) => {\n    activeEditor.dispatchCommand(INSERT_IMAGE_COMMAND, payload);\n    onClose();\n  };\n\n  return (\n    <>\n      {!mode && (\n        <div className=\"ToolbarPlugin__dialogButtonsList\">\n          <Button\n            data-test-id=\"image-modal-option-sample\"\n            onClick={() =>\n              onClick({\n                altText: 'Yellow flower in tilt shift lens',\n                src: null, //yellowFlowerImage,\n              })\n            }\n          >\n            Sample\n          </Button>\n          <Button\n            data-test-id=\"image-modal-option-url\"\n            onClick={() => setMode('url')}\n          >\n            URL\n          </Button>\n          <Button\n            data-test-id=\"image-modal-option-file\"\n            onClick={() => setMode('file')}\n          >\n            File\n          </Button>\n        </div>\n      )}\n      {mode === 'url' && <InsertImageUriDialogBody onClick={onClick} />}\n      {mode === 'file' && <InsertImageUploadedDialogBody onClick={onClick} />}\n    </>\n  );\n}\n\nfunction InsertTableDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [rows, setRows] = useState('5');\n  const [columns, setColumns] = useState('5');\n\n  const onClick = () => {\n    activeEditor.dispatchCommand(INSERT_TABLE_COMMAND, { columns, rows });\n    onClose();\n  };\n\n  return (\n    <>\n      <TextInput label=\"No of rows\" onChange={setRows} value={rows} />\n      <TextInput label=\"No of columns\" onChange={setColumns} value={columns} />\n      <div\n        className=\"ToolbarPlugin__dialogActions\"\n        data-test-id=\"table-model-confirm-insert\"\n      >\n        <Button onClick={onClick}>Confirm</Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertPollDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [question, setQuestion] = useState('');\n\n  const onClick = () => {\n    activeEditor.dispatchCommand(INSERT_POLL_COMMAND, question);\n    onClose();\n  };\n\n  return (\n    <>\n      <TextInput label=\"Question\" onChange={setQuestion} value={question} />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button disabled={question.trim() === ''} onClick={onClick}>\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nconst VALID_TWITTER_URL = /twitter.com\\/[0-9a-zA-Z]{1,20}\\/status\\/([0-9]*)/g;\n\nfunction InsertTweetDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [text, setText] = useState('');\n\n  const onClick = () => {\n    const tweetID = text.split('status/')?.[1]?.split('?')?.[0];\n    activeEditor.dispatchCommand(INSERT_TWEET_COMMAND, tweetID);\n    onClose();\n  };\n\n  const isDisabled = text === '' || !text.match(VALID_TWITTER_URL);\n\n  return (\n    <>\n      <TextInput\n        label=\"Tweet URL\"\n        placeholder=\"i.e. https://twitter.com/jack/status/20\"\n        onChange={setText}\n        value={text}\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button disabled={isDisabled} onClick={onClick}>\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertImageUriDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  return (\n    <>\n      <TextInput\n        label=\"Image URL\"\n        placeholder=\"i.e. https://source.unsplash.com/random\"\n        onChange={setSrc}\n        value={src}\n        data-test-id=\"image-modal-url-input\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Random unsplash image\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"image-modal-confirm-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertImageUploadedDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  const loadImage = (files: FileList) => {\n    const reader = new FileReader();\n    reader.onload = function () {\n      if (typeof reader.result === 'string') {\n        setSrc(reader.result);\n      }\n      return '';\n    };\n    reader.readAsDataURL(files[0]);\n  };\n\n  return (\n    <>\n      <FileInput\n        label=\"Image Upload\"\n        onChange={loadImage}\n        accept=\"image/*\"\n        data-test-id=\"image-modal-file-upload\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Descriptive alternative text\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"image-modal-file-upload-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertYouTubeDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [text, setText] = useState('');\n\n  const onClick = () => {\n    const videoID = parseYouTubeVideoID(text);\n    if (videoID) {\n      activeEditor.dispatchCommand(INSERT_YOUTUBE_COMMAND, videoID);\n    }\n    onClose();\n  };\n\n  const isDisabled = text === '' || !parseYouTubeVideoID(text);\n\n  return (\n    <>\n      <TextInput\n        data-test-id=\"youtube-embed-modal-url\"\n        label=\"YouTube URL\"\n        placeholder=\"i.e. https://www.youtube.com/watch?v=jNQXAC9IVRw\"\n        onChange={setText}\n        value={text}\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"youtube-embed-modal-submit-btn\"\n          disabled={isDisabled}\n          onClick={onClick}\n        >\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\n//#endregion Inserting different modules\n\nexport interface IInsertDropdownProps {\n  enableTable?: boolean;\n  enableYoutube?: boolean;\n  enableTwitter?: boolean;\n  enablePoll?: boolean;\n  enableImage?: { enable: boolean; maxWidth: number };\n  enableEquations?: boolean;\n  enableExcalidraw?: boolean;\n  enableHorizontalRule?: boolean;\n  enableStickyNote?: boolean;\n}\n\nconst InsertDropdown: React.FC<IInsertDropdownProps> = ({\n  enableTable = true,\n  enableImage = { enable: true, maxWidth: 1000 },\n  enableYoutube = false,\n  enableTwitter = false,\n  enablePoll = false,\n  enableHorizontalRule = false,\n  enableStickyNote = false,\n}: IInsertDropdownProps) => {\n  const { initialEditor, activeEditor } = useContext(EditorContext);\n  const [modal, showModal] = useModal();\n\n  return (\n    <div>\n      {enableTable && (\n        <>\n          <TablePlugin />\n          <TableCellActionMenuPlugin />\n          <TableCellResizer />\n        </>\n      )}\n      {enableYoutube && <YouTubePlugin />}\n      {enableTwitter && <TwitterPlugin />}\n      {enablePoll && <PollPlugin />}\n      {enableImage.enable && <ImagesPlugin maxWidth={enableImage.maxWidth} />}\n      {enableHorizontalRule && <HorizontalRulePlugin />}\n\n      <DropDown\n        buttonClassName=\"toolbar-item spaced\"\n        buttonLabel=\"Insert\"\n        buttonAriaLabel=\"Insert specialized editor node\"\n        buttonIconClassName=\"icon plus\"\n      >\n        {enableHorizontalRule && (\n          <button\n            onClick={() => {\n              activeEditor.dispatchCommand(\n                INSERT_HORIZONTAL_RULE_COMMAND,\n                undefined\n              );\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon horizontal-rule\" />\n            <span className=\"text\">Horizontal Rule</span>\n          </button>\n        )}\n        {enableImage.enable && (\n          <button\n            onClick={() => {\n              showModal('Insert Image', (onClose) => (\n                <InsertImageDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon image\" />\n            <span className=\"text\">Image</span>\n          </button>\n        )}\n        {enableTable && (\n          <div>\n            <button\n              onClick={() => {\n                showModal('Insert Table', (onClose) => (\n                  <InsertTableDialog\n                    activeEditor={activeEditor}\n                    onClose={onClose}\n                  />\n                ));\n              }}\n              className=\"item\"\n              type=\"button\"\n            >\n              <i className=\"icon table\" />\n              <span className=\"text\">Table</span>\n            </button>\n          </div>\n        )}\n        {enablePoll && (\n          <button\n            onClick={() => {\n              showModal('Insert Poll', (onClose) => (\n                <InsertPollDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon poll\" />\n            <span className=\"text\">Poll</span>\n          </button>\n        )}\n        {enableTwitter && (\n          <button\n            onClick={() => {\n              showModal('Insert Tweet', (onClose) => (\n                <InsertTweetDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon tweet\" />\n            <span className=\"text\">Tweet</span>\n          </button>\n        )}\n        {enableYoutube && (\n          <button\n            onClick={() => {\n              showModal('Insert YouTube Video', (onClose) => (\n                <InsertYouTubeDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon youtube\" />\n            <span className=\"text\">YouTube Video</span>\n          </button>\n        )}\n        {enableStickyNote && (\n          <button\n            onClick={() => {\n              initialEditor.update(() => {\n                const root = $getRoot();\n                const stickyNode = $createStickyNode(0, 0);\n                root.append(stickyNode);\n              });\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon sticky\" />\n            <span className=\"text\">Sticky Note</span>\n          </button>\n        )}\n      </DropDown>\n      {modal}\n    </div>\n  );\n};\n\nexport default InsertDropdown;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict\n */\n\nimport { CAN_USE_DOM } from './canUseDOM';\n\nconst documentMode =\n  // @ts-ignore\n  CAN_USE_DOM && 'documentMode' in document ? document.documentMode : null;\n\nexport const IS_APPLE: boolean =\n  CAN_USE_DOM && /Mac|iPod|iPhone|iPad/.test(navigator.platform);\n\nexport const IS_FIREFOX: boolean =\n  CAN_USE_DOM && /^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent);\n\nexport const CAN_USE_BEFORE_INPUT: boolean =\n  CAN_USE_DOM && 'InputEvent' in window && !documentMode\n    ? 'getTargetRanges' in new window.InputEvent('input')\n    : false;\n\nexport const IS_SAFARI: boolean =\n  CAN_USE_DOM && /Version\\/[\\d\\.]+.*Safari/.test(navigator.userAgent);\n\nexport const IS_IOS: boolean =\n  CAN_USE_DOM &&\n  /iPad|iPhone|iPod/.test(navigator.userAgent) &&\n  !(window as any).MSStream;\n\n// Keep these in case we need to use them in the future.\n// export const IS_WINDOWS: boolean = CAN_USE_DOM && /Win/.test(navigator.platform);\n// export const IS_CHROME: boolean = CAN_USE_DOM && /^(?=.*Chrome).*/i.test(navigator.userAgent);\n// export const canUseTextInputEvent: boolean = CAN_USE_DOM && 'TextEvent' in window && !documentMode;\n","import * as React from 'react';\nimport { useContext } from 'react';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { UNDO_COMMAND } from 'lexical';\nimport EditorContext from '../../../context/EditorContext';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport { useTranslation } from 'react-i18next';\n\nconst UndoButton = () => {\n  const { canUndo } = useContext(ToolbarContext);\n  const { activeEditor } = useContext(EditorContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <button\n      disabled={!canUndo}\n      onClick={() => {\n        activeEditor.dispatchCommand(UNDO_COMMAND, undefined);\n      }}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:undoButton.Title')} (⌘Z)`\n          : `${t('toolbar:undoButton.Title')} (Ctrl+Z)`\n      }\n      className=\"toolbar-item spaced\"\n      aria-label={t('toolbar:undoButton.Description')}\n      type=\"button\"\n    >\n      <i className=\"format undo\" />\n    </button>\n  );\n};\n\nexport default UndoButton;\n","import * as React from 'react';\nimport { useContext } from 'react';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { REDO_COMMAND } from 'lexical';\nimport EditorContext from '../../../context/EditorContext';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport { useTranslation } from 'react-i18next';\n\nconst RedoButton = () => {\n  const { canRedo } = useContext(ToolbarContext);\n  const { activeEditor } = useContext(EditorContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <button\n      disabled={!canRedo}\n      onClick={() => {\n        activeEditor.dispatchCommand(REDO_COMMAND, undefined);\n      }}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:redoButton.Title')} (⌘Y)`\n          : `${t('toolbar:redoButton.Title')} (Ctrl+Y)`\n      }\n      className=\"toolbar-item\"\n      aria-label={t('toolbar:redoButton.Description')}\n      type=\"button\"\n    >\n      <i className=\"format redo\" />\n    </button>\n  );\n};\n\nexport default RedoButton;\n","import React from 'react';\n\nconst Select = ({\n  onChange,\n  className,\n  options,\n  value,\n}: {\n  className: string;\n  onChange: (event: { target: { value: string } }) => void;\n  options: [string, string][];\n  value: string;\n}): JSX.Element => {\n  return (\n    <select className={className} onChange={onChange} value={value}>\n      {options.map(([option, text]) => (\n        <option key={option} value={option}>\n          {text}\n        </option>\n      ))}\n    </select>\n  );\n};\n\nexport default Select;\n","import { $isCodeNode } from '@lexical/code';\nimport { $getNodeByKey } from 'lexical';\nimport React, { useCallback, useContext } from 'react';\nimport EditorContext from '../../../context/EditorContext';\nimport Select from '../../../ui/Select';\nimport ToolbarContext from '../../../context/ToolbarContext';\n\nconst CODE_LANGUAGE_OPTIONS: [string, string][] = [\n  ['', '- Select language -'],\n  ['c', 'C'],\n  ['clike', 'C-like'],\n  ['css', 'CSS'],\n  ['html', 'HTML'],\n  ['js', 'JavaScript'],\n  ['markdown', 'Markdown'],\n  ['objc', 'Objective-C'],\n  ['plain', 'Plain Text'],\n  ['py', 'Python'],\n  ['rust', 'Rust'],\n  ['sql', 'SQL'],\n  ['swift', 'Swift'],\n  ['xml', 'XML'],\n];\n\nconst CodeLanguageDropdown = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { selectedElementKey, codeLanguage } = useContext(ToolbarContext);\n  const onCodeLanguageSelect = useCallback(\n    (e) => {\n      activeEditor.update(() => {\n        if (selectedElementKey !== null) {\n          const node = $getNodeByKey(selectedElementKey);\n          if ($isCodeNode(node)) {\n            console.log(e.target.value);\n            node.setLanguage(e.target.value);\n          }\n        }\n      });\n    },\n    [activeEditor, selectedElementKey]\n  );\n\n  return (\n    <>\n      <Select\n        className=\"toolbar-item code-language\"\n        onChange={onCodeLanguageSelect}\n        options={CODE_LANGUAGE_OPTIONS}\n        value={codeLanguage}\n      />\n      <i className=\"chevron-down inside\" />\n    </>\n  );\n};\n\nexport default CodeLanguageDropdown;\n","import { $createCodeNode } from '@lexical/code';\nimport {\n  INSERT_CHECK_LIST_COMMAND,\n  INSERT_ORDERED_LIST_COMMAND,\n  INSERT_UNORDERED_LIST_COMMAND,\n  REMOVE_LIST_COMMAND,\n} from '@lexical/list';\nimport { $createHeadingNode, $createQuoteNode } from '@lexical/rich-text';\nimport { $wrapNodes } from '@lexical/selection';\nimport {\n  $createParagraphNode,\n  $getSelection,\n  $isRangeSelection,\n  LexicalEditor,\n} from 'lexical';\nimport React, { useContext } from 'react';\nimport EditorContext from '../../../context/EditorContext';\nimport DropDown from '../../../ui/DropDown';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst BlockFormatDropdown = () => {\n  const { initialEditor } = useContext(EditorContext);\n  const { blockType } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n  const formatParagraph = () => {\n    if (blockType !== 'paragraph') {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          $wrapNodes(selection, () => $createParagraphNode());\n        }\n      });\n    }\n  };\n\n  const formatHeading = (headingSize) => {\n    if (blockType !== headingSize) {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          $wrapNodes(selection, () => $createHeadingNode(headingSize));\n        }\n      });\n    }\n  };\n\n  const formatBulletList = () => {\n    if (blockType !== 'bullet') {\n      initialEditor.dispatchCommand(INSERT_UNORDERED_LIST_COMMAND, undefined);\n    } else {\n      initialEditor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatCheckList = () => {\n    if (blockType !== 'check') {\n      initialEditor.dispatchCommand(INSERT_CHECK_LIST_COMMAND, undefined);\n    } else {\n      initialEditor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatNumberedList = () => {\n    if (blockType !== 'number') {\n      initialEditor.dispatchCommand(INSERT_ORDERED_LIST_COMMAND, undefined);\n    } else {\n      initialEditor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatQuote = () => {\n    if (blockType !== 'quote') {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          $wrapNodes(selection, () => $createQuoteNode());\n        }\n      });\n    }\n  };\n\n  const formatCode = () => {\n    if (blockType !== 'code') {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          if (selection.isCollapsed()) {\n            $wrapNodes(selection, () => $createCodeNode());\n          } else {\n            const textContent = selection.getTextContent();\n            const codeNode = $createCodeNode();\n            selection.removeText();\n            selection.insertNodes([codeNode]);\n            selection.insertRawText(textContent);\n          }\n        }\n      });\n    }\n  };\n\n  return (\n    <DropDown\n      buttonLabel={t(`blockFormatDropdown.${blockType}`)}\n      buttonAriaLabel={t('toolbar:blockFormatDropdown.Description')}\n      buttonClassName=\"toolbar-item block-controls\"\n      buttonIconClassName={'icon block-type ' + blockType}\n    >\n      <button className=\"item\" onClick={formatParagraph} type=\"button\">\n        <span className=\"icon paragraph\" />\n        <span className=\"text\">{t('toolbar:blockFormatDropdown.paragraph')}</span>\n        {blockType === 'paragraph' && <span className=\"active\" />}\n      </button>\n      <button\n        className=\"item\"\n        onClick={() => formatHeading('h1')}\n        type=\"button\"\n      >\n        <span className=\"icon h1\" />\n        <span className=\"text\">\n          {t('toolbar:blockFormatDropdown.h1')}\n        </span>\n        {blockType === 'h1' && <span className=\"active\" />}\n      </button>\n      <button\n        className=\"item\"\n        onClick={() => formatHeading('h2')}\n        type=\"button\"\n      >\n        <span className=\"icon h2\" />\n        <span className=\"text\">\n          {t('toolbar:blockFormatDropdown.h2')}\n        </span>\n        {blockType === 'h2' && <span className=\"active\" />}\n      </button>\n      <button\n        className=\"item\"\n        onClick={() => formatHeading('h3')}\n        type=\"button\"\n      >\n        <span className=\"icon h3\" />\n        <span className=\"text\">\n          {t('toolbar:blockFormatDropdown.h3')}\n        </span>\n        {blockType === 'h3' && <span className=\"active\" />}\n      </button>\n      <button className=\"item\" onClick={formatBulletList} type=\"button\">\n        <span className=\"icon bullet-list\" />\n        <span className=\"text\">\n          {t('toolbar:blockFormatDropdown.bullet')}\n        </span>\n        {blockType === 'bullet' && <span className=\"active\" />}\n      </button>\n      <button className=\"item\" onClick={formatNumberedList} type=\"button\">\n        <span className=\"icon numbered-list\" />\n        <span className=\"text\">\n          {t('toolbar:blockFormatDropdown.number')}\n        </span>\n        {blockType === 'number' && <span className=\"active\" />}\n      </button>\n      <button className=\"item\" onClick={formatCheckList} type=\"button\">\n        <span className=\"icon check-list\" />\n        <span className=\"text\">\n          {t('toolbar:blockFormatDropdown.check')}\n        </span>\n        {blockType === 'check' && <span className=\"active\" />}\n      </button>\n      <button className=\"item\" onClick={formatQuote} type=\"button\">\n        <span className=\"icon quote\" />\n        <span className=\"text\">{t('toolbar:blockFormatDropdown.quote')}</span>\n        {blockType === 'quote' && <span className=\"active\" />}\n      </button>\n      <button className=\"item\" onClick={formatCode} type=\"button\">\n        <span className=\"icon code\" />\n        <span className=\"text\">\n          {t('toolbar:blockFormatDropdown.code')}\n        </span>\n        {blockType === 'code' && <span className=\"active\" />}\n      </button>\n    </DropDown>\n  );\n};\n\nexport default BlockFormatDropdown;\n","import React from 'react';\n\nexport default function Divider(): JSX.Element {\n  return <div className=\"divider\" />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { $isCodeNode } from '@lexical/code';\nimport { $isLinkNode, TOGGLE_LINK_COMMAND } from '@lexical/link';\nimport { $isListNode, ListNode } from '@lexical/list';\nimport { $isHeadingNode } from '@lexical/rich-text';\nimport {\n  $getSelectionStyleValueForProperty,\n  $isParentElementRTL,\n  $patchStyleText,\n} from '@lexical/selection';\nimport { $getNearestNodeOfType, mergeRegister } from '@lexical/utils';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  CAN_REDO_COMMAND,\n  CAN_UNDO_COMMAND,\n  COMMAND_PRIORITY_CRITICAL,\n  SELECTION_CHANGE_COMMAND,\n} from 'lexical';\nimport * as React from 'react';\nimport { useCallback, useContext, useEffect, useRef, useState } from 'react';\nimport useChild from 'use-child';\nimport { getSelectedNode } from '../../utils/node.util';\nimport EditorContext from '../../context/EditorContext';\nimport ToolbarContext from '../../context/ToolbarContext';\nimport AlignDropdown from './components/AlignDropdown';\nimport InsertDropdown from './components/InsertDropdown';\nimport './ToolbarPlugin.css';\nimport UndoButton from './components/UndoButton';\nimport RedoButton from './components/RedoButton';\nimport CodeLanguageDropdown from './components/CodeLanguageDropdown';\nimport BlockFormatDropdown from './components/BlockFormatDropdown';\nimport Divider from '../../ui/Divider';\n\nconst supportedBlockTypes = new Set([\n  'paragraph',\n  'quote',\n  'code',\n  'h1',\n  'h2',\n  'h3',\n  'bullet',\n  'number',\n  'check',\n]);\n\nconst CODE_LANGUAGE_MAP = {\n  javascript: 'js',\n  md: 'markdown',\n  plaintext: 'plain',\n  python: 'py',\n  text: 'plain',\n};\n\ninterface IToolbarProps {\n  children?: React.ReactElement | React.ReactElement[];\n  defaultFontSize?: string /** The default selected font size in the toolbar */;\n  defaultFontColor?: string /** The default selected font color in the toolbar */;\n  defaultBgColor?: string /** The default selected background color in the toolbar */;\n  defaultFontFamily?: string /** The default selected font family in the toolbar */;\n}\n\nconst ToolbarPlugin = ({\n  children,\n  defaultFontSize = '15px',\n  defaultFontColor = '#000',\n  defaultBgColor = '#fff',\n  defaultFontFamily = 'Arial',\n}: IToolbarProps) => {\n  const [insertExists, InsertComponent] = useChild(children, InsertDropdown);\n  const [alignExists, AlignComponent] = useChild(children, AlignDropdown);\n\n  const { initialEditor, activeEditor, setActiveEditor } =\n    useContext(EditorContext);\n  const [blockType, setBlockType] = useState('paragraph');\n  const [selectedElementKey, setSelectedElementKey] = useState(null);\n  const [fontSize, setFontSize] = useState<string>(defaultFontSize);\n  const [fontColor, setFontColor] = useState<string>(defaultFontColor);\n  const [bgColor, setBgColor] = useState<string>(defaultBgColor);\n  const [fontFamily, setFontFamily] = useState<string>(defaultFontFamily);\n  const [isLink, setIsLink] = useState(false);\n  const [isBold, setIsBold] = useState(false);\n  const [isItalic, setIsItalic] = useState(false);\n  const [isUnderline, setIsUnderline] = useState(false);\n  const [isStrikethrough, setIsStrikethrough] = useState(false);\n  const [isSubscript, setIsSubscript] = useState(false);\n  const [isSuperscript, setIsSuperscript] = useState(false);\n  const [isCode, setIsCode] = useState(false);\n  const [canUndo, setCanUndo] = useState(false);\n  const [canRedo, setCanRedo] = useState(false);\n  const [isRTL, setIsRTL] = useState(false);\n  const [codeLanguage, setCodeLanguage] = useState<string>('');\n\n  const updateToolbar = useCallback(() => {\n    const selection = $getSelection();\n    if ($isRangeSelection(selection)) {\n      const anchorNode = selection.anchor.getNode();\n      const element =\n        anchorNode.getKey() === 'root'\n          ? anchorNode\n          : anchorNode.getTopLevelElementOrThrow();\n      const elementKey = element.getKey();\n      const elementDOM = activeEditor.getElementByKey(elementKey);\n\n      // Update text format\n      setIsBold(selection.hasFormat('bold'));\n      setIsItalic(selection.hasFormat('italic'));\n      setIsUnderline(selection.hasFormat('underline'));\n      setIsStrikethrough(selection.hasFormat('strikethrough'));\n      setIsSubscript(selection.hasFormat('subscript'));\n      setIsSuperscript(selection.hasFormat('superscript'));\n      setIsCode(selection.hasFormat('code'));\n      setIsRTL($isParentElementRTL(selection));\n\n      // Update links\n      const node = getSelectedNode(selection);\n      const parent = node.getParent();\n      if ($isLinkNode(parent) || $isLinkNode(node)) {\n        setIsLink(true);\n      } else {\n        setIsLink(false);\n      }\n\n      if (elementDOM !== null) {\n        setSelectedElementKey(elementKey);\n        if ($isListNode(element)) {\n          const parentList = $getNearestNodeOfType<ListNode>(\n            anchorNode,\n            ListNode\n          );\n          const type = parentList\n            ? parentList.getListType()\n            : element.getListType();\n          setBlockType(type);\n        } else {\n          const type = $isHeadingNode(element)\n            ? element.getTag()\n            : element.getType();\n          setBlockType(type);\n          if ($isCodeNode(element)) {\n            const language = element.getLanguage();\n            setCodeLanguage(\n              language ? CODE_LANGUAGE_MAP[language] || language : ''\n            );\n            return;\n          }\n        }\n      }\n      // Hande buttons\n      setFontSize(\n        $getSelectionStyleValueForProperty(\n          selection,\n          'font-size',\n          defaultFontSize\n        )\n      );\n      setFontColor(\n        $getSelectionStyleValueForProperty(selection, 'color', defaultFontColor)\n      );\n      setBgColor(\n        $getSelectionStyleValueForProperty(\n          selection,\n          'background-color',\n          defaultBgColor\n        )\n      );\n\n      setFontFamily(\n        $getSelectionStyleValueForProperty(\n          selection,\n          'font-family',\n          defaultFontFamily\n        )\n      );\n    }\n  }, [activeEditor]);\n\n  useEffect(() => {\n    return initialEditor.registerCommand(\n      SELECTION_CHANGE_COMMAND,\n      (_payload, newEditor) => {\n        updateToolbar();\n        setActiveEditor(newEditor);\n        return false;\n      },\n      COMMAND_PRIORITY_CRITICAL\n    );\n  }, [initialEditor, updateToolbar]);\n\n  useEffect(() => {\n    return mergeRegister(\n      activeEditor.registerUpdateListener(({ editorState }) => {\n        editorState.read(() => {\n          updateToolbar();\n        });\n      }),\n      activeEditor.registerCommand<boolean>(\n        CAN_UNDO_COMMAND,\n        (payload) => {\n          setCanUndo(payload);\n          return false;\n        },\n        COMMAND_PRIORITY_CRITICAL\n      ),\n      activeEditor.registerCommand<boolean>(\n        CAN_REDO_COMMAND,\n        (payload) => {\n          setCanRedo(payload);\n          return false;\n        },\n        COMMAND_PRIORITY_CRITICAL\n      )\n    );\n  }, [activeEditor, updateToolbar]);\n\n  const applyStyleText = useCallback(\n    (styles: Record<string, string>) => {\n      activeEditor.update(() => {\n        const selection = $getSelection();\n        if ($isRangeSelection(selection)) {\n          $patchStyleText(selection, styles);\n        }\n      });\n    },\n    [activeEditor]\n  );\n\n  const insertLink = useCallback(() => {\n    if (!isLink) {\n      initialEditor.dispatchCommand(TOGGLE_LINK_COMMAND, 'https://');\n    } else {\n      initialEditor.dispatchCommand(TOGGLE_LINK_COMMAND, null);\n    }\n  }, [initialEditor, isLink]);\n\n  return (\n    <ToolbarContext.Provider\n      value={{\n        isRTL,\n        canUndo,\n        canRedo,\n        fontFamily,\n        fontSize,\n        fontColor,\n        bgColor,\n        isBold,\n        isItalic,\n        isUnderline,\n        isCode,\n        isLink,\n        applyStyleText,\n        insertLink,\n        isStrikethrough,\n        isSubscript,\n        isSuperscript,\n        selectedElementKey,\n        codeLanguage,\n        blockType,\n      }}\n    >\n      <div className=\"toolbar\">\n        <UndoButton />\n        <RedoButton />\n        <Divider />\n        {supportedBlockTypes.has(blockType) && activeEditor === initialEditor && (\n          <>\n            <BlockFormatDropdown />\n            <Divider />\n          </>\n        )}\n        {blockType === 'code' ? (\n          <>\n            <CodeLanguageDropdown />\n            <Divider />\n            {alignExists && AlignComponent}\n          </>\n        ) : (\n          <>{children}</>\n        )}\n      </div>\n    </ToolbarContext.Provider>\n  );\n};\n\nexport default ToolbarPlugin;\n","import { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  LexicalTypeaheadMenuPlugin,\n  MenuTextMatch,\n  MenuOption,\n  useBasicTypeaheadTriggerMatch,\n} from '@lexical/react/LexicalTypeaheadMenuPlugin';\nimport { TextNode } from 'lexical';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { renderToStaticMarkup } from 'react-dom/server';\nimport { $createMentionNode } from '../nodes/MentionNode';\nimport { $createAutoLinkNode } from '@lexical/link';\n\nimport './MentionsPlugin.css';\n\ntype SearchData<A> = (p: string) => Promise<A[]>;\n\ntype OffsetCard = {\n  leftOffset: number;\n  topOffset: number;\n};\n\ntype PopoverCard<A> = {\n  card: (data: A) => JSX.Element;\n  offset: OffsetCard;\n};\n\ntype UserCard = {\n  card: JSX.Element;\n  offset: OffsetCard;\n};\n\ntype GetTypeaheadValues<A> = (result: A) => {\n  url: string;\n  value: string;\n  picture: JSX.Element;\n  popoverCard?: PopoverCard<A>;\n};\n\nconst PUNCTUATION =\n  '\\\\.,\\\\+\\\\*\\\\?\\\\$\\\\@\\\\|#{}\\\\(\\\\)\\\\^\\\\-\\\\[\\\\]\\\\\\\\/!%\\'\"~=<>_:;';\nconst NAME = '\\\\b[A-Z][^\\\\s' + PUNCTUATION + ']';\n\nconst DocumentMentionsRegex = {\n  NAME,\n  PUNCTUATION,\n};\n\nconst CapitalizedNameMentionsRegex = new RegExp(\n  '(^|[^#])((?:' + DocumentMentionsRegex.NAME + '{' + 1 + ',})$)'\n);\n\nconst PUNC = DocumentMentionsRegex.PUNCTUATION;\n\nconst TRIGGERS = ['@'].join('');\n\n// Chars we expect to see in a mention (non-space, non-punctuation).\nconst VALID_CHARS = '[^' + TRIGGERS + PUNC + '\\\\s]';\n\n// Non-standard series of chars. Each series must be preceded and followed by\n// a valid char.\nconst VALID_JOINS =\n  '(?:' +\n  '\\\\.[ |$]|' + // E.g. \"r. \" in \"Mr. Smith\"\n  ' |' + // E.g. \" \" in \"Josh Duck\"\n  '[' +\n  PUNC +\n  ']|' + // E.g. \"-' in \"Salier-Hellendag\"\n  ')';\n\nconst LENGTH_LIMIT = 75;\n\nconst AtSignMentionsRegex = new RegExp(\n  '(^|\\\\s|\\\\()(' +\n    '[' +\n    TRIGGERS +\n    ']' +\n    '((?:' +\n    VALID_CHARS +\n    VALID_JOINS +\n    '){0,' +\n    LENGTH_LIMIT +\n    '})' +\n    ')$'\n);\n\n// 50 is the longest alias length limit.\nconst ALIAS_LENGTH_LIMIT = 50;\n\n// Regex used to match alias.\nconst AtSignMentionsRegexAliasRegex = new RegExp(\n  '(^|\\\\s|\\\\()(' +\n    '[' +\n    TRIGGERS +\n    ']' +\n    '((?:' +\n    VALID_CHARS +\n    '){0,' +\n    ALIAS_LENGTH_LIMIT +\n    '})' +\n    ')$'\n);\n\n// At most, 5 suggestions are shown in the popup.\nconst SUGGESTION_LIST_LENGTH_LIMIT = 5;\n\nconst mentionsCache = new Map();\n\nfunction useMentionLookupService<A>(\n  mentionString: string | null,\n  mentionData: SearchData<A>\n) {\n  const [results, setResults] = useState<Array<A>>([]);\n\n  useEffect(() => {\n    const cachedResults = mentionsCache.get(mentionString);\n\n    if (mentionString == null) {\n      setResults([]);\n      return;\n    }\n\n    if (cachedResults === null) {\n      return;\n    } else if (cachedResults !== undefined) {\n      setResults(cachedResults);\n      return;\n    }\n\n    mentionsCache.set(mentionString, null);\n\n    mentionData(mentionString).then((results) => {\n      mentionsCache.set(mentionString, results);\n      setResults(results);\n    });\n  }, [mentionString]);\n\n  return results;\n}\n\nfunction checkForCapitalizedNameMentions(\n  text: string,\n  minMatchLength: number\n): MenuTextMatch | null {\n  const match = CapitalizedNameMentionsRegex.exec(text);\n  if (match !== null) {\n    // The strategy ignores leading whitespace but we need to know it's\n    // length to add it to the leadOffset\n    const maybeLeadingWhitespace = match[1];\n\n    const matchingString = match[2];\n    if (matchingString != null && matchingString.length >= minMatchLength) {\n      return {\n        leadOffset: match.index + maybeLeadingWhitespace.length,\n        matchingString,\n        replaceableString: matchingString,\n      };\n    }\n  }\n  return null;\n}\n\nfunction checkForAtSignMentions(\n  text: string,\n  minMatchLength: number\n): MenuTextMatch | null {\n  let match = AtSignMentionsRegex.exec(text);\n\n  if (match === null) {\n    match = AtSignMentionsRegexAliasRegex.exec(text);\n  }\n  if (match !== null) {\n    // The strategy ignores leading whitespace but we need to know it's\n    // length to add it to the leadOffset\n    const maybeLeadingWhitespace = match[1];\n\n    const matchingString = match[3];\n    if (matchingString.length >= minMatchLength) {\n      return {\n        leadOffset: match.index + maybeLeadingWhitespace.length,\n        matchingString,\n        replaceableString: match[2],\n      };\n    }\n  }\n  return null;\n}\n\nfunction getPossibleMenuTextMatch(text: string): MenuTextMatch | null {\n  const match = checkForAtSignMentions(text, 1);\n  return match === null ? checkForCapitalizedNameMentions(text, 3) : match;\n}\n\nclass MentionMenuOption extends MenuOption {\n  name: string;\n  picture: JSX.Element;\n  url: string;\n  userCard: UserCard;\n\n  constructor(\n    name: string,\n    picture: JSX.Element,\n    url?: string,\n    userCard?: UserCard\n  ) {\n    super(name);\n    this.name = name;\n    this.picture = picture;\n    this.url = url;\n    this.userCard = userCard;\n  }\n}\n\nfunction MentionsTypeaheadMenuItem({\n  index,\n  isSelected,\n  onClick,\n  onMouseEnter,\n  option,\n}: {\n  index: number;\n  isSelected: boolean;\n  onClick: () => void;\n  onMouseEnter: () => void;\n  option: MentionMenuOption;\n}) {\n  let className = 'item';\n  if (isSelected) {\n    className += ' selected';\n  }\n  return (\n    <li\n      key={option.key}\n      tabIndex={-1}\n      className={className}\n      ref={option.setRefElement}\n      role=\"option\"\n      aria-selected={isSelected}\n      id={'typeahead-item-' + index}\n      onMouseEnter={onMouseEnter}\n      onClick={onClick}\n    >\n      {option.picture}\n      <span className=\"text\">{option.name}</span>\n    </li>\n  );\n}\n\nexport default function MentionsPlugin<A>(props: {\n  searchData: SearchData<A>;\n  getTypeaheadValues: GetTypeaheadValues<A>;\n}): JSX.Element | null {\n  const { searchData, getTypeaheadValues } = props;\n\n  const [editor] = useLexicalComposerContext();\n\n  const [queryString, setQueryString] = useState<string | null>(null);\n\n  const results = useMentionLookupService(queryString, searchData);\n\n  const checkForSlashTriggerMatch = useBasicTypeaheadTriggerMatch('/', {\n    minLength: 0,\n  });\n\n  const options = useMemo(\n    () =>\n      results\n        .map(\n          (result) =>\n            new MentionMenuOption(\n              getTypeaheadValues(result).value,\n              getTypeaheadValues(result).picture,\n              getTypeaheadValues(result).url,\n              {\n                card: getTypeaheadValues(result).popoverCard.card(result),\n                offset: {\n                  leftOffset:\n                    getTypeaheadValues(result).popoverCard.offset.leftOffset,\n                  topOffset:\n                    getTypeaheadValues(result).popoverCard.offset.topOffset,\n                },\n              }\n            )\n        )\n        .slice(0, SUGGESTION_LIST_LENGTH_LIMIT),\n    [results]\n  );\n\n  const onSelectOption = useCallback(\n    (\n      selectedOption: MentionMenuOption,\n      nodeToReplace: TextNode | null,\n      closeMenu: () => void\n    ) => {\n      editor.update(() => {\n        if (nodeToReplace) {\n          const popover = document.createElement('div');\n          const staticElement = renderToStaticMarkup(\n            selectedOption.userCard.card\n          );\n          popover.innerHTML = staticElement;\n\n          const mentionNode = $createMentionNode(`@${selectedOption.name}`, {\n            card: popover,\n            leftOffset: selectedOption.userCard.offset.leftOffset,\n            topOffset: selectedOption.userCard.offset.topOffset,\n          });\n          const linkNode = $createAutoLinkNode(selectedOption.url);\n          linkNode.append(mentionNode);\n          nodeToReplace.replace(linkNode);\n          linkNode.select();\n        }\n        closeMenu();\n      });\n    },\n    [editor]\n  );\n\n  const checkForMentionMatch = useCallback(\n    (text: string) => {\n      const mentionMatch = getPossibleMenuTextMatch(text);\n      const slashMatch = checkForSlashTriggerMatch(text, editor);\n      return !slashMatch && mentionMatch ? mentionMatch : null;\n    },\n    [checkForSlashTriggerMatch, editor]\n  );\n\n  return (\n    <LexicalTypeaheadMenuPlugin<MentionMenuOption>\n      onQueryChange={setQueryString}\n      onSelectOption={onSelectOption}\n      triggerFn={checkForMentionMatch}\n      options={options}\n      menuRenderFn={(\n        anchorElementRef,\n        { selectedIndex, selectOptionAndCleanUp, setHighlightedIndex }\n      ) =>\n        anchorElementRef && results.length\n          ? ReactDOM.createPortal(\n              <div className=\"typeahead-popover mentions-menu\">\n                <ul>\n                  {options.map((option, i: number) => (\n                    <MentionsTypeaheadMenuItem\n                      index={i}\n                      isSelected={selectedIndex === i}\n                      onClick={() => {\n                        setHighlightedIndex(i);\n                        selectOptionAndCleanUp(option);\n                      }}\n                      onMouseEnter={() => {\n                        setHighlightedIndex(i);\n                      }}\n                      key={option.key}\n                      option={option}\n                    />\n                  ))}\n                </ul>\n              </div>,\n              anchorElementRef.current\n            )\n          : null\n      }\n    />\n  );\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './ColorPicker.css';\n\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport * as React from 'react';\n\nimport DropDown from './DropDown';\n\ninterface ColorPickerProps {\n  buttonAriaLabel?: string;\n  buttonClassName: string;\n  buttonIconClassName?: string;\n  buttonLabel?: string;\n  color?: string;\n  children?: JSX.Element;\n  onChange?: (color: string) => void;\n  title?: string;\n}\n\nconst basicColors = [\n  '#d0021b',\n  '#f5a623',\n  '#f8e71c',\n  '#8b572a',\n  '#7ed321',\n  '#417505',\n  '#bd10e0',\n  '#9013fe',\n  '#4a90e2',\n  '#50e3c2',\n  '#b8e986',\n  '#000000',\n  '#4a4a4a',\n  '#9b9b9b',\n  '#ffffff',\n];\n\nconst WIDTH = 214;\nconst HEIGHT = 150;\n\nexport default function ColorPicker({\n  color,\n  children,\n  onChange,\n  ...rest\n}: Readonly<ColorPickerProps>): JSX.Element {\n  const [selfColor, setSelfColor] = useState(transformColor('hex', color));\n\n  const saturationPosition = useMemo(\n    () => ({\n      x: (selfColor.hsv.s / 100) * WIDTH,\n      y: ((100 - selfColor.hsv.v) / 100) * HEIGHT,\n    }),\n    [selfColor.hsv.s, selfColor.hsv.v]\n  );\n\n  const huePosition = useMemo(\n    () => ({\n      x: (selfColor.hsv.h / 360) * WIDTH,\n    }),\n    [selfColor.hsv]\n  );\n\n  const onMoveSaturation = ({ x, y }: Position) => {\n    const newHsv = {\n      ...selfColor.hsv,\n      s: (x / WIDTH) * 100,\n      v: 100 - (y / HEIGHT) * 100,\n    };\n    const newColor = transformColor('hsv', newHsv);\n    setSelfColor(newColor);\n  };\n\n  const onMoveHue = ({ x }: Position) => {\n    const newHsv = { ...selfColor.hsv, h: (x / WIDTH) * 360 };\n    const newColor = transformColor('hsv', newHsv);\n\n    setSelfColor(newColor);\n  };\n\n  useEffect(() => {\n    onChange(selfColor.hex);\n  }, [selfColor, onChange]);\n\n  useEffect(() => {\n    if (color === undefined) return;\n    setSelfColor(transformColor('hex', color));\n  }, [color]);\n\n  return (\n    <DropDown {...rest} stopCloseOnClickSelf={true}>\n      <div className=\"color-picker-wrapper\" style={{ width: WIDTH }}>\n        <div className=\"color-picker-basic-color\">\n          {basicColors.map((basicColor) => (\n            <button\n              className={basicColor === selfColor.hex ? ' active' : ''}\n              key={basicColor}\n              style={{ backgroundColor: basicColor }}\n              onClick={() => setSelfColor(transformColor('hex', basicColor))}\n              type=\"button\"\n            />\n          ))}\n        </div>\n        <MoveWrapper\n          className=\"color-picker-saturation\"\n          style={{ backgroundColor: `hsl(${selfColor.hsv.h}, 100%, 50%)` }}\n          onChange={onMoveSaturation}\n        >\n          <div\n            className=\"color-picker-saturation_cursor\"\n            style={{\n              backgroundColor: selfColor.hex,\n              left: saturationPosition.x,\n              top: saturationPosition.y,\n            }}\n          />\n        </MoveWrapper>\n        <MoveWrapper className=\"color-picker-hue\" onChange={onMoveHue}>\n          <div\n            className=\"color-picker-hue_cursor\"\n            style={{\n              backgroundColor: `hsl(${selfColor.hsv.h}, 100%, 50%)`,\n              left: huePosition.x,\n            }}\n          />\n        </MoveWrapper>\n        <div className=\"color-picker-info\">\n          <span>{selfColor.hex}</span>\n          <div\n            className=\"color-picker-color\"\n            style={{ backgroundColor: selfColor.hex }}\n          />\n        </div>\n      </div>\n      {children}\n    </DropDown>\n  );\n}\n\nexport interface Position {\n  x: number;\n  y: number;\n}\n\ninterface MoveWrapperProps {\n  className?: string;\n  style?: React.CSSProperties;\n  onChange: (position: Position) => void;\n  children: JSX.Element;\n}\n\nfunction MoveWrapper({\n  className,\n  style,\n  onChange,\n  children,\n}: MoveWrapperProps) {\n  const divRef = useRef<HTMLDivElement>(null);\n\n  const move = (e: React.MouseEvent | MouseEvent): void => {\n    if (divRef.current) {\n      const { current: div } = divRef;\n      const { width, height, left, top } = div.getBoundingClientRect();\n\n      const x = clamp(e.clientX - left, width, 0);\n      const y = clamp(e.clientY - top, height, 0);\n\n      onChange({ x, y });\n    }\n  };\n\n  const onMouseDown = (e: React.MouseEvent): void => {\n    if (e.button !== 0) return;\n\n    move(e);\n\n    const onMouseMove = (_e: MouseEvent): void => {\n      move(_e);\n    };\n\n    const onMouseUp = (_e: MouseEvent): void => {\n      document.removeEventListener('mousemove', onMouseMove, false);\n      document.removeEventListener('mouseup', onMouseUp, false);\n\n      move(_e);\n    };\n\n    document.addEventListener('mousemove', onMouseMove, false);\n    document.addEventListener('mouseup', onMouseUp, false);\n  };\n\n  return (\n    <div\n      ref={divRef}\n      className={className}\n      style={style}\n      onMouseDown={onMouseDown}\n    >\n      {children}\n    </div>\n  );\n}\n\nfunction clamp(value: number, max: number, min: number) {\n  return value > max ? max : value < min ? min : value;\n}\n\ninterface RGB {\n  b: number;\n  g: number;\n  r: number;\n}\ninterface HSV {\n  h: number;\n  s: number;\n  v: number;\n}\ninterface Color {\n  hex: string;\n  hsv: HSV;\n  rgb: RGB;\n}\n\nexport function toHex(value: string): string {\n  if (!value.startsWith('#')) {\n    const ctx = document.createElement('canvas').getContext('2d');\n\n    if (!ctx) {\n      throw new Error('2d context not supported or canvas already initialized');\n    }\n\n    ctx.fillStyle = value;\n\n    return ctx.fillStyle;\n  } else if (value.length === 4 || value.length === 5) {\n    value = value\n      .split('')\n      .map((v, i) => (i ? v + v : '#'))\n      .join('');\n\n    return value;\n  } else if (value.length === 7 || value.length === 9) {\n    return value;\n  }\n\n  return '#000000';\n}\n\nfunction hex2rgb(hex: string): RGB {\n  const rbgArr = hex\n    .replace(\n      /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i,\n      (m, r, g, b) => '#' + r + r + g + g + b + b\n    )\n    .substring(1)\n    .match(/.{2}/g)\n    .map((x) => parseInt(x, 16));\n\n  return {\n    b: rbgArr[2],\n    g: rbgArr[1],\n    r: rbgArr[0],\n  };\n}\n\nfunction rgb2hsv({ r, g, b }: RGB): HSV {\n  r /= 255;\n  g /= 255;\n  b /= 255;\n\n  const max = Math.max(r, g, b);\n  const d = max - Math.min(r, g, b);\n\n  const h = d\n    ? (max === r\n        ? (g - b) / d + (g < b ? 6 : 0)\n        : max === g\n        ? 2 + (b - r) / d\n        : 4 + (r - g) / d) * 60\n    : 0;\n  const s = max ? (d / max) * 100 : 0;\n  const v = max * 100;\n\n  return { h, s, v };\n}\n\nfunction hsv2rgb({ h, s, v }: HSV): RGB {\n  s /= 100;\n  v /= 100;\n\n  const i = ~~(h / 60);\n  const f = h / 60 - i;\n  const p = v * (1 - s);\n  const q = v * (1 - s * f);\n  const t = v * (1 - s * (1 - f));\n  const index = i % 6;\n\n  const r = Math.round([v, q, p, p, t, v][index] * 255);\n  const g = Math.round([t, v, v, q, p, p][index] * 255);\n  const b = Math.round([p, p, t, v, v, q][index] * 255);\n\n  return { b, g, r };\n}\n\nfunction rgb2hex({ b, g, r }: RGB): string {\n  return '#' + [r, g, b].map((x) => x.toString(16).padStart(2, '0')).join('');\n}\n\nfunction transformColor<M extends keyof Color, C extends Color[M]>(\n  format: M,\n  color: C\n): Color {\n  let hex: Color['hex'] = toHex('#121212');\n  let rgb: Color['rgb'] = hex2rgb(hex);\n  let hsv: Color['hsv'] = rgb2hsv(rgb);\n\n  if (format === 'hex') {\n    const value = color as Color['hex'];\n\n    hex = toHex(value);\n    rgb = hex2rgb(hex);\n    hsv = rgb2hsv(rgb);\n  } else if (format === 'rgb') {\n    const value = color as Color['rgb'];\n\n    rgb = value;\n    hex = rgb2hex(rgb);\n    hsv = rgb2hsv(rgb);\n  } else if (format === 'hsv') {\n    const value = color as Color['hsv'];\n\n    hsv = value;\n    rgb = hsv2rgb(hsv);\n    hex = rgb2hex(rgb);\n  }\n\n  return { hex, hsv, rgb };\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './LinkPreview.css';\n\nimport * as React from 'react';\nimport { Suspense } from 'react';\n\n// Cached responses or running request promises\nconst PREVIEW_CACHE = {};\n\nconst URL_MATCHER =\n  /((https?:\\/\\/(www\\.)?)|(www\\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/;\n\nfunction useSuspenseRequest(url: string) {\n  let cached = PREVIEW_CACHE[url];\n\n  if (!url.match(URL_MATCHER)) {\n    return { preview: null };\n  }\n\n  if (!cached) {\n    cached = PREVIEW_CACHE[url] = fetch(\n      `/api/link-preview?url=${encodeURI(url)}`\n    )\n      .then((response) => response.json())\n      .then((preview) => {\n        PREVIEW_CACHE[url] = preview;\n        return preview;\n      })\n      .catch(() => {\n        PREVIEW_CACHE[url] = { preview: null };\n      });\n  }\n\n  if (cached instanceof Promise) {\n    throw cached;\n  }\n\n  return cached;\n}\n\nfunction LinkPreviewContent({\n  url,\n}: Readonly<{\n  url: string;\n}>): JSX.Element {\n  const { preview } = useSuspenseRequest(url);\n  if (preview === null) {\n    return null;\n  }\n  return (\n    <div className=\"LinkPreview__container\">\n      {preview.img && (\n        <div className=\"LinkPreview__imageWrapper\">\n          <img\n            src={preview.img}\n            alt={preview.title}\n            className=\"LinkPreview__image\"\n          />\n        </div>\n      )}\n      {preview.domain && (\n        <div className=\"LinkPreview__domain\">{preview.domain}</div>\n      )}\n      {preview.title && (\n        <div className=\"LinkPreview__title\">{preview.title}</div>\n      )}\n      {preview.description && (\n        <div className=\"LinkPreview__description\">{preview.description}</div>\n      )}\n    </div>\n  );\n}\n\nfunction Glimmer(props): JSX.Element {\n  return (\n    <div\n      className=\"LinkPreview__glimmer\"\n      {...props}\n      style={{\n        animationDelay: (props.index || 0) * 300,\n        ...(props.style || {}),\n      }}\n    />\n  );\n}\n\nexport default function LinkPreview({\n  url,\n}: Readonly<{\n  url: string;\n}>): JSX.Element {\n  return (\n    <Suspense\n      fallback={\n        <>\n          <Glimmer style={{ height: '80px' }} index={0} />\n          <Glimmer style={{ width: '60%' }} index={1} />\n          <Glimmer style={{ width: '80%' }} index={2} />\n        </>\n      }\n    >\n      <LinkPreviewContent url={url} />\n    </Suspense>\n  );\n}\n","import { $isLinkNode, TOGGLE_LINK_COMMAND } from '@lexical/link';\nimport { $isAtNodeEnd } from '@lexical/selection';\nimport { mergeRegister } from '@lexical/utils';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_LOW,\n  ElementNode,\n  LexicalEditor,\n  RangeSelection,\n  SELECTION_CHANGE_COMMAND,\n  TextNode,\n} from 'lexical';\nimport React from 'react';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport LinkPreview from '../../../ui/LinkPreview';\nimport { getSelectedNode } from '../../../utils/node.util';\n\nfunction positionEditorElement(editor, rect) {\n  if (rect === null) {\n    editor.style.opacity = '0';\n    editor.style.top = '-1000px';\n    editor.style.left = '-1000px';\n  } else {\n    editor.style.opacity = '1';\n    editor.style.top = `${rect.top + rect.height + window.pageYOffset + 10}px`;\n    editor.style.left = `${\n      rect.left + window.pageXOffset - editor.offsetWidth / 2 + rect.width / 2\n    }px`;\n  }\n}\n\nfunction FloatingLinkEditor({\n  editor,\n}: {\n  editor: LexicalEditor;\n}): JSX.Element {\n  const editorRef = useRef<HTMLDivElement | null>(null);\n  const inputRef = useRef(null);\n  const [linkUrl, setLinkUrl] = useState('');\n  const [isEditMode, setEditMode] = useState(false);\n  const [lastSelection, setLastSelection] = useState(null);\n\n  const updateLinkEditor = useCallback(() => {\n    const selection = $getSelection();\n    if ($isRangeSelection(selection)) {\n      const node = getSelectedNode(selection);\n      const parent = node.getParent();\n      if ($isLinkNode(parent)) {\n        setLinkUrl(parent.getURL());\n      } else if ($isLinkNode(node)) {\n        setLinkUrl(node.getURL());\n      } else {\n        setLinkUrl('');\n      }\n    }\n    const editorElem = editorRef.current;\n    const nativeSelection = window.getSelection();\n    const activeElement = document.activeElement;\n\n    if (editorElem === null) {\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n    if (\n      selection !== null &&\n      !nativeSelection.isCollapsed &&\n      rootElement !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const domRange = nativeSelection.getRangeAt(0);\n      let rect;\n      if (nativeSelection.anchorNode === rootElement) {\n        let inner = rootElement;\n        while (inner.firstElementChild != null) {\n          inner = inner.firstElementChild as HTMLElement;\n        }\n        rect = inner.getBoundingClientRect();\n      } else {\n        rect = domRange.getBoundingClientRect();\n      }\n\n      positionEditorElement(editorElem, rect);\n      setLastSelection(selection);\n    } else if (!activeElement || activeElement.className !== 'link-input') {\n      positionEditorElement(editorElem, null);\n      setLastSelection(null);\n      setEditMode(false);\n      setLinkUrl('');\n    }\n\n    return true;\n  }, [editor]);\n\n  useEffect(() => {\n    const onResize = () => {\n      editor.getEditorState().read(() => {\n        updateLinkEditor();\n      });\n    };\n    window.addEventListener('resize', onResize);\n\n    return () => {\n      window.removeEventListener('resize', onResize);\n    };\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerUpdateListener(({ editorState }) => {\n        editorState.read(() => {\n          updateLinkEditor();\n        });\n      }),\n\n      editor.registerCommand(\n        SELECTION_CHANGE_COMMAND,\n        () => {\n          updateLinkEditor();\n          return true;\n        },\n        COMMAND_PRIORITY_LOW\n      )\n    );\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      updateLinkEditor();\n    });\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    if (isEditMode && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [isEditMode]);\n\n  return (\n    <div ref={editorRef} className=\"link-editor\">\n      {isEditMode ? (\n        <input\n          ref={inputRef}\n          className=\"link-input\"\n          value={linkUrl}\n          onChange={(event) => {\n            setLinkUrl(event.target.value);\n          }}\n          onKeyDown={(event) => {\n            if (event.key === 'Enter') {\n              event.preventDefault();\n              if (lastSelection !== null) {\n                if (linkUrl !== '') {\n                  editor.dispatchCommand(TOGGLE_LINK_COMMAND, linkUrl);\n                }\n                setEditMode(false);\n              }\n            } else if (event.key === 'Escape') {\n              event.preventDefault();\n              setEditMode(false);\n            }\n          }}\n        />\n      ) : (\n        <>\n          <div className=\"link-input\">\n            <a href={linkUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n              {linkUrl}\n            </a>\n            <div\n              className=\"link-edit\"\n              role=\"button\"\n              tabIndex={0}\n              onMouseDown={(event) => event.preventDefault()}\n              onClick={() => {\n                setEditMode(true);\n              }}\n            />\n          </div>\n          <LinkPreview url={linkUrl} />\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default FloatingLinkEditor;\n","import React, { useCallback, useContext } from 'react';\nimport Select from '../../../ui/Select';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { FontOptions } from '../../../types';\n\nconst defaultFontFamilyOptions: FontOptions = [\n  ['Arial', 'Arial'],\n  ['Courier New', 'Courier New'],\n  ['Georgia', 'Georgia'],\n  ['Times New Roman', 'Times New Roman'],\n  ['Trebuchet MS', 'Trebuchet MS'],\n  ['Verdana', 'Verdana'],\n];\n\ninterface IFontFamilyDropdown {\n  fontOptions?: FontOptions;\n}\n\nconst FontFamilyDropdown = ({\n  fontOptions = defaultFontFamilyOptions,\n}: IFontFamilyDropdown) => {\n  const { fontFamily, applyStyleText } = useContext(ToolbarContext);\n\n  const onFontFamilySelect = useCallback(\n    (e) => {\n      applyStyleText({ 'font-family': e.target.value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <>\n      <Select\n        className=\"toolbar-item font-family\"\n        onChange={onFontFamilySelect}\n        options={fontOptions}\n        value={fontFamily}\n      />\n      <i className=\"chevron-down inside\" />\n    </>\n  );\n};\n\nexport default FontFamilyDropdown;\n","import React, { useCallback, useContext } from 'react';\nimport Select from '../../../ui/Select';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { FontOptions } from '../../../types';\n\nconst defaultFontSizeOptions: FontOptions = [\n  ['10px', '10px'],\n  ['11px', '11px'],\n  ['12px', '12px'],\n  ['13px', '13px'],\n  ['14px', '14px'],\n  ['15px', '15px'],\n  ['16px', '16px'],\n  ['17px', '17px'],\n  ['18px', '18px'],\n  ['19px', '19px'],\n  ['20px', '20px'],\n];\n\ninterface IFontSizeDropdown {\n  fontSizeOptions?: FontOptions;\n}\n\nconst FontSizeDropdown = ({\n  fontSizeOptions = defaultFontSizeOptions,\n}: IFontSizeDropdown) => {\n  const { fontSize, applyStyleText } = useContext(ToolbarContext);\n\n  const onFontSizeSelect = useCallback(\n    (e) => {\n      applyStyleText({ 'font-size': e.target.value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <>\n      <Select\n        className=\"toolbar-item font-size\"\n        onChange={onFontSizeSelect}\n        options={fontSizeOptions}\n        value={fontSize}\n      />\n      <i className=\"chevron-down inside\" />\n    </>\n  );\n};\n\nexport default FontSizeDropdown;\n","import {\n  $getSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n  LexicalCommand,\n} from 'lexical';\nimport {\n  $createCustomFieldNode,\n  CustomFieldNode,\n} from '../nodes/CustomFieldNode';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport * as React from 'react';\n\ntype Params = { text: string; id?: string };\n\nconst INSERT_CUSTOM_FIELD_COMMAND: LexicalCommand<Params> = createCommand();\n\nexport default function CustomFieldPlugin({\n  itemClassName = 'custom-field-selector',\n  listStyle = {},\n  itemStyle = {},\n  record = {},\n}: {\n  itemClassName: string;\n  listStyle: Record<string, any>;\n  itemStyle: Record<string, any>;\n  record?: Record<string, any>;\n}) {\n  const [editor] = useLexicalComposerContext();\n\n  React.useEffect(() => {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    if (!editor.hasNodes([CustomFieldNode])) {\n      throw new Error(\n        'CustomFieldPlugin: CustomFieldNode not registered on editor'\n      );\n    }\n\n    return editor.registerCommand(\n      INSERT_CUSTOM_FIELD_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n        const customFieldNode = $createCustomFieldNode(\n          payload.text,\n          payload.id\n        );\n\n        selection.insertNodes([customFieldNode]);\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  const onClick = (params: Params) => {\n    editor.update(() => {\n      editor.dispatchCommand(INSERT_CUSTOM_FIELD_COMMAND, params);\n    });\n  };\n\n  const entries = Object.entries(record);\n\n  return (\n    <div style={listStyle}>\n      {entries.map(([key, value]) => (\n        <div\n          key={key}\n          style={itemStyle}\n          className={itemClassName}\n          onClick={() => onClick({ text: value, id: key })}\n        >\n          {value}\n        </div>\n      ))}\n    </div>\n  );\n}\n","import type { LexicalEditor, NodeKey } from 'lexical';\n\nimport * as React from 'react';\nimport { Suspense, useRef } from 'react';\n\nconst imageCache = new Set();\n\nfunction useSuspenseImage(src: string) {\n  if (!imageCache.has(src)) {\n    throw new Promise((resolve) => {\n      const img = new Image();\n      img.src = src;\n      img.onload = () => {\n        imageCache.add(src);\n        resolve(null);\n      };\n    });\n  }\n}\n\nfunction LazyImage({\n  altText,\n  className,\n  imageRef,\n  src,\n  width,\n  height,\n  maxWidth,\n}: {\n  altText: string;\n  className: string | null;\n  height: 'inherit' | number;\n  imageRef: { current: null | HTMLImageElement };\n  maxWidth: number;\n  src: string;\n  width: 'inherit' | number;\n}): JSX.Element {\n  useSuspenseImage(src);\n  return (\n    <img\n      className={className || undefined}\n      src={src}\n      alt={altText}\n      ref={imageRef}\n      style={{\n        height,\n        maxWidth,\n        width,\n      }}\n    />\n  );\n}\n\nexport default function ImageComponent({\n  src,\n  altText,\n  width,\n  height,\n  maxWidth,\n}: {\n  altText: string;\n  caption: LexicalEditor;\n  height: 'inherit' | number;\n  maxWidth: number;\n  nodeKey: NodeKey;\n  resizable: boolean;\n  showCaption: boolean;\n  src: string;\n  width: 'inherit' | number;\n  captionsEnabled: boolean;\n}): JSX.Element {\n  const imageRef = useRef<null | HTMLImageElement>(null);\n\n  return (\n    <Suspense fallback={null}>\n      <>\n        <div>\n          <LazyImage\n            className=\"\"\n            src={src}\n            altText={altText}\n            imageRef={imageRef}\n            width={width}\n            height={height}\n            maxWidth={maxWidth}\n          />\n        </div>\n      </>\n    </Suspense>\n  );\n}\n","import React, { useCallback, useContext } from 'react';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport ColorPicker from '../../../ui/ColorPicker';\nimport { useTranslation } from 'react-i18next';\n\nconst BackgroundColorPicker = () => {\n  const { bgColor, applyStyleText } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  const onBgColorSelect = useCallback(\n    (value: string) => {\n      applyStyleText({ 'background-color': value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <ColorPicker\n      buttonClassName=\"toolbar-item color-picker\"\n      buttonAriaLabel={t('toolbar:backgroundColorPicker.Description')}\n      buttonIconClassName=\"icon bg-color\"\n      color={bgColor}\n      onChange={onBgColorSelect}\n      title=\"bg color\"\n    />\n  );\n};\n\nexport default BackgroundColorPicker;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst BoldButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isBold } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'bold');\n      }}\n      className={'toolbar-item spaced ' + (isBold ? 'active' : '')}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:boldButton.Title')} (⌘B)`\n          : `${t('toolbar:boldButton.Title')} (Ctrl + B)`\n      }\n      aria-label={`${t('toolbar:boldButton.Description')} ${\n        IS_APPLE ? '⌘B' : 'Ctrl+B'\n      }`}\n      type=\"button\"\n    >\n      <i className=\"format bold\" />\n    </button>\n  );\n};\n\nexport default BoldButton;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\n\nconst CodeFormatButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isCode } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'code');\n      }}\n      className={'toolbar-item spaced ' + (isCode ? 'active' : '')}\n      title={t('toolbar:codeFormatButton.Description')}\n      aria-label={t('toolbar:codeFormatButton.Description')}\n      type=\"button\"\n    >\n      <i className=\"format code\" />\n    </button>\n  );\n};\n\nexport default CodeFormatButton;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { AutoFocusPlugin } from '@lexical/react/LexicalAutoFocusPlugin';\nimport { CheckListPlugin } from '@lexical/react/LexicalCheckListPlugin';\nimport { ClearEditorPlugin } from '@lexical/react/LexicalClearEditorPlugin';\nimport { HashtagPlugin } from '@lexical/react/LexicalHashtagPlugin';\nimport { LinkPlugin } from '@lexical/react/LexicalLinkPlugin';\nimport { ListPlugin } from '@lexical/react/LexicalListPlugin';\nimport { RichTextPlugin } from '@lexical/react/LexicalRichTextPlugin';\nimport { OnChangePlugin } from '@lexical/react/LexicalOnChangePlugin';\nimport LexicalErrorBoundary from '@lexical/react/LexicalErrorBoundary';\nimport React, { ReactNode, useEffect, useState } from 'react';\nimport { useRef } from 'react';\n\nimport { useSettings } from './context/SettingsContext';\nimport { useSharedHistoryContext } from './context/SharedHistoryContext';\nimport ActionsPlugin from './plugins/ActionsPlugin';\nimport AutoLinkPlugin from './plugins/AutoLinkPlugin';\nimport CharacterStylesPopupPlugin from './plugins/CharacterStylesPopupPlugin';\nimport ClickableLinkPlugin from './plugins/ClickableLinkPlugin';\nimport CodeHighlightPlugin from './plugins/CodeHighlightPlugin';\nimport EmojisPlugin from './plugins/EmojisPlugin';\nimport KeywordsPlugin from './plugins/KeywordsPlugin';\nimport ListMaxIndentLevelPlugin from './plugins/ListMaxIndentLevelPlugin';\nimport MarkdownShortcutPlugin from './plugins/MarkdownShortcutPlugin';\nimport SpeechToTextPlugin from './plugins/SpeechToTextPlugin';\nimport TabFocusPlugin from './plugins/TabFocusPlugin';\nimport ContentEditable from './ui/ContentEditable';\nimport Placeholder from './ui/Placeholder';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport EditorContext from './context/EditorContext';\nimport { LexicalEditor } from 'lexical';\nimport { useTranslation } from 'react-i18next';\nimport DragDropPaste from './plugins/DragDropPastePlugin';\n\ninterface IEditorProps {\n  children?: ReactNode;\n  hashtagsEnabled?: boolean;\n  autoLinkEnabled?: boolean;\n  emojisEnabled?: boolean;\n  actionsEnabled?: boolean;\n  placeholder?: string;\n  listMaxIndent?: number;\n  isEditable?: boolean;\n  locale?: 'en' | 'fr' | 'ptBr' | 'ru' | null;\n  onChange?: (editorState: string, editorInstance?: LexicalEditor) => void;\n}\n\nconst Editor = ({\n  children,\n  hashtagsEnabled = false,\n  autoLinkEnabled = false,\n  emojisEnabled = false,\n  actionsEnabled = false,\n  listMaxIndent = 7,\n  placeholder = '',\n  isEditable = true,\n  locale = null,\n  onChange,\n}: IEditorProps) => {\n  const [editor] = useLexicalComposerContext();\n  const [activeEditor, setActiveEditor] = useState(editor);\n\n  const editorStateRef = useRef(null);\n  const { historyState } = useSharedHistoryContext();\n  const {\n    settings: { isRichText },\n  } = useSettings();\n  const placeholderComponent = <Placeholder>{placeholder}</Placeholder>;\n\n  const { i18n } = useTranslation();\n\n  useEffect(() => {\n    editor.setEditable(isEditable);\n\n    if (locale) i18n.changeLanguage(locale);\n  }, []);\n\n  return (\n    <EditorContext.Provider\n      value={{ initialEditor: editor, activeEditor, setActiveEditor }}\n    >\n      {children}\n      <div className={`editor-container`}>\n        <AutoFocusPlugin />\n        <ClearEditorPlugin />\n        {hashtagsEnabled && <HashtagPlugin />}\n        {emojisEnabled && <EmojisPlugin />}\n        <KeywordsPlugin />\n        <SpeechToTextPlugin />\n        <DragDropPaste />\n        {autoLinkEnabled && <AutoLinkPlugin />}\n\n        <>\n          <RichTextPlugin\n            contentEditable={<ContentEditable />}\n            placeholder={placeholderComponent}\n            ErrorBoundary={LexicalErrorBoundary}\n          />\n          <OnChangePlugin\n            onChange={(editorState) => {\n              onChange?.(JSON.stringify(editorState), activeEditor);\n              return (editorStateRef.current = editorState);\n            }}\n          />\n          <MarkdownShortcutPlugin />\n          <CodeHighlightPlugin />\n          <ListPlugin />\n          <CheckListPlugin />\n          <ListMaxIndentLevelPlugin maxDepth={listMaxIndent} />\n          <LinkPlugin />\n          <ClickableLinkPlugin />\n          <CharacterStylesPopupPlugin />\n          <TabFocusPlugin />\n        </>\n\n        <HistoryPlugin externalHistoryState={historyState} />\n        {actionsEnabled && <ActionsPlugin isRichText={isRichText} />}\n      </div>\n    </EditorContext.Provider>\n  );\n};\n\nexport default Editor;\n","import {\n  LexicalComposer,\n  InitialEditorStateType,\n} from '@lexical/react/LexicalComposer';\nimport React from 'react';\nimport PlaygroundNodes from './nodes/PlaygroundNodes';\nimport PlaygroundEditorTheme from './themes/PlaygroundEditorTheme';\nimport './EditorComposer.css';\nimport i18n from './locale';\nimport { I18nextProvider } from 'react-i18next';\nimport { LexicalNode } from 'lexical';\nimport { Class } from 'utility-types';\n\ninterface IEditorComposer {\n  children: React.ReactElement;\n  initialEditorState?: InitialEditorStateType;\n  extraNodes?: Class<LexicalNode>[];\n  editable?: boolean;\n}\n\nconst EditorComposer = ({\n  children,\n  initialEditorState,\n  extraNodes = [],\n  editable,\n}: IEditorComposer) => {\n  const initialConfig = {\n    namespace: 'VerbumEditor',\n    nodes: [...PlaygroundNodes, ...extraNodes],\n    onError: (error) => {\n      throw error;\n    },\n    theme: PlaygroundEditorTheme,\n    editorState: initialEditorState,\n    editable,\n  };\n  return (\n    <LexicalComposer initialConfig={initialConfig}>\n      <I18nextProvider i18n={i18n}>\n        <div className=\"editor-shell\">{children}</div>\n      </I18nextProvider>\n    </LexicalComposer>\n  );\n};\n\nexport default EditorComposer;\n","import React from 'react';\nimport { useContext } from 'react';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport FloatingLinkEditor from './FloatingLinkEditor';\nimport { createPortal } from 'react-dom';\nimport { useTranslation } from 'react-i18next';\n\nconst InsertLinkButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isLink, insertLink } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <>\n      <button\n        onClick={insertLink}\n        className={'toolbar-item spaced ' + (isLink ? 'active' : '')}\n        aria-label={t('toolbar:insertLinkButton.Description')}\n        title={t('toolbar:insertLinkButton.Description')}\n        type=\"button\"\n      >\n        <i className=\"format link\" />\n      </button>\n      {isLink &&\n        createPortal(\n          <FloatingLinkEditor editor={activeEditor} />,\n          document.body\n        )}\n    </>\n  );\n};\n\nexport default InsertLinkButton;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst ItalicButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isItalic } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'italic');\n      }}\n      className={'toolbar-item spaced ' + (isItalic ? 'active' : '')}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:italicButton.Title')} (⌘I)`\n          : `${t('toolbar:italicButton.Title')} (Ctrl+I)`\n      }\n      aria-label={`${t('toolbar:italicButton.Description')} ${\n        IS_APPLE ? '⌘I' : 'Ctrl+I'\n      }`}\n      type=\"button\"\n    >\n      <i className=\"format italic\" />\n    </button>\n  );\n};\n\nexport default ItalicButton;\n","import React, { useCallback, useContext } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport ColorPicker from '../../../ui/ColorPicker';\n\nconst TextColorPicker = () => {\n  const { fontColor, applyStyleText } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  const onFontColorSelect = useCallback(\n    (value: string) => {\n      applyStyleText({ color: value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <ColorPicker\n      buttonClassName=\"toolbar-item color-picker\"\n      buttonAriaLabel={t('toolbar:textColorPicker.Description')}\n      buttonIconClassName=\"icon font-color\"\n      color={fontColor}\n      onChange={onFontColorSelect}\n      title=\"text color\"\n    />\n  );\n};\n\nexport default TextColorPicker;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React, { useContext } from 'react';\nimport DropDown from '../../../ui/DropDown';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst TextFormatDropdown = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isStrikethrough, isSubscript, isSuperscript } =\n    useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <DropDown\n      buttonClassName=\"toolbar-item spaced\"\n      buttonLabel=\"\"\n      buttonAriaLabel={t('toolbar:textFormatDropdown.Description')}\n      buttonIconClassName=\"icon dropdown-more\"\n    >\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'strikethrough');\n        }}\n        className={\n          'item ' + (isStrikethrough ? 'active dropdown-item-active' : '')\n        }\n        title={t('toolbar:textFormatDropdown.Options.Strikethrough.Label')}\n        aria-label={t(\n          'toolbar:textFormatDropdown.Options.Strikethrough.Description'\n        )}\n        type=\"button\"\n      >\n        <i className=\"icon strikethrough\" />\n        <span className=\"text\">\n          {t('toolbar:textFormatDropdown.Options.Strikethrough.Label')}\n        </span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'subscript');\n        }}\n        className={'item ' + (isSubscript ? 'active dropdown-item-active' : '')}\n        title={t('toolbar:textFormatDropdown.Options.Subscript.Label')}\n        aria-label={t(\n          'toolbar:textFormatDropdown.Options.Subscript.Description'\n        )}\n        type=\"button\"\n      >\n        <i className=\"icon subscript\" />\n        <span className=\"text\">\n          {t('toolbar:textFormatDropdown.Options.Subscript.Label')}\n        </span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'superscript');\n        }}\n        className={\n          'item ' + (isSuperscript ? 'active dropdown-item-active' : '')\n        }\n        title={t('toolbar:textFormatDropdown.Options.Superscript.Label')}\n        aria-label={t(\n          'toolbar:textFormatDropdown.Options.Superscript.Description'\n        )}\n        type=\"button\"\n      >\n        <i className=\"icon superscript\" />\n        <span className=\"text\">\n          {t('toolbar:textFormatDropdown.Options.Superscript.Label')}\n        </span>\n      </button>\n    </DropDown>\n  );\n};\n\nexport default TextFormatDropdown;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst UnderlineButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isUnderline } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'underline');\n      }}\n      className={'toolbar-item spaced ' + (isUnderline ? 'active' : '')}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:underlineButton.Title')} (⌘U)`\n          : `${t('toolbar:underlineButton.Title')} (Ctrl+U)`\n      }\n      aria-label={`${t('toolbar:underlineButton.Description')} ${\n        IS_APPLE ? '⌘U' : 'Ctrl+U'\n      }`}\n      type=\"button\"\n    >\n      <i className=\"format underline\" />\n    </button>\n  );\n};\n\nexport default UnderlineButton;\n"],"names":["__className","EmojiNode","TextNode","[object Object]","node","__text","__key","constructor","className","text","key","super","createDOM","config","dom","document","createElement","inner","appendChild","updateDOM","prevNode","firstChild","serializedNode","$createEmojiNode","setFormat","format","setDetail","detail","setMode","mode","setStyle","style","exportJSON","this","getClassName","type","getLatest","emojiText","ImageComponent","React","Promise","convertImageElement","domNode","HTMLImageElement","alt","altText","src","width","height","$createImageNode","ImageNode","DecoratorNode","maxWidth","showCaption","caption","captionsEnabled","__src","__altText","__maxWidth","__width","__height","__showCaption","__caption","createEditor","__captionsEnabled","undefined","nestedEditor","editorState","parseEditorState","isEmpty","setEditorState","exportDOM","element","setAttribute","toString","img","conversion","priority","getAltText","toJSON","getSrc","version","setWidthAndHeight","writable","getWritable","setShowCaption","span","theme","image","decorate","Suspense","fallback","nodeKey","getKey","resizable","$applyNodeReplacement","$isImageNode","KeywordNode","$createKeywordNode","cursor","canInsertTextBefore","canInsertTextAfter","isTextEntity","keyword","MentionNode","mentionName","popover","existingPopover","getElementById","__popoverCard","card","id","parentElement","removeChild","__mention","position","removePopover","$createMentionNode","setTextContent","cssText","addEventListener","event","left","top","getBoundingClientRect","leftOffset","topOffset","body","mentionNode","toggleDirectionless","styleInject","css","ref","insertAt","head","getElementsByTagName","insertBefore","styleSheet","createTextNode","joinClasses","args","filter","Boolean","join","Button","data-test-id","dataTestId","children","onClick","disabled","small","title","createPollOption","uid","Math","random","replace","substr","votes","cloneOption","option","Array","from","PollOptionComponent","index","options","totalVotes","withPollNode","clientID","useCollaborationContext","checkboxRef","useRef","votesArray","checked","indexOf","length","onChange","e","toggleVote","value","setOptionText","target","placeholder","deleteOption","PollComponent","question","editor","useLexicalComposerContext","useMemo","reduce","next","getTotalVotes","cb","update","$getNodeByKey","PollNode","$isPollNode","map","addOption","convertPollElement","$createPollNode","getAttribute","__question","__options","forEach","self","push","splice","clonedOption","votesClone","voteIndex","hasAttribute","elem","display","CAN_USE_DOM","window","useLayoutEffectImpl","useLayoutEffect","useEffect","url","URL","location","href","WEBSOCKET_ID","URLSearchParams","search","get","createWebsocketProvider","yjsDocMap","doc","Doc","set","load","WebsocketProvider","WEBSOCKET_SLUG","connect","Context","createContext","historyState","current","redoStack","undoStack","useSharedHistoryContext","useContext","characterLimit","code","codeHighlight","atrule","attr","boolean","builtin","cdata","char","class","class-name","comment","constant","deleted","doctype","entity","function","important","inserted","namespace","number","operator","prolog","property","punctuation","regex","selector","string","symbol","tag","variable","hashtag","heading","h1","h2","h3","h4","h5","link","list","listitem","listitemChecked","listitemUnchecked","nested","olDepth","ul","ltr","mark","markOverlap","paragraph","quote","rtl","table","tableCell","tableCellHeader","bold","italic","strikethrough","subscript","superscript","underline","underlineStrikethrough","baseTheme","LexicalContentEditable","ContentEditable","Placeholder","positionSticky","stickyElem","positioning","rootElementRect","rectLeft","y","x","StickyComponent","color","stickyContainerRef","positioningRef","isDragging","offsetX","offsetY","isCollab","stickyContainer","resizeObserver","ResizeObserver","entries","i","entry","removeRootListener","registerRootListener","nextRootElem","prevRootElem","unobserve","observe","handleWindowResize","rootElement","getRootElement","removeEventListener","setTimeout","setProperty","handlePointerMove","pageX","pageY","handlePointerUp","classList","remove","$isStickyNode","setPosition","onPointerDown","button","stickContainer","clientX","clientY","add","preventDefault","toggleColor","LexicalNestedComposer","initialEditor","initialTheme","StickyEditorTheme","CollaborationPlugin","providerFactory","shouldBootstrap","HistoryPlugin","externalHistoryState","PlainTextPlugin","contentEditable","ErrorBoundary","LexicalErrorBoundary","StickyNode","__x","__y","__color","xOffset","yOffset","div","$setSelection","createPortal","isIsolated","convertTweetElement","$createTweetNode","isTwitterScriptLoading","TweetComponent","loadingComponent","onError","onLoad","tweetID","containerRef","previousTweetIDRef","isTweetLoading","setIsTweetLoading","useState","createTweet","useCallback","twttr","widgets","error","String","script","async","onload","onerror","BlockWithAlignableContents","TweetNode","DecoratorBlockNode","__id","__format","getId","embedBlockTheme","embedBlock","base","focus","isTopLevel","TypeaheadNode","YouTubeComponent","videoID","frameBorder","allow","allowFullScreen","YouTubeNode","$createYouTubeNode","_editor","CustomFieldNode","innerHTML","getText","$createCustomFieldNode","getType","PlaygroundNodes","HeadingNode","ListNode","ListItemNode","QuoteNode","CodeNode","TableNode","TableCellNode","TableRowNode","HashtagNode","CodeHighlightNode","AutoLinkNode","LinkNode","OverflowNode","HorizontalRuleNode","MarkNode","languageDetector","detect","callback","navigator","language","substring","init","cacheUserLanguage","i18n","i18next","ns","resources","ar","de","en","es","fr","it","ja","nl","pl","pt","ptBr","ru","ukr","zh","fallbackLng","debug","interpolation","escapeValue","err","t","use","hostName","hostname","setOption","name","settings","disableBeforeInput","emptyEditor","isAutocomplete","isCharLimit","isCharLimitUtf8","isRichText","measureTypingPerf","showNestedEditorTreeView","showTreeView","PortalImpl","onClose","closeOnClickOutside","modalRef","modalOverlayElement","handler","keyCode","clickOutsideHandler","contains","_modalRef$current","role","tabIndex","Modal","useModal","modalContent","setModalContent","content","getContent","TABLE_ROW_REG_EXP","TABLE","dependencies","export","exportChildren","$isTableNode","output","row","getChildren","rowOutput","$isTableRowNode","cell","$isElementNode","regExp","parentNode","_1","match","matchCells","mapToTableCells","rows","sibling","getPreviousSibling","maxCells","$isParagraphNode","getChildrenSize","getFirstChild","$isTextNode","cells","getTextContent","max","unshift","previousSibling","$createTableNode","tableRow","$createTableRowNode","append","createTableCell","getTableColumnsSize","selectEnd","textContent","$createTableCellNode","TableCellHeaderStates","NO_STATUS","$createParagraphNode","$createTextNode","trim","split","PLAYGROUND_TRANSFORMERS","$isHorizontalRuleNode","_2","isImport","line","$createHorizontalRuleNode","getNextSibling","selectNext","exportFormat","importRegExp","textNode","imageNode","trigger","$isTweetNode","tweetNode","CHECK_LIST","ELEMENT_TRANSFORMERS","TEXT_FORMAT_TRANSFORMERS","TEXT_MATCH_TRANSFORMERS","getElement","fontSize","transform","padding","background","borderRadius","SPEECH_TO_TEXT_COMMAND","createCommand","VOICE_COMMANDS","\n","_ref","selection","insertParagraph","redo","_ref2","dispatchCommand","REDO_COMMAND","undo","_ref3","UNDO_COMMAND","SUPPORT_SPEECH_RECOGNITION","timer","cleanup","isEnabled","setIsEnabled","SpeechRecognition","webkitSpeechRecognition","recognition","report","clearTimeout","console","log","continuous","interimResults","resultItem","results","item","resultIndex","transcript","isFinal","$getSelection","$isRangeSelection","command","toLowerCase","insertText","start","stop","registerCommand","_isEnabled","COMMAND_PRIORITY_EDITOR","ActionsPlugin","isEditable","setIsEditable","isSpeechToText","setIsSpeechToText","connected","setConnected","isEditorEmpty","setIsEditorEmpty","modal","showModal","useTranslation","mergeRegister","registerEditableListener","editable","CONNECTED_COMMAND","payload","registerUpdateListener","getEditorState","read","$getRoot","paragraphChildren","handleMarkdownToggle","root","$isCodeNode","getLanguage","$convertFromMarkdownString","markdown","$convertToMarkdownString","clear","$createCodeNode","importFile","exportFile","fileName","Date","toISOString","source","ShowClearDialog","setEditable","TOGGLE_CONNECT_COMMAND","CLEAR_EDITOR_COMMAND","URL_MATCHER","EMAIL_MATCHER","MATCHERS","exec","LexicalAutoLinkPlugin","AutoLinkPlugin","matchers","INSERT_INLINE_COMMAND","FloatingCharacterStylesEditor","isLink","isBold","isItalic","isUnderline","isCode","isStrikethrough","isSubscript","isSuperscript","popupCharStylesEditorRef","mouseDownRef","insertLink","TOGGLE_LINK_COMMAND","updateCharacterStylesEditor","popupCharStylesEditorElem","nativeSelection","getSelection","isCollapsed","anchorNode","rect","domRange","getRangeAt","firstElementChild","pageYOffset","pageXOffset","offsetWidth","bottom","opacity","setPopupPosition","onResize","SELECTION_CHANGE_COMMAND","COMMAND_PRIORITY_LOW","FORMAT_TEXT_COMMAND","getSelectedNode","anchor","getNode","focusNode","isBackward","$isAtNodeEnd","CharacterStylesPopupPlugin","isText","setIsText","setIsLink","setIsBold","setIsItalic","setIsUnderline","setIsStrikethrough","setIsSubscript","setIsSuperscript","setIsCode","updatePopup","hasFormat","parent","getParent","$isLinkNode","$isCodeHighlightNode","useCharacterStylesPopup","ClickableLinkPlugin","newTab","hasMoved","prevOffsetX","prevOffsetY","onPointerUp","hasMovedDuringClick","linkDomNode","isLinkDomNode","getLinkDomNode","linkNode","maybeLinkNode","$getNearestNodeFromDOMNode","open","metaKey","ctrlKey","prevRootElement","nodeName","CodeHighlightPlugin","registerCodeHighlighting","emojis","Map","findAndTransformEmoji","emojiData","slice","emojiStyle","targetNode","splitText","emojiNode","textNodeTransform","isSimpleText","EmojisPlugin","hasNodes","Error","registerNodeTransform","useEmojis","KEYWORDS_REGEX","KeywordsPlugin","createKeywordNode","getKeywordMatch","matchArr","startOffset","end","useLexicalTextEntity","ListMaxIndentLevelPlugin","maxDepth","INDENT_CONTENT_COMMAND","elementNodesInSelection","nodesInSelection","getNodes","Set","getParentOrThrow","n","getElementNodesInSelection","totalDepth","elementNode","$isListNode","$getListDepth","$isListItemNode","isIndentPermitted","COMMAND_PRIORITY_CRITICAL","MarkdownPlugin","MarkdownShortcutPlugin","transformers","lastTabKeyDownTimestamp","hasRegisteredKeyDownListener","TabFocusPlugin","timeStamp","FOCUS_COMMAND","clone","EditorContext","FileInput","accept","label","files","TextInput","INSERT_IMAGE_COMMAND","ImagesPlugin","$insertNodes","$isRootOrShadowRoot","$wrapNodeInElement","DRAGSTART_COMMAND","getImageNodeInSelection","dataTransfer","setData","setDragImage","JSON","stringify","data","onDragStart","COMMAND_PRIORITY_HIGH","DRAGOVER_COMMAND","canDropImage","onDragover","DROP_COMMAND","dragData","_event$dataTransfer","getData","parse","getDragImageData","range","domSelection","nodeType","defaultView","ownerDocument","caretRangeFromPoint","rangeParent","collapse","rangeOffset","getDragSelection","rangeSelection","$createRangeSelection","applyDOMRange","onDrop","$isNodeSelection","HTMLElement","closest","ACCEPTABLE_IMAGE_TYPES","DragDropPaste","DRAG_DROP_PASTE","_asyncToGenerator","filesResult","mediaFileReader","flatMap","file","result","isMimeType","ToolbarContext","DropDown","buttonLabel","buttonAriaLabel","buttonClassName","buttonIconClassName","stopCloseOnClickSelf","dropDownRef","buttonRef","showDropDown","setShowDropDown","dropDown","min","innerWidth","handle","Divider","AlignDropdown","activeEditor","isRTL","FORMAT_ELEMENT_COMMAND","OUTDENT_CONTENT_COMMAND","INSERT_POLL_COMMAND","PollPlugin","pollNode","$isRootNode","insertNodes","INSERT_TWEET_COMMAND","TwitterPlugin","getTopLevelElementOrThrow","insertAfter","paragraphNode","select","INSERT_YOUTUBE_COMMAND","YouTubePlugin","youTubeNode","TableCellResizer","targetRef","resizerRef","tableRectRef","mouseStartPosRef","mouseCurrentPos","updateMouseCurrentPos","activeCell","updateActiveCell","isSelectingGrid","updateIsSelectingGrid","draggingDirection","updateDraggingDirection","isGridSelection","DEPRECATED_$isGridSelection","resetState","onMouseMove","getCellFromTarget","tableCellNode","tableNode","$getTableNodeFromLexicalNodeOrThrow","tableElement","getElementByKey","isHeightChanging","direction","updateRowHeight","newHeight","$isTableCellNode","tableRowIndex","$getTableRowIndexFromTableCellNode","tableRows","setHeight","updateColumnWidth","newWidth","tableColumnIndex","$getTableColumnIndexFromTableCellNode","r","tableCells","setWidth","toggleResize","stopPropagation","heightChange","abs","widthChange","resizerStyles","styles","backgroundColor","right","tableRect","getResizers","onMouseDown","onMouseUp","TableCellResizerPlugin","TableActionMenu","_tableCellNode","setIsMenuOpen","contextRef","updateTableCellNode","selectionCounts","updateSelectionCounts","columns","registerMutationListener","nodeMutations","selectionShape","getShape","toX","fromX","toY","fromY","menuButtonElement","dropDownElement","menuButtonRect","handleClickOutside","clearTableSelection","isAttached","tableSelection","getTableSelectionFromTableElement","clearHighlight","markDirty","insertTableRowAtSelection","shouldInsertAfter","grid","$getElementGridForTableNode","$insertTableRow","insertTableColumnAtSelection","$insertTableColumn","deleteTableRowAtSelection","$removeTableRowAtIndex","deleteTableAtSelection","deleteTableColumnAtSelection","$deleteTableColumn","toggleTableRowIsHeader","toggleHeaderStyle","ROW","toggleTableColumnIsHeader","COLUMN","__headerState","TableCellActionMenuContainer","menuButtonRef","menuRootRef","isMenuOpen","setTableMenuCellNode","moveMenu","menu","activeElement","tableCellNodeFromSelection","$getTableCellNodeFromLexicalNode","menuButtonDOM","tableCellNodeDOM","tableCellRect","menuRect","prevTableCellDOM","TableActionMenuPlugin","HorizontalRulePlugin","INSERT_HORIZONTAL_RULE_COMMAND","horizontalRuleNode","YOUTUBE_ID_PARSER","parseYouTubeVideoID","urlMatches","InsertImageDialog","InsertImageUriDialogBody","InsertImageUploadedDialogBody","InsertTableDialog","setRows","setColumns","INSERT_TABLE_COMMAND","InsertPollDialog","setQuestion","VALID_TWITTER_URL","InsertTweetDialog","setText","isDisabled","_text$split","_text$split$","_text$split$$split","setSrc","setAltText","reader","FileReader","readAsDataURL","InsertYouTubeDialog","InsertDropdown","_ref8","enableTable","enableImage","enable","enableYoutube","enableTwitter","enablePoll","enableHorizontalRule","enableStickyNote","TablePlugin","TableCellActionMenuPlugin","stickyNode","IS_APPLE","test","platform","UndoButton","canUndo","RedoButton","canRedo","Select","CODE_LANGUAGE_OPTIONS","CodeLanguageDropdown","selectedElementKey","codeLanguage","onCodeLanguageSelect","setLanguage","BlockFormatDropdown","blockType","formatHeading","headingSize","$wrapNodes","$createHeadingNode","INSERT_UNORDERED_LIST_COMMAND","REMOVE_LIST_COMMAND","INSERT_ORDERED_LIST_COMMAND","INSERT_CHECK_LIST_COMMAND","$createQuoteNode","codeNode","removeText","insertRawText","supportedBlockTypes","CODE_LANGUAGE_MAP","javascript","md","plaintext","python","CapitalizedNameMentionsRegex","RegExp","PUNC","TRIGGERS","VALID_CHARS","AtSignMentionsRegex","AtSignMentionsRegexAliasRegex","mentionsCache","MentionMenuOption","MenuOption","picture","userCard","MentionsTypeaheadMenuItem","isSelected","onMouseEnter","setRefElement","basicColors","ColorPicker","rest","selfColor","setSelfColor","transformColor","saturationPosition","hsv","s","v","huePosition","h","hex","basicColor","MoveWrapper","newColor","divRef","move","clamp","_e","toHex","startsWith","ctx","getContext","fillStyle","hex2rgb","rbgArr","m","g","b","parseInt","rgb2hsv","d","rgb2hex","padStart","rgb","f","p","q","round","hsv2rgb","PREVIEW_CACHE","LinkPreviewContent","preview","cached","fetch","encodeURI","then","response","json","catch","useSuspenseRequest","domain","description","Glimmer","props","animationDelay","LinkPreview","positionEditorElement","FloatingLinkEditor","editorRef","inputRef","linkUrl","setLinkUrl","isEditMode","setEditMode","lastSelection","setLastSelection","updateLinkEditor","getURL","editorElem","onKeyDown","rel","defaultFontFamilyOptions","defaultFontSizeOptions","INSERT_CUSTOM_FIELD_COMMAND","imageCache","LazyImage","imageRef","has","resolve","Image","useSuspenseImage","bgColor","applyStyleText","onBgColorSelect","background-color","itemClassName","listStyle","itemStyle","record","customFieldNode","Object","params","hashtagsEnabled","autoLinkEnabled","emojisEnabled","actionsEnabled","listMaxIndent","locale","setActiveEditor","editorStateRef","placeholderComponent","changeLanguage","Provider","AutoFocusPlugin","ClearEditorPlugin","HashtagPlugin","SpeechToTextPlugin","RichTextPlugin","OnChangePlugin","ListPlugin","CheckListPlugin","LinkPlugin","initialEditorState","extraNodes","initialConfig","nodes","PlaygroundEditorTheme","LexicalComposer","I18nextProvider","fontOptions","fontFamily","onFontFamilySelect","font-family","fontSizeOptions","onFontSizeSelect","font-size","searchData","getTypeaheadValues","queryString","setQueryString","mentionString","mentionData","setResults","cachedResults","useMentionLookupService","checkForSlashTriggerMatch","useBasicTypeaheadTriggerMatch","minLength","popoverCard","offset","onSelectOption","selectedOption","nodeToReplace","closeMenu","staticElement","renderToStaticMarkup","$createAutoLinkNode","checkForMentionMatch","mentionMatch","minMatchLength","matchingString","leadOffset","replaceableString","checkForAtSignMentions","checkForCapitalizedNameMentions","getPossibleMenuTextMatch","LexicalTypeaheadMenuPlugin","onQueryChange","triggerFn","menuRenderFn","anchorElementRef","selectedIndex","selectOptionAndCleanUp","setHighlightedIndex","ReactDOM","fontColor","onFontColorSelect","defaultFontSize","defaultFontColor","defaultBgColor","defaultFontFamily","insertExists","InsertComponent","useChild","alignExists","AlignComponent","setBlockType","setSelectedElementKey","setFontSize","setFontColor","setBgColor","setFontFamily","setCanUndo","setCanRedo","setIsRTL","setCodeLanguage","updateToolbar","elementKey","elementDOM","$isParentElementRTL","parentList","$getNearestNodeOfType","getListType","$isHeadingNode","getTag","$getSelectionStyleValueForProperty","_payload","newEditor","CAN_UNDO_COMMAND","CAN_REDO_COMMAND","$patchStyleText"],"mappings":"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"}