{"version":3,"file":"verbum.esm.js","sources":["../src/nodes/EmojiNode.tsx","../src/nodes/ImageNode.tsx","../src/nodes/KeywordNode.ts","../src/nodes/MentionNode.ts","../node_modules/style-inject/dist/style-inject.es.js","../src/utils/join-classes.ts","../src/ui/Button.tsx","../src/nodes/PollNode.tsx","../src/shared/src/canUseDOM.ts","../src/shared/src/useLayoutEffect.ts","../src/collaboration.ts","../src/context/SharedHistoryContext.tsx","../src/themes/PlaygroundEditorTheme.ts","../src/themes/StickyEditorTheme.ts","../src/ui/ContentEditable.tsx","../src/ui/Placeholder.tsx","../src/nodes/StickyNode.tsx","../src/nodes/TweetNode.tsx","../src/nodes/TypeaheadNode.ts","../src/nodes/YouTubeNode.tsx","../src/nodes/CustomFieldNode.ts","../src/nodes/PlaygroundNodes.ts","../src/locale/index.tsx","../src/EditorComposer.tsx","../src/appSettings.ts","../src/context/SettingsContext.tsx","../src/ui/Modal.tsx","../src/hooks/useModal.tsx","../src/plugins/MarkdownTransformers.ts","../src/hooks/useReport.ts","../src/plugins/SpeechToTextPlugin.ts","../src/plugins/ActionsPlugin.tsx","../src/plugins/AutoLinkPlugin.tsx","../src/plugins/CommentPlugin.tsx","../src/plugins/CharacterStylesPopupPlugin.tsx","../src/plugins/ClickableLinkPlugin.ts","../src/plugins/CodeHighlightPlugin.ts","../src/plugins/EmojisPlugin.ts","../src/plugins/KeywordsPlugin.ts","../src/plugins/ListMaxIndentLevelPlugin.ts","../src/plugins/MarkdownShortcutPlugin.tsx","../src/plugins/TabFocusPlugin.tsx","../src/context/EditorContext.tsx","../src/ui/FileInput.tsx","../src/ui/TextInput.tsx","../src/plugins/ImagesPlugin.tsx","../src/plugins/DragDropPastePlugin.tsx","../src/Editor.tsx","../src/utils/node.util.ts","../src/context/ToolbarContext.tsx","../src/ui/DropDown.tsx","../src/plugins/ToolbarPlugin/components/AlignDropdown.tsx","../src/plugins/PollPlugin.ts","../src/plugins/TwitterPlugin.ts","../src/plugins/YouTubePlugin.ts","../src/plugins/TableCellResizer.tsx","../src/plugins/TableActionMenuPlugin.tsx","../src/plugins/HorizontalRulePlugin.ts","../src/plugins/ToolbarPlugin/components/InsertDropdown.tsx","../src/shared/src/environment.ts","../src/plugins/ToolbarPlugin/components/UndoButton.tsx","../src/plugins/ToolbarPlugin/components/RedoButton.tsx","../src/ui/Select.tsx","../src/plugins/ToolbarPlugin/components/CodeLanguageDropdown.tsx","../src/plugins/ToolbarPlugin/components/BlockFormatDropdown.tsx","../src/ui/Divider.tsx","../src/plugins/ToolbarPlugin/ToolbarPlugin.tsx","../src/plugins/MentionsPlugin.tsx","../src/ui/ColorPicker.tsx","../src/plugins/ToolbarPlugin/components/BackgroundColorPicker.tsx","../src/plugins/ToolbarPlugin/components/BoldButton.tsx","../src/plugins/ToolbarPlugin/components/CodeFormatButton.tsx","../src/ui/LinkPreview.tsx","../src/plugins/ToolbarPlugin/components/FloatingLinkEditor.tsx","../src/plugins/ToolbarPlugin/components/FontFamilyDropdown.tsx","../src/plugins/ToolbarPlugin/components/FontSizeDropdown.tsx","../src/plugins/ToolbarPlugin/components/InsertLinkButton.tsx","../src/plugins/ToolbarPlugin/components/ItalicButton.tsx","../src/plugins/ToolbarPlugin/components/TextColorPicker.tsx","../src/plugins/ToolbarPlugin/components/TextFormatDropdown.tsx","../src/plugins/ToolbarPlugin/components/UnderlineButton.tsx","../src/plugins/CustomFieldPlugin.tsx","../src/nodes/ImageComponent.tsx"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport React from 'react';\n\nimport type { EditorConfig, LexicalNode, NodeKey } from 'lexical';\n\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedEmojiNode = Spread<\n  {\n    className: string;\n    type: 'emoji';\n  },\n  typeof SerializedTextNode\n>;\n\nlet __className: string = 'EmojiNode';\nexport class EmojiNode extends TextNode {\n  static getType(): string {\n    return 'emoji';\n  }\n\n  static clone(node: EmojiNode): EmojiNode {\n    return new EmojiNode(__className, node.__text, node.__key);\n  }\n\n  constructor(className: string, text: string, key?: NodeKey) {\n    super(text, key);\n    __className = className;\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = document.createElement('span');\n    const inner = super.createDOM(config);\n    dom.className = __className;\n    inner.className = 'emoji-inner';\n    dom.appendChild(inner);\n    return dom;\n  }\n\n  updateDOM(\n    prevNode: TextNode,\n    dom: HTMLElement,\n    config: EditorConfig\n  ): boolean {\n    const inner = dom.firstChild;\n    if (inner === null) {\n      return true;\n    }\n    super.updateDOM(prevNode, inner as HTMLElement, config);\n    return false;\n  }\n\n  static importJSON(serializedNode: SerializedEmojiNode): EmojiNode {\n    const node = $createEmojiNode(\n      serializedNode.className,\n      serializedNode.text\n    );\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedEmojiNode {\n    return {\n      ...super.exportJSON(),\n      className: this.getClassName(),\n      type: 'emoji',\n    };\n  }\n\n  getClassName(): string {\n    const self = this.getLatest();\n    return self.__className;\n  }\n}\n\nexport function $isEmojiNode(\n  node: LexicalNode | null | undefined\n): node is EmojiNode {\n  return node instanceof EmojiNode;\n}\n\nexport function $createEmojiNode(\n  className: string,\n  emojiText: string\n): EmojiNode {\n  return new EmojiNode(className, emojiText).setMode('token');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  EditorConfig,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  SerializedEditor,\n  SerializedLexicalNode,\n  Spread,\n} from 'lexical';\n\nimport { $applyNodeReplacement, createEditor, DecoratorNode } from 'lexical';\nimport * as React from 'react';\nimport { Suspense } from 'react';\n\nconst ImageComponent = React.lazy(\n  // @ts-ignore\n  () => import('./ImageComponent')\n);\n\nexport interface ImagePayload {\n  altText: string;\n  caption?: LexicalEditor;\n  height?: number;\n  key?: NodeKey;\n  maxWidth?: number;\n  showCaption?: boolean;\n  src: string;\n  width?: number;\n  captionsEnabled?: boolean;\n}\n\nfunction convertImageElement(domNode: Node): null | DOMConversionOutput {\n  if (domNode instanceof HTMLImageElement) {\n    const { alt: altText, src, width, height } = domNode;\n    const node = $createImageNode({ altText, height, src, width });\n    return { node };\n  }\n  return null;\n}\n\nexport type SerializedImageNode = Spread<\n  {\n    altText: string;\n    caption: SerializedEditor;\n    height?: number;\n    maxWidth: number;\n    showCaption: boolean;\n    src: string;\n    width?: number;\n  },\n  SerializedLexicalNode\n>;\n\nexport class ImageNode extends DecoratorNode<JSX.Element> {\n  __src: string;\n  __altText: string;\n  __width: 'inherit' | number;\n  __height: 'inherit' | number;\n  __maxWidth: number;\n  __showCaption: boolean;\n  __caption: LexicalEditor;\n  // Captions cannot yet be used within editor cells\n  __captionsEnabled: boolean;\n\n  static getType(): string {\n    return 'image';\n  }\n\n  static clone(node: ImageNode): ImageNode {\n    return new ImageNode(\n      node.__src,\n      node.__altText,\n      node.__maxWidth,\n      node.__width,\n      node.__height,\n      node.__showCaption,\n      node.__caption,\n      node.__captionsEnabled,\n      node.__key\n    );\n  }\n\n  static importJSON(serializedNode: SerializedImageNode): ImageNode {\n    const { altText, height, width, maxWidth, caption, src, showCaption } =\n      serializedNode;\n    const node = $createImageNode({\n      altText,\n      height,\n      maxWidth,\n      showCaption,\n      src,\n      width,\n    });\n    const nestedEditor = node.__caption;\n    const editorState = nestedEditor.parseEditorState(caption.editorState);\n    if (!editorState.isEmpty()) {\n      nestedEditor.setEditorState(editorState);\n    }\n    return node;\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement('img');\n    element.setAttribute('src', this.__src);\n    element.setAttribute('alt', this.__altText);\n    element.setAttribute('width', this.__width.toString());\n    element.setAttribute('height', this.__height.toString());\n    return { element };\n  }\n\n  static importDOM(): DOMConversionMap | null {\n    return {\n      img: (node: Node) => ({\n        conversion: convertImageElement,\n        priority: 0,\n      }),\n    };\n  }\n\n  constructor(\n    src: string,\n    altText: string,\n    maxWidth: number,\n    width?: 'inherit' | number,\n    height?: 'inherit' | number,\n    showCaption?: boolean,\n    caption?: LexicalEditor,\n    captionsEnabled?: boolean,\n    key?: NodeKey\n  ) {\n    super(key);\n    this.__src = src;\n    this.__altText = altText;\n    this.__maxWidth = maxWidth;\n    this.__width = width || 'inherit';\n    this.__height = height || 'inherit';\n    this.__showCaption = showCaption || false;\n    this.__caption = caption || createEditor();\n    this.__captionsEnabled = captionsEnabled || captionsEnabled === undefined;\n  }\n\n  exportJSON(): SerializedImageNode {\n    return {\n      altText: this.getAltText(),\n      caption: this.__caption.toJSON(),\n      height: this.__height === 'inherit' ? 0 : this.__height,\n      maxWidth: this.__maxWidth,\n      showCaption: this.__showCaption,\n      src: this.getSrc(),\n      type: 'image',\n      version: 1,\n      width: this.__width === 'inherit' ? 0 : this.__width,\n    };\n  }\n\n  setWidthAndHeight(\n    width: 'inherit' | number,\n    height: 'inherit' | number\n  ): void {\n    const writable = this.getWritable();\n    writable.__width = width;\n    writable.__height = height;\n  }\n\n  setShowCaption(showCaption: boolean): void {\n    const writable = this.getWritable();\n    writable.__showCaption = showCaption;\n  }\n\n  // View\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const span = document.createElement('span');\n    const theme = config.theme;\n    const className = theme.image;\n    if (className !== undefined) {\n      span.className = className;\n    }\n    return span;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  getSrc(): string {\n    return this.__src;\n  }\n\n  getAltText(): string {\n    return this.__altText;\n  }\n\n  decorate(): JSX.Element {\n    return (\n      <Suspense fallback={null}>\n        <ImageComponent\n          src={this.__src}\n          altText={this.__altText}\n          width={this.__width}\n          height={this.__height}\n          maxWidth={this.__maxWidth}\n          nodeKey={this.getKey()}\n          showCaption={this.__showCaption}\n          caption={this.__caption}\n          captionsEnabled={this.__captionsEnabled}\n          resizable={true}\n        />\n      </Suspense>\n    );\n  }\n}\n\nexport function $createImageNode({\n  altText,\n  height,\n  maxWidth = 500,\n  captionsEnabled,\n  src,\n  width,\n  showCaption,\n  caption,\n  key,\n}: ImagePayload): ImageNode {\n  return $applyNodeReplacement(\n    new ImageNode(\n      src,\n      altText,\n      maxWidth,\n      width,\n      height,\n      showCaption,\n      caption,\n      captionsEnabled,\n      key\n    )\n  );\n}\n\nexport function $isImageNode(\n  node: LexicalNode | null | undefined\n): node is ImageNode {\n  return node instanceof ImageNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorConfig, LexicalNode } from 'lexical';\n\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedKeywordNode = Spread<\n  {\n    type: 'keyword';\n    version: 1;\n  },\n  typeof SerializedTextNode\n>;\n\nexport class KeywordNode extends TextNode {\n  static getType(): string {\n    return 'keyword';\n  }\n\n  static clone(node: KeywordNode): KeywordNode {\n    return new KeywordNode(node.__text, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedKeywordNode): KeywordNode {\n    const node = $createKeywordNode(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedKeywordNode {\n    return {\n      ...super.exportJSON(),\n      type: 'keyword',\n      version: 1,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cursor = 'default';\n    dom.className = 'keyword';\n    return dom;\n  }\n\n  canInsertTextBefore(): boolean {\n    return false;\n  }\n\n  canInsertTextAfter(): boolean {\n    return false;\n  }\n\n  isTextEntity(): true {\n    return true;\n  }\n}\n\nexport function $createKeywordNode(keyword: string): KeywordNode {\n  return new KeywordNode(keyword);\n}\n\nexport function $isKeywordNode(\n  node: LexicalNode | null | undefined | undefined\n): boolean {\n  return node instanceof KeywordNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorConfig, LexicalNode, NodeKey } from 'lexical';\n\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedMentionNode = Spread<\n  {\n    mentionName: string;\n    type: 'mention';\n    version: 1;\n  },\n  typeof SerializedTextNode\n>;\n\ntype PopoverCard = {\n  card: HTMLElement;\n  leftOffset: number;\n  topOffset: number;\n};\n\nconst mentionStyle = 'background-color: rgba(24, 119, 232, 0.2)';\n\nexport class MentionNode extends TextNode {\n  __mention: string;\n  __popoverCard: PopoverCard;\n\n  static getType(): string {\n    return 'mention';\n  }\n\n  static clone(node: MentionNode): MentionNode {\n    return new MentionNode(node.__mention, undefined, node.__text, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedMentionNode): MentionNode {\n    const node = $createMentionNode(serializedNode.mentionName);\n    node.setTextContent(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  constructor(\n    mentionName: string,\n    popover?: PopoverCard,\n    text?: string,\n    key?: NodeKey\n  ) {\n    super(text ?? mentionName, key);\n    this.__mention = mentionName;\n    if (popover !== undefined) {\n      this.__popoverCard = popover;\n      this.__popoverCard.card.id = 'verbum-mention-popover';\n      this.__popoverCard.card.style.position = 'absolute';\n      this.removePopover();\n    }\n  }\n\n  exportJSON(): SerializedMentionNode {\n    return {\n      ...super.exportJSON(),\n      mentionName: this.__mention,\n      type: 'mention',\n      version: 1,\n    };\n  }\n\n  removePopover = () => {\n    const existingPopover = document.getElementById(this.__popoverCard.card.id);\n    if (existingPopover && existingPopover.parentElement) {\n      existingPopover.parentElement.removeChild(existingPopover);\n    }\n  };\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cssText = mentionStyle;\n    dom.className = 'mention';\n\n    dom.addEventListener('pointerover', (event) => {\n      const { left, top } = dom.getBoundingClientRect();\n      this.__popoverCard.card.style.left = `${left - this.__popoverCard.leftOffset}px`;\n      this.__popoverCard.card.style.top = `${top - this.__popoverCard.topOffset}px`;\n      document.body.appendChild(this.__popoverCard.card);\n    });\n\n    dom.addEventListener('pointerout', (event) => {\n      this.removePopover();\n    });\n\n    return dom;\n  }\n\n  isTextEntity(): true {\n    return true;\n  }\n}\n\nexport function $createMentionNode(\n  mentionName: string,\n  popover?: PopoverCard\n): MentionNode {\n  const mentionNode = new MentionNode(mentionName, popover);\n  mentionNode.setMode('segmented').toggleDirectionless();\n  return mentionNode;\n}\n\nexport function $isMentionNode(\n  node: LexicalNode | null | undefined\n): node is MentionNode {\n  return node instanceof MentionNode;\n}\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nexport default function joinClasses(...args) {\n  return args.filter(Boolean).join(' ');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Button.css';\n\nimport * as React from 'react';\n\nimport joinClasses from '../utils/join-classes';\n\nexport default function Button({\n  'data-test-id': dataTestId,\n  children,\n  className,\n  onClick,\n  disabled,\n  small,\n  title,\n}: {\n  'data-test-id'?: string;\n  children: JSX.Element | string | (JSX.Element | string)[];\n  className?: string;\n  disabled?: boolean;\n  onClick: () => void;\n  small?: boolean;\n  title?: string;\n}): JSX.Element {\n  return (\n    <button\n      disabled={disabled}\n      className={joinClasses(\n        'Button__root',\n        disabled && 'Button__disabled',\n        small && 'Button__small',\n        className\n      )}\n      onClick={onClick}\n      title={title}\n      aria-label={title}\n      {...(dataTestId && { 'data-test-id': dataTestId })}\n    >\n      {children}\n    </button>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  LexicalNode,\n  NodeKey,\n  SerializedLexicalNode,\n} from 'lexical';\n\nimport './PollNode.css';\n\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $getNodeByKey, DecoratorNode } from 'lexical';\nimport { Spread } from 'libdefs/globals';\nimport * as React from 'react';\nimport { useMemo, useRef } from 'react';\n\nimport Button from '../ui/Button';\nimport joinClasses from '../utils/join-classes';\n\ntype Options = ReadonlyArray<Option>;\n\ntype Option = Readonly<{\n  text: string;\n  uid: string;\n  votes: Array<number>;\n}>;\n\nfunction createUID(): string {\n  return Math.random()\n    .toString(36)\n    .replace(/[^a-z]+/g, '')\n    .substr(0, 5);\n}\n\nfunction createPollOption(text = ''): Option {\n  return {\n    text,\n    uid: createUID(),\n    votes: [],\n  };\n}\n\nfunction cloneOption(\n  option: Option,\n  text: string,\n  votes?: Array<number>\n): Option {\n  return {\n    text,\n    uid: option.uid,\n    votes: votes || Array.from(option.votes),\n  };\n}\n\nfunction getTotalVotes(options: Options): number {\n  return options.reduce((totalVotes, next) => {\n    return totalVotes + next.votes.length;\n  }, 0);\n}\n\nfunction PollOptionComponent({\n  option,\n  index,\n  options,\n  totalVotes,\n  withPollNode,\n}: {\n  index: number;\n  option: Option;\n  options: Options;\n  totalVotes: number;\n  withPollNode: (cb: (PollNode) => void) => void;\n}): JSX.Element {\n  const { clientID } = useCollaborationContext();\n  const checkboxRef = useRef(null);\n  const votesArray = option.votes;\n  const checkedIndex = votesArray.indexOf(clientID);\n  const checked = checkedIndex !== -1;\n  const votes = votesArray.length;\n  const text = option.text;\n\n  return (\n    <div className=\"PollNode__optionContainer\">\n      <div\n        className={joinClasses(\n          'PollNode__optionCheckboxWrapper',\n          checked && 'PollNode__optionCheckboxChecked'\n        )}\n      >\n        <input\n          ref={checkboxRef}\n          className=\"PollNode__optionCheckbox\"\n          type=\"checkbox\"\n          onChange={(e) => {\n            withPollNode((node) => {\n              node.toggleVote(option, clientID);\n            });\n          }}\n          checked={checked}\n        />\n      </div>\n      <div className=\"PollNode__optionInputWrapper\">\n        <div\n          className=\"PollNode__optionInputVotes\"\n          style={{ width: `${votes === 0 ? 0 : (votes / totalVotes) * 100}%` }}\n        />\n        <span className=\"PollNode__optionInputVotesCount\">\n          {votes > 0 && (votes === 1 ? '1 vote' : `${votes} votes`)}\n        </span>\n        <input\n          className=\"PollNode__optionInput\"\n          type=\"text\"\n          value={text}\n          onChange={(e) => {\n            withPollNode((node) => {\n              node.setOptionText(option, e.target.value);\n            });\n          }}\n          placeholder={`Option ${index + 1}`}\n        />\n      </div>\n      <button\n        disabled={options.length < 3}\n        className={joinClasses(\n          'PollNode__optionDelete',\n          options.length < 3 && 'PollNode__optionDeleteDisabled'\n        )}\n        arial-label=\"Remove\"\n        onClick={() => {\n          withPollNode((node) => {\n            node.deleteOption(option);\n          });\n        }}\n      />\n    </div>\n  );\n}\n\nfunction PollComponent({\n  question,\n  options,\n  nodeKey,\n}: {\n  nodeKey: NodeKey;\n  options: Options;\n  question: string;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const totalVotes = useMemo(() => getTotalVotes(options), [options]);\n\n  const withPollNode = (cb: (node: PollNode) => void): void => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isPollNode(node)) {\n        cb(node);\n      }\n    });\n  };\n\n  const addOption = () => {\n    withPollNode((node) => {\n      node.addOption(createPollOption());\n    });\n  };\n\n  return (\n    <div className=\"PollNode__container\">\n      <h2 className=\"PollNode__heading\">{question}</h2>\n      {options.map((option, index) => {\n        const key = option.uid;\n        return (\n          <PollOptionComponent\n            key={key}\n            withPollNode={withPollNode}\n            option={option}\n            index={index}\n            options={options}\n            totalVotes={totalVotes}\n          />\n        );\n      })}\n      <div className=\"PollNode__footer\">\n        <Button onClick={addOption} small={true}>\n          Add Option\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nexport type SerializedPollNode = Spread<\n  {\n    question: string;\n    options: Options;\n    type: 'poll';\n    version: 1;\n  },\n  SerializedLexicalNode\n>;\n\nfunction convertPollElement(domNode: HTMLElement): DOMConversionOutput {\n  const question = domNode.getAttribute('data-lexical-poll-question');\n  const node = $createPollNode(question);\n  return { node };\n}\n\nexport class PollNode extends DecoratorNode<JSX.Element> {\n  __question: string;\n  __options: Options;\n\n  static getType(): string {\n    return 'poll';\n  }\n\n  static clone(node: PollNode): PollNode {\n    return new PollNode(node.__question, node.__options, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedPollNode): PollNode {\n    const node = $createPollNode(serializedNode.question);\n    serializedNode.options.forEach(node.addOption);\n    return node;\n  }\n\n  constructor(question: string, options?: Options, key?: NodeKey) {\n    super(key);\n    this.__question = question;\n    this.__options = options || [createPollOption(), createPollOption()];\n  }\n\n  exportJSON(): SerializedPollNode {\n    return {\n      options: this.__options,\n      question: this.__question,\n      type: 'poll',\n      version: 1,\n    };\n  }\n\n  addOption(option: Option): void {\n    const self = this.getWritable();\n    const options = Array.from(self.__options);\n    options.push(option);\n    self.__options = options;\n  }\n\n  deleteOption(option: Option): void {\n    const self = this.getWritable();\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options.splice(index, 1);\n    self.__options = options;\n  }\n\n  setOptionText(option: Option, text: string): void {\n    const self = this.getWritable();\n    const clonedOption = cloneOption(option, text);\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options[index] = clonedOption;\n    self.__options = options;\n  }\n\n  toggleVote(option: Option, clientID: number): void {\n    const self = this.getWritable();\n    const votes = option.votes;\n    const votesClone = Array.from(votes);\n    const voteIndex = votes.indexOf(clientID);\n    if (voteIndex === -1) {\n      votesClone.push(clientID);\n    } else {\n      votesClone.splice(voteIndex, 1);\n    }\n    const clonedOption = cloneOption(option, option.text, votesClone);\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options[index] = clonedOption;\n    self.__options = options;\n  }\n\n  static importDOM(): DOMConversionMap | null {\n    return {\n      span: (domNode: HTMLElement) => {\n        if (!domNode.hasAttribute('data-lexical-poll-question')) {\n          return null;\n        }\n        return {\n          conversion: convertPollElement,\n          priority: 2,\n        };\n      },\n    };\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement('span');\n    element.setAttribute('data-lexical-poll-question', this.__question);\n    return { element };\n  }\n\n  createDOM(): HTMLElement {\n    const elem = document.createElement('span');\n    elem.style.display = 'inline-block';\n    return elem;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  decorate(): JSX.Element {\n    return (\n      <PollComponent\n        question={this.__question}\n        options={this.__options}\n        nodeKey={this.__key}\n      />\n    );\n  }\n}\n\nexport function $createPollNode(question: string): PollNode {\n  return new PollNode(question);\n}\n\nexport function $isPollNode(\n  node: LexicalNode | null | undefined\n): node is PollNode {\n  return node instanceof PollNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict\n */\n\nexport const CAN_USE_DOM: boolean =\n  typeof window !== 'undefined' &&\n  typeof window.document !== 'undefined' &&\n  typeof window.document.createElement !== 'undefined';\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict\n */\n\nimport { useEffect, useLayoutEffect } from 'react';\nimport { CAN_USE_DOM } from './canUseDOM';\n\nconst useLayoutEffectImpl: typeof useLayoutEffect = CAN_USE_DOM\n  ? useLayoutEffect\n  : useEffect;\n\nexport default useLayoutEffectImpl;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {Provider} from '@lexical/yjs';\nimport { WebsocketProvider } from 'y-websocket';\nimport { Doc } from 'yjs';\n\nconst url = new URL(window.location.href);\nconst params = new URLSearchParams(url.search);\nconst WEBSOCKET_ENDPOINT = 'ws://localhost:1234';\nconst WEBSOCKET_SLUG = 'playground';\nconst WEBSOCKET_ID = params.get('collabId') || '0';\n\n// parent dom -> child doc\nexport function createWebsocketProvider(\n  id: string,\n  yjsDocMap: Map<string, Doc>\n): Provider {\n  let doc = yjsDocMap.get(id);\n\n  if (doc === undefined) {\n    doc = new Doc();\n    yjsDocMap.set(id, doc);\n  } else {\n    doc.load();\n  }\n\n  \n  // @ts-ignore\n  return new WebsocketProvider(\n    WEBSOCKET_ENDPOINT,\n    WEBSOCKET_SLUG + '/' + WEBSOCKET_ID + '/' + id,\n    doc,\n    {\n      connect: false,\n    }\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { HistoryState } from '@lexical/react/LexicalHistoryPlugin';\n\nimport { createEmptyHistoryState } from '@lexical/react/LexicalHistoryPlugin';\nimport * as React from 'react';\nimport { createContext, useContext, useMemo } from 'react';\n\ntype ContextShape = {\n  historyState: HistoryState;\n};\n\nconst Context: React.Context<ContextShape> = createContext({\n  historyState: { current: null, redoStack: [], undoStack: [] },\n});\n\nexport const SharedHistoryContext = ({\n  children,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n}): JSX.Element => {\n  const historyContext = useMemo(\n    () => ({ historyState: createEmptyHistoryState() }),\n    []\n  );\n  return <Context.Provider value={historyContext}>{children}</Context.Provider>;\n};\n\nexport const useSharedHistoryContext = (): ContextShape => {\n  return useContext(Context);\n};\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorThemeClasses } from 'lexical';\n\nimport './PlaygroundEditorTheme.css';\n\nconst theme: EditorThemeClasses = {\n  characterLimit: 'PlaygroundEditorTheme__characterLimit',\n  code: 'PlaygroundEditorTheme__code',\n  codeHighlight: {\n    atrule: 'PlaygroundEditorTheme__tokenAttr',\n    attr: 'PlaygroundEditorTheme__tokenAttr',\n    boolean: 'PlaygroundEditorTheme__tokenProperty',\n    builtin: 'PlaygroundEditorTheme__tokenSelector',\n    cdata: 'PlaygroundEditorTheme__tokenComment',\n    char: 'PlaygroundEditorTheme__tokenSelector',\n    class: 'PlaygroundEditorTheme__tokenFunction',\n    'class-name': 'PlaygroundEditorTheme__tokenFunction',\n    comment: 'PlaygroundEditorTheme__tokenComment',\n    constant: 'PlaygroundEditorTheme__tokenProperty',\n    deleted: 'PlaygroundEditorTheme__tokenProperty',\n    doctype: 'PlaygroundEditorTheme__tokenComment',\n    entity: 'PlaygroundEditorTheme__tokenOperator',\n    function: 'PlaygroundEditorTheme__tokenFunction',\n    important: 'PlaygroundEditorTheme__tokenVariable',\n    inserted: 'PlaygroundEditorTheme__tokenSelector',\n    keyword: 'PlaygroundEditorTheme__tokenAttr',\n    namespace: 'PlaygroundEditorTheme__tokenVariable',\n    number: 'PlaygroundEditorTheme__tokenProperty',\n    operator: 'PlaygroundEditorTheme__tokenOperator',\n    prolog: 'PlaygroundEditorTheme__tokenComment',\n    property: 'PlaygroundEditorTheme__tokenProperty',\n    punctuation: 'PlaygroundEditorTheme__tokenPunctuation',\n    regex: 'PlaygroundEditorTheme__tokenVariable',\n    selector: 'PlaygroundEditorTheme__tokenSelector',\n    string: 'PlaygroundEditorTheme__tokenSelector',\n    symbol: 'PlaygroundEditorTheme__tokenProperty',\n    tag: 'PlaygroundEditorTheme__tokenProperty',\n    url: 'PlaygroundEditorTheme__tokenOperator',\n    variable: 'PlaygroundEditorTheme__tokenVariable',\n  },\n  hashtag: 'PlaygroundEditorTheme__hashtag',\n  heading: {\n    h1: 'PlaygroundEditorTheme__h1',\n    h2: 'PlaygroundEditorTheme__h2',\n    h3: 'PlaygroundEditorTheme__h3',\n    h4: 'PlaygroundEditorTheme__h4',\n    h5: 'PlaygroundEditorTheme__h5',\n  },\n  image: 'editor-image',\n  link: 'PlaygroundEditorTheme__link',\n  list: {\n    listitem: 'PlaygroundEditorTheme__listItem',\n    listitemChecked: 'PlaygroundEditorTheme__listItemChecked',\n    listitemUnchecked: 'PlaygroundEditorTheme__listItemUnchecked',\n    nested: {\n      listitem: 'PlaygroundEditorTheme__nestedListItem',\n    },\n    olDepth: [\n      'PlaygroundEditorTheme__ol1',\n      'PlaygroundEditorTheme__ol2',\n      'PlaygroundEditorTheme__ol3',\n      'PlaygroundEditorTheme__ol4',\n      'PlaygroundEditorTheme__ol5',\n    ],\n    ul: 'PlaygroundEditorTheme__ul',\n  },\n  ltr: 'PlaygroundEditorTheme__ltr',\n  mark: 'PlaygroundEditorTheme__mark',\n  markOverlap: 'PlaygroundEditorTheme__markOverlap',\n  paragraph: 'PlaygroundEditorTheme__paragraph',\n  quote: 'PlaygroundEditorTheme__quote',\n  rtl: 'PlaygroundEditorTheme__rtl',\n  table: 'PlaygroundEditorTheme__table',\n  tableCell: 'PlaygroundEditorTheme__tableCell',\n  tableCellHeader: 'PlaygroundEditorTheme__tableCellHeader',\n  text: {\n    bold: 'PlaygroundEditorTheme__textBold',\n    code: 'PlaygroundEditorTheme__textCode',\n    italic: 'PlaygroundEditorTheme__textItalic',\n    strikethrough: 'PlaygroundEditorTheme__textStrikethrough',\n    subscript: 'PlaygroundEditorTheme__textSubscript',\n    superscript: 'PlaygroundEditorTheme__textSuperscript',\n    underline: 'PlaygroundEditorTheme__textUnderline',\n    underlineStrikethrough: 'PlaygroundEditorTheme__textUnderlineStrikethrough',\n  },\n};\n\nexport default theme;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorThemeClasses } from 'lexical';\n\nimport './StickyEditorTheme.css';\n\nimport baseTheme from './PlaygroundEditorTheme';\n\nconst theme: EditorThemeClasses = {\n  ...baseTheme,\n  paragraph: 'StickyEditorTheme__paragraph',\n};\n\nexport default theme;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './ContentEditable.css';\n\nimport { ContentEditable } from '@lexical/react/LexicalContentEditable';\nimport * as React from 'react';\n\nexport default function LexicalContentEditable({\n  className,\n}: {\n  className?: string;\n}): JSX.Element {\n  return <ContentEditable className={className || 'ContentEditable__root'} />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Placeholder.css';\n\nimport * as React from 'react';\n\nexport default function Placeholder({\n  children,\n  className,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n  className?: string;\n}): JSX.Element {\n  return <div className={className || 'Placeholder__root'}>{children}</div>;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  EditorConfig,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  SerializedLexicalNode,\n} from 'lexical';\n\nimport './StickyNode.css';\n\nimport { CollaborationPlugin } from '@lexical/react/LexicalCollaborationPlugin';\n\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport { LexicalNestedComposer } from '@lexical/react/LexicalNestedComposer';\nimport { PlainTextPlugin } from '@lexical/react/LexicalPlainTextPlugin';\nimport LexicalErrorBoundary from '@lexical/react/LexicalErrorBoundary';\nimport {\n  $getNodeByKey,\n  $setSelection,\n  createEditor,\n  DecoratorNode,\n} from 'lexical';\nimport { Spread } from 'libdefs/globals';\nimport * as React from 'react';\nimport { useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport useLayoutEffect from '../shared/src/useLayoutEffect';\n\nimport { createWebsocketProvider } from '../collaboration';\nimport { useSharedHistoryContext } from '../context/SharedHistoryContext';\nimport StickyEditorTheme from '../themes/StickyEditorTheme';\nimport ContentEditable from '../ui/ContentEditable';\nimport Placeholder from '../ui/Placeholder';\n\nfunction positionSticky(stickyElem: HTMLElement, positioning): void {\n  const style = stickyElem.style;\n  const rootElementRect = positioning.rootElementRect;\n  const rectLeft = rootElementRect !== null ? rootElementRect.left : 0;\n  const rectTop = rootElementRect !== null ? rootElementRect.top : 0;\n  style.top = rectTop + positioning.y + 'px';\n  style.left = rectLeft + positioning.x + 'px';\n}\n\nfunction StickyComponent({\n  x,\n  y,\n  nodeKey,\n  color,\n  caption,\n}: {\n  caption: LexicalEditor;\n  color: 'pink' | 'yellow';\n  nodeKey: NodeKey;\n  x: number;\n  y: number;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const stickyContainerRef = useRef<null | HTMLDivElement>(null);\n  const positioningRef = useRef<{\n    isDragging: boolean;\n    offsetX: number;\n    offsetY: number;\n    rootElementRect: null | ClientRect;\n    x: number;\n    y: number;\n  }>({\n    isDragging: false,\n    offsetX: 0,\n    offsetY: 0,\n    rootElementRect: null,\n    x: 0,\n    y: 0,\n  });\n  const { yjsDocMap } = useCollaborationContext();\n  const isCollab = yjsDocMap.get('main') !== undefined;\n\n  useEffect(() => {\n    const position = positioningRef.current;\n    position.x = x;\n    position.y = y;\n\n    const stickyContainer = stickyContainerRef.current;\n    if (stickyContainer !== null) {\n      positionSticky(stickyContainer, position);\n    }\n  }, [x, y]);\n\n  useLayoutEffect(() => {\n    const position = positioningRef.current;\n    const resizeObserver = new ResizeObserver((entries) => {\n      for (let i = 0; i < entries.length; i++) {\n        const entry = entries[i];\n        const { target } = entry;\n        position.rootElementRect = target.getBoundingClientRect();\n        const stickyContainer = stickyContainerRef.current;\n        if (stickyContainer !== null) {\n          positionSticky(stickyContainer, position);\n        }\n      }\n    });\n\n    const removeRootListener = editor.registerRootListener(\n      (nextRootElem, prevRootElem) => {\n        if (prevRootElem !== null) {\n          resizeObserver.unobserve(prevRootElem);\n        }\n        if (nextRootElem !== null) {\n          resizeObserver.observe(nextRootElem);\n        }\n      }\n    );\n\n    const handleWindowResize = () => {\n      const rootElement = editor.getRootElement();\n      const stickyContainer = stickyContainerRef.current;\n      if (rootElement !== null && stickyContainer !== null) {\n        position.rootElementRect = rootElement.getBoundingClientRect();\n        positionSticky(stickyContainer, position);\n      }\n    };\n\n    window.addEventListener('resize', handleWindowResize);\n\n    return () => {\n      window.removeEventListener('resize', handleWindowResize);\n      removeRootListener();\n    };\n  }, [editor]);\n\n  useEffect(() => {\n    const stickyContainer = stickyContainerRef.current;\n    if (stickyContainer !== null) {\n      // Delay adding transition so we don't trigger the\n      // transition on load of the sticky.\n      setTimeout(() => {\n        stickyContainer.style.setProperty(\n          'transition',\n          'top 0.3s ease 0s, left 0.3s ease 0s'\n        );\n      }, 500);\n    }\n  }, []);\n\n  const handlePointerMove = (event: PointerEvent) => {\n    const stickyContainer = stickyContainerRef.current;\n    const positioning = positioningRef.current;\n    const rootElementRect = positioning.rootElementRect;\n    if (\n      stickyContainer !== null &&\n      positioning.isDragging &&\n      rootElementRect !== null\n    ) {\n      positioning.x = event.pageX - positioning.offsetX - rootElementRect.left;\n      positioning.y = event.pageY - positioning.offsetY - rootElementRect.top;\n      positionSticky(stickyContainer, positioning);\n    }\n  };\n\n  const handlePointerUp = (event: PointerEvent) => {\n    const stickyContainer = stickyContainerRef.current;\n    const positioning = positioningRef.current;\n    if (stickyContainer !== null) {\n      positioning.isDragging = false;\n      stickyContainer.classList.remove('dragging');\n      editor.update(() => {\n        const node = $getNodeByKey(nodeKey);\n        if ($isStickyNode(node)) {\n          node.setPosition(positioning.x, positioning.y);\n        }\n      });\n    }\n    document.removeEventListener('pointermove', handlePointerMove);\n    document.removeEventListener('pointerup', handlePointerUp);\n  };\n\n  const handleDelete = () => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isStickyNode(node)) {\n        node.remove();\n      }\n    });\n  };\n\n  const handleColorChange = () => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isStickyNode(node)) {\n        node.toggleColor();\n      }\n    });\n  };\n\n  const { historyState } = useSharedHistoryContext();\n\n  return (\n    <div ref={stickyContainerRef} className=\"sticky-note-container\">\n      <div\n        className={`sticky-note ${color}`}\n        onPointerDown={(event) => {\n          const stickyContainer = stickyContainerRef.current;\n          if (\n            stickyContainer == null ||\n            event.button === 2 ||\n            event.target !== stickyContainer.firstChild\n          ) {\n            // Right click or click on editor should not work\n            return;\n          }\n          const stickContainer = stickyContainer;\n          const positioning = positioningRef.current;\n          if (stickContainer !== null) {\n            const { top, left } = stickContainer.getBoundingClientRect();\n            positioning.offsetX = event.clientX - left;\n            positioning.offsetY = event.clientY - top;\n            positioning.isDragging = true;\n            stickContainer.classList.add('dragging');\n            document.addEventListener('pointermove', handlePointerMove);\n            document.addEventListener('pointerup', handlePointerUp);\n            event.preventDefault();\n          }\n        }}\n      >\n        <button\n          onClick={handleDelete}\n          className=\"delete\"\n          aria-label=\"Delete sticky note\"\n          title=\"Delete\"\n        >\n          X\n        </button>\n        <button\n          onClick={handleColorChange}\n          className=\"color\"\n          aria-label=\"Change sticky note color\"\n          title=\"Color\"\n        >\n          <i className=\"bucket\" />\n        </button>\n        <LexicalNestedComposer\n          initialEditor={caption}\n          initialTheme={StickyEditorTheme}\n        >\n          {isCollab ? (\n            <CollaborationPlugin\n              id={caption.getKey()}\n              providerFactory={createWebsocketProvider}\n              shouldBootstrap={true}\n            />\n          ) : (\n            <HistoryPlugin externalHistoryState={historyState} />\n          )}\n          <PlainTextPlugin\n            contentEditable={\n              <ContentEditable className=\"StickyNode__contentEditable\" />\n            }\n            placeholder={\n              <Placeholder className=\"StickyNode__placeholder\">\n                What's up?\n              </Placeholder>\n            }\n            ErrorBoundary={LexicalErrorBoundary}\n          />\n        </LexicalNestedComposer>\n      </div>\n    </div>\n  );\n}\n\ntype StickyNoteColor = 'pink' | 'yellow';\n\nexport type SerializedStickyNode = Spread<\n  {\n    xOffset: number;\n    yOffset: number;\n    color: StickyNoteColor;\n    caption: LexicalEditor;\n    type: 'sticky';\n    version: 1;\n  },\n  SerializedLexicalNode\n>;\n\nexport class StickyNode extends DecoratorNode<JSX.Element> {\n  __x: number;\n  __y: number;\n  __color: StickyNoteColor;\n  __caption: LexicalEditor;\n\n  static getType(): string {\n    return 'sticky';\n  }\n\n  static clone(node: StickyNode): StickyNode {\n    return new StickyNode(\n      node.__x,\n      node.__y,\n      node.__color,\n      node.__caption,\n      node.__key\n    );\n  }\n  static importJSON(serializedNode: SerializedStickyNode): StickyNode {\n    return new StickyNode(\n      serializedNode.xOffset,\n      serializedNode.yOffset,\n      serializedNode.color,\n      serializedNode.caption\n    );\n  }\n\n  constructor(\n    x: number,\n    y: number,\n    color: 'pink' | 'yellow',\n    caption?: LexicalEditor,\n    key?: NodeKey\n  ) {\n    super(key);\n    this.__x = x;\n    this.__y = y;\n    this.__caption = caption || createEditor();\n    this.__color = color;\n  }\n\n  exportJSON(): SerializedStickyNode {\n    return {\n      caption: this.__caption,\n      color: this.__color,\n      type: 'sticky',\n      version: 1,\n      xOffset: this.__x,\n      yOffset: this.__y,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const div = document.createElement('div');\n    div.style.display = 'contents';\n    return div;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  setPosition(x: number, y: number): void {\n    const writable = this.getWritable();\n    writable.__x = x;\n    writable.__y = y;\n    $setSelection(null);\n  }\n\n  toggleColor(): void {\n    const writable = this.getWritable();\n    writable.__color = writable.__color === 'pink' ? 'yellow' : 'pink';\n  }\n\n  decorate(editor: LexicalEditor): JSX.Element {\n    return createPortal(\n      <StickyComponent\n        color={this.__color}\n        x={this.__x}\n        y={this.__y}\n        nodeKey={this.getKey()}\n        caption={this.__caption}\n      />,\n      document.body\n    );\n  }\n\n  isIsolated(): true {\n    return true;\n  }\n}\n\nexport function $isStickyNode(\n  node: LexicalNode | null | undefined\n): node is StickyNode {\n  return node instanceof StickyNode;\n}\n\nexport function $createStickyNode(\n  xOffset: number,\n  yOffset: number\n): StickyNode {\n  return new StickyNode(xOffset, yOffset, 'yellow');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  EditorConfig,\n  ElementFormatType,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  Spread,\n} from 'lexical';\n\nimport { BlockWithAlignableContents } from '@lexical/react/LexicalBlockWithAlignableContents';\nimport {\n  DecoratorBlockNode,\n  SerializedDecoratorBlockNode,\n} from '@lexical/react/LexicalDecoratorBlockNode';\nimport * as React from 'react';\nimport { useCallback, useEffect, useRef, useState } from 'react';\n\nconst WIDGET_SCRIPT_URL = 'https://platform.twitter.com/widgets.js';\n\ntype TweetComponentProps = Readonly<{\n  className: Readonly<{\n    base: string;\n    focus: string;\n  }>;\n  format: ElementFormatType | null;\n  loadingComponent?: JSX.Element | string;\n  nodeKey: NodeKey;\n  onError?: (error: string) => void;\n  onLoad?: () => void;\n  tweetID: string;\n}>;\n\nfunction convertTweetElement(\n  domNode: HTMLDivElement\n): DOMConversionOutput | null {\n  const id = domNode.getAttribute('data-lexical-tweet-id');\n  if (id) {\n    const node = $createTweetNode(id);\n    return { node };\n  }\n  return null;\n}\n\nlet isTwitterScriptLoading = true;\n\nfunction TweetComponent({\n  className,\n  format,\n  loadingComponent,\n  nodeKey,\n  onError,\n  onLoad,\n  tweetID,\n}: TweetComponentProps) {\n  const containerRef = useRef<HTMLDivElement | null>(null);\n\n  const previousTweetIDRef = useRef<string>('');\n  const [isTweetLoading, setIsTweetLoading] = useState(false);\n\n  const createTweet = useCallback(async () => {\n    try {\n      // @ts-expect-error Twitter is attached to the window.\n      await window.twttr.widgets.createTweet(tweetID, containerRef.current);\n\n      setIsTweetLoading(false);\n      isTwitterScriptLoading = false;\n\n      if (onLoad) {\n        onLoad();\n      }\n    } catch (error) {\n      if (onError) {\n        onError(String(error));\n      }\n    }\n  }, [onError, onLoad, tweetID]);\n\n  useEffect(() => {\n    if (tweetID !== previousTweetIDRef.current) {\n      setIsTweetLoading(true);\n\n      if (isTwitterScriptLoading) {\n        const script = document.createElement('script');\n        script.src = WIDGET_SCRIPT_URL;\n        script.async = true;\n        document.body?.appendChild(script);\n        script.onload = createTweet;\n        if (onError) {\n          script.onerror = onError as OnErrorEventHandler;\n        }\n      } else {\n        createTweet();\n      }\n\n      if (previousTweetIDRef) {\n        previousTweetIDRef.current = tweetID;\n      }\n    }\n  }, [createTweet, onError, tweetID]);\n\n  return (\n    <BlockWithAlignableContents\n      className={className}\n      format={format}\n      nodeKey={nodeKey}\n    >\n      {isTweetLoading ? loadingComponent : null}\n      <div\n        style={{ display: 'inline-block', width: '550px' }}\n        ref={containerRef}\n      />\n    </BlockWithAlignableContents>\n  );\n}\n\nexport type SerializedTweetNode = Spread<\n  {\n    id: string;\n    type: 'tweet';\n    version: 1;\n  },\n  SerializedDecoratorBlockNode\n>;\n\nexport class TweetNode extends DecoratorBlockNode {\n  __id: string;\n\n  static getType(): string {\n    return 'tweet';\n  }\n\n  static clone(node: TweetNode): TweetNode {\n    return new TweetNode(node.__id, node.__format, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedTweetNode): TweetNode {\n    const node = $createTweetNode(serializedNode.id);\n    node.setFormat(serializedNode.format);\n    return node;\n  }\n\n  exportJSON(): SerializedTweetNode {\n    return {\n      ...super.exportJSON(),\n      id: this.getId(),\n      type: 'tweet',\n      version: 1,\n    };\n  }\n\n  static importDOM(): DOMConversionMap<HTMLDivElement> | null {\n    return {\n      div: (domNode: HTMLDivElement) => {\n        if (!domNode.hasAttribute('data-lexical-tweet-id')) {\n          return null;\n        }\n        return {\n          conversion: convertTweetElement,\n          priority: 2,\n        };\n      },\n    };\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement('div');\n    element.setAttribute('data-lexical-tweet-id', this.__id);\n    return { element };\n  }\n\n  constructor(id: string, format?: ElementFormatType, key?: NodeKey) {\n    super(format, key);\n    this.__id = id;\n  }\n\n  getId(): string {\n    return this.__id;\n  }\n\n  decorate(editor: LexicalEditor, config: EditorConfig): JSX.Element {\n    const embedBlockTheme = config.theme.embedBlock || {};\n    const className = {\n      base: embedBlockTheme.base || '',\n      focus: embedBlockTheme.focus || '',\n    };\n    return (\n      <TweetComponent\n        className={className}\n        format={this.__format}\n        loadingComponent=\"Loading...\"\n        nodeKey={this.getKey()}\n        tweetID={this.__id}\n      />\n    );\n  }\n\n  isTopLevel(): true {\n    return true;\n  }\n}\n\nexport function $createTweetNode(tweetID: string): TweetNode {\n  return new TweetNode(tweetID);\n}\n\nexport function $isTweetNode(\n  node: TweetNode | LexicalNode | null | undefined\n): node is TweetNode {\n  return node instanceof TweetNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { EditorConfig } from 'lexical';\nimport SerializedTextNode from 'lexical';\n\nimport { Spread } from 'globals';\nimport { TextNode } from 'lexical';\n\nexport type SerializedTypeaheadNode = Spread<\n  {\n    type: 'typeahead';\n    version: 1;\n  },\n  typeof SerializedTextNode\n>;\n\nexport class TypeaheadNode extends TextNode {\n  static clone(node: TypeaheadNode): TypeaheadNode {\n    return new TypeaheadNode(node.__text, node.__key);\n  }\n\n  static getType(): 'typeahead' {\n    return 'typeahead';\n  }\n\n  static importJSON(serializedNode: SerializedTypeaheadNode): TypeaheadNode {\n    const node = $createTypeaheadNode(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedTypeaheadNode {\n    return {\n      ...super.exportJSON(),\n      type: 'typeahead',\n      version: 1,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cssText = 'color: #ccc;';\n    return dom;\n  }\n}\n\nexport function $createTypeaheadNode(text: string): TypeaheadNode {\n  return new TypeaheadNode(text).setMode('token');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  EditorConfig,\n  ElementFormatType,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  Spread,\n} from 'lexical';\n\nimport { BlockWithAlignableContents } from '@lexical/react/LexicalBlockWithAlignableContents';\nimport {\n  DecoratorBlockNode,\n  SerializedDecoratorBlockNode,\n} from '@lexical/react/LexicalDecoratorBlockNode';\nimport * as React from 'react';\n\ntype YouTubeComponentProps = Readonly<{\n  className: Readonly<{\n    base: string;\n    focus: string;\n  }>;\n  format: ElementFormatType | null;\n  nodeKey: NodeKey;\n  videoID: string;\n}>;\n\nfunction YouTubeComponent({\n  className,\n  format,\n  nodeKey,\n  videoID,\n}: YouTubeComponentProps) {\n  return (\n    <BlockWithAlignableContents\n      className={className}\n      format={format}\n      nodeKey={nodeKey}\n    >\n      <iframe\n        width=\"560\"\n        height=\"315\"\n        src={`https://www.youtube.com/embed/${videoID}`}\n        frameBorder=\"0\"\n        allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n        allowFullScreen={true}\n        title=\"YouTube video\"\n      />\n    </BlockWithAlignableContents>\n  );\n}\n\nexport type SerializedYouTubeNode = Spread<\n  {\n    videoID: string;\n    type: 'youtube';\n    version: 1;\n  },\n  SerializedDecoratorBlockNode\n>;\n\nexport class YouTubeNode extends DecoratorBlockNode {\n  __id: string;\n\n  static getType(): string {\n    return 'youtube';\n  }\n\n  static clone(node: YouTubeNode): YouTubeNode {\n    return new YouTubeNode(node.__id, node.__format, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedYouTubeNode): YouTubeNode {\n    const node = $createYouTubeNode(serializedNode.videoID);\n    node.setFormat(serializedNode.format);\n    return node;\n  }\n\n  exportJSON(): SerializedYouTubeNode {\n    return {\n      ...super.exportJSON(),\n      type: 'youtube',\n      version: 1,\n      videoID: this.__id,\n    };\n  }\n\n  constructor(id: string, format?: ElementFormatType, key?: NodeKey) {\n    super(format, key);\n    this.__id = id;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  getId(): string {\n    return this.__id;\n  }\n\n  decorate(_editor: LexicalEditor, config: EditorConfig): JSX.Element {\n    const embedBlockTheme = config.theme.embedBlock || {};\n    const className = {\n      base: embedBlockTheme.base || '',\n      focus: embedBlockTheme.focus || '',\n    };\n    return (\n      <YouTubeComponent\n        className={className}\n        format={this.__format}\n        nodeKey={this.getKey()}\n        videoID={this.__id}\n      />\n    );\n  }\n\n  isTopLevel(): true {\n    return true;\n  }\n}\n\nexport function $createYouTubeNode(videoID: string): YouTubeNode {\n  return new YouTubeNode(videoID);\n}\n\nexport function $isYouTubeNode(\n  node: YouTubeNode | LexicalNode | null | undefined\n): node is YouTubeNode {\n  return node instanceof YouTubeNode;\n}\n","import { EditorConfig, TextNode, LexicalNode, NodeKey } from 'lexical';\nimport SerializedTextNode from 'lexical';\nimport { Spread } from 'globals';\n\nexport type SerializedCustomFieldNode = Spread<\n    {\n        text: string;\n        id: string;\n        className: string;\n        type: 'custom-field';\n        version: 1;\n    },\n    typeof SerializedTextNode\n>;\n\nexport class CustomFieldNode extends TextNode {\n    __id: string;\n\n    static getType(): string {\n        return 'custom-field';\n    }\n\n    static clone(node: CustomFieldNode): CustomFieldNode {\n        return new CustomFieldNode(node.__text, node.__id, node.__key);\n    }\n\n    constructor(text: string, id?: string, key?: NodeKey) {\n        super(text, key);\n        this.__id = id;\n    }\n\n    createDOM(config: EditorConfig): HTMLElement {\n        // Define the DOM element here\n        const dom = document.createElement('p');\n        dom.setAttribute('contenteditable', 'false');\n        dom.className = 'custom-field';\n\n        const self = this.getLatest();\n        dom.innerHTML = self.__text;\n        dom.id = self.__id;\n        return dom;\n    }\n\n    updateDOM(prevNode: CustomFieldNode, dom: HTMLElement): boolean {\n        // Returning false tells Lexical that this node does not need its\n        // DOM element replacing with a new copy from createDOM.\n        return false;\n    }\n\n    getClassName(): string {\n        const self = this.getLatest();\n        return self.__className;\n    }\n\n    getId(): string {\n        const self = this.getLatest();\n        return self.__id;\n    }\n\n    getText(): string {\n        const self = this.getLatest();\n        return self.__text;\n    }\n\n\n    static importJSON(serializedNode: SerializedCustomFieldNode): CustomFieldNode {\n        const node = $createCustomFieldNode(\n            serializedNode.text,\n            serializedNode.id,\n        );\n        node.setStyle(serializedNode.style);\n        return node;\n    }\n\n    exportJSON(): SerializedCustomFieldNode {\n        return {\n            ...super.exportJSON(),\n            id: this.getId(),\n            text: this.getText(),\n            className: this.getClassName(),\n            type: 'custom-field',\n            version: 1,\n        };\n    }\n}\n\nexport function $createCustomFieldNode(text: string, id?: string, key?: string): CustomFieldNode {\n    return new CustomFieldNode(text, id, key);\n}\n\nexport function $isCustomFieldNodeNode(node: LexicalNode | null | undefined): node is CustomFieldNode {\n    return node instanceof CustomFieldNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalNode } from 'lexical';\n\nimport { CodeHighlightNode, CodeNode } from '@lexical/code';\nimport { HashtagNode } from '@lexical/hashtag';\nimport { AutoLinkNode, LinkNode } from '@lexical/link';\nimport { ListItemNode, ListNode } from '@lexical/list';\nimport { MarkNode } from '@lexical/mark';\nimport { OverflowNode } from '@lexical/overflow';\nimport { HorizontalRuleNode } from '@lexical/react/LexicalHorizontalRuleNode';\nimport { HeadingNode, QuoteNode } from '@lexical/rich-text';\nimport { TableCellNode, TableNode, TableRowNode } from '@lexical/table';\nimport { Class } from 'utility-types';\n\nimport { EmojiNode } from './EmojiNode';\nimport { ImageNode } from './ImageNode';\nimport { KeywordNode } from './KeywordNode';\nimport { MentionNode } from './MentionNode';\nimport { PollNode } from './PollNode';\nimport { StickyNode } from './StickyNode';\nimport { TweetNode } from './TweetNode';\nimport { TypeaheadNode } from './TypeaheadNode';\nimport { YouTubeNode } from './YouTubeNode';\nimport { CustomFieldNode } from './CustomFieldNode';\n\nconst PlaygroundNodes: Array<Class<LexicalNode>> = [\n  HeadingNode,\n  ListNode,\n  ListItemNode,\n  QuoteNode,\n  CodeNode,\n  TableNode,\n  TableCellNode,\n  TableRowNode,\n  HashtagNode,\n  CodeHighlightNode,\n  AutoLinkNode,\n  LinkNode,\n  OverflowNode,\n  PollNode,\n  StickyNode,\n  ImageNode,\n  MentionNode,\n  EmojiNode,\n  TypeaheadNode,\n  KeywordNode,\n  HorizontalRuleNode,\n  TweetNode,\n  YouTubeNode,\n  MarkNode,\n  CustomFieldNode,\n];\n\nexport default PlaygroundNodes;\n","import * as i18next from 'i18next';\nimport EN from './languages/en.json';\nimport FR from './languages/fr.json';\nimport PTBR from './languages/ptBr.json';\nimport RU from './languages/ru.json';\n\nexport const resources = {\n  ar: {},\n  de: {},\n  en: EN,\n  es: {},\n  fr: FR,\n  it: {},\n  ja: {},\n  nl: {},\n  pl: {},\n  pt: {},\n  ptBr: PTBR,\n  ru: RU,\n  ukr: {},\n  zh: {},\n} as const;\n\nexport const languageDetector = {\n  type: 'languageDetector',\n  async: true,\n  detect: (callback) => {\n    const language = navigator.language;\n    callback(language.substring(0, 2));\n  },\n  init: () => {},\n  cacheUserLanguage: () => {},\n};\n\nconst i18n = i18next\n  .createInstance(\n    {\n      ns: ['toolbar', 'action'],\n      resources,\n      fallbackLng: 'en',\n      debug: true,\n      interpolation: {\n        escapeValue: false,\n      },\n    },\n    // We must provide a function as second parameter, otherwise i18next errors\n    (err, t) => {}\n  )\n  .use(languageDetector as i18next.Module);\n\nexport default i18n;\n","import {\n  LexicalComposer,\n  InitialEditorStateType,\n} from '@lexical/react/LexicalComposer';\nimport React from 'react';\nimport PlaygroundNodes from './nodes/PlaygroundNodes';\nimport PlaygroundEditorTheme from './themes/PlaygroundEditorTheme';\nimport './EditorComposer.css';\nimport i18n from './locale';\nimport { I18nextProvider } from 'react-i18next';\nimport { LexicalNode } from 'lexical';\nimport { Class } from 'utility-types';\n\ninterface IEditorComposer {\n  children: React.ReactElement;\n  initialEditorState?: InitialEditorStateType;\n  extraNodes?: Class<LexicalNode>[];\n  editable?: boolean;\n}\n\nconst EditorComposer = ({\n  children,\n  initialEditorState,\n  extraNodes = [],\n  editable,\n}: IEditorComposer) => {\n  const initialConfig = {\n    namespace: 'VerbumEditor',\n    nodes: [...PlaygroundNodes, ...extraNodes],\n    onError: (error) => {\n      throw error;\n    },\n    theme: PlaygroundEditorTheme,\n    editorState: initialEditorState,\n    editable,\n  };\n  return (\n    <LexicalComposer initialConfig={initialConfig}>\n      <I18nextProvider i18n={i18n}>\n        <div className=\"editor-shell\">{children}</div>\n      </I18nextProvider>\n    </LexicalComposer>\n  );\n};\n\nexport default EditorComposer;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nexport type SettingName =\n  | 'disableBeforeInput'\n  | 'measureTypingPerf'\n  | 'isRichText'\n  | 'isCollab'\n  | 'isCharLimit'\n  | 'isCharLimitUtf8'\n  | 'isAutocomplete'\n  | 'showTreeView'\n  | 'showNestedEditorTreeView'\n  | 'emptyEditor';\n\nexport type Settings = Record<SettingName, boolean>;\n\nconst hostName = window.location.hostname;\nexport const isDevPlayground: boolean =\n  hostName !== 'playground.lexical.dev' &&\n  hostName !== 'lexical-playground.vercel.app';\n\nexport const DEFAULT_SETTINGS: Settings = {\n  disableBeforeInput: false,\n  emptyEditor: isDevPlayground,\n  isAutocomplete: false,\n  isCharLimit: false,\n  isCharLimitUtf8: false,\n  isCollab: false,\n  isRichText: true,\n  measureTypingPerf: false,\n  showNestedEditorTreeView: false,\n  showTreeView: true,\n};\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { SettingName } from '../appSettings';\n\nimport * as React from 'react';\nimport {\n  createContext,\n  useCallback,\n  useContext,\n  useMemo,\n  useState,\n} from 'react';\n\nimport { DEFAULT_SETTINGS } from '../appSettings';\n\ntype SettingsContextShape = {\n  setOption: (name: SettingName, value: boolean) => void;\n  settings: Record<SettingName, boolean>;\n};\n\nconst Context: React.Context<SettingsContextShape> = createContext({\n  setOption: (name: SettingName, value: boolean) => {\n    return;\n  },\n  settings: DEFAULT_SETTINGS,\n});\n\nexport const SettingsContext = ({\n  children,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n}): JSX.Element => {\n  const [settings, setSettings] = useState(DEFAULT_SETTINGS);\n  const setOption = useCallback((setting: SettingName, value: boolean) => {\n    setSettings((options) => ({\n      ...options,\n      [setting as string]: value,\n    }));\n    if (DEFAULT_SETTINGS[setting] === value) {\n      setURLParam(setting, null);\n    } else {\n      setURLParam(setting, value);\n    }\n  }, []);\n  const contextValue = useMemo(() => {\n    return { setOption, settings };\n  }, [setOption, settings]);\n  return <Context.Provider value={contextValue}>{children}</Context.Provider>;\n};\n\nexport const useSettings = (): SettingsContextShape => {\n  return useContext(Context);\n};\n\nfunction setURLParam(param: SettingName, value: null | boolean) {\n  const url = new URL(window.location.href);\n  const params = new URLSearchParams(url.search);\n  if (value !== null) {\n    if (params.has(param)) {\n      params.set(param, String(value));\n    } else {\n      params.append(param, String(value));\n    }\n  } else {\n    if (params.has(param)) {\n      params.delete(param);\n    }\n  }\n  url.search = params.toString();\n  window.history.pushState(null, '', url.toString());\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Modal.css';\n\nimport * as React from 'react';\nimport { useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\n\nfunction PortalImpl({\n  onClose,\n  children,\n  title,\n  closeOnClickOutside,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n  closeOnClickOutside: boolean;\n  onClose: () => void;\n  title: string;\n}) {\n  const modalRef = useRef<HTMLDivElement>();\n\n  useEffect(() => {\n    if (modalRef.current !== null) {\n      modalRef.current.focus();\n    }\n  }, []);\n\n  useEffect(() => {\n    let modalOverlayElement = null;\n    const handler = (event) => {\n      if (event.keyCode === 27) {\n        onClose();\n      }\n    };\n    const clickOutsideHandler = (event: MouseEvent) => {\n      const target = event.target;\n      if (\n        modalRef.current !== null &&\n        !modalRef.current.contains(target as Node) &&\n        closeOnClickOutside\n      ) {\n        onClose();\n      }\n    };\n    if (modalRef.current !== null) {\n      modalOverlayElement = modalRef.current?.parentElement;\n      if (modalOverlayElement !== null) {\n        modalOverlayElement?.addEventListener('click', clickOutsideHandler);\n      }\n    }\n\n    window.addEventListener('keydown', handler);\n\n    return () => {\n      window.removeEventListener('keydown', handler);\n      if (modalOverlayElement !== null) {\n        modalOverlayElement?.removeEventListener('click', clickOutsideHandler);\n      }\n    };\n  }, [closeOnClickOutside, onClose]);\n\n  return (\n    <div className=\"Modal__overlay\" role=\"dialog\">\n      <div className=\"Modal__modal\" tabIndex={-1} ref={modalRef}>\n        <h2 className=\"Modal__title\">{title}</h2>\n        <button\n          className=\"Modal__closeButton\"\n          aria-label=\"Close modal\"\n          type=\"button\"\n          onClick={onClose}\n        >\n          X\n        </button>\n        <div className=\"Modal__content\">{children}</div>\n      </div>\n    </div>\n  );\n}\n\nexport default function Modal({\n  onClose,\n  children,\n  title,\n  closeOnClickOutside = false,\n}: {\n  children: JSX.Element | string | (JSX.Element | string)[];\n  closeOnClickOutside?: boolean;\n  onClose: () => void;\n  title: string;\n}): JSX.Element {\n  return createPortal(\n    <PortalImpl\n      onClose={onClose}\n      title={title}\n      closeOnClickOutside={closeOnClickOutside}\n    >\n      {children}\n    </PortalImpl>,\n    document.body\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useCallback, useMemo, useState } from 'react';\nimport * as React from 'react';\n\nimport Modal from '../ui/Modal';\n\nexport default function useModal(): [\n  JSX.Element,\n  (title: string, showModal: (onClose: () => void) => JSX.Element) => void\n] {\n  const [modalContent, setModalContent] = useState<null | {\n    closeOnClickOutside: boolean;\n    content: JSX.Element;\n    title: string;\n  }>(null);\n\n  const onClose = useCallback(() => {\n    setModalContent(null);\n  }, []);\n\n  const modal = useMemo(() => {\n    if (modalContent === null) {\n      return null;\n    }\n    const { title, content, closeOnClickOutside } = modalContent;\n    return (\n      <Modal\n        onClose={onClose}\n        title={title}\n        closeOnClickOutside={closeOnClickOutside}\n      >\n        {content}\n      </Modal>\n    );\n  }, [modalContent, onClose]);\n\n  const showModal = useCallback(\n    (\n      title,\n      // eslint-disable-next-line no-shadow\n      getContent: (onClose: () => void) => JSX.Element,\n      closeOnClickOutside = false\n    ) => {\n      setModalContent({\n        closeOnClickOutside,\n        content: getContent(onClose),\n        title,\n      });\n    },\n    [onClose]\n  );\n\n  return [modal, showModal];\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  ElementTransformer,\n  TextMatchTransformer,\n  Transformer,\n} from '@lexical/markdown';\nimport type { ElementNode, LexicalNode } from 'lexical';\n\nimport {\n  CHECK_LIST,\n  ELEMENT_TRANSFORMERS,\n  TEXT_FORMAT_TRANSFORMERS,\n  TEXT_MATCH_TRANSFORMERS,\n} from '@lexical/markdown';\nimport {\n  $createHorizontalRuleNode,\n  $isHorizontalRuleNode,\n  HorizontalRuleNode,\n} from '@lexical/react/LexicalHorizontalRuleNode';\nimport {\n  $createTableCellNode,\n  $createTableNode,\n  $createTableRowNode,\n  $isTableNode,\n  $isTableRowNode,\n  TableCellHeaderStates,\n  TableCellNode,\n  TableNode,\n  TableRowNode,\n} from '@lexical/table';\nimport {\n  $createParagraphNode,\n  $createTextNode,\n  $isElementNode,\n  $isParagraphNode,\n  $isTextNode,\n} from 'lexical';\n\nimport { $createImageNode, $isImageNode, ImageNode } from '../nodes/ImageNode';\nimport { $createTweetNode, $isTweetNode, TweetNode } from '../nodes/TweetNode';\n\nexport const HR: ElementTransformer = {\n  dependencies: [HorizontalRuleNode],\n  export: (node: LexicalNode) => {\n    return $isHorizontalRuleNode(node) ? '***' : null;\n  },\n  regExp: /^(---|\\*\\*\\*|___)\\s?$/,\n  replace: (parentNode, _1, _2, isImport) => {\n    const line = $createHorizontalRuleNode();\n\n    // TODO: Get rid of isImport flag\n    if (isImport || parentNode.getNextSibling() != null) {\n      parentNode.replace(line);\n    } else {\n      parentNode.insertBefore(line);\n    }\n\n    line.selectNext();\n  },\n  type: 'element',\n};\n\nexport const IMAGE: TextMatchTransformer = {\n  dependencies: [ImageNode],\n  export: (node, exportChildren, exportFormat) => {\n    if (!$isImageNode(node)) {\n      return null;\n    }\n\n    return `![${node.getAltText()}](${node.getSrc()})`;\n  },\n  importRegExp: /!(?:\\[([^[]*)\\])(?:\\(([^(]+)\\))/,\n  regExp: /!(?:\\[([^[]*)\\])(?:\\(([^(]+)\\))$/,\n  replace: (textNode, match) => {\n    const [, altText, src] = match;\n    const imageNode = $createImageNode({\n      altText,\n      maxWidth: 800,\n      src,\n    });\n    textNode.replace(imageNode);\n  },\n  trigger: ')',\n  type: 'text-match',\n};\n\nexport const TWEET: ElementTransformer = {\n  dependencies: [TweetNode],\n  export: (node) => {\n    if (!$isTweetNode(node)) {\n      return null;\n    }\n\n    return `<tweet id=\"${node.getId()}\" />`;\n  },\n  regExp: /<tweet id=\"([^\"]+?)\"\\s?\\/>\\s?$/,\n  replace: (textNode, _1, match) => {\n    const [, id] = match;\n    const tweetNode = $createTweetNode(id);\n    textNode.replace(tweetNode);\n  },\n  type: 'element',\n};\n\n// Very primitive table setup\nconst TABLE_ROW_REG_EXP = /^(?:\\|)(.+)(?:\\|)\\s?$/;\n\nexport const TABLE: ElementTransformer = {\n  dependencies: [TableNode, TableRowNode, TableCellNode],\n  export: (\n    node: LexicalNode,\n    exportChildren: (elementNode: ElementNode) => string\n  ) => {\n    if (!$isTableNode(node)) {\n      return null;\n    }\n\n    const output = [];\n\n    for (const row of node.getChildren()) {\n      const rowOutput = [];\n\n      if ($isTableRowNode(row)) {\n        for (const cell of row.getChildren()) {\n          // It's TableCellNode (hence ElementNode) so it's just to make flow happy\n          if ($isElementNode(cell)) {\n            rowOutput.push(exportChildren(cell));\n          }\n        }\n      }\n\n      output.push(`| ${rowOutput.join(' | ')} |`);\n    }\n\n    return output.join('\\n');\n  },\n  regExp: TABLE_ROW_REG_EXP,\n  replace: (parentNode, _1, match) => {\n    const matchCells = mapToTableCells(match[0]);\n\n    if (matchCells == null) {\n      return;\n    }\n\n    const rows = [matchCells];\n    let sibling = parentNode.getPreviousSibling();\n    let maxCells = matchCells.length;\n\n    while (sibling) {\n      if (!$isParagraphNode(sibling)) {\n        break;\n      }\n\n      if (sibling.getChildrenSize() !== 1) {\n        break;\n      }\n\n      const firstChild = sibling.getFirstChild();\n\n      if (!$isTextNode(firstChild)) {\n        break;\n      }\n\n      const cells = mapToTableCells(firstChild.getTextContent());\n\n      if (cells == null) {\n        break;\n      }\n\n      maxCells = Math.max(maxCells, cells.length);\n      rows.unshift(cells);\n      const previousSibling = sibling.getPreviousSibling();\n      sibling.remove();\n      sibling = previousSibling;\n    }\n\n    const table = $createTableNode();\n\n    for (const cells of rows) {\n      const tableRow = $createTableRowNode();\n      table.append(tableRow);\n\n      for (let i = 0; i < maxCells; i++) {\n        tableRow.append(i < cells.length ? cells[i] : createTableCell(null));\n      }\n    }\n\n    const previousSibling = parentNode.getPreviousSibling();\n    if (\n      $isTableNode(previousSibling) &&\n      getTableColumnsSize(previousSibling) === maxCells\n    ) {\n      previousSibling.append(...table.getChildren());\n      parentNode.remove();\n    } else {\n      parentNode.replace(table);\n    }\n\n    table.selectEnd();\n  },\n  type: 'element',\n};\n\nfunction getTableColumnsSize(table: TableNode) {\n  const row = table.getFirstChild();\n  return $isTableRowNode(row) ? row.getChildrenSize() : 0;\n}\n\nconst createTableCell = (\n  textContent: string | null | undefined\n): TableCellNode => {\n  const cell = $createTableCellNode(TableCellHeaderStates.NO_STATUS);\n  const paragraph = $createParagraphNode();\n\n  if (textContent != null) {\n    paragraph.append($createTextNode(textContent.trim()));\n  }\n\n  cell.append(paragraph);\n  return cell;\n};\n\nconst mapToTableCells = (textContent: string): Array<TableCellNode> | null => {\n  // TODO:\n  // For now plain text, single node. Can be expanded to more complex content\n  // including formatted text\n  const match = textContent.match(TABLE_ROW_REG_EXP);\n\n  if (!match || !match[1]) {\n    return null;\n  }\n\n  return match[1].split('|').map((text) => createTableCell(text));\n};\n\nexport const PLAYGROUND_TRANSFORMERS: Array<Transformer> = [\n  TABLE,\n  HR,\n  IMAGE,\n  TWEET,\n  CHECK_LIST,\n  ...ELEMENT_TRANSFORMERS,\n  ...TEXT_FORMAT_TRANSFORMERS,\n  ...TEXT_MATCH_TRANSFORMERS,\n];\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useCallback, useEffect, useRef } from 'react';\n\nconst getElement = (): HTMLElement => {\n  let element = document.getElementById('report-container');\n\n  if (element === null) {\n    element = document.createElement('div');\n    element.id = 'report-container';\n    element.style.position = 'fixed';\n    element.style.top = '50%';\n    element.style.left = '50%';\n    element.style.fontSize = '32px';\n    element.style.transform = 'translate(-50%, -50px)';\n    element.style.padding = '20px';\n    element.style.background = 'rgba(240, 240, 240, 0.4)';\n    element.style.borderRadius = '20px';\n\n    if (document.body) {\n      document.body.appendChild(element);\n    }\n  }\n\n  return element;\n};\n\nexport default function useReport(): (arg0: string) => NodeJS.Timeout {\n  const timer = useRef<NodeJS.Timeout | null>(null);\n  const cleanup = useCallback(() => {\n    clearTimeout(timer.current);\n\n    if (document.body) {\n      document.body.removeChild(getElement());\n    }\n  }, []);\n\n  useEffect(() => {\n    return cleanup;\n  }, [cleanup]);\n\n  return useCallback(\n    (content) => {\n      // eslint-disable-next-line no-console\n      console.log(content);\n      const element = getElement();\n      clearTimeout(timer.current);\n      element.innerHTML = content;\n      timer.current = setTimeout(cleanup, 1000);\n      return timer.current;\n    },\n    [cleanup]\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand, LexicalEditor, RangeSelection } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n  REDO_COMMAND,\n  UNDO_COMMAND,\n} from 'lexical';\nimport { useEffect, useRef, useState } from 'react';\n\nimport useReport from '../hooks/useReport';\n\nexport const SPEECH_TO_TEXT_COMMAND: LexicalCommand<boolean> = createCommand();\n\nconst VOICE_COMMANDS: Readonly<\n  Record<\n    string,\n    (arg0: { editor: LexicalEditor; selection: RangeSelection }) => void\n  >\n> = {\n  '\\n': ({ selection }) => {\n    selection.insertParagraph();\n  },\n  redo: ({ editor }) => {\n    editor.dispatchCommand(REDO_COMMAND, undefined);\n  },\n  undo: ({ editor }) => {\n    editor.dispatchCommand(UNDO_COMMAND, undefined);\n  },\n};\n\nexport const SUPPORT_SPEECH_RECOGNITION: boolean =\n  'SpeechRecognition' in window || 'webkitSpeechRecognition' in window;\n\nfunction SpeechToTextPlugin(): null {\n  const [editor] = useLexicalComposerContext();\n  const [isEnabled, setIsEnabled] = useState<boolean>(false);\n  const SpeechRecognition =\n    // @ts-ignore\n    window.SpeechRecognition || window.webkitSpeechRecognition;\n  const recognition = useRef<typeof SpeechRecognition | null>(null);\n  const report = useReport();\n\n  useEffect(() => {\n    if (isEnabled && recognition.current === null) {\n      recognition.current = new SpeechRecognition();\n      recognition.current.continuous = true;\n      recognition.current.interimResults = true;\n      recognition.current.addEventListener(\n        'result',\n        (event: typeof SpeechRecognition) => {\n          const resultItem = event.results.item(event.resultIndex);\n          const { transcript } = resultItem.item(0);\n          report(transcript);\n\n          if (!resultItem.isFinal) {\n            return;\n          }\n\n          editor.update(() => {\n            const selection = $getSelection();\n\n            if ($isRangeSelection(selection)) {\n              const command = VOICE_COMMANDS[transcript.toLowerCase().trim()];\n\n              if (command) {\n                command({\n                  editor,\n                  selection,\n                });\n              } else if (transcript.match(/\\s*\\n\\s*/)) {\n                selection.insertParagraph();\n              } else {\n                selection.insertText(transcript);\n              }\n            }\n          });\n        }\n      );\n    }\n\n    if (recognition.current) {\n      if (isEnabled) {\n        recognition.current.start();\n      } else {\n        recognition.current.stop();\n      }\n    }\n\n    return () => {\n      if (recognition.current !== null) {\n        recognition.current.stop();\n      }\n    };\n  }, [SpeechRecognition, editor, isEnabled, report]);\n  useEffect(() => {\n    return editor.registerCommand(\n      SPEECH_TO_TEXT_COMMAND,\n      (_isEnabled: boolean) => {\n        setIsEnabled(_isEnabled);\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n\nexport default (SUPPORT_SPEECH_RECOGNITION\n  ? SpeechToTextPlugin\n  : () => null) as () => null;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalEditor } from 'lexical';\n\nimport { $createCodeNode, $isCodeNode } from '@lexical/code';\nimport { exportFile, importFile } from '@lexical/file';\nimport {\n  $convertFromMarkdownString,\n  $convertToMarkdownString,\n} from '@lexical/markdown';\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { mergeRegister } from '@lexical/utils';\nimport { CONNECTED_COMMAND, TOGGLE_CONNECT_COMMAND } from '@lexical/yjs';\nimport {\n  $createTextNode,\n  $getRoot,\n  $isParagraphNode,\n  CLEAR_EDITOR_COMMAND,\n  COMMAND_PRIORITY_EDITOR,\n} from 'lexical';\nimport * as React from 'react';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport useModal from '../hooks/useModal';\nimport Button from '../ui/Button';\nimport { PLAYGROUND_TRANSFORMERS } from './MarkdownTransformers';\nimport {\n  SPEECH_TO_TEXT_COMMAND,\n  SUPPORT_SPEECH_RECOGNITION,\n} from './SpeechToTextPlugin';\nimport { useTranslation } from 'react-i18next';\nimport { TFunction } from 'i18next';\n\nexport default function ActionsPlugin({\n  isRichText,\n}: {\n  isRichText: boolean;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const [isEditable, setIsEditable] = useState(() => editor.isEditable());\n  const [isSpeechToText, setIsSpeechToText] = useState(false);\n  const [connected, setConnected] = useState(false);\n  const [isEditorEmpty, setIsEditorEmpty] = useState(true);\n  const [modal, showModal] = useModal();\n  const { yjsDocMap } = useCollaborationContext();\n  const isCollab = yjsDocMap.get('main') !== undefined;\n  const { t } = useTranslation(['action']);\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerEditableListener((editable) => {\n        setIsEditable(editable);\n      }),\n      editor.registerCommand<boolean>(\n        CONNECTED_COMMAND,\n        (payload) => {\n          const isConnected = payload;\n          setConnected(isConnected);\n          return false;\n        },\n        COMMAND_PRIORITY_EDITOR\n      )\n    );\n  }, [editor]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      editor.getEditorState().read(() => {\n        const root = $getRoot();\n        const children = root.getChildren();\n\n        if (children.length > 1) {\n          setIsEditorEmpty(false);\n        } else {\n          if ($isParagraphNode(children[0])) {\n            const paragraphChildren = children[0].getChildren();\n            setIsEditorEmpty(paragraphChildren.length === 0);\n          } else {\n            setIsEditorEmpty(false);\n          }\n        }\n      });\n    });\n  }, [editor]);\n\n  const handleMarkdownToggle = useCallback(() => {\n    editor.update(() => {\n      const root = $getRoot();\n      const firstChild = root.getFirstChild();\n      if ($isCodeNode(firstChild) && firstChild.getLanguage() === 'markdown') {\n        $convertFromMarkdownString(\n          firstChild.getTextContent(),\n          PLAYGROUND_TRANSFORMERS\n        );\n      } else {\n        const markdown = $convertToMarkdownString(PLAYGROUND_TRANSFORMERS);\n        root\n          .clear()\n          .append(\n            $createCodeNode('markdown').append($createTextNode(markdown))\n          );\n      }\n      root.selectEnd();\n    });\n  }, [editor]);\n\n  return (\n    <div className=\"actions\">\n      {SUPPORT_SPEECH_RECOGNITION && (\n        <button\n          onClick={() => {\n            editor.dispatchCommand(SPEECH_TO_TEXT_COMMAND, !isSpeechToText);\n            setIsSpeechToText(!isSpeechToText);\n          }}\n          className={\n            'action-button action-button-mic ' +\n            (isSpeechToText ? 'active' : '')\n          }\n          title={t('action:Speech_To_Text')}\n          aria-label={`${\n            isSpeechToText ? t('action:Enable') : t('action:Disable')\n          } ${t('action:speech_To_Text')}`}\n          type=\"button\"\n        >\n          <i className=\"mic\" />\n        </button>\n      )}\n      <button\n        className=\"action-button import\"\n        onClick={() => importFile(editor)}\n        title={t('action:Import')}\n        aria-label={t('action:Import_Description')}\n        type=\"button\"\n      >\n        <i className=\"import\" />\n      </button>\n      <button\n        className=\"action-button export\"\n        onClick={() =>\n          exportFile(editor, {\n            fileName: `Playground ${new Date().toISOString()}`,\n            source: 'Playground',\n          })\n        }\n        title={t('action:Export')}\n        aria-label={t('action:Export_Description')}\n        type=\"button\"\n      >\n        <i className=\"export\" />\n      </button>\n      <button\n        className=\"action-button clear\"\n        disabled={isEditorEmpty}\n        onClick={() => {\n          showModal(t('action:Clear_Editor'), (onClose) => (\n            <ShowClearDialog editor={editor} onClose={onClose} t={t} />\n          ));\n        }}\n        title={t('action:Clear')}\n        aria-label={t('action:Clear_Description')}\n        type=\"button\"\n      >\n        <i className=\"clear\" />\n      </button>\n      <button\n        className={`action-button ${isEditable ? 'unlock' : 'lock'}`}\n        onClick={() => {\n          editor.setEditable(!editor.isEditable());\n        }}\n        title={t('action:Read-Only_Mode')}\n        aria-label={`${isEditable ? t('action:Unlock') : t('action:Lock')} ${t(\n          'action:Read-Only_Mode'\n        )}`}\n        type=\"button\"\n      >\n        <i className={isEditable ? 'unlock' : 'lock'} />\n      </button>\n      <button\n        className=\"action-button\"\n        onClick={handleMarkdownToggle}\n        title={t('action:Convert_From_Markdown')}\n        aria-label={t('action:Convert_From_Markdown_Description')}\n        type=\"button\"\n      >\n        <i className=\"markdown\" />\n      </button>\n      {isCollab && (\n        <button\n          className=\"action-button connect\"\n          onClick={() => {\n            editor.dispatchCommand(TOGGLE_CONNECT_COMMAND, !connected);\n          }}\n          title={`${\n            connected ? t('action:Disconnect') : t('action:Connect')\n          } ${t('action:Collaborative')}`}\n          aria-label={`${\n            connected ? t('action:Disconnect_From') : t('action:Connect_To')\n          } ${t('action:Server')}`}\n          type=\"button\"\n        >\n          <i\n            className={connected ? t('action:disconnect') : t('action:connect')}\n          />\n        </button>\n      )}\n      {modal}\n    </div>\n  );\n}\n\nfunction ShowClearDialog({\n  editor,\n  onClose,\n  t,\n}: {\n  editor: LexicalEditor;\n  onClose: () => void;\n  t: TFunction;\n}): JSX.Element {\n  return (\n    <>\n      {t('action:Confirm_Clear')}\n      <div className=\"Modal__content\">\n        <Button\n          onClick={() => {\n            editor.dispatchCommand(CLEAR_EDITOR_COMMAND, undefined);\n            editor.focus();\n            onClose();\n          }}\n        >\n          {t('action:Clear')}\n        </Button>{' '}\n        <Button\n          onClick={() => {\n            editor.focus();\n            onClose();\n          }}\n        >\n          {t('action:Cancel')}\n        </Button>\n      </div>\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { AutoLinkPlugin } from '@lexical/react/LexicalAutoLinkPlugin';\nimport * as React from 'react';\n\nconst URL_MATCHER =\n  /((https?:\\/\\/(www\\.)?)|(www\\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/;\n\nconst EMAIL_MATCHER =\n  /(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))/;\n\nconst MATCHERS = [\n  (text) => {\n    const match = URL_MATCHER.exec(text);\n    return (\n      match && {\n        index: match.index,\n        length: match[0].length,\n        text: match[0],\n        url: match[0],\n      }\n    );\n  },\n  (text) => {\n    const match = EMAIL_MATCHER.exec(text);\n    return (\n      match && {\n        index: match.index,\n        length: match[0].length,\n        text: match[0],\n        url: `mailto:${match[0]}`,\n      }\n    );\n  },\n];\n\nexport default function LexicalAutoLinkPlugin(): JSX.Element {\n  return <AutoLinkPlugin matchers={MATCHERS} />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {\n  Comment,\n  Comments,\n  CommentStore,\n  createComment,\n  createThread,\n  Thread,\n  useCommentStore,\n} from '../commenting';\nimport type {\n  EditorState,\n  LexicalCommand,\n  LexicalEditor,\n  NodeKey,\n} from 'lexical';\n\nimport './CommentPlugin.css';\n\nimport {\n  $createMarkNode,\n  $getMarkIDs,\n  $isMarkNode,\n  $unwrapMarkNode,\n  $wrapSelectionInMarkNode,\n  MarkNode,\n} from '@lexical/mark';\nimport { AutoFocusPlugin } from '@lexical/react/LexicalAutoFocusPlugin';\nimport { ClearEditorPlugin } from '@lexical/react/LexicalClearEditorPlugin';\nimport { LexicalComposer } from '@lexical/react/LexicalComposer';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport { OnChangePlugin } from '@lexical/react/LexicalOnChangePlugin';\nimport { PlainTextPlugin } from '@lexical/react/LexicalPlainTextPlugin';\nimport LexicalErrorBoundary from '@lexical/react/LexicalErrorBoundary';\nimport { createDOMRange, createRectsFromDOMRange } from '@lexical/selection';\nimport { $isRootTextContentEmpty, $rootTextContent } from '@lexical/text';\nimport { mergeRegister, registerNestedElementResolver } from '@lexical/utils';\nimport {\n  $getNodeByKey,\n  $getSelection,\n  $isRangeSelection,\n  $isTextNode,\n  CLEAR_EDITOR_COMMAND,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n  KEY_ESCAPE_COMMAND,\n} from 'lexical';\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport useLayoutEffect from '../shared/src/useLayoutEffect';\n\nimport useModal from '../hooks/useModal';\nimport CommentEditorTheme from '../themes/CommentEditorTheme';\nimport Button from '../ui/Button';\nimport ContentEditable from '../ui/ContentEditable';\nimport Placeholder from '../ui/Placeholder';\nimport type { Doc } from 'yjs';\nimport { useCollaborationContext } from '@lexical/react/LexicalCollaborationContext';\nimport { WebsocketProvider } from 'y-websocket';\nimport { useTranslation } from 'react-i18next';\nimport { TFunction } from 'i18next';\n\nexport const INSERT_INLINE_COMMAND: LexicalCommand<void> = createCommand();\n\nfunction AddCommentBox({\n  anchorKey,\n  editor,\n  onAddComment,\n}: {\n  anchorKey: NodeKey;\n  editor: LexicalEditor;\n  onAddComment: () => void;\n}): JSX.Element {\n  const boxRef = useRef<HTMLDivElement>(null);\n\n  const updatePosition = useCallback(() => {\n    const boxElem = boxRef.current;\n    const rootElement = editor.getRootElement();\n    const anchorElement = editor.getElementByKey(anchorKey);\n\n    if (boxElem !== null && rootElement !== null && anchorElement !== null) {\n      const { right } = rootElement.getBoundingClientRect();\n      const { top } = anchorElement.getBoundingClientRect();\n      boxElem.style.left = `${right - 20}px`;\n      boxElem.style.top = `${top - 30}px`;\n    }\n  }, [anchorKey, editor]);\n\n  useEffect(() => {\n    window.addEventListener('resize', updatePosition);\n\n    return () => {\n      window.removeEventListener('resize', updatePosition);\n    };\n  }, [editor, updatePosition]);\n\n  useLayoutEffect(() => {\n    updatePosition();\n  }, [anchorKey, editor, updatePosition]);\n\n  return (\n    <div className=\"CommentPlugin_AddCommentBox\" ref={boxRef}>\n      <button\n        className=\"CommentPlugin_AddCommentBox_button\"\n        onClick={onAddComment}\n        type=\"button\"\n      >\n        <i className=\"icon add-comment\" />\n      </button>\n    </div>\n  );\n}\n\nfunction EditorRefPlugin({\n  editorRef,\n}: {\n  editorRef: { current: null | LexicalEditor };\n}): null {\n  const [editor] = useLexicalComposerContext();\n\n  useLayoutEffect(() => {\n    editorRef.current = editor;\n    return () => {\n      editorRef.current = null;\n    };\n  }, [editor, editorRef]);\n\n  return null;\n}\n\nfunction EscapeHandlerPlugin({\n  onEscape,\n}: {\n  onEscape: (e: KeyboardEvent) => boolean;\n}): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      KEY_ESCAPE_COMMAND,\n      (event: KeyboardEvent) => {\n        return onEscape(event);\n      },\n      2\n    );\n  }, [editor, onEscape]);\n\n  return null;\n}\n\nfunction PlainTextEditor({\n  className,\n  autoFocus,\n  onEscape,\n  onChange,\n  editorRef,\n  placeholder = 'Type a comment...',\n}: {\n  autoFocus?: boolean;\n  className?: string;\n  editorRef?: { current: null | LexicalEditor };\n  onChange: (editorState: EditorState, editor: LexicalEditor) => void;\n  onEscape: (e: KeyboardEvent) => boolean;\n  placeholder?: string;\n}) {\n  const initialConfig = {\n    namespace: 'Commenting',\n    nodes: [],\n    onError: (error: Error) => {\n      throw error;\n    },\n    theme: CommentEditorTheme,\n  };\n\n  return (\n    <LexicalComposer initialConfig={initialConfig}>\n      <div className=\"CommentPlugin_CommentInputBox_EditorContainer\">\n        <PlainTextPlugin\n          contentEditable={<ContentEditable className={className} />}\n          placeholder={<Placeholder>{placeholder}</Placeholder>}\n          ErrorBoundary={LexicalErrorBoundary}\n        />\n        <OnChangePlugin onChange={onChange} />\n        <HistoryPlugin />\n        {autoFocus !== false && <AutoFocusPlugin />}\n        <EscapeHandlerPlugin onEscape={onEscape} />\n        <ClearEditorPlugin />\n        {editorRef !== undefined && <EditorRefPlugin editorRef={editorRef} />}\n      </div>\n    </LexicalComposer>\n  );\n}\n\nfunction useOnChange(\n  setContent: (text: string) => void,\n  setCanSubmit: (canSubmit: boolean) => void\n) {\n  return useCallback(\n    (editorState: EditorState, _editor: LexicalEditor) => {\n      editorState.read(() => {\n        setContent($rootTextContent());\n        setCanSubmit(!$isRootTextContentEmpty(_editor.isComposing(), true));\n      });\n    },\n    [setCanSubmit, setContent]\n  );\n}\n\nfunction CommentInputBox({\n  editor,\n  cancelAddComment,\n  submitAddComment,\n  t,\n}: {\n  cancelAddComment: () => void;\n  editor: LexicalEditor;\n  submitAddComment: (\n    commentOrThread: Comment | Thread,\n    isInlineComment: boolean\n  ) => void;\n  t: TFunction;\n}) {\n  const [content, setContent] = useState('');\n  const [canSubmit, setCanSubmit] = useState(false);\n  const boxRef = useRef<HTMLDivElement>(null);\n  const selectionState = useMemo(\n    () => ({\n      container: document.createElement('div'),\n      elements: [],\n    }),\n    []\n  );\n  const author = useCollabAuthorName();\n\n  const updateLocation = useCallback(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n\n      if ($isRangeSelection(selection)) {\n        const anchor = selection.anchor;\n        const focus = selection.focus;\n        const range = createDOMRange(\n          editor,\n          anchor.getNode(),\n          anchor.offset,\n          focus.getNode(),\n          focus.offset\n        );\n        const boxElem = boxRef.current;\n        if (range !== null && boxElem !== null) {\n          const { left, bottom, width } = range.getBoundingClientRect();\n          const selectionRects = createRectsFromDOMRange(editor, range);\n          let correctedLeft =\n            selectionRects.length === 1 ? left + width / 2 - 125 : left - 125;\n          if (correctedLeft < 10) {\n            correctedLeft = 10;\n          }\n          boxElem.style.left = `${correctedLeft}px`;\n          boxElem.style.top = `${bottom + 20}px`;\n          const selectionRectsLength = selectionRects.length;\n          const { container } = selectionState;\n          const elements: Array<HTMLSpanElement> = selectionState.elements;\n          const elementsLength = elements.length;\n\n          for (let i = 0; i < selectionRectsLength; i++) {\n            const selectionRect = selectionRects[i];\n            let elem: HTMLSpanElement = elements[i];\n            if (elem === undefined) {\n              elem = document.createElement('span');\n              elements[i] = elem;\n              container.appendChild(elem);\n            }\n            const color = '255, 212, 0';\n            const style = `position:absolute;top:${selectionRect.top}px;left:${selectionRect.left}px;height:${selectionRect.height}px;width:${selectionRect.width}px;background-color:rgba(${color}, 0.3);pointer-events:none;z-index:5;`;\n            elem.style.cssText = style;\n          }\n          for (let i = elementsLength - 1; i >= selectionRectsLength; i--) {\n            const elem = elements[i];\n            container.removeChild(elem);\n            elements.pop();\n          }\n        }\n      }\n    });\n  }, [editor, selectionState]);\n\n  useLayoutEffect(() => {\n    updateLocation();\n    const container = selectionState.container;\n    const body = document.body;\n    if (body !== null) {\n      body.appendChild(container);\n      return () => {\n        body.removeChild(container);\n      };\n    }\n  }, [selectionState.container, updateLocation]);\n\n  useEffect(() => {\n    window.addEventListener('resize', updateLocation);\n\n    return () => {\n      window.removeEventListener('resize', updateLocation);\n    };\n  }, [updateLocation]);\n\n  const onEscape = (event: KeyboardEvent): boolean => {\n    event.preventDefault();\n    cancelAddComment();\n    return true;\n  };\n\n  const submitComment = () => {\n    if (canSubmit) {\n      let quote = editor.getEditorState().read(() => {\n        const selection = $getSelection();\n        return selection !== null ? selection.getTextContent() : '';\n      });\n      if (quote.length > 100) {\n        quote = quote.slice(0, 99) + '';\n      }\n      submitAddComment(\n        createThread(quote, [createComment(content, author)]),\n        true\n      );\n    }\n  };\n\n  const onChange = useOnChange(setContent, setCanSubmit);\n\n  return (\n    <div className=\"CommentPlugin_CommentInputBox\" ref={boxRef}>\n      <PlainTextEditor\n        className=\"CommentPlugin_CommentInputBox_Editor\"\n        onEscape={onEscape}\n        onChange={onChange}\n      />\n      <div className=\"CommentPlugin_CommentInputBox_Buttons\">\n        <Button\n          onClick={cancelAddComment}\n          className=\"CommentPlugin_CommentInputBox_Button\"\n        >\n          {t('action:Cancel')}\n        </Button>\n        <Button\n          onClick={submitComment}\n          disabled={!canSubmit}\n          className=\"CommentPlugin_CommentInputBox_Button primary\"\n        >\n          {t('action:Comment')}\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nfunction CommentsComposer({\n  submitAddComment,\n  thread,\n  placeholder,\n}: {\n  placeholder?: string;\n  submitAddComment: (\n    commentOrThread: Comment,\n    isInlineComment: boolean,\n    // eslint-disable-next-line no-shadow\n    thread?: Thread\n  ) => void;\n  thread?: Thread;\n}) {\n  const [content, setContent] = useState('');\n  const [canSubmit, setCanSubmit] = useState(false);\n  const editorRef = useRef<LexicalEditor>(null);\n  const author = useCollabAuthorName();\n\n  const onChange = useOnChange(setContent, setCanSubmit);\n\n  const submitComment = () => {\n    if (canSubmit) {\n      submitAddComment(createComment(content, author), false, thread);\n      const editor = editorRef.current;\n      if (editor !== null) {\n        editor.dispatchCommand(CLEAR_EDITOR_COMMAND, undefined);\n      }\n    }\n  };\n\n  return (\n    <>\n      <PlainTextEditor\n        className=\"CommentPlugin_CommentsPanel_Editor\"\n        autoFocus={false}\n        onEscape={() => {\n          return true;\n        }}\n        onChange={onChange}\n        editorRef={editorRef}\n        placeholder={placeholder}\n      />\n      <Button\n        className=\"CommentPlugin_CommentsPanel_SendButton\"\n        onClick={submitComment}\n        disabled={!canSubmit}\n      >\n        <i className=\"send\" />\n      </Button>\n    </>\n  );\n}\n\nfunction ShowDeleteCommentOrThreadDialog({\n  commentOrThread,\n  deleteCommentOrThread,\n  onClose,\n  thread = undefined,\n  t,\n}: {\n  commentOrThread: Comment | Thread;\n\n  deleteCommentOrThread: (\n    comment: Comment | Thread,\n    // eslint-disable-next-line no-shadow\n    thread?: Thread\n  ) => void;\n  onClose: () => void;\n  thread?: Thread;\n  t: TFunction;\n}): JSX.Element {\n  return (\n    <>\n      {`${t('toolbar:commentPlugin.Delete_Comment_Description')} ${\n        commentOrThread.type\n      }?`}\n      <div className=\"Modal__content\">\n        <Button\n          onClick={() => {\n            deleteCommentOrThread(commentOrThread, thread);\n            onClose();\n          }}\n        >\n          {t('action:Delete')}\n        </Button>{' '}\n        <Button\n          onClick={() => {\n            onClose();\n          }}\n        >\n          {t('action:Cancel')}\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction CommentsPanelListComment({\n  comment,\n  deleteComment,\n  thread,\n  rtf,\n  t,\n}: {\n  comment: Comment;\n  deleteComment: (\n    commentOrThread: Comment | Thread,\n    // eslint-disable-next-line no-shadow\n    thread?: Thread\n  ) => void;\n  thread?: Thread;\n  rtf: null; //FIXME: Intl.RelativeTimeFormat gives build error;\n  t: TFunction;\n}): JSX.Element {\n  const seconds = Math.round((comment.timeStamp - performance.now()) / 1000);\n  const minutes = Math.round(seconds / 60);\n  const [modal, showModal] = useModal();\n\n  return (\n    <li className=\"CommentPlugin_CommentsPanel_List_Comment\">\n      <div className=\"CommentPlugin_CommentsPanel_List_Details\">\n        <span className=\"CommentPlugin_CommentsPanel_List_Comment_Author\">\n          {comment.author}\n        </span>\n        <span className=\"CommentPlugin_CommentsPanel_List_Comment_Time\">\n          {/*  {seconds > -10 ? 'Just now' : rtf.format(minutes, 'minute')} */}\n        </span>\n      </div>\n      <p\n        className={\n          comment.deleted ? 'CommentPlugin_CommentsPanel_DeletedComment' : ''\n        }\n      >\n        {comment.content}\n      </p>\n      {!comment.deleted && (\n        <>\n          <Button\n            onClick={() => {\n              showModal(\n                t('toolbar:commentPlugin.Delete_Comment'),\n                (onClose) => (\n                  <ShowDeleteCommentOrThreadDialog\n                    commentOrThread={comment}\n                    deleteCommentOrThread={deleteComment}\n                    thread={thread}\n                    onClose={onClose}\n                    t={t}\n                  />\n                )\n              );\n            }}\n            className=\"CommentPlugin_CommentsPanel_List_DeleteButton\"\n          >\n            <i className=\"delete\" />\n          </Button>\n          {modal}\n        </>\n      )}\n    </li>\n  );\n}\n\nfunction CommentsPanelList({\n  activeIDs,\n  comments,\n  deleteCommentOrThread,\n  listRef,\n  markNodeMap,\n  submitAddComment,\n  t,\n}: {\n  activeIDs: Array<string>;\n  comments: Comments;\n  deleteCommentOrThread: (\n    commentOrThread: Comment | Thread,\n    thread?: Thread\n  ) => void;\n  listRef: { current: null | HTMLUListElement };\n  markNodeMap: Map<string, Set<NodeKey>>;\n  submitAddComment: (\n    commentOrThread: Comment | Thread,\n    isInlineComment: boolean,\n    thread?: Thread\n  ) => void;\n  t: TFunction;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const [counter, setCounter] = useState(0);\n  const [modal, showModal] = useModal();\n  // const rtf = useMemo(\n  //   () =>\n  //     new Intl.RelativeTimeFormat('en', {\n  //       localeMatcher: 'best fit',\n  //       numeric: 'auto',\n  //       style: 'short',\n  //     }),\n  //   []\n  // ); //FIXME: it is closed to fix a build error\n  const rtf = null;\n\n  useEffect(() => {\n    // Used to keep the time stamp up to date\n    const id = setTimeout(() => {\n      setCounter(counter + 1);\n    }, 10000);\n\n    return () => {\n      clearTimeout(id);\n    };\n  }, [counter]);\n\n  return (\n    <ul className=\"CommentPlugin_CommentsPanel_List\" ref={listRef}>\n      {comments.map((commentOrThread) => {\n        const id = commentOrThread.id;\n        if (commentOrThread.type === 'thread') {\n          const handleClickThread = () => {\n            const markNodeKeys = markNodeMap.get(id);\n            if (\n              markNodeKeys !== undefined &&\n              (activeIDs === null || activeIDs.indexOf(id) === -1)\n            ) {\n              const activeElement = document.activeElement;\n              // Move selection to the start of the mark, so that we\n              // update the UI with the selected thread.\n              editor.update(\n                () => {\n                  const markNodeKey = Array.from(markNodeKeys)[0];\n                  const markNode = $getNodeByKey<MarkNode>(markNodeKey);\n                  if ($isMarkNode(markNode)) {\n                    markNode.selectStart();\n                  }\n                },\n                {\n                  onUpdate() {\n                    // Restore selection to the previous element\n                    if (activeElement !== null) {\n                      (activeElement as HTMLElement).focus();\n                    }\n                  },\n                }\n              );\n            }\n          };\n\n          return (\n            // eslint-disable-next-line jsx-a11y/no-noninteractive-element-interactions\n            <li\n              key={id}\n              onClick={handleClickThread}\n              className={`CommentPlugin_CommentsPanel_List_Thread ${\n                markNodeMap.has(id) ? 'interactive' : ''\n              } ${activeIDs.indexOf(id) === -1 ? '' : 'active'}`}\n            >\n              <div className=\"CommentPlugin_CommentsPanel_List_Thread_QuoteBox\">\n                <blockquote className=\"CommentPlugin_CommentsPanel_List_Thread_Quote\">\n                  {'> '}\n                  <span>{commentOrThread.quote}</span>\n                </blockquote>\n                {/* INTRODUCE DELETE THREAD HERE*/}\n                <Button\n                  onClick={() => {\n                    showModal(\n                      t('toolbar:commentPlugin.Delete_Thread'),\n                      (onClose) => (\n                        <ShowDeleteCommentOrThreadDialog\n                          commentOrThread={commentOrThread}\n                          deleteCommentOrThread={deleteCommentOrThread}\n                          onClose={onClose}\n                          t={t}\n                        />\n                      )\n                    );\n                  }}\n                  className=\"CommentPlugin_CommentsPanel_List_DeleteButton\"\n                >\n                  <i className=\"delete\" />\n                </Button>\n                {modal}\n              </div>\n              <ul className=\"CommentPlugin_CommentsPanel_List_Thread_Comments\">\n                {commentOrThread.comments.map((comment) => (\n                  <CommentsPanelListComment\n                    key={comment.id}\n                    comment={comment}\n                    deleteComment={deleteCommentOrThread}\n                    thread={commentOrThread}\n                    rtf={rtf}\n                    t={t}\n                  />\n                ))}\n              </ul>\n              <div className=\"CommentPlugin_CommentsPanel_List_Thread_Editor\">\n                <CommentsComposer\n                  submitAddComment={submitAddComment}\n                  thread={commentOrThread}\n                  placeholder={t('toolbar:commentPlugin.Reply_to_comment')}\n                />\n              </div>\n            </li>\n          );\n        }\n        return (\n          <CommentsPanelListComment\n            key={id}\n            comment={commentOrThread}\n            deleteComment={deleteCommentOrThread}\n            rtf={rtf}\n            t={t}\n          />\n        );\n      })}\n    </ul>\n  );\n}\n\nfunction CommentsPanel({\n  activeIDs,\n  deleteCommentOrThread,\n  comments,\n  markNodeMap,\n  submitAddComment,\n  t,\n}: {\n  activeIDs: Array<string>;\n  comments: Comments;\n  deleteCommentOrThread: (\n    commentOrThread: Comment | Thread,\n    thread?: Thread\n  ) => void;\n  markNodeMap: Map<string, Set<NodeKey>>;\n  submitAddComment: (\n    commentOrThread: Comment | Thread,\n    isInlineComment: boolean,\n    thread?: Thread\n  ) => void;\n  t: TFunction;\n}): JSX.Element {\n  const listRef = useRef<HTMLUListElement>(null);\n  const isEmpty = comments.length === 0;\n\n  return (\n    <div className=\"CommentPlugin_CommentsPanel\">\n      <h2 className=\"CommentPlugin_CommentsPanel_Heading\">\n        {t('toolbar:commentPlugin.Comments')}\n      </h2>\n      {isEmpty ? (\n        <div className=\"CommentPlugin_CommentsPanel_Empty\">\n          {t('toolbar:commentPlugin.No_Comments')}\n        </div>\n      ) : (\n        <CommentsPanelList\n          activeIDs={activeIDs}\n          comments={comments}\n          deleteCommentOrThread={deleteCommentOrThread}\n          listRef={listRef}\n          submitAddComment={submitAddComment}\n          markNodeMap={markNodeMap}\n          t={t}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction useCollabAuthorName(): string {\n  const collabContext = useCollaborationContext();\n  const { yjsDocMap, name } = collabContext;\n  return yjsDocMap.has('comments') ? name : 'Playground User';\n}\n\nexport default function CommentPlugin({\n  providerFactory,\n}: {\n  providerFactory?: (\n    id: string,\n    yjsDocMap: Map<string, Doc>\n  ) => WebsocketProvider;\n}): JSX.Element {\n  const collabContext = useCollaborationContext();\n  const [editor] = useLexicalComposerContext();\n  const commentStore = useMemo(() => new CommentStore(editor), [editor]);\n  const comments = useCommentStore(commentStore);\n  const markNodeMap = useMemo<Map<string, Set<NodeKey>>>(() => {\n    return new Map();\n  }, []);\n  const [activeAnchorKey, setActiveAnchorKey] = useState<NodeKey | null>();\n  const [activeIDs, setActiveIDs] = useState<Array<string>>([]);\n  const [showCommentInput, setShowCommentInput] = useState(false);\n  const [showComments, setShowComments] = useState(false);\n  const { yjsDocMap } = collabContext;\n  const { t } = useTranslation(['toolbar']);\n\n  useEffect(() => {\n    if (providerFactory) {\n      const provider = providerFactory('comments', yjsDocMap);\n      return commentStore.registerCollaboration(provider);\n    }\n  }, [commentStore, providerFactory, yjsDocMap]);\n\n  const cancelAddComment = useCallback(() => {\n    editor.update(() => {\n      const selection = $getSelection();\n      // Restore selection\n      if (selection !== null) {\n        selection.dirty = true;\n      }\n    });\n    setShowCommentInput(false);\n  }, [editor]);\n\n  const deleteCommentOrThread = useCallback(\n    (comment: Comment | Thread, thread?: Thread) => {\n      if (comment.type === 'comment') {\n        const deletionInfo = commentStore.deleteCommentOrThread(\n          comment,\n          thread\n        );\n        if (!deletionInfo) return;\n        const { markedComment, index } = deletionInfo;\n        commentStore.addComment(markedComment, thread, index);\n      } else {\n        commentStore.deleteCommentOrThread(comment);\n        // Remove ids from associated marks\n        const id = thread !== undefined ? thread.id : comment.id;\n        const markNodeKeys = markNodeMap.get(id);\n        if (markNodeKeys !== undefined) {\n          // Do async to avoid causing a React infinite loop\n          setTimeout(() => {\n            editor.update(() => {\n              for (const key of markNodeKeys) {\n                const node: null | MarkNode = $getNodeByKey(key);\n                if ($isMarkNode(node)) {\n                  node.deleteID(id);\n                  if (node.getIDs().length === 0) {\n                    $unwrapMarkNode(node);\n                  }\n                }\n              }\n            });\n          });\n        }\n      }\n    },\n    [commentStore, editor, markNodeMap]\n  );\n\n  const submitAddComment = useCallback(\n    (\n      commentOrThread: Comment | Thread,\n      isInlineComment: boolean,\n      thread?: Thread\n    ) => {\n      commentStore.addComment(commentOrThread, thread);\n      if (isInlineComment) {\n        editor.update(() => {\n          const selection = $getSelection();\n          if ($isRangeSelection(selection)) {\n            const focus = selection.focus;\n            const anchor = selection.anchor;\n            const isBackward = selection.isBackward();\n            const id = commentOrThread.id;\n\n            // Wrap content in a MarkNode\n            $wrapSelectionInMarkNode(selection, isBackward, id);\n\n            // Make selection collapsed at the end\n            if (isBackward) {\n              focus.set(anchor.key, anchor.offset, anchor.type);\n            } else {\n              anchor.set(focus.key, focus.offset, focus.type);\n            }\n          }\n        });\n        setShowCommentInput(false);\n      }\n    },\n    [commentStore, editor]\n  );\n\n  useEffect(() => {\n    const changedElems: Array<HTMLElement> = [];\n    for (let i = 0; i < activeIDs.length; i++) {\n      const id = activeIDs[i];\n      const keys = markNodeMap.get(id);\n      if (keys !== undefined) {\n        for (const key of keys) {\n          const elem = editor.getElementByKey(key);\n          if (elem !== null) {\n            elem.classList.add('selected');\n            changedElems.push(elem);\n            setShowComments(true);\n          }\n        }\n      }\n    }\n    return () => {\n      for (let i = 0; i < changedElems.length; i++) {\n        const changedElem = changedElems[i];\n        changedElem.classList.remove('selected');\n      }\n    };\n  }, [activeIDs, editor, markNodeMap]);\n\n  useEffect(() => {\n    const markNodeKeysToIDs: Map<NodeKey, Array<string>> = new Map();\n\n    return mergeRegister(\n      registerNestedElementResolver<MarkNode>(\n        editor,\n        MarkNode,\n        (from: MarkNode) => {\n          return $createMarkNode(from.getIDs());\n        },\n        (from: MarkNode, to: MarkNode) => {\n          // Merge the IDs\n          const ids = from.getIDs();\n          ids.forEach((id) => {\n            to.addID(id);\n          });\n        }\n      ),\n      editor.registerMutationListener(MarkNode, (mutations) => {\n        editor.getEditorState().read(() => {\n          for (const [key, mutation] of mutations) {\n            const node: null | MarkNode = $getNodeByKey(key);\n            let ids: NodeKey[] = [];\n\n            if (mutation === 'destroyed') {\n              ids = markNodeKeysToIDs.get(key) || [];\n            } else if ($isMarkNode(node)) {\n              ids = node.getIDs();\n            }\n\n            for (let i = 0; i < ids.length; i++) {\n              const id = ids[i];\n              let markNodeKeys = markNodeMap.get(id);\n              markNodeKeysToIDs.set(key, ids);\n\n              if (mutation === 'destroyed') {\n                if (markNodeKeys !== undefined) {\n                  markNodeKeys.delete(key);\n                  if (markNodeKeys.size === 0) {\n                    markNodeMap.delete(id);\n                  }\n                }\n              } else {\n                if (markNodeKeys === undefined) {\n                  markNodeKeys = new Set();\n                  markNodeMap.set(id, markNodeKeys);\n                }\n                if (!markNodeKeys.has(key)) {\n                  markNodeKeys.add(key);\n                }\n              }\n            }\n          }\n        });\n      }),\n      editor.registerUpdateListener(({ editorState, tags }) => {\n        editorState.read(() => {\n          const selection = $getSelection();\n          let hasActiveIds = false;\n          let hasAnchorKey = false;\n\n          if ($isRangeSelection(selection)) {\n            const anchorNode = selection.anchor.getNode();\n\n            if ($isTextNode(anchorNode)) {\n              const commentIDs = $getMarkIDs(\n                anchorNode,\n                selection.anchor.offset\n              );\n              if (commentIDs !== null) {\n                setActiveIDs(commentIDs);\n                hasActiveIds = true;\n              }\n              if (!selection.isCollapsed()) {\n                setActiveAnchorKey(anchorNode.getKey());\n                hasAnchorKey = true;\n              }\n            }\n          }\n          if (!hasActiveIds) {\n            setActiveIDs((_activeIds) =>\n              _activeIds.length === 0 ? _activeIds : []\n            );\n          }\n          if (!hasAnchorKey) {\n            setActiveAnchorKey(null);\n          }\n        });\n        if (!tags.has('collaboration')) {\n          setShowCommentInput(false);\n        }\n      }),\n      editor.registerCommand(\n        INSERT_INLINE_COMMAND,\n        () => {\n          const domSelection = window.getSelection();\n          if (domSelection !== null) {\n            domSelection.removeAllRanges();\n          }\n          setShowCommentInput(true);\n          return true;\n        },\n        COMMAND_PRIORITY_EDITOR\n      )\n    );\n  }, [editor, markNodeMap]);\n\n  const onAddComment = () => {\n    editor.dispatchCommand(INSERT_INLINE_COMMAND, undefined);\n  };\n\n  return (\n    <>\n      {showCommentInput &&\n        createPortal(\n          <CommentInputBox\n            editor={editor}\n            cancelAddComment={cancelAddComment}\n            submitAddComment={submitAddComment}\n            t={t}\n          />,\n          document.body\n        )}\n      {activeAnchorKey !== null &&\n        activeAnchorKey !== undefined &&\n        !showCommentInput &&\n        createPortal(\n          <AddCommentBox\n            anchorKey={activeAnchorKey}\n            editor={editor}\n            onAddComment={onAddComment}\n          />,\n          document.body\n        )}\n      {createPortal(\n        <Button\n          className={`CommentPlugin_ShowCommentsButton ${\n            showComments ? 'active' : ''\n          }`}\n          onClick={() => setShowComments(!showComments)}\n          title={\n            showComments\n              ? t('toolbar:commentPlugin.Hide_Comments')\n              : t('toolbar:commentPlugin.Show_Comments')\n          }\n        >\n          <i className=\"comments\" />\n        </Button>,\n        document.body\n      )}\n      {showComments &&\n        createPortal(\n          <CommentsPanel\n            comments={comments}\n            submitAddComment={submitAddComment}\n            deleteCommentOrThread={deleteCommentOrThread}\n            activeIDs={activeIDs}\n            markNodeMap={markNodeMap}\n            t={t}\n          />,\n          document.body\n        )}\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { $isCodeHighlightNode } from '@lexical/code';\nimport { $isLinkNode, TOGGLE_LINK_COMMAND } from '@lexical/link';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $isAtNodeEnd } from '@lexical/selection';\nimport { mergeRegister } from '@lexical/utils';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $isTextNode,\n  COMMAND_PRIORITY_LOW,\n  ElementNode,\n  FORMAT_TEXT_COMMAND,\n  LexicalEditor,\n  RangeSelection,\n  SELECTION_CHANGE_COMMAND,\n  TextNode,\n} from 'lexical';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\n\nimport { INSERT_INLINE_COMMAND } from './CommentPlugin';\nimport { useTranslation } from 'react-i18next';\nimport { TFunction } from 'i18next';\n\nfunction setPopupPosition(\n  editor: HTMLElement,\n  rect: ClientRect,\n  rootElementRect: ClientRect\n): void {\n  let top = rect.top - 8 + window.pageYOffset;\n  let left =\n    rect.left + 340 + window.pageXOffset - editor.offsetWidth + rect.width;\n  if (\n    rect.width >= rootElementRect.width - 20 ||\n    left > rootElementRect.width - 150\n  ) {\n    left = rect.left;\n    top = rect.top - 50 + window.pageYOffset;\n  }\n  if (top < rootElementRect.top) {\n    top = rect.bottom + 20;\n  }\n  editor.style.opacity = '1';\n  editor.style.top = `${top}px`;\n  editor.style.left = `${left}px`;\n}\n\nfunction FloatingCharacterStylesEditor({\n  editor,\n  isLink,\n  isBold,\n  isItalic,\n  isUnderline,\n  isCode,\n  isStrikethrough,\n  isSubscript,\n  isSuperscript,\n  t,\n}: {\n  editor: LexicalEditor;\n  isBold: boolean;\n  isCode: boolean;\n  isItalic: boolean;\n  isLink: boolean;\n  isStrikethrough: boolean;\n  isSubscript: boolean;\n  isSuperscript: boolean;\n  isUnderline: boolean;\n  t: TFunction;\n}): JSX.Element {\n  const popupCharStylesEditorRef = useRef<HTMLDivElement | null>(null);\n  const mouseDownRef = useRef(false);\n\n  const insertLink = useCallback(() => {\n    if (!isLink) {\n      editor.dispatchCommand(TOGGLE_LINK_COMMAND, 'https://');\n    } else {\n      editor.dispatchCommand(TOGGLE_LINK_COMMAND, null);\n    }\n  }, [editor, isLink]);\n\n  const insertComment = () => {\n    editor.dispatchCommand(INSERT_INLINE_COMMAND, null);\n  };\n\n  const updateCharacterStylesEditor = useCallback(() => {\n    const selection = $getSelection();\n\n    const popupCharStylesEditorElem = popupCharStylesEditorRef.current;\n    const nativeSelection = window.getSelection();\n\n    if (popupCharStylesEditorElem === null) {\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n    if (\n      selection !== null &&\n      nativeSelection !== null &&\n      !nativeSelection.isCollapsed &&\n      rootElement !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const domRange = nativeSelection.getRangeAt(0);\n      const rootElementRect = rootElement.getBoundingClientRect();\n      let rect;\n\n      if (nativeSelection.anchorNode === rootElement) {\n        let inner = rootElement;\n        while (inner.firstElementChild != null) {\n          inner = inner.firstElementChild as HTMLElement;\n        }\n        rect = inner.getBoundingClientRect();\n      } else {\n        rect = domRange.getBoundingClientRect();\n      }\n\n      if (!mouseDownRef.current) {\n        setPopupPosition(popupCharStylesEditorElem, rect, rootElementRect);\n      }\n    }\n  }, [editor]);\n\n  useEffect(() => {\n    const onResize = () => {\n      editor.getEditorState().read(() => {\n        updateCharacterStylesEditor();\n      });\n    };\n    window.addEventListener('resize', onResize);\n\n    return () => {\n      window.removeEventListener('resize', onResize);\n    };\n  }, [editor, updateCharacterStylesEditor]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      updateCharacterStylesEditor();\n    });\n    return mergeRegister(\n      editor.registerUpdateListener(({ editorState }) => {\n        editorState.read(() => {\n          updateCharacterStylesEditor();\n        });\n      }),\n\n      editor.registerCommand(\n        SELECTION_CHANGE_COMMAND,\n        () => {\n          updateCharacterStylesEditor();\n          return false;\n        },\n        COMMAND_PRIORITY_LOW\n      )\n    );\n  }, [editor, updateCharacterStylesEditor]);\n\n  return (\n    <div ref={popupCharStylesEditorRef} className=\"character-style-popup\">\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'bold');\n        }}\n        className={'popup-item spaced ' + (isBold ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Format_text_as_bold')}\n        type=\"button\"\n      >\n        <i className=\"format bold\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'italic');\n        }}\n        className={'popup-item spaced ' + (isItalic ? 'active' : '')}\n        aria-label={t(\n          'toolbar:characterStylesPopupPlugin.Format_text_as_italics'\n        )}\n        type=\"button\"\n      >\n        <i className=\"format italic\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'underline');\n        }}\n        className={'popup-item spaced ' + (isUnderline ? 'active' : '')}\n        aria-label={t(\n          'toolbar:characterStylesPopupPlugin.Format_text_to_underlined'\n        )}\n        type=\"button\"\n      >\n        <i className=\"format underline\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'strikethrough');\n        }}\n        className={'popup-item spaced ' + (isStrikethrough ? 'active' : '')}\n        aria-label={t(\n          'toolbar:characterStylesPopupPlugin.Format_text_with_a_strikethrough'\n        )}\n        type=\"button\"\n      >\n        <i className=\"format strikethrough\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'subscript');\n        }}\n        className={'popup-item spaced ' + (isSubscript ? 'active' : '')}\n        title=\"Subscript\"\n        aria-label={t('toolbar:characterStylesPopupPlugin.Format_Subscript')}\n        type=\"button\"\n      >\n        <i className=\"format subscript\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'superscript');\n        }}\n        className={'popup-item spaced ' + (isSuperscript ? 'active' : '')}\n        title=\"Superscript\"\n        aria-label={t('toolbar:characterStylesPopupPlugin.Format_Superscript')}\n        type=\"button\"\n      >\n        <i className=\"format superscript\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'code');\n        }}\n        className={'popup-item spaced ' + (isCode ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Insert_code_block')}\n        type=\"button\"\n      >\n        <i className=\"format code\" />\n      </button>\n      <button\n        onClick={insertLink}\n        className={'popup-item spaced ' + (isLink ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Insert_link')}\n        type=\"button\"\n      >\n        <i className=\"format link\" />\n      </button>\n      <button\n        onClick={insertComment}\n        className={'popup-item spaced ' + (isLink ? 'active' : '')}\n        aria-label={t('toolbar:characterStylesPopupPlugin.Add_comment')}\n        type=\"button\"\n      >\n        <i className=\"format add-comment\" />\n      </button>\n    </div>\n  );\n}\n\nfunction getSelectedNode(selection: RangeSelection): TextNode | ElementNode {\n  const anchor = selection.anchor;\n  const focus = selection.focus;\n  const anchorNode = selection.anchor.getNode();\n  const focusNode = selection.focus.getNode();\n  if (anchorNode === focusNode) {\n    return anchorNode;\n  }\n  const isBackward = selection.isBackward();\n  if (isBackward) {\n    return $isAtNodeEnd(focus) ? anchorNode : focusNode;\n  } else {\n    return $isAtNodeEnd(anchor) ? focusNode : anchorNode;\n  }\n}\n\nfunction useCharacterStylesPopup(editor: LexicalEditor): JSX.Element | null {\n  const [isText, setIsText] = useState(false);\n  const [isLink, setIsLink] = useState(false);\n  const [isBold, setIsBold] = useState(false);\n  const [isItalic, setIsItalic] = useState(false);\n  const [isUnderline, setIsUnderline] = useState(false);\n  const [isStrikethrough, setIsStrikethrough] = useState(false);\n  const [isSubscript, setIsSubscript] = useState(false);\n  const [isSuperscript, setIsSuperscript] = useState(false);\n  const [isCode, setIsCode] = useState(false);\n  const { t } = useTranslation(['toolbar']);\n\n  const updatePopup = useCallback(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n      const nativeSelection = window.getSelection();\n      const rootElement = editor.getRootElement();\n\n      if (\n        nativeSelection !== null &&\n        (!$isRangeSelection(selection) ||\n          rootElement === null ||\n          !rootElement.contains(nativeSelection.anchorNode))\n      ) {\n        setIsText(false);\n        return;\n      }\n\n      if (!$isRangeSelection(selection)) {\n        return;\n      }\n\n      const node = getSelectedNode(selection);\n\n      // Update text format\n      setIsBold(selection.hasFormat('bold'));\n      setIsItalic(selection.hasFormat('italic'));\n      setIsUnderline(selection.hasFormat('underline'));\n      setIsStrikethrough(selection.hasFormat('strikethrough'));\n      setIsSubscript(selection.hasFormat('subscript'));\n      setIsSuperscript(selection.hasFormat('superscript'));\n      setIsCode(selection.hasFormat('code'));\n\n      // Update links\n      const parent = node.getParent();\n      if ($isLinkNode(parent) || $isLinkNode(node)) {\n        setIsLink(true);\n      } else {\n        setIsLink(false);\n      }\n\n      if (\n        !$isCodeHighlightNode(selection.anchor.getNode()) &&\n        selection.getTextContent() !== ''\n      ) {\n        setIsText($isTextNode(node));\n      } else {\n        setIsText(false);\n      }\n    });\n  }, [editor]);\n\n  useEffect(() => {\n    document.addEventListener('selectionchange', updatePopup);\n    return () => {\n      document.removeEventListener('selectionchange', updatePopup);\n    };\n  }, [updatePopup]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      updatePopup();\n    });\n  }, [editor, updatePopup]);\n\n  if (!isText || isLink) {\n    return null;\n  }\n\n  return createPortal(\n    <FloatingCharacterStylesEditor\n      editor={editor}\n      isLink={isLink}\n      isBold={isBold}\n      isItalic={isItalic}\n      isStrikethrough={isStrikethrough}\n      isSubscript={isSubscript}\n      isSuperscript={isSuperscript}\n      isUnderline={isUnderline}\n      isCode={isCode}\n      t={t}\n    />,\n    document.body\n  );\n}\n\nexport default function CharacterStylesPopupPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n  return useCharacterStylesPopup(editor);\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LinkNode } from '@lexical/link';\nimport type { LexicalEditor } from 'lexical';\n\nimport { $isLinkNode } from '@lexical/link';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $getNearestNodeFromDOMNode } from 'lexical';\nimport { useEffect, useRef } from 'react';\n\ntype LinkFilter = (event: MouseEvent, linkNode: LinkNode) => boolean;\nexport default function ClickableLinkPlugin({\n  filter,\n  newTab = true,\n}: {\n  filter?: LinkFilter;\n  newTab?: boolean;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const hasMoved = useRef(false);\n  useEffect(() => {\n    let prevOffsetX;\n    let prevOffsetY;\n\n    function onPointerDown(event: PointerEvent) {\n      prevOffsetX = event.offsetX;\n      prevOffsetY = event.offsetY;\n    }\n\n    function onPointerUp(event: PointerEvent) {\n      hasMoved.current =\n        event.offsetX !== prevOffsetX || event.offsetY !== prevOffsetY;\n    }\n\n    function onClick(e: Event) {\n      // Based on pointerdown/up we can check if cursor moved during click event,\n      // and ignore clicks with moves (to allow link text selection)\n      const hasMovedDuringClick = hasMoved.current;\n      hasMoved.current = false;\n      // $FlowExpectedError[incompatible-cast] onClick handler will get MouseEvent, safe to cast\n      const event = e as MouseEvent;\n      const linkDomNode = getLinkDomNode(event, editor);\n\n      if (linkDomNode === null) {\n        return;\n      }\n\n      const href = linkDomNode.getAttribute('href');\n\n      if (\n        linkDomNode.getAttribute('contenteditable') === 'false' ||\n        href === undefined\n      ) {\n        return;\n      }\n\n      let linkNode = null;\n      editor.update(() => {\n        const maybeLinkNode = $getNearestNodeFromDOMNode(linkDomNode);\n\n        if ($isLinkNode(maybeLinkNode)) {\n          linkNode = maybeLinkNode;\n        }\n      });\n\n      if (\n        linkNode === null ||\n        (filter !== undefined && !filter(event, linkNode))\n      ) {\n        return;\n      }\n\n      if (hasMovedDuringClick) {\n        return;\n      }\n\n      try {\n        window.open(\n          href,\n          newTab || event.metaKey || event.ctrlKey ? '_blank' : '_self'\n        );\n      } catch {\n        // It didn't work, which is better than throwing an exception!\n      }\n    }\n\n    return editor.registerRootListener(\n      (\n        rootElement: null | HTMLElement,\n        prevRootElement: null | HTMLElement\n      ) => {\n        if (prevRootElement !== null) {\n          prevRootElement.removeEventListener('pointerdown', onPointerDown);\n          prevRootElement.removeEventListener('pointerup', onPointerUp);\n          prevRootElement.removeEventListener('click', onClick);\n        }\n\n        if (rootElement !== null) {\n          rootElement.addEventListener('click', onClick);\n          rootElement.addEventListener('pointerdown', onPointerDown);\n          rootElement.addEventListener('pointerup', onPointerUp);\n        }\n      }\n    );\n  }, [editor, filter, newTab]);\n  return null;\n}\n\nfunction isLinkDomNode(domNode: Node): boolean {\n  return domNode.nodeName.toLowerCase() === 'a';\n}\n\nfunction getLinkDomNode(\n  event: MouseEvent,\n  editor: LexicalEditor\n): HTMLAnchorElement | null {\n  return editor.getEditorState().read(() => {\n    // $FlowExpectedError[incompatible-cast]\n    const domNode = event.target as Node;\n\n    if (isLinkDomNode(domNode)) {\n      // $FlowExpectedError[incompatible-cast]\n      return domNode as HTMLAnchorElement;\n    }\n\n    if (domNode.parentNode && isLinkDomNode(domNode.parentNode)) {\n      // $FlowExpectedError[incompatible-cast]\n      return domNode.parentNode as HTMLAnchorElement;\n    }\n\n    return null;\n  });\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { registerCodeHighlighting } from '@lexical/code';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { useEffect } from 'react';\n\nexport default function CodeHighlightPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return registerCodeHighlighting(editor);\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalEditor } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { TextNode } from 'lexical';\nimport { useEffect } from 'react';\n\nimport { $createEmojiNode, EmojiNode } from '../nodes/EmojiNode';\n\nconst emojis: Map<string, [string, string]> = new Map([\n  [':)', ['emoji happysmile', '']],\n  [':D', ['emoji veryhappysmile', '']],\n  [':(', ['emoji unhappysmile', '']],\n  ['<3', ['emoji heart', '']],\n  ['', ['emoji happysmile', '']],\n  ['', ['emoji veryhappysmile', '']],\n  ['', ['emoji unhappysmile', '']],\n  ['', ['emoji heart', '']],\n]);\n\nfunction findAndTransformEmoji(node: TextNode): null | TextNode {\n  const text = node.getTextContent();\n\n  for (let i = 0; i < text.length; i++) {\n    const emojiData = emojis.get(text[i]) || emojis.get(text.slice(i, i + 2));\n\n    if (emojiData !== undefined) {\n      const [emojiStyle, emojiText] = emojiData;\n      let targetNode;\n\n      if (i === 0) {\n        [targetNode] = node.splitText(i + 2);\n      } else {\n        [, targetNode] = node.splitText(i, i + 2);\n      }\n\n      const emojiNode = $createEmojiNode(emojiStyle, emojiText);\n      targetNode.replace(emojiNode);\n      return emojiNode;\n    }\n  }\n\n  return null;\n}\n\nfunction textNodeTransform(node: TextNode): void {\n  let targetNode = node;\n\n  while (targetNode !== null) {\n    if (!targetNode.isSimpleText()) {\n      return;\n    }\n\n    targetNode = findAndTransformEmoji(targetNode);\n  }\n}\n\nfunction useEmojis(editor: LexicalEditor): void {\n  useEffect(() => {\n    if (!editor.hasNodes([EmojiNode])) {\n      throw new Error('EmojisPlugin: EmojiNode not registered on editor');\n    }\n\n    return editor.registerNodeTransform(TextNode, textNodeTransform);\n  }, [editor]);\n}\n\nexport default function EmojisPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  useEmojis(editor);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { TextNode } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { useLexicalTextEntity } from '@lexical/react/useLexicalTextEntity';\nimport { useCallback, useEffect } from 'react';\n\nimport { $createKeywordNode, KeywordNode } from '../nodes/KeywordNode';\n\nconst KEYWORDS_REGEX =\n  /(^|$|[^A-Za-z-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------])(congrats|congratulations|gratuluju|gratuluji|gratulujeme|blahopeju|blahopeji|blahopejeme|Til lykke|Tillykke|Glckwunsch|Gratuliere|felicitaciones|enhorabuena|paljon onnea|onnittelut|Flicitations|gratula|gratullok|gratullunk|congratulazioni|complimenti|||||gratulerer|Gefeliciteerd|gratulacje|Parabns|parabns|felicitaes|felicitri| |||gratulujem|blahoelm|||tebrikler|tebrik ederim||||||baie geluk|veels geluk||estitam|estitke|estitamo||||badhai|||| |hongera|||||Chc mng| |mazel tov|mazal tov)(^|$|[^A-Za-z-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------])/i;\n\nexport default function KeywordsPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([KeywordNode])) {\n      throw new Error('KeywordsPlugin: KeywordNode not registered on editor');\n    }\n  }, [editor]);\n\n  const createKeywordNode = useCallback((textNode: TextNode): KeywordNode => {\n    return $createKeywordNode(textNode.getTextContent());\n  }, []);\n\n  const getKeywordMatch = useCallback((text: string) => {\n    const matchArr = KEYWORDS_REGEX.exec(text);\n\n    if (matchArr === null) {\n      return null;\n    }\n\n    const hashtagLength = matchArr[2].length;\n    const startOffset = matchArr.index + matchArr[1].length;\n    const endOffset = startOffset + hashtagLength;\n    return {\n      end: endOffset,\n      start: startOffset,\n    };\n  }, []);\n\n  useLexicalTextEntity<KeywordNode>(\n    getKeywordMatch,\n    KeywordNode,\n    createKeywordNode\n  );\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { RangeSelection } from 'lexical';\n\nimport { $getListDepth, $isListItemNode, $isListNode } from '@lexical/list';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isElementNode,\n  $isRangeSelection,\n  COMMAND_PRIORITY_CRITICAL,\n  ElementNode,\n  INDENT_CONTENT_COMMAND,\n} from 'lexical';\nimport { useEffect } from 'react';\n\ntype Props = Readonly<{\n  maxDepth: number | null | undefined;\n}>;\n\nfunction getElementNodesInSelection(\n  selection: RangeSelection\n): Set<ElementNode> {\n  const nodesInSelection = selection.getNodes();\n\n  if (nodesInSelection.length === 0) {\n    return new Set([\n      selection.anchor.getNode().getParentOrThrow(),\n      selection.focus.getNode().getParentOrThrow(),\n    ]);\n  }\n\n  return new Set(\n    nodesInSelection.map((n) => ($isElementNode(n) ? n : n.getParentOrThrow()))\n  );\n}\n\nfunction isIndentPermitted(maxDepth: number): boolean {\n  const selection = $getSelection();\n\n  if (!$isRangeSelection(selection)) {\n    return false;\n  }\n\n  const elementNodesInSelection: Set<ElementNode> =\n    getElementNodesInSelection(selection);\n\n  let totalDepth = 0;\n\n  for (const elementNode of elementNodesInSelection) {\n    if ($isListNode(elementNode)) {\n      totalDepth = Math.max($getListDepth(elementNode) + 1, totalDepth);\n    } else if ($isListItemNode(elementNode)) {\n      const parent = elementNode.getParent();\n\n      if (!$isListNode(parent)) {\n        throw new Error(\n          'ListMaxIndentLevelPlugin: A ListItemNode must have a ListNode for a parent.'\n        );\n      }\n\n      totalDepth = Math.max($getListDepth(parent) + 1, totalDepth);\n    }\n  }\n\n  return totalDepth <= maxDepth;\n}\n\nexport default function ListMaxIndentLevelPlugin({ maxDepth }: Props): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      INDENT_CONTENT_COMMAND,\n      () => !isIndentPermitted(maxDepth ?? 7),\n      COMMAND_PRIORITY_CRITICAL\n    );\n  }, [editor, maxDepth]);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n *\n */\n\nimport { MarkdownShortcutPlugin } from '@lexical/react/LexicalMarkdownShortcutPlugin';\nimport * as React from 'react';\n\nimport { PLAYGROUND_TRANSFORMERS } from './MarkdownTransformers';\n\nexport default function MarkdownPlugin(): JSX.Element {\n  return <MarkdownShortcutPlugin transformers={PLAYGROUND_TRANSFORMERS} />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $setSelection,\n  FOCUS_COMMAND,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nconst COMMAND_PRIORITY_LOW = 1;\nconst TAB_TO_FOCUS_INTERVAL = 100;\n\nlet lastTabKeyDownTimestamp = 0;\nlet hasRegisteredKeyDownListener = false;\n\nfunction registerKeyTimeStampTracker() {\n  window.addEventListener(\n    'keydown',\n    (event: KeyboardEvent) => {\n      // Tab\n      if (event.keyCode === 9) {\n        lastTabKeyDownTimestamp = event.timeStamp;\n      }\n    },\n    true\n  );\n}\n\nexport default function TabFocusPlugin(): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!hasRegisteredKeyDownListener) {\n      registerKeyTimeStampTracker();\n      hasRegisteredKeyDownListener = true;\n    }\n\n    return editor.registerCommand(\n      FOCUS_COMMAND,\n      (event: FocusEvent) => {\n        const selection = $getSelection();\n        if ($isRangeSelection(selection)) {\n          if (\n            lastTabKeyDownTimestamp + TAB_TO_FOCUS_INTERVAL >\n            event.timeStamp\n          ) {\n            $setSelection(selection.clone());\n          }\n        }\n        return false;\n      },\n      COMMAND_PRIORITY_LOW\n    );\n  }, [editor]);\n\n  return null;\n}\n","import { LexicalEditor } from 'lexical';\nimport React, { createContext } from 'react';\n\ninterface IEditorContext {\n  initialEditor: LexicalEditor;\n  activeEditor: LexicalEditor;\n  setActiveEditor: React.Dispatch<React.SetStateAction<LexicalEditor>>;\n}\n\nconst EditorContext = createContext<IEditorContext | null>(null);\n\nexport default EditorContext;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Input.css';\n\nimport * as React from 'react';\n\ntype Props = Readonly<{\n  'data-test-id'?: string;\n  accept?: string;\n  label: string;\n  onChange: (files: FileList) => void;\n}>;\n\nexport default function FileInput({\n  accept,\n  label,\n  onChange,\n  'data-test-id': dataTestId,\n}: Props): JSX.Element {\n  return (\n    <div className=\"Input__wrapper\">\n      <label className=\"Input__label\">{label}</label>\n      <input\n        type=\"file\"\n        accept={accept}\n        className=\"Input__input\"\n        onChange={(e) => onChange(e.target.files)}\n        data-test-id={dataTestId}\n      />\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './Input.css';\n\nimport * as React from 'react';\n\ntype Props = Readonly<{\n  'data-test-id'?: string;\n  label: string;\n  onChange: (string) => void;\n  placeholder?: string;\n  value: string;\n}>;\n\nexport default function TextInput({\n  label,\n  value,\n  onChange,\n  placeholder = '',\n  'data-test-id': dataTestId,\n}: Props): JSX.Element {\n  return (\n    <div className=\"Input__wrapper\">\n      <label className=\"Input__label\">{label}</label>\n      <input\n        type=\"text\"\n        className=\"Input__input\"\n        placeholder={placeholder}\n        value={value}\n        onChange={(e) => {\n          onChange(e.target.value);\n        }}\n        data-test-id={dataTestId}\n      />\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { $wrapNodeInElement, mergeRegister } from '@lexical/utils';\nimport {\n  $createParagraphNode,\n  $createRangeSelection,\n  $getSelection,\n  $insertNodes,\n  $isNodeSelection,\n  $isRootOrShadowRoot,\n  $setSelection,\n  COMMAND_PRIORITY_EDITOR,\n  COMMAND_PRIORITY_HIGH,\n  COMMAND_PRIORITY_LOW,\n  createCommand,\n  DRAGOVER_COMMAND,\n  DRAGSTART_COMMAND,\n  DROP_COMMAND,\n  LexicalCommand,\n  LexicalEditor,\n} from 'lexical';\nimport { useEffect, useRef, useState } from 'react';\nimport * as React from 'react';\n\nimport {\n  $createImageNode,\n  $isImageNode,\n  ImageNode,\n  ImagePayload,\n} from '../nodes/ImageNode';\nimport Button from '../ui/Button';\nimport { DialogActions, DialogButtonsList } from '../ui/Dialog';\nimport FileInput from '../ui/FileInput';\nimport TextInput from '../ui/TextInput';\n\nexport type InsertImagePayload = Readonly<ImagePayload>;\n\nexport const CAN_USE_DOM: boolean =\n  typeof window !== 'undefined' &&\n  typeof window.document !== 'undefined' &&\n  typeof window.document.createElement !== 'undefined';\n\nconst getDOMSelection = (targetWindow: Window | null): Selection | null =>\n  CAN_USE_DOM ? (targetWindow || window).getSelection() : null;\n\nexport const INSERT_IMAGE_COMMAND: LexicalCommand<InsertImagePayload> =\n  createCommand('INSERT_IMAGE_COMMAND');\n\nexport function InsertImageUriDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  return (\n    <>\n      <TextInput\n        label=\"Image URL\"\n        placeholder=\"i.e. https://source.unsplash.com/random\"\n        onChange={setSrc}\n        value={src}\n        data-test-id=\"image-modal-url-input\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Random unsplash image\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <DialogActions>\n        <Button\n          data-test-id=\"image-modal-confirm-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </DialogActions>\n    </>\n  );\n}\n\nexport function InsertImageUploadedDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  const loadImage = (files: FileList | null) => {\n    const reader = new FileReader();\n    reader.onload = function () {\n      if (typeof reader.result === 'string') {\n        setSrc(reader.result);\n      }\n      return '';\n    };\n    if (files !== null) {\n      reader.readAsDataURL(files[0]);\n    }\n  };\n\n  return (\n    <>\n      <FileInput\n        label=\"Image Upload\"\n        onChange={loadImage}\n        accept=\"image/*\"\n        data-test-id=\"image-modal-file-upload\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Descriptive alternative text\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <DialogActions>\n        <Button\n          data-test-id=\"image-modal-file-upload-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </DialogActions>\n    </>\n  );\n}\n\nexport function InsertImageDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [mode, setMode] = useState<null | 'url' | 'file'>(null);\n  const hasModifier = useRef(false);\n\n  useEffect(() => {\n    hasModifier.current = false;\n    const handler = (e: KeyboardEvent) => {\n      hasModifier.current = e.altKey;\n    };\n    document.addEventListener('keydown', handler);\n    return () => {\n      document.removeEventListener('keydown', handler);\n    };\n  }, [activeEditor]);\n\n  const onClick = (payload: InsertImagePayload) => {\n    activeEditor.dispatchCommand(INSERT_IMAGE_COMMAND, payload);\n    onClose();\n  };\n\n  return (\n    <>\n      {!mode && (\n        <DialogButtonsList>\n          <Button\n            data-test-id=\"image-modal-option-sample\"\n            onClick={() =>\n              onClick(\n                hasModifier.current\n                  ? {\n                      altText:\n                        'Daylight fir trees forest glacier green high ice landscape',\n                      src: '../images/landscape.jpg',\n                    }\n                  : {\n                      altText: 'Yellow flower in tilt shift lens',\n                      src: '../images/yellow-flower.jpg',\n                    }\n              )\n            }\n          >\n            Sample\n          </Button>\n          <Button\n            data-test-id=\"image-modal-option-url\"\n            onClick={() => setMode('url')}\n          >\n            URL\n          </Button>\n          <Button\n            data-test-id=\"image-modal-option-file\"\n            onClick={() => setMode('file')}\n          >\n            File\n          </Button>\n        </DialogButtonsList>\n      )}\n      {mode === 'url' && <InsertImageUriDialogBody onClick={onClick} />}\n      {mode === 'file' && <InsertImageUploadedDialogBody onClick={onClick} />}\n    </>\n  );\n}\n\nexport default function ImagesPlugin({\n  captionsEnabled,\n  maxWidth,\n}: {\n  captionsEnabled?: boolean;\n  maxWidth?: number;\n}): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([ImageNode])) {\n      throw new Error('ImagesPlugin: ImageNode not registered on editor');\n    }\n\n    return mergeRegister(\n      editor.registerCommand<InsertImagePayload>(\n        INSERT_IMAGE_COMMAND,\n        (payload) => {\n          const imageNode = $createImageNode({\n            ...payload,\n            maxWidth: maxWidth,\n          });\n          $insertNodes([imageNode]);\n          if ($isRootOrShadowRoot(imageNode.getParentOrThrow())) {\n            $wrapNodeInElement(imageNode, $createParagraphNode).selectEnd();\n          }\n\n          return true;\n        },\n        COMMAND_PRIORITY_EDITOR\n      ),\n      editor.registerCommand<DragEvent>(\n        DRAGSTART_COMMAND,\n        (event) => {\n          return onDragStart(event);\n        },\n        COMMAND_PRIORITY_HIGH\n      ),\n      editor.registerCommand<DragEvent>(\n        DRAGOVER_COMMAND,\n        (event) => {\n          return onDragover(event);\n        },\n        COMMAND_PRIORITY_LOW\n      ),\n      editor.registerCommand<DragEvent>(\n        DROP_COMMAND,\n        (event) => {\n          return onDrop(event, editor);\n        },\n        COMMAND_PRIORITY_HIGH\n      )\n    );\n  }, [captionsEnabled, editor]);\n\n  return null;\n}\n\nconst TRANSPARENT_IMAGE =\n  'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\nconst img = document.createElement('img');\nimg.src = TRANSPARENT_IMAGE;\n\nfunction onDragStart(event: DragEvent): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  const dataTransfer = event.dataTransfer;\n  if (!dataTransfer) {\n    return false;\n  }\n  dataTransfer.setData('text/plain', '_');\n  dataTransfer.setDragImage(img, 0, 0);\n  dataTransfer.setData(\n    'application/x-lexical-drag',\n    JSON.stringify({\n      data: {\n        altText: node.__altText,\n        caption: node.__caption,\n        height: node.__height,\n        key: node.getKey(),\n        maxWidth: node.__maxWidth,\n        showCaption: node.__showCaption,\n        src: node.__src,\n        width: node.__width,\n      },\n      type: 'image',\n    })\n  );\n\n  return true;\n}\n\nfunction onDragover(event: DragEvent): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  if (!canDropImage(event)) {\n    event.preventDefault();\n  }\n  return true;\n}\n\nfunction onDrop(event: DragEvent, editor: LexicalEditor): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  const data = getDragImageData(event);\n  if (!data) {\n    return false;\n  }\n  event.preventDefault();\n  if (canDropImage(event)) {\n    const range = getDragSelection(event);\n    node.remove();\n    const rangeSelection = $createRangeSelection();\n    if (range !== null && range !== undefined) {\n      rangeSelection.applyDOMRange(range);\n    }\n    $setSelection(rangeSelection);\n    editor.dispatchCommand(INSERT_IMAGE_COMMAND, data);\n  }\n  return true;\n}\n\nfunction getImageNodeInSelection(): ImageNode | null {\n  const selection = $getSelection();\n  if (!$isNodeSelection(selection)) {\n    return null;\n  }\n  const nodes = selection.getNodes();\n  const node = nodes[0];\n  return $isImageNode(node) ? node : null;\n}\n\nfunction getDragImageData(event: DragEvent): null | InsertImagePayload {\n  const dragData = event.dataTransfer?.getData('application/x-lexical-drag');\n  if (!dragData) {\n    return null;\n  }\n  const { type, data } = JSON.parse(dragData);\n  if (type !== 'image') {\n    return null;\n  }\n\n  return data;\n}\n\ndeclare global {\n  interface DragEvent {\n    rangeOffset?: number;\n    rangeParent?: Node;\n  }\n}\n\nfunction canDropImage(event: DragEvent): boolean {\n  const target = event.target;\n  return !!(\n    target &&\n    target instanceof HTMLElement &&\n    !target.closest('code, span.editor-image') &&\n    target.parentElement &&\n    target.parentElement.closest('div.ContentEditable__root')\n  );\n}\n\nfunction getDragSelection(event: DragEvent): Range | null | undefined {\n  let range;\n  const target = event.target as null | Element | Document;\n  const targetWindow =\n    target == null\n      ? null\n      : target.nodeType === 9\n      ? (target as Document).defaultView\n      : (target as Element).ownerDocument.defaultView;\n  const domSelection = getDOMSelection(targetWindow);\n  if (document.caretRangeFromPoint) {\n    range = document.caretRangeFromPoint(event.clientX, event.clientY);\n  } else if (event.rangeParent && domSelection !== null) {\n    domSelection.collapse(event.rangeParent, event.rangeOffset || 0);\n    range = domSelection.getRangeAt(0);\n  } else {\n    throw Error(`Cannot get the selection when dragging`);\n  }\n\n  return range;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { DRAG_DROP_PASTE } from '@lexical/rich-text';\nimport { isMimeType, mediaFileReader } from '@lexical/utils';\nimport { COMMAND_PRIORITY_LOW } from 'lexical';\nimport { useEffect } from 'react';\n\nimport { INSERT_IMAGE_COMMAND } from './ImagesPlugin';\n\nconst ACCEPTABLE_IMAGE_TYPES = [\n  'image/',\n  'image/heic',\n  'image/heif',\n  'image/gif',\n  'image/webp',\n];\n\nexport default function DragDropPaste(): null {\n  const [editor] = useLexicalComposerContext();\n  useEffect(() => {\n    return editor.registerCommand(\n      DRAG_DROP_PASTE,\n      (files) => {\n        (async () => {\n          const filesResult = await mediaFileReader(\n            files,\n            [ACCEPTABLE_IMAGE_TYPES].flatMap((x) => x)\n          );\n          for (const { file, result } of filesResult) {\n            if (isMimeType(file, ACCEPTABLE_IMAGE_TYPES)) {\n              editor.dispatchCommand(INSERT_IMAGE_COMMAND, {\n                altText: file.name,\n                src: result,\n              });\n            }\n          }\n        })();\n        return true;\n      },\n      COMMAND_PRIORITY_LOW\n    );\n  }, [editor]);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { AutoFocusPlugin } from '@lexical/react/LexicalAutoFocusPlugin';\nimport { CheckListPlugin } from '@lexical/react/LexicalCheckListPlugin';\nimport { ClearEditorPlugin } from '@lexical/react/LexicalClearEditorPlugin';\nimport { HashtagPlugin } from '@lexical/react/LexicalHashtagPlugin';\nimport { LinkPlugin } from '@lexical/react/LexicalLinkPlugin';\nimport { ListPlugin } from '@lexical/react/LexicalListPlugin';\nimport { RichTextPlugin } from '@lexical/react/LexicalRichTextPlugin';\nimport { OnChangePlugin } from '@lexical/react/LexicalOnChangePlugin';\nimport LexicalErrorBoundary from '@lexical/react/LexicalErrorBoundary';\nimport React, { ReactNode, useEffect, useState } from 'react';\nimport { useRef } from 'react';\n\nimport { useSettings } from './context/SettingsContext';\nimport { useSharedHistoryContext } from './context/SharedHistoryContext';\nimport ActionsPlugin from './plugins/ActionsPlugin';\nimport AutoLinkPlugin from './plugins/AutoLinkPlugin';\nimport CharacterStylesPopupPlugin from './plugins/CharacterStylesPopupPlugin';\nimport ClickableLinkPlugin from './plugins/ClickableLinkPlugin';\nimport CodeHighlightPlugin from './plugins/CodeHighlightPlugin';\nimport EmojisPlugin from './plugins/EmojisPlugin';\nimport KeywordsPlugin from './plugins/KeywordsPlugin';\nimport ListMaxIndentLevelPlugin from './plugins/ListMaxIndentLevelPlugin';\nimport MarkdownShortcutPlugin from './plugins/MarkdownShortcutPlugin';\nimport SpeechToTextPlugin from './plugins/SpeechToTextPlugin';\nimport TabFocusPlugin from './plugins/TabFocusPlugin';\nimport ContentEditable from './ui/ContentEditable';\nimport Placeholder from './ui/Placeholder';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport EditorContext from './context/EditorContext';\nimport { LexicalEditor } from 'lexical';\nimport { useTranslation } from 'react-i18next';\nimport DragDropPaste from './plugins/DragDropPastePlugin';\n\ninterface IEditorProps {\n  children?: ReactNode;\n  hashtagsEnabled?: boolean;\n  autoLinkEnabled?: boolean;\n  emojisEnabled?: boolean;\n  actionsEnabled?: boolean;\n  placeholder?: string;\n  listMaxIndent?: number;\n  isEditable?: boolean;\n  locale?: 'en' | 'fr' | 'ptBr' | 'ru' | null;\n  onChange?: (editorState: string, editorInstance?: LexicalEditor) => void;\n}\n\nconst Editor = ({\n  children,\n  hashtagsEnabled = false,\n  autoLinkEnabled = false,\n  emojisEnabled = false,\n  actionsEnabled = false,\n  listMaxIndent = 7,\n  placeholder = '',\n  isEditable = true,\n  locale = null,\n  onChange,\n}: IEditorProps) => {\n  const [editor] = useLexicalComposerContext();\n  const [activeEditor, setActiveEditor] = useState(editor);\n\n  const editorStateRef = useRef(null);\n  const { historyState } = useSharedHistoryContext();\n  const {\n    settings: { isRichText },\n  } = useSettings();\n  const placeholderComponent = <Placeholder>{placeholder}</Placeholder>;\n\n  const { i18n } = useTranslation();\n\n  useEffect(() => {\n    editor.setEditable(isEditable);\n\n    if (locale) i18n.changeLanguage(locale);\n  }, []);\n\n  return (\n    <EditorContext.Provider\n      value={{ initialEditor: editor, activeEditor, setActiveEditor }}\n    >\n      {children}\n      <div className={`editor-container`}>\n        <AutoFocusPlugin />\n        <ClearEditorPlugin />\n        {hashtagsEnabled && <HashtagPlugin />}\n        {emojisEnabled && <EmojisPlugin />}\n        <KeywordsPlugin />\n        <SpeechToTextPlugin />\n        <DragDropPaste />\n        {autoLinkEnabled && <AutoLinkPlugin />}\n\n        <>\n          <RichTextPlugin\n            contentEditable={<ContentEditable />}\n            placeholder={placeholderComponent}\n            ErrorBoundary={LexicalErrorBoundary}\n          />\n          <OnChangePlugin\n            onChange={(editorState) => {\n              onChange?.(JSON.stringify(editorState), activeEditor);\n              return (editorStateRef.current = editorState);\n            }}\n          />\n          <MarkdownShortcutPlugin />\n          <CodeHighlightPlugin />\n          <ListPlugin />\n          <CheckListPlugin />\n          <ListMaxIndentLevelPlugin maxDepth={listMaxIndent} />\n          <LinkPlugin />\n          <ClickableLinkPlugin />\n          <CharacterStylesPopupPlugin />\n          <TabFocusPlugin />\n        </>\n\n        <HistoryPlugin externalHistoryState={historyState} />\n        {actionsEnabled && <ActionsPlugin isRichText={isRichText} />}\n      </div>\n    </EditorContext.Provider>\n  );\n};\n\nexport default Editor;\n","import { $isAtNodeEnd } from '@lexical/selection';\nimport { ElementNode, RangeSelection, TextNode } from 'lexical';\n\nexport function getSelectedNode(\n  selection: RangeSelection\n): TextNode | ElementNode {\n  const anchor = selection.anchor;\n  const focus = selection.focus;\n  const anchorNode = selection.anchor.getNode();\n  const focusNode = selection.focus.getNode();\n  if (anchorNode === focusNode) {\n    return anchorNode;\n  }\n  const isBackward = selection.isBackward();\n  if (isBackward) {\n    return $isAtNodeEnd(focus) ? anchorNode : focusNode;\n  } else {\n    return $isAtNodeEnd(anchor) ? focusNode : anchorNode;\n  }\n}\n","import { LexicalEditor } from 'lexical';\nimport React, { createContext } from 'react';\n\ninterface IToolbarContext {\n  isRTL: boolean;\n  isBold: boolean;\n  isItalic: boolean;\n  isUnderline: boolean;\n  isCode: boolean;\n  isLink: boolean;\n  isStrikethrough: boolean;\n  isSubscript: boolean;\n  isSuperscript: boolean;\n  canUndo: boolean;\n  canRedo: boolean;\n  fontFamily: string;\n  fontSize: string;\n  fontColor: string;\n  bgColor: string;\n  blockType: string;\n  codeLanguage: string;\n  selectedElementKey: string;\n  applyStyleText: (styles: Record<string, string>) => void;\n  insertLink: () => void;\n}\n\nconst ToolbarContext = createContext<IToolbarContext | null>(null);\n\nexport default ToolbarContext;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useEffect, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\n\nexport default function DropDown({\n  buttonLabel,\n  buttonAriaLabel,\n  buttonClassName,\n  buttonIconClassName,\n  children,\n  stopCloseOnClickSelf,\n}: {\n  buttonAriaLabel?: string;\n  buttonClassName: string;\n  buttonIconClassName?: string;\n  buttonLabel?: string;\n  children: JSX.Element | string | (JSX.Element | string)[];\n  stopCloseOnClickSelf?: boolean;\n}): JSX.Element {\n  const dropDownRef = useRef<HTMLDivElement | null>(null);\n  const buttonRef = useRef<HTMLButtonElement | null>(null);\n  const [showDropDown, setShowDropDown] = useState(false);\n\n  useEffect(() => {\n    const button = buttonRef.current;\n    const dropDown = dropDownRef.current;\n\n    if (showDropDown && button !== null && dropDown !== null) {\n      const { top, left } = button.getBoundingClientRect();\n      dropDown.style.top = `${top + 40}px`;\n      dropDown.style.left = `${Math.min(\n        left,\n        window.innerWidth - dropDown.offsetWidth - 20\n      )}px`;\n    }\n  }, [dropDownRef, buttonRef, showDropDown]);\n\n  useEffect(() => {\n    const button = buttonRef.current;\n\n    if (button !== null && showDropDown) {\n      const handle = (event: MouseEvent) => {\n        const target = event.target;\n        if (stopCloseOnClickSelf) {\n          if (dropDownRef.current.contains(target as Node)) return;\n        }\n        if (!button.contains(target as Node)) {\n          setShowDropDown(false);\n        }\n      };\n      document.addEventListener('click', handle);\n\n      return () => {\n        document.removeEventListener('click', handle);\n      };\n    }\n  }, [dropDownRef, buttonRef, showDropDown, stopCloseOnClickSelf]);\n\n  return (\n    <>\n      <button\n        aria-label={buttonAriaLabel || buttonLabel}\n        className={buttonClassName}\n        onClick={() => setShowDropDown(!showDropDown)}\n        ref={buttonRef}\n        type=\"button\"\n      >\n        {buttonIconClassName && <span className={buttonIconClassName} />}\n        {buttonLabel && (\n          <span className=\"text dropdown-button-text\">{buttonLabel}</span>\n        )}\n        <i className=\"chevron-down\" />\n      </button>\n\n      {showDropDown &&\n        createPortal(\n          <div className=\"dropdown\" ref={dropDownRef}>\n            {children}\n          </div>,\n          document.body\n        )}\n    </>\n  );\n}\n","import React, { useContext } from 'react';\nimport DropDown from '../../../ui/DropDown';\n\nimport {\n  FORMAT_ELEMENT_COMMAND,\n  INDENT_CONTENT_COMMAND,\n  LexicalEditor,\n  OUTDENT_CONTENT_COMMAND,\n} from 'lexical';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nfunction Divider(): JSX.Element {\n  return <div className=\"divider\" />;\n}\n\nconst AlignDropdown = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isRTL } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <DropDown\n      buttonLabel={t('toolbar:alignDropdown.Title')}\n      buttonAriaLabel={t('toolbar:alignDropdown.Description')}\n      buttonClassName=\"toolbar-item spaced alignment\"\n      buttonIconClassName=\"icon left-align\"\n    >\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'left');\n        }}\n        className=\"item\"\n        type=\"button\"\n      >\n        <i className=\"icon left-align\" />\n        <span className=\"text\">{t('toolbar:alignDropdown.LeftAlign')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'center');\n        }}\n        className=\"item\"\n        type=\"button\"\n      >\n        <i className=\"icon center-align\" />\n        <span className=\"text\">{t('toolbar:alignDropdown.CenterAlign')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'right');\n        }}\n        className=\"item\"\n        type=\"button\"\n      >\n        <i className=\"icon right-align\" />\n        <span className=\"text\">{t('toolbar:alignDropdown.RightAlign')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'justify');\n        }}\n        className=\"item\"\n        type=\"button\"\n      >\n        <i className=\"icon justify-align\" />\n        <span className=\"text\">{t('toolbar:alignDropdown.JustifyAlign')}</span>\n      </button>\n      <Divider />\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(OUTDENT_CONTENT_COMMAND, undefined);\n        }}\n        className=\"item\"\n        type=\"button\"\n      >\n        <i className={'icon ' + (isRTL ? 'indent' : 'outdent')} />\n        <span className=\"text\">{t('toolbar:alignDropdown.Outdent')}</span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(INDENT_CONTENT_COMMAND, undefined);\n        }}\n        className=\"item\"\n        type=\"button\"\n      >\n        <i className={'icon ' + (isRTL ? 'outdent' : 'indent')} />\n        <span className=\"text\">{t('toolbar:alignDropdown.Indent')}</span>\n      </button>\n    </DropDown>\n  );\n};\n\nexport default AlignDropdown;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $isRootNode,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nimport { $createPollNode, PollNode } from '../nodes/PollNode';\n\nexport const INSERT_POLL_COMMAND: LexicalCommand<string> = createCommand();\n\nexport default function PollPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  useEffect(() => {\n    if (!editor.hasNodes([PollNode])) {\n      throw new Error('PollPlugin: PollNode not registered on editor');\n    }\n\n    return editor.registerCommand<string>(\n      INSERT_POLL_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          const question = payload;\n          const pollNode = $createPollNode(question);\n\n          if ($isRootNode(selection.anchor.getNode())) {\n            selection.insertParagraph();\n          }\n\n          selection.insertNodes([pollNode]);\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $createParagraphNode,\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nimport { $createTweetNode, TweetNode } from '../nodes/TweetNode';\n\nexport const INSERT_TWEET_COMMAND: LexicalCommand<string> = createCommand();\n\nexport default function TwitterPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([TweetNode])) {\n      throw new Error('TwitterPlugin: TweetNode not registered on editor');\n    }\n\n    return editor.registerCommand<string>(\n      INSERT_TWEET_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          const focusNode = selection.focus.getNode();\n\n          if (focusNode !== null) {\n            const tweetNode = $createTweetNode(payload);\n            selection.focus\n              .getNode()\n              .getTopLevelElementOrThrow()\n              .insertAfter(tweetNode);\n            const paragraphNode = $createParagraphNode();\n            tweetNode.insertAfter(paragraphNode);\n            paragraphNode.select();\n          }\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type { LexicalCommand } from 'lexical';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $createParagraphNode,\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nimport { $createYouTubeNode, YouTubeNode } from '../nodes/YouTubeNode';\n\nexport const INSERT_YOUTUBE_COMMAND: LexicalCommand<string> = createCommand();\n\nexport default function YouTubePlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([YouTubeNode])) {\n      throw new Error('YouTubePlugin: YouTubeNode not registered on editor');\n    }\n\n    return editor.registerCommand<string>(\n      INSERT_YOUTUBE_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          const focusNode = selection.focus.getNode();\n\n          if (focusNode !== null) {\n            const youTubeNode = $createYouTubeNode(payload);\n            selection.focus\n              .getNode()\n              .getTopLevelElementOrThrow()\n              .insertAfter(youTubeNode);\n            const paragraphNode = $createParagraphNode();\n            youTubeNode.insertAfter(paragraphNode);\n            paragraphNode.select();\n          }\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nimport type { Cell } from '@lexical/table';\nimport type { LexicalEditor } from 'lexical';\n\nimport './TableCellResizer.css';\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $getTableColumnIndexFromTableCellNode,\n  $getTableNodeFromLexicalNodeOrThrow,\n  $getTableRowIndexFromTableCellNode,\n  $isTableCellNode,\n  $isTableRowNode,\n  getCellFromTarget,\n} from '@lexical/table';\nimport {\n  $getNearestNodeFromDOMNode,\n  $getSelection,\n  DEPRECATED_$isGridSelection,\n  COMMAND_PRIORITY_HIGH,\n  SELECTION_CHANGE_COMMAND,\n} from 'lexical';\nimport * as React from 'react';\nimport {\n  ReactPortal,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { createPortal } from 'react-dom';\n\ntype MousePosition = {\n  x: number;\n  y: number;\n};\n\ntype MouseDraggingDirection = 'right' | 'bottom';\n\nconst MIN_ROW_HEIGHT = 33;\nconst MIN_COLUMN_WIDTH = 50;\n\nfunction TableCellResizer({ editor }: { editor: LexicalEditor }): JSX.Element {\n  const targetRef = useRef<HTMLElement | null>(null);\n  const resizerRef = useRef<HTMLDivElement | null>(null);\n  const tableRectRef = useRef<ClientRect | null>(null);\n\n  const mouseStartPosRef = useRef<MousePosition | null>(null);\n  const [mouseCurrentPos, updateMouseCurrentPos] =\n    useState<MousePosition | null>(null);\n\n  const [activeCell, updateActiveCell] = useState<Cell | null>(null);\n  const [isSelectingGrid, updateIsSelectingGrid] = useState<boolean>(false);\n  const [draggingDirection, updateDraggingDirection] =\n    useState<MouseDraggingDirection | null>(null);\n\n  useEffect(() => {\n    return editor.registerCommand(\n      SELECTION_CHANGE_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n        const isGridSelection = DEPRECATED_$isGridSelection(selection);\n\n        if (isSelectingGrid !== isGridSelection) {\n          updateIsSelectingGrid(isGridSelection);\n        }\n\n        return false;\n      },\n      COMMAND_PRIORITY_HIGH\n    );\n  });\n\n  const resetState = useCallback(() => {\n    updateActiveCell(null);\n    targetRef.current = null;\n    updateDraggingDirection(null);\n    mouseStartPosRef.current = null;\n    tableRectRef.current = null;\n  }, []);\n\n  useEffect(() => {\n    const onMouseMove = (event: MouseEvent) => {\n      setTimeout(() => {\n        const target = event.target;\n\n        if (draggingDirection) {\n          updateMouseCurrentPos({\n            x: event.clientX,\n            y: event.clientY,\n          });\n          return;\n        }\n\n        if (resizerRef.current && resizerRef.current.contains(target as Node)) {\n          return;\n        }\n\n        if (targetRef.current !== target) {\n          targetRef.current = target as HTMLElement;\n          const cell = getCellFromTarget(target as HTMLElement);\n\n          if (cell && activeCell !== cell) {\n            editor.update(() => {\n              const tableCellNode = $getNearestNodeFromDOMNode(cell.elem);\n              if (!tableCellNode) {\n                throw new Error('TableCellResizer: Table cell node not found.');\n              }\n\n              const tableNode =\n                $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n              const tableElement = editor.getElementByKey(tableNode.getKey());\n\n              if (!tableElement) {\n                throw new Error('TableCellResizer: Table element not found.');\n              }\n\n              targetRef.current = target as HTMLElement;\n              tableRectRef.current = tableElement.getBoundingClientRect();\n              updateActiveCell(cell);\n            });\n          } else if (cell == null) {\n            resetState();\n          }\n        }\n      }, 0);\n    };\n\n    document.addEventListener('mousemove', onMouseMove);\n\n    return () => {\n      document.removeEventListener('mousemove', onMouseMove);\n    };\n  }, [activeCell, draggingDirection, editor, resetState]);\n\n  const isHeightChanging = (direction: MouseDraggingDirection) => {\n    if (direction === 'bottom') return true;\n    return false;\n  };\n\n  const updateRowHeight = useCallback(\n    (newHeight: number) => {\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n\n      editor.update(() => {\n        const tableCellNode = $getNearestNodeFromDOMNode(activeCell.elem);\n        if (!$isTableCellNode(tableCellNode)) {\n          throw new Error('TableCellResizer: Table cell node not found.');\n        }\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n        const tableRows = tableNode.getChildren();\n\n        if (tableRowIndex >= tableRows.length || tableRowIndex < 0) {\n          throw new Error('Expected table cell to be inside of table row.');\n        }\n\n        const tableRow = tableRows[tableRowIndex];\n\n        if (!$isTableRowNode(tableRow)) {\n          throw new Error('Expected table row');\n        }\n\n        tableRow.setHeight(newHeight);\n      });\n    },\n    [activeCell, editor]\n  );\n\n  const updateColumnWidth = useCallback(\n    (newWidth: number) => {\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n      editor.update(() => {\n        const tableCellNode = $getNearestNodeFromDOMNode(activeCell.elem);\n        if (!$isTableCellNode(tableCellNode)) {\n          throw new Error('TableCellResizer: Table cell node not found.');\n        }\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        const tableColumnIndex =\n          $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n        const tableRows = tableNode.getChildren();\n\n        for (let r = 0; r < tableRows.length; r++) {\n          const tableRow = tableRows[r];\n\n          if (!$isTableRowNode(tableRow)) {\n            throw new Error('Expected table row');\n          }\n\n          const tableCells = tableRow.getChildren();\n\n          if (tableColumnIndex >= tableCells.length || tableColumnIndex < 0) {\n            throw new Error('Expected table cell to be inside of table row.');\n          }\n\n          const tableCell = tableCells[tableColumnIndex];\n\n          if (!$isTableCellNode(tableCell)) {\n            throw new Error('Expected table cell');\n          }\n\n          tableCell.setWidth(newWidth);\n        }\n      });\n    },\n    [activeCell, editor]\n  );\n\n  const toggleResize = useCallback(\n    (direction) => (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n\n      if (draggingDirection === direction && mouseStartPosRef.current) {\n        const { x, y } = mouseStartPosRef.current;\n\n        if (!activeCell) {\n          return;\n        }\n\n        const { height, width } = activeCell.elem.getBoundingClientRect();\n\n        if (isHeightChanging(direction)) {\n          const heightChange = Math.abs(event.clientY - y);\n\n          const isShrinking = direction === 'bottom' && y > event.clientY;\n\n          updateRowHeight(\n            Math.max(\n              isShrinking ? height - heightChange : heightChange + height,\n              MIN_ROW_HEIGHT\n            )\n          );\n        } else {\n          const widthChange = Math.abs(event.clientX - x);\n\n          const isShrinking = direction === 'right' && x > event.clientX;\n\n          updateColumnWidth(\n            Math.max(\n              isShrinking ? width - widthChange : widthChange + width,\n              MIN_COLUMN_WIDTH\n            )\n          );\n        }\n\n        resetState();\n      } else {\n        mouseStartPosRef.current = {\n          x: event.clientX,\n          y: event.clientY,\n        };\n        updateMouseCurrentPos(mouseStartPosRef.current);\n        updateDraggingDirection(direction);\n      }\n    },\n    [\n      activeCell,\n      draggingDirection,\n      resetState,\n      updateColumnWidth,\n      updateRowHeight,\n    ]\n  );\n\n  const getResizers = useCallback(() => {\n    if (activeCell) {\n      const { height, width, top, left } =\n        activeCell.elem.getBoundingClientRect();\n\n      const styles = {\n        bottom: {\n          backgroundColor: 'none',\n          cursor: 'row-resize',\n          height: '10px',\n          left: `${window.pageXOffset + left}px`,\n          top: `${window.pageYOffset + top + height}px`,\n          width: `${width}px`,\n        },\n        right: {\n          backgroundColor: 'none',\n          cursor: 'col-resize',\n          height: `${height}px`,\n          left: `${window.pageXOffset + left + width}px`,\n          top: `${window.pageYOffset + top}px`,\n          width: '10px',\n        },\n      };\n\n      const tableRect = tableRectRef.current;\n\n      if (draggingDirection && mouseCurrentPos && tableRect) {\n        if (isHeightChanging(draggingDirection)) {\n          styles[draggingDirection].left = `${\n            window.pageXOffset + tableRect.left\n          }px`;\n          styles[draggingDirection].top = `${\n            window.pageYOffset + mouseCurrentPos.y\n          }px`;\n          styles[draggingDirection].height = '3px';\n          styles[draggingDirection].width = `${tableRect.width}px`;\n        } else {\n          styles[draggingDirection].top = `${\n            window.pageYOffset + tableRect.top\n          }px`;\n          styles[draggingDirection].left = `${\n            window.pageXOffset + mouseCurrentPos.x\n          }px`;\n          styles[draggingDirection].width = '3px';\n          styles[draggingDirection].height = `${tableRect.height}px`;\n        }\n\n        styles[draggingDirection].backgroundColor = '#adf';\n      }\n\n      return styles;\n    }\n\n    return {\n      bottom: null,\n      left: null,\n      right: null,\n      top: null,\n    };\n  }, [activeCell, draggingDirection, mouseCurrentPos]);\n\n  const resizerStyles = getResizers();\n\n  return (\n    <div ref={resizerRef}>\n      {activeCell != null && !isSelectingGrid && (\n        <>\n          <div\n            className=\"TableCellResizer__resizer TableCellResizer__ui\"\n            style={resizerStyles.right}\n            onMouseDown={toggleResize('right')}\n            onMouseUp={toggleResize('right')}\n          />\n          <div\n            className=\"TableCellResizer__resizer TableCellResizer__ui\"\n            style={resizerStyles.bottom}\n            onMouseDown={toggleResize('bottom')}\n            onMouseUp={toggleResize('bottom')}\n          />\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default function TableCellResizerPlugin(): ReactPortal {\n  const [editor] = useLexicalComposerContext();\n\n  return useMemo(\n    () => createPortal(<TableCellResizer editor={editor} />, document.body),\n    [editor]\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $deleteTableColumn,\n  $getElementGridForTableNode,\n  $getTableCellNodeFromLexicalNode,\n  $getTableColumnIndexFromTableCellNode,\n  $getTableNodeFromLexicalNodeOrThrow,\n  $getTableRowIndexFromTableCellNode,\n  $insertTableColumn,\n  $insertTableRow,\n  $isTableCellNode,\n  $isTableRowNode,\n  $removeTableRowAtIndex,\n  getTableSelectionFromTableElement,\n  HTMLTableElementWithWithTableSelectionState,\n  TableCellHeaderStates,\n  TableCellNode,\n} from '@lexical/table';\nimport { TFunction } from 'i18next';\nimport {\n  $getSelection,\n  DEPRECATED_$isGridSelection,\n  $isRangeSelection,\n  $setSelection,\n} from 'lexical';\nimport * as React from 'react';\nimport { ReactPortal, useCallback, useEffect, useRef, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport { useTranslation } from 'react-i18next';\n\ntype TableCellActionMenuProps = Readonly<{\n  contextRef: { current: null | HTMLElement };\n  onClose: () => void;\n  setIsMenuOpen: (isOpen: boolean) => void;\n  tableCellNode: TableCellNode;\n  t: TFunction;\n}>;\n\nfunction TableActionMenu({\n  onClose,\n  tableCellNode: _tableCellNode,\n  setIsMenuOpen,\n  contextRef,\n  t,\n}: TableCellActionMenuProps) {\n  const [editor] = useLexicalComposerContext();\n  const dropDownRef = useRef<HTMLDivElement | null>(null);\n  const [tableCellNode, updateTableCellNode] = useState(_tableCellNode);\n  const [selectionCounts, updateSelectionCounts] = useState({\n    columns: 1,\n    rows: 1,\n  });\n\n  useEffect(() => {\n    return editor.registerMutationListener(TableCellNode, (nodeMutations) => {\n      const nodeUpdated =\n        nodeMutations.get(tableCellNode.getKey()) === 'updated';\n\n      if (nodeUpdated) {\n        editor.getEditorState().read(() => {\n          updateTableCellNode(tableCellNode.getLatest());\n        });\n      }\n    });\n  }, [editor, tableCellNode]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n\n      if (DEPRECATED_$isGridSelection(selection)) {\n        const selectionShape = selection.getShape();\n\n        updateSelectionCounts({\n          columns: selectionShape.toX - selectionShape.fromX + 1,\n          rows: selectionShape.toY - selectionShape.fromY + 1,\n        });\n      }\n    });\n  }, [editor]);\n\n  useEffect(() => {\n    const menuButtonElement = contextRef.current;\n    const dropDownElement = dropDownRef.current;\n\n    if (menuButtonElement != null && dropDownElement != null) {\n      const menuButtonRect = menuButtonElement.getBoundingClientRect();\n\n      dropDownElement.style.opacity = '1';\n\n      dropDownElement.style.left = `${\n        menuButtonRect.left + menuButtonRect.width + window.pageXOffset + 5\n      }px`;\n\n      dropDownElement.style.top = `${\n        menuButtonRect.top + window.pageYOffset\n      }px`;\n    }\n  }, [contextRef, dropDownRef]);\n\n  useEffect(() => {\n    function handleClickOutside(event: MouseEvent) {\n      if (\n        dropDownRef.current != null &&\n        contextRef.current != null &&\n        !dropDownRef.current.contains(event.target as Node) &&\n        !contextRef.current.contains(event.target as Node)\n      ) {\n        setIsMenuOpen(false);\n      }\n    }\n\n    window.addEventListener('click', handleClickOutside);\n\n    return () => window.removeEventListener('click', handleClickOutside);\n  }, [setIsMenuOpen, contextRef]);\n\n  const clearTableSelection = useCallback(() => {\n    editor.update(() => {\n      if (tableCellNode.isAttached()) {\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n        const tableElement = editor.getElementByKey(\n          tableNode.getKey()\n        ) as HTMLTableElementWithWithTableSelectionState;\n\n        if (!tableElement) {\n          throw new Error('Expected to find tableElement in DOM');\n        }\n\n        const tableSelection = getTableSelectionFromTableElement(tableElement);\n        if (tableSelection !== null) {\n          tableSelection.clearHighlight();\n        }\n\n        tableNode.markDirty();\n        updateTableCellNode(tableCellNode.getLatest());\n      }\n\n      $setSelection(null);\n    });\n  }, [editor, tableCellNode]);\n\n  const insertTableRowAtSelection = useCallback(\n    (shouldInsertAfter: boolean) => {\n      editor.update(() => {\n        const selection = $getSelection();\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        let tableRowIndex;\n\n        if (DEPRECATED_$isGridSelection(selection)) {\n          const selectionShape = selection.getShape();\n          tableRowIndex = shouldInsertAfter\n            ? selectionShape.toY\n            : selectionShape.fromY;\n        } else {\n          tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n        }\n\n        const grid = $getElementGridForTableNode(editor, tableNode);\n\n        $insertTableRow(\n          tableNode,\n          tableRowIndex,\n          shouldInsertAfter,\n          selectionCounts.rows,\n          grid\n        );\n\n        clearTableSelection();\n\n        onClose();\n      });\n    },\n    [editor, tableCellNode, selectionCounts.rows, clearTableSelection, onClose]\n  );\n\n  const insertTableColumnAtSelection = useCallback(\n    (shouldInsertAfter: boolean) => {\n      editor.update(() => {\n        const selection = $getSelection();\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        let tableColumnIndex;\n\n        if (DEPRECATED_$isGridSelection(selection)) {\n          const selectionShape = selection.getShape();\n          tableColumnIndex = shouldInsertAfter\n            ? selectionShape.toX\n            : selectionShape.fromX;\n        } else {\n          tableColumnIndex =\n            $getTableColumnIndexFromTableCellNode(tableCellNode);\n        }\n\n        const grid = $getElementGridForTableNode(editor, tableNode);\n\n        $insertTableColumn(\n          tableNode,\n          tableColumnIndex,\n          shouldInsertAfter,\n          selectionCounts.columns,\n          grid\n        );\n\n        clearTableSelection();\n\n        onClose();\n      });\n    },\n    [\n      editor,\n      tableCellNode,\n      selectionCounts.columns,\n      clearTableSelection,\n      onClose,\n    ]\n  );\n\n  const deleteTableRowAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n      const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n      $removeTableRowAtIndex(tableNode, tableRowIndex);\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const deleteTableAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n      tableNode.remove();\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const deleteTableColumnAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableColumnIndex =\n        $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n      $deleteTableColumn(tableNode, tableColumnIndex);\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const toggleTableRowIsHeader = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n      const tableRows = tableNode.getChildren();\n\n      if (tableRowIndex >= tableRows.length || tableRowIndex < 0) {\n        throw new Error('Expected table cell to be inside of table row.');\n      }\n\n      const tableRow = tableRows[tableRowIndex];\n\n      if (!$isTableRowNode(tableRow)) {\n        throw new Error('Expected table row');\n      }\n\n      tableRow.getChildren().forEach((tableCell) => {\n        if (!$isTableCellNode(tableCell)) {\n          throw new Error('Expected table cell');\n        }\n\n        tableCell.toggleHeaderStyle(TableCellHeaderStates.ROW);\n      });\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const toggleTableColumnIsHeader = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableColumnIndex =\n        $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n      const tableRows = tableNode.getChildren();\n\n      for (let r = 0; r < tableRows.length; r++) {\n        const tableRow = tableRows[r];\n\n        if (!$isTableRowNode(tableRow)) {\n          throw new Error('Expected table row');\n        }\n\n        const tableCells = tableRow.getChildren();\n\n        if (tableColumnIndex >= tableCells.length || tableColumnIndex < 0) {\n          throw new Error('Expected table cell to be inside of table row.');\n        }\n\n        const tableCell = tableCells[tableColumnIndex];\n\n        if (!$isTableCellNode(tableCell)) {\n          throw new Error('Expected table cell');\n        }\n\n        tableCell.toggleHeaderStyle(TableCellHeaderStates.COLUMN);\n      }\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  return createPortal(\n    // eslint-disable-next-line jsx-a11y/no-static-element-interactions\n    <div\n      className=\"dropdown\"\n      ref={dropDownRef}\n      onClick={(e) => {\n        e.stopPropagation();\n      }}\n    >\n      <button\n        className=\"item\"\n        onClick={() => insertTableRowAtSelection(false)}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.rows === 1\n            ? t('toolbar:tableActionMenuPlugin.row')\n            : `${selectionCounts.rows} ${t(\n                'toolbar:tableActionMenuPlugin.rows'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.above')}\n        </span>\n      </button>\n      <button\n        className=\"item\"\n        onClick={() => insertTableRowAtSelection(true)}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.rows === 1\n            ? t('toolbar:tableActionMenuPlugin.row')\n            : `${selectionCounts.rows} ${t(\n                'toolbar:tableActionMenuPlugin.rows'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.below')}\n        </span>\n      </button>\n      <hr />\n      <button\n        className=\"item\"\n        onClick={() => insertTableColumnAtSelection(false)}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.columns === 1\n            ? t('toolbar:tableActionMenuPlugin.column')\n            : `${selectionCounts.columns} ${t(\n                'toolbar:tableActionMenuPlugin.columns'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.left')}\n        </span>\n      </button>\n      <button\n        className=\"item\"\n        onClick={() => insertTableColumnAtSelection(true)}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          {t('toolbar:tableActionMenuPlugin.Insert')}{' '}\n          {selectionCounts.columns === 1\n            ? t('toolbar:tableActionMenuPlugin.column')\n            : `${selectionCounts.columns} ${t(\n                'toolbar:tableActionMenuPlugin.columns'\n              )}`}{' '}\n          {t('toolbar:tableActionMenuPlugin.right')}\n        </span>\n      </button>\n      <hr />\n      <button\n        className=\"item\"\n        onClick={() => deleteTableColumnAtSelection()}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          {t('toolbar:tableActionMenuPlugin.Delete_column')}\n        </span>\n      </button>\n      <button\n        className=\"item\"\n        onClick={() => deleteTableRowAtSelection()}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          {t('toolbar:tableActionMenuPlugin.Delete_row')}\n        </span>\n      </button>\n      <button\n        className=\"item\"\n        onClick={() => deleteTableAtSelection()}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          {t('toolbar:tableActionMenuPlugin.Delete_table')}\n        </span>\n      </button>\n      <hr />\n      <button\n        className=\"item\"\n        onClick={() => toggleTableRowIsHeader()}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          {(tableCellNode.__headerState & TableCellHeaderStates.ROW) ===\n          TableCellHeaderStates.ROW\n            ? t('action:Remove')\n            : t('action:Add')}{' '}\n          {t('toolbar:tableActionMenuPlugin.row_header')}\n        </span>\n      </button>\n      <button\n        className=\"item\"\n        onClick={() => toggleTableColumnIsHeader()}\n        type=\"button\"\n      >\n        <span className=\"text\">\n          {(tableCellNode.__headerState & TableCellHeaderStates.COLUMN) ===\n          TableCellHeaderStates.COLUMN\n            ? t('action:Remove')\n            : t('action:Add ')}{' '}\n          {t('toolbar:tableActionMenuPlugin.column_header')}\n        </span>\n      </button>\n    </div>,\n    document.body\n  );\n}\n\nfunction TableCellActionMenuContainer(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  const menuButtonRef = useRef(null);\n  const menuRootRef = useRef(null);\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n\n  const [tableCellNode, setTableMenuCellNode] = useState<TableCellNode | null>(\n    null\n  );\n  const { t } = useTranslation(['toolbar', 'action']);\n\n  const moveMenu = useCallback(() => {\n    const menu = menuButtonRef.current;\n    const selection = $getSelection();\n    const nativeSelection = window.getSelection();\n    const activeElement = document.activeElement;\n\n    if (selection == null || menu == null) {\n      setTableMenuCellNode(null);\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n\n    if (\n      $isRangeSelection(selection) &&\n      rootElement !== null &&\n      nativeSelection !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const tableCellNodeFromSelection = $getTableCellNodeFromLexicalNode(\n        selection.anchor.getNode()\n      );\n\n      if (tableCellNodeFromSelection == null) {\n        setTableMenuCellNode(null);\n        return;\n      }\n\n      const tableCellParentNodeDOM = editor.getElementByKey(\n        tableCellNodeFromSelection.getKey()\n      );\n\n      if (tableCellParentNodeDOM == null) {\n        setTableMenuCellNode(null);\n        return;\n      }\n\n      setTableMenuCellNode(tableCellNodeFromSelection);\n    } else if (!activeElement) {\n      setTableMenuCellNode(null);\n    }\n  }, [editor]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      editor.getEditorState().read(() => {\n        moveMenu();\n      });\n    });\n  });\n\n  useEffect(() => {\n    const menuButtonDOM = menuButtonRef.current as HTMLButtonElement | null;\n\n    if (menuButtonDOM != null && tableCellNode != null) {\n      const tableCellNodeDOM = editor.getElementByKey(tableCellNode.getKey());\n\n      if (tableCellNodeDOM != null) {\n        const tableCellRect = tableCellNodeDOM.getBoundingClientRect();\n        const menuRect = menuButtonDOM.getBoundingClientRect();\n\n        menuButtonDOM.style.opacity = '1';\n\n        menuButtonDOM.style.left = `${\n          tableCellRect.left +\n          window.pageXOffset -\n          menuRect.width +\n          tableCellRect.width -\n          10\n        }px`;\n\n        menuButtonDOM.style.top = `${\n          tableCellRect.top + window.pageYOffset + 5\n        }px`;\n      } else {\n        menuButtonDOM.style.opacity = '0';\n      }\n    }\n  }, [menuButtonRef, tableCellNode, editor]);\n\n  const prevTableCellDOM = useRef(tableCellNode);\n\n  useEffect(() => {\n    if (prevTableCellDOM.current !== tableCellNode) {\n      setIsMenuOpen(false);\n    }\n\n    prevTableCellDOM.current = tableCellNode;\n  }, [prevTableCellDOM, tableCellNode]);\n\n  return (\n    <div className=\"table-cell-action-button-container\" ref={menuButtonRef}>\n      {tableCellNode != null && (\n        <>\n          <button\n            className=\"table-cell-action-button chevron-down\"\n            onClick={(e) => {\n              e.stopPropagation();\n              setIsMenuOpen(!isMenuOpen);\n            }}\n            ref={menuRootRef}\n            type=\"button\"\n          >\n            <i className=\"chevron-down\" />\n          </button>\n          {isMenuOpen && (\n            <TableActionMenu\n              contextRef={menuRootRef}\n              setIsMenuOpen={setIsMenuOpen}\n              onClose={() => setIsMenuOpen(false)}\n              tableCellNode={tableCellNode}\n              t={t}\n            />\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default function TableActionMenuPlugin(): ReactPortal {\n  return createPortal(<TableCellActionMenuContainer />, document.body);\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  $createHorizontalRuleNode,\n  INSERT_HORIZONTAL_RULE_COMMAND,\n} from '@lexical/react/LexicalHorizontalRuleNode';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n} from 'lexical';\nimport { useEffect } from 'react';\n\nexport default function HorizontalRulePlugin(): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      INSERT_HORIZONTAL_RULE_COMMAND,\n      (type) => {\n        const selection = $getSelection();\n\n        if (!$isRangeSelection(selection)) {\n          return false;\n        }\n\n        const focusNode = selection.focus.getNode();\n\n        if (focusNode !== null) {\n          const horizontalRuleNode = $createHorizontalRuleNode();\n          selection.insertParagraph();\n          selection.focus\n            .getNode()\n            .getTopLevelElementOrThrow()\n            .insertBefore(horizontalRuleNode);\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  return null;\n}\n","import React, { useState, useCallback, useContext } from 'react';\nimport { $getRoot, LexicalEditor, RangeSelection } from 'lexical';\nimport DropDown from '../../../ui/DropDown';\nimport Button from '../../../ui/Button';\nimport TextInput from '../../../ui/TextInput';\nimport FileInput from '../../../ui/FileInput';\nimport ImagesPlugin, {\n  INSERT_IMAGE_COMMAND,\n  InsertImagePayload,\n} from '../../ImagesPlugin';\nimport { INSERT_TABLE_COMMAND } from '@lexical/table';\nimport { INSERT_HORIZONTAL_RULE_COMMAND } from '@lexical/react/LexicalHorizontalRuleNode';\nimport PollPlugin, { INSERT_POLL_COMMAND } from '../../PollPlugin';\nimport TwitterPlugin, { INSERT_TWEET_COMMAND } from '../../TwitterPlugin';\nimport YouTubePlugin, { INSERT_YOUTUBE_COMMAND } from '../../YouTubePlugin';\nimport { $createStickyNode } from '../../../nodes/StickyNode';\nimport useModal from '../../../hooks/useModal';\nimport TableCellResizer from '../../TableCellResizer';\nimport { TablePlugin } from '@lexical/react/LexicalTablePlugin';\nimport TableCellActionMenuPlugin from '../../TableActionMenuPlugin';\nimport HorizontalRulePlugin from '../../HorizontalRulePlugin';\nimport EditorContext from '../../../context/EditorContext';\n\n// Taken from https://stackoverflow.com/a/9102270\nconst YOUTUBE_ID_PARSER =\n  /^.*(youtu\\.be\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=|&v=)([^#&?]*).*/;\n\nconst parseYouTubeVideoID = (url: string) => {\n  const urlMatches = url.match(YOUTUBE_ID_PARSER);\n\n  return urlMatches?.[2].length === 11 ? urlMatches[2] : null;\n};\n\n//#region Inserting different modules\nfunction InsertImageDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [mode, setMode] = useState<null | 'url' | 'file'>(null);\n\n  const onClick = (payload: InsertImagePayload) => {\n    activeEditor.dispatchCommand(INSERT_IMAGE_COMMAND, payload);\n    onClose();\n  };\n\n  return (\n    <>\n      {!mode && (\n        <div className=\"ToolbarPlugin__dialogButtonsList\">\n          <Button\n            data-test-id=\"image-modal-option-sample\"\n            onClick={() =>\n              onClick({\n                altText: 'Yellow flower in tilt shift lens',\n                src: null, //yellowFlowerImage,\n              })\n            }\n          >\n            Sample\n          </Button>\n          <Button\n            data-test-id=\"image-modal-option-url\"\n            onClick={() => setMode('url')}\n          >\n            URL\n          </Button>\n          <Button\n            data-test-id=\"image-modal-option-file\"\n            onClick={() => setMode('file')}\n          >\n            File\n          </Button>\n        </div>\n      )}\n      {mode === 'url' && <InsertImageUriDialogBody onClick={onClick} />}\n      {mode === 'file' && <InsertImageUploadedDialogBody onClick={onClick} />}\n    </>\n  );\n}\n\nfunction InsertTableDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [rows, setRows] = useState('5');\n  const [columns, setColumns] = useState('5');\n\n  const onClick = () => {\n    activeEditor.dispatchCommand(INSERT_TABLE_COMMAND, { columns, rows });\n    onClose();\n  };\n\n  return (\n    <>\n      <TextInput label=\"No of rows\" onChange={setRows} value={rows} />\n      <TextInput label=\"No of columns\" onChange={setColumns} value={columns} />\n      <div\n        className=\"ToolbarPlugin__dialogActions\"\n        data-test-id=\"table-model-confirm-insert\"\n      >\n        <Button onClick={onClick}>Confirm</Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertPollDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [question, setQuestion] = useState('');\n\n  const onClick = () => {\n    activeEditor.dispatchCommand(INSERT_POLL_COMMAND, question);\n    onClose();\n  };\n\n  return (\n    <>\n      <TextInput label=\"Question\" onChange={setQuestion} value={question} />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button disabled={question.trim() === ''} onClick={onClick}>\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nconst VALID_TWITTER_URL = /twitter.com\\/[0-9a-zA-Z]{1,20}\\/status\\/([0-9]*)/g;\n\nfunction InsertTweetDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [text, setText] = useState('');\n\n  const onClick = () => {\n    const tweetID = text.split('status/')?.[1]?.split('?')?.[0];\n    activeEditor.dispatchCommand(INSERT_TWEET_COMMAND, tweetID);\n    onClose();\n  };\n\n  const isDisabled = text === '' || !text.match(VALID_TWITTER_URL);\n\n  return (\n    <>\n      <TextInput\n        label=\"Tweet URL\"\n        placeholder=\"i.e. https://twitter.com/jack/status/20\"\n        onChange={setText}\n        value={text}\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button disabled={isDisabled} onClick={onClick}>\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertImageUriDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  return (\n    <>\n      <TextInput\n        label=\"Image URL\"\n        placeholder=\"i.e. https://source.unsplash.com/random\"\n        onChange={setSrc}\n        value={src}\n        data-test-id=\"image-modal-url-input\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Random unsplash image\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"image-modal-confirm-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertImageUploadedDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  const loadImage = (files: FileList) => {\n    const reader = new FileReader();\n    reader.onload = function () {\n      if (typeof reader.result === 'string') {\n        setSrc(reader.result);\n      }\n      return '';\n    };\n    reader.readAsDataURL(files[0]);\n  };\n\n  return (\n    <>\n      <FileInput\n        label=\"Image Upload\"\n        onChange={loadImage}\n        accept=\"image/*\"\n        data-test-id=\"image-modal-file-upload\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Descriptive alternative text\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"image-modal-file-upload-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({ altText, src })}\n        >\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertYouTubeDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [text, setText] = useState('');\n\n  const onClick = () => {\n    const videoID = parseYouTubeVideoID(text);\n    if (videoID) {\n      activeEditor.dispatchCommand(INSERT_YOUTUBE_COMMAND, videoID);\n    }\n    onClose();\n  };\n\n  const isDisabled = text === '' || !parseYouTubeVideoID(text);\n\n  return (\n    <>\n      <TextInput\n        data-test-id=\"youtube-embed-modal-url\"\n        label=\"YouTube URL\"\n        placeholder=\"i.e. https://www.youtube.com/watch?v=jNQXAC9IVRw\"\n        onChange={setText}\n        value={text}\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"youtube-embed-modal-submit-btn\"\n          disabled={isDisabled}\n          onClick={onClick}\n        >\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\n//#endregion Inserting different modules\n\nexport interface IInsertDropdownProps {\n  enableTable?: boolean;\n  enableYoutube?: boolean;\n  enableTwitter?: boolean;\n  enablePoll?: boolean;\n  enableImage?: { enable: boolean; maxWidth: number };\n  enableEquations?: boolean;\n  enableExcalidraw?: boolean;\n  enableHorizontalRule?: boolean;\n  enableStickyNote?: boolean;\n}\n\nconst InsertDropdown: React.FC<IInsertDropdownProps> = ({\n  enableTable = true,\n  enableImage = { enable: true, maxWidth: 1000 },\n  enableYoutube = false,\n  enableTwitter = false,\n  enablePoll = false,\n  enableHorizontalRule = false,\n  enableStickyNote = false,\n}: IInsertDropdownProps) => {\n  const { initialEditor, activeEditor } = useContext(EditorContext);\n  const [modal, showModal] = useModal();\n\n  return (\n    <div>\n      {enableTable && (\n        <>\n          <TablePlugin />\n          <TableCellActionMenuPlugin />\n          <TableCellResizer />\n        </>\n      )}\n      {enableYoutube && <YouTubePlugin />}\n      {enableTwitter && <TwitterPlugin />}\n      {enablePoll && <PollPlugin />}\n      {enableImage.enable && <ImagesPlugin maxWidth={enableImage.maxWidth} />}\n      {enableHorizontalRule && <HorizontalRulePlugin />}\n\n      <DropDown\n        buttonClassName=\"toolbar-item spaced\"\n        buttonLabel=\"Insert\"\n        buttonAriaLabel=\"Insert specialized editor node\"\n        buttonIconClassName=\"icon plus\"\n      >\n        {enableHorizontalRule && (\n          <button\n            onClick={() => {\n              activeEditor.dispatchCommand(\n                INSERT_HORIZONTAL_RULE_COMMAND,\n                undefined\n              );\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon horizontal-rule\" />\n            <span className=\"text\">Horizontal Rule</span>\n          </button>\n        )}\n        {enableImage.enable && (\n          <button\n            onClick={() => {\n              showModal('Insert Image', (onClose) => (\n                <InsertImageDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon image\" />\n            <span className=\"text\">Image</span>\n          </button>\n        )}\n        {enableTable && (\n          <div>\n            <button\n              onClick={() => {\n                showModal('Insert Table', (onClose) => (\n                  <InsertTableDialog\n                    activeEditor={activeEditor}\n                    onClose={onClose}\n                  />\n                ));\n              }}\n              className=\"item\"\n              type=\"button\"\n            >\n              <i className=\"icon table\" />\n              <span className=\"text\">Table</span>\n            </button>\n          </div>\n        )}\n        {enablePoll && (\n          <button\n            onClick={() => {\n              showModal('Insert Poll', (onClose) => (\n                <InsertPollDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon poll\" />\n            <span className=\"text\">Poll</span>\n          </button>\n        )}\n        {enableTwitter && (\n          <button\n            onClick={() => {\n              showModal('Insert Tweet', (onClose) => (\n                <InsertTweetDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon tweet\" />\n            <span className=\"text\">Tweet</span>\n          </button>\n        )}\n        {enableYoutube && (\n          <button\n            onClick={() => {\n              showModal('Insert YouTube Video', (onClose) => (\n                <InsertYouTubeDialog\n                  activeEditor={activeEditor}\n                  onClose={onClose}\n                />\n              ));\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon youtube\" />\n            <span className=\"text\">YouTube Video</span>\n          </button>\n        )}\n        {enableStickyNote && (\n          <button\n            onClick={() => {\n              initialEditor.update(() => {\n                const root = $getRoot();\n                const stickyNode = $createStickyNode(0, 0);\n                root.append(stickyNode);\n              });\n            }}\n            className=\"item\"\n            type=\"button\"\n          >\n            <i className=\"icon sticky\" />\n            <span className=\"text\">Sticky Note</span>\n          </button>\n        )}\n      </DropDown>\n      {modal}\n    </div>\n  );\n};\n\nexport default InsertDropdown;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict\n */\n\nimport { CAN_USE_DOM } from './canUseDOM';\n\nconst documentMode =\n  // @ts-ignore\n  CAN_USE_DOM && 'documentMode' in document ? document.documentMode : null;\n\nexport const IS_APPLE: boolean =\n  CAN_USE_DOM && /Mac|iPod|iPhone|iPad/.test(navigator.platform);\n\nexport const IS_FIREFOX: boolean =\n  CAN_USE_DOM && /^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent);\n\nexport const CAN_USE_BEFORE_INPUT: boolean =\n  CAN_USE_DOM && 'InputEvent' in window && !documentMode\n    ? 'getTargetRanges' in new window.InputEvent('input')\n    : false;\n\nexport const IS_SAFARI: boolean =\n  CAN_USE_DOM && /Version\\/[\\d\\.]+.*Safari/.test(navigator.userAgent);\n\nexport const IS_IOS: boolean =\n  CAN_USE_DOM &&\n  /iPad|iPhone|iPod/.test(navigator.userAgent) &&\n  !(window as any).MSStream;\n\n// Keep these in case we need to use them in the future.\n// export const IS_WINDOWS: boolean = CAN_USE_DOM && /Win/.test(navigator.platform);\n// export const IS_CHROME: boolean = CAN_USE_DOM && /^(?=.*Chrome).*/i.test(navigator.userAgent);\n// export const canUseTextInputEvent: boolean = CAN_USE_DOM && 'TextEvent' in window && !documentMode;\n","import * as React from 'react';\nimport { useContext } from 'react';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { UNDO_COMMAND } from 'lexical';\nimport EditorContext from '../../../context/EditorContext';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport { useTranslation } from 'react-i18next';\n\nconst UndoButton = () => {\n  const { canUndo } = useContext(ToolbarContext);\n  const { activeEditor } = useContext(EditorContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <button\n      disabled={!canUndo}\n      onClick={() => {\n        activeEditor.dispatchCommand(UNDO_COMMAND, undefined);\n      }}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:undoButton.Title')} (Z)`\n          : `${t('toolbar:undoButton.Title')} (Ctrl+Z)`\n      }\n      className=\"toolbar-item spaced\"\n      aria-label={t('toolbar:undoButton.Description')}\n      type=\"button\"\n    >\n      <i className=\"format undo\" />\n    </button>\n  );\n};\n\nexport default UndoButton;\n","import * as React from 'react';\nimport { useContext } from 'react';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { REDO_COMMAND } from 'lexical';\nimport EditorContext from '../../../context/EditorContext';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport { useTranslation } from 'react-i18next';\n\nconst RedoButton = () => {\n  const { canRedo } = useContext(ToolbarContext);\n  const { activeEditor } = useContext(EditorContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <button\n      disabled={!canRedo}\n      onClick={() => {\n        activeEditor.dispatchCommand(REDO_COMMAND, undefined);\n      }}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:redoButton.Title')} (Y)`\n          : `${t('toolbar:redoButton.Title')} (Ctrl+Y)`\n      }\n      className=\"toolbar-item\"\n      aria-label={t('toolbar:redoButton.Description')}\n      type=\"button\"\n    >\n      <i className=\"format redo\" />\n    </button>\n  );\n};\n\nexport default RedoButton;\n","import React from 'react';\n\nconst Select = ({\n  onChange,\n  className,\n  options,\n  value,\n}: {\n  className: string;\n  onChange: (event: { target: { value: string } }) => void;\n  options: [string, string][];\n  value: string;\n}): JSX.Element => {\n  return (\n    <select className={className} onChange={onChange} value={value}>\n      {options.map(([option, text]) => (\n        <option key={option} value={option}>\n          {text}\n        </option>\n      ))}\n    </select>\n  );\n};\n\nexport default Select;\n","import { $isCodeNode } from '@lexical/code';\nimport { $getNodeByKey } from 'lexical';\nimport React, { useCallback, useContext } from 'react';\nimport EditorContext from '../../../context/EditorContext';\nimport Select from '../../../ui/Select';\nimport ToolbarContext from '../../../context/ToolbarContext';\n\nconst CODE_LANGUAGE_OPTIONS: [string, string][] = [\n  ['', '- Select language -'],\n  ['c', 'C'],\n  ['clike', 'C-like'],\n  ['css', 'CSS'],\n  ['html', 'HTML'],\n  ['js', 'JavaScript'],\n  ['markdown', 'Markdown'],\n  ['objc', 'Objective-C'],\n  ['plain', 'Plain Text'],\n  ['py', 'Python'],\n  ['rust', 'Rust'],\n  ['sql', 'SQL'],\n  ['swift', 'Swift'],\n  ['xml', 'XML'],\n];\n\nconst CodeLanguageDropdown = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { selectedElementKey, codeLanguage } = useContext(ToolbarContext);\n  const onCodeLanguageSelect = useCallback(\n    (e) => {\n      activeEditor.update(() => {\n        if (selectedElementKey !== null) {\n          const node = $getNodeByKey(selectedElementKey);\n          if ($isCodeNode(node)) {\n            console.log(e.target.value);\n            node.setLanguage(e.target.value);\n          }\n        }\n      });\n    },\n    [activeEditor, selectedElementKey]\n  );\n\n  return (\n    <>\n      <Select\n        className=\"toolbar-item code-language\"\n        onChange={onCodeLanguageSelect}\n        options={CODE_LANGUAGE_OPTIONS}\n        value={codeLanguage}\n      />\n      <i className=\"chevron-down inside\" />\n    </>\n  );\n};\n\nexport default CodeLanguageDropdown;\n","import { $createCodeNode } from '@lexical/code';\nimport {\n  INSERT_CHECK_LIST_COMMAND,\n  INSERT_ORDERED_LIST_COMMAND,\n  INSERT_UNORDERED_LIST_COMMAND,\n  REMOVE_LIST_COMMAND,\n} from '@lexical/list';\nimport { $createHeadingNode, $createQuoteNode } from '@lexical/rich-text';\nimport { $wrapNodes } from '@lexical/selection';\nimport {\n  $createParagraphNode,\n  $getSelection,\n  $isRangeSelection,\n  LexicalEditor,\n} from 'lexical';\nimport React, { useContext } from 'react';\nimport EditorContext from '../../../context/EditorContext';\nimport DropDown from '../../../ui/DropDown';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst BlockFormatDropdown = () => {\n  const { initialEditor } = useContext(EditorContext);\n  const { blockType } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n  const formatParagraph = () => {\n    if (blockType !== 'paragraph') {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          $wrapNodes(selection, () => $createParagraphNode());\n        }\n      });\n    }\n  };\n\n  const formatHeading = (headingSize) => {\n    if (blockType !== headingSize) {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          $wrapNodes(selection, () => $createHeadingNode(headingSize));\n        }\n      });\n    }\n  };\n\n  const formatBulletList = () => {\n    if (blockType !== 'bullet') {\n      initialEditor.dispatchCommand(INSERT_UNORDERED_LIST_COMMAND, undefined);\n    } else {\n      initialEditor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatCheckList = () => {\n    if (blockType !== 'check') {\n      initialEditor.dispatchCommand(INSERT_CHECK_LIST_COMMAND, undefined);\n    } else {\n      initialEditor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatNumberedList = () => {\n    if (blockType !== 'number') {\n      initialEditor.dispatchCommand(INSERT_ORDERED_LIST_COMMAND, undefined);\n    } else {\n      initialEditor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatQuote = () => {\n    if (blockType !== 'quote') {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          $wrapNodes(selection, () => $createQuoteNode());\n        }\n      });\n    }\n  };\n\n  const formatCode = () => {\n    if (blockType !== 'code') {\n      initialEditor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          if (selection.isCollapsed()) {\n            $wrapNodes(selection, () => $createCodeNode());\n          } else {\n            const textContent = selection.getTextContent();\n            const codeNode = $createCodeNode();\n            selection.removeText();\n            selection.insertNodes([codeNode]);\n            selection.insertRawText(textContent);\n          }\n        }\n      });\n    }\n  };\n\n  return (\n    <DropDown\n      buttonLabel={t(`blockFormatDropdown.${blockType}`)}\n      buttonAriaLabel={t('toolbar:blockFormatDropdown.Description')}\n      buttonClassName=\"toolbar-item block-controls\"\n      buttonIconClassName={'icon block-type ' + blockType}\n    >\n      <button className=\"item\" onClick={formatParagraph} type=\"button\">\n        <span className=\"icon paragraph\" />\n        <span className=\"text\">{t('toolbar:blockFormatDropdown.paragraph')}</span>\n        {blockType === 'paragraph' && <span className=\"active\" />}\n      </button>\n      <button\n        className=\"item\"\n        onClick={() => formatHeading('h1')}\n        type=\"button\"\n      >\n        <span className=\"icon h1\" />\n        <span className=\"text\">\n          {t('toolbar:blockFormatDropdown.h1')}\n        </span>\n        {blockType === 'h1' && <span className=\"active\" />}\n      </button>\n      <button\n        className=\"item\"\n        onClick={() => formatHeading('h2')}\n        type=\"button\"\n      >\n        <span className=\"icon h2\" />\n        <span className=\"text\">\n          {t('toolbar:blockFormatDropdown.h2')}\n        </span>\n        {blockType === 'h2' && <span className=\"active\" />}\n      </button>\n      <button\n        className=\"item\"\n        onClick={() => formatHeading('h3')}\n        type=\"button\"\n      >\n        <span className=\"icon h3\" />\n        <span className=\"text\">\n          {t('toolbar:blockFormatDropdown.h3')}\n        </span>\n        {blockType === 'h3' && <span className=\"active\" />}\n      </button>\n      <button className=\"item\" onClick={formatBulletList} type=\"button\">\n        <span className=\"icon bullet-list\" />\n        <span className=\"text\">\n          {t('toolbar:blockFormatDropdown.bullet')}\n        </span>\n        {blockType === 'bullet' && <span className=\"active\" />}\n      </button>\n      <button className=\"item\" onClick={formatNumberedList} type=\"button\">\n        <span className=\"icon numbered-list\" />\n        <span className=\"text\">\n          {t('toolbar:blockFormatDropdown.number')}\n        </span>\n        {blockType === 'number' && <span className=\"active\" />}\n      </button>\n      <button className=\"item\" onClick={formatCheckList} type=\"button\">\n        <span className=\"icon check-list\" />\n        <span className=\"text\">\n          {t('toolbar:blockFormatDropdown.check')}\n        </span>\n        {blockType === 'check' && <span className=\"active\" />}\n      </button>\n      <button className=\"item\" onClick={formatQuote} type=\"button\">\n        <span className=\"icon quote\" />\n        <span className=\"text\">{t('toolbar:blockFormatDropdown.quote')}</span>\n        {blockType === 'quote' && <span className=\"active\" />}\n      </button>\n      <button className=\"item\" onClick={formatCode} type=\"button\">\n        <span className=\"icon code\" />\n        <span className=\"text\">\n          {t('toolbar:blockFormatDropdown.code')}\n        </span>\n        {blockType === 'code' && <span className=\"active\" />}\n      </button>\n    </DropDown>\n  );\n};\n\nexport default BlockFormatDropdown;\n","import React from 'react';\n\nexport default function Divider(): JSX.Element {\n  return <div className=\"divider\" />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { $isCodeNode } from '@lexical/code';\nimport { $isLinkNode, TOGGLE_LINK_COMMAND } from '@lexical/link';\nimport { $isListNode, ListNode } from '@lexical/list';\nimport { $isHeadingNode } from '@lexical/rich-text';\nimport {\n  $getSelectionStyleValueForProperty,\n  $isParentElementRTL,\n  $patchStyleText,\n} from '@lexical/selection';\nimport { $getNearestNodeOfType, mergeRegister } from '@lexical/utils';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  CAN_REDO_COMMAND,\n  CAN_UNDO_COMMAND,\n  COMMAND_PRIORITY_CRITICAL,\n  SELECTION_CHANGE_COMMAND,\n} from 'lexical';\nimport * as React from 'react';\nimport { useCallback, useContext, useEffect, useRef, useState } from 'react';\nimport useChild from 'use-child';\nimport { getSelectedNode } from '../../utils/node.util';\nimport EditorContext from '../../context/EditorContext';\nimport ToolbarContext from '../../context/ToolbarContext';\nimport AlignDropdown from './components/AlignDropdown';\nimport InsertDropdown from './components/InsertDropdown';\nimport './ToolbarPlugin.css';\nimport UndoButton from './components/UndoButton';\nimport RedoButton from './components/RedoButton';\nimport CodeLanguageDropdown from './components/CodeLanguageDropdown';\nimport BlockFormatDropdown from './components/BlockFormatDropdown';\nimport Divider from '../../ui/Divider';\n\nconst supportedBlockTypes = new Set([\n  'paragraph',\n  'quote',\n  'code',\n  'h1',\n  'h2',\n  'h3',\n  'bullet',\n  'number',\n  'check',\n]);\n\nconst CODE_LANGUAGE_MAP = {\n  javascript: 'js',\n  md: 'markdown',\n  plaintext: 'plain',\n  python: 'py',\n  text: 'plain',\n};\n\ninterface IToolbarProps {\n  children?: React.ReactElement | React.ReactElement[];\n  defaultFontSize?: string /** The default selected font size in the toolbar */;\n  defaultFontColor?: string /** The default selected font color in the toolbar */;\n  defaultBgColor?: string /** The default selected background color in the toolbar */;\n  defaultFontFamily?: string /** The default selected font family in the toolbar */;\n}\n\nconst ToolbarPlugin = ({\n  children,\n  defaultFontSize = '15px',\n  defaultFontColor = '#000',\n  defaultBgColor = '#fff',\n  defaultFontFamily = 'Arial',\n}: IToolbarProps) => {\n  const [insertExists, InsertComponent] = useChild(children, InsertDropdown);\n  const [alignExists, AlignComponent] = useChild(children, AlignDropdown);\n\n  const { initialEditor, activeEditor, setActiveEditor } =\n    useContext(EditorContext);\n  const [blockType, setBlockType] = useState('paragraph');\n  const [selectedElementKey, setSelectedElementKey] = useState(null);\n  const [fontSize, setFontSize] = useState<string>(defaultFontSize);\n  const [fontColor, setFontColor] = useState<string>(defaultFontColor);\n  const [bgColor, setBgColor] = useState<string>(defaultBgColor);\n  const [fontFamily, setFontFamily] = useState<string>(defaultFontFamily);\n  const [isLink, setIsLink] = useState(false);\n  const [isBold, setIsBold] = useState(false);\n  const [isItalic, setIsItalic] = useState(false);\n  const [isUnderline, setIsUnderline] = useState(false);\n  const [isStrikethrough, setIsStrikethrough] = useState(false);\n  const [isSubscript, setIsSubscript] = useState(false);\n  const [isSuperscript, setIsSuperscript] = useState(false);\n  const [isCode, setIsCode] = useState(false);\n  const [canUndo, setCanUndo] = useState(false);\n  const [canRedo, setCanRedo] = useState(false);\n  const [isRTL, setIsRTL] = useState(false);\n  const [codeLanguage, setCodeLanguage] = useState<string>('');\n\n  const updateToolbar = useCallback(() => {\n    const selection = $getSelection();\n    if ($isRangeSelection(selection)) {\n      const anchorNode = selection.anchor.getNode();\n      const element =\n        anchorNode.getKey() === 'root'\n          ? anchorNode\n          : anchorNode.getTopLevelElementOrThrow();\n      const elementKey = element.getKey();\n      const elementDOM = activeEditor.getElementByKey(elementKey);\n\n      // Update text format\n      setIsBold(selection.hasFormat('bold'));\n      setIsItalic(selection.hasFormat('italic'));\n      setIsUnderline(selection.hasFormat('underline'));\n      setIsStrikethrough(selection.hasFormat('strikethrough'));\n      setIsSubscript(selection.hasFormat('subscript'));\n      setIsSuperscript(selection.hasFormat('superscript'));\n      setIsCode(selection.hasFormat('code'));\n      setIsRTL($isParentElementRTL(selection));\n\n      // Update links\n      const node = getSelectedNode(selection);\n      const parent = node.getParent();\n      if ($isLinkNode(parent) || $isLinkNode(node)) {\n        setIsLink(true);\n      } else {\n        setIsLink(false);\n      }\n\n      if (elementDOM !== null) {\n        setSelectedElementKey(elementKey);\n        if ($isListNode(element)) {\n          const parentList = $getNearestNodeOfType<ListNode>(\n            anchorNode,\n            ListNode\n          );\n          const type = parentList\n            ? parentList.getListType()\n            : element.getListType();\n          setBlockType(type);\n        } else {\n          const type = $isHeadingNode(element)\n            ? element.getTag()\n            : element.getType();\n          setBlockType(type);\n          if ($isCodeNode(element)) {\n            const language = element.getLanguage();\n            setCodeLanguage(\n              language ? CODE_LANGUAGE_MAP[language] || language : ''\n            );\n            return;\n          }\n        }\n      }\n      // Hande buttons\n      setFontSize(\n        $getSelectionStyleValueForProperty(\n          selection,\n          'font-size',\n          defaultFontSize\n        )\n      );\n      setFontColor(\n        $getSelectionStyleValueForProperty(selection, 'color', defaultFontColor)\n      );\n      setBgColor(\n        $getSelectionStyleValueForProperty(\n          selection,\n          'background-color',\n          defaultBgColor\n        )\n      );\n\n      setFontFamily(\n        $getSelectionStyleValueForProperty(\n          selection,\n          'font-family',\n          defaultFontFamily\n        )\n      );\n    }\n  }, [activeEditor]);\n\n  useEffect(() => {\n    return initialEditor.registerCommand(\n      SELECTION_CHANGE_COMMAND,\n      (_payload, newEditor) => {\n        updateToolbar();\n        setActiveEditor(newEditor);\n        return false;\n      },\n      COMMAND_PRIORITY_CRITICAL\n    );\n  }, [initialEditor, updateToolbar]);\n\n  useEffect(() => {\n    return mergeRegister(\n      activeEditor.registerUpdateListener(({ editorState }) => {\n        editorState.read(() => {\n          updateToolbar();\n        });\n      }),\n      activeEditor.registerCommand<boolean>(\n        CAN_UNDO_COMMAND,\n        (payload) => {\n          setCanUndo(payload);\n          return false;\n        },\n        COMMAND_PRIORITY_CRITICAL\n      ),\n      activeEditor.registerCommand<boolean>(\n        CAN_REDO_COMMAND,\n        (payload) => {\n          setCanRedo(payload);\n          return false;\n        },\n        COMMAND_PRIORITY_CRITICAL\n      )\n    );\n  }, [activeEditor, updateToolbar]);\n\n  const applyStyleText = useCallback(\n    (styles: Record<string, string>) => {\n      activeEditor.update(() => {\n        const selection = $getSelection();\n        if ($isRangeSelection(selection)) {\n          $patchStyleText(selection, styles);\n        }\n      });\n    },\n    [activeEditor]\n  );\n\n  const insertLink = useCallback(() => {\n    if (!isLink) {\n      initialEditor.dispatchCommand(TOGGLE_LINK_COMMAND, 'https://');\n    } else {\n      initialEditor.dispatchCommand(TOGGLE_LINK_COMMAND, null);\n    }\n  }, [initialEditor, isLink]);\n\n  return (\n    <ToolbarContext.Provider\n      value={{\n        isRTL,\n        canUndo,\n        canRedo,\n        fontFamily,\n        fontSize,\n        fontColor,\n        bgColor,\n        isBold,\n        isItalic,\n        isUnderline,\n        isCode,\n        isLink,\n        applyStyleText,\n        insertLink,\n        isStrikethrough,\n        isSubscript,\n        isSuperscript,\n        selectedElementKey,\n        codeLanguage,\n        blockType,\n      }}\n    >\n      <div className=\"toolbar\">\n        <UndoButton />\n        <RedoButton />\n        <Divider />\n        {supportedBlockTypes.has(blockType) && activeEditor === initialEditor && (\n          <>\n            <BlockFormatDropdown />\n            <Divider />\n          </>\n        )}\n        {blockType === 'code' ? (\n          <>\n            <CodeLanguageDropdown />\n            <Divider />\n            {alignExists && AlignComponent}\n          </>\n        ) : (\n          <>{children}</>\n        )}\n      </div>\n    </ToolbarContext.Provider>\n  );\n};\n\nexport default ToolbarPlugin;\n","import { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport {\n  LexicalTypeaheadMenuPlugin,\n  MenuTextMatch,\n  MenuOption,\n  useBasicTypeaheadTriggerMatch,\n} from '@lexical/react/LexicalTypeaheadMenuPlugin';\nimport { TextNode } from 'lexical';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { renderToStaticMarkup } from 'react-dom/server';\nimport { $createMentionNode } from '../nodes/MentionNode';\nimport { $createAutoLinkNode } from '@lexical/link';\n\nimport './MentionsPlugin.css';\n\ntype SearchData<A> = (p: string) => Promise<A[]>;\n\ntype OffsetCard = {\n  leftOffset: number;\n  topOffset: number;\n};\n\ntype PopoverCard<A> = {\n  card: (data: A) => JSX.Element;\n  offset: OffsetCard;\n};\n\ntype UserCard = {\n  card: JSX.Element;\n  offset: OffsetCard;\n};\n\ntype GetTypeaheadValues<A> = (result: A) => {\n  url: string;\n  value: string;\n  picture: JSX.Element;\n  popoverCard?: PopoverCard<A>;\n};\n\nconst PUNCTUATION =\n  '\\\\.,\\\\+\\\\*\\\\?\\\\$\\\\@\\\\|#{}\\\\(\\\\)\\\\^\\\\-\\\\[\\\\]\\\\\\\\/!%\\'\"~=<>_:;';\nconst NAME = '\\\\b[A-Z][^\\\\s' + PUNCTUATION + ']';\n\nconst DocumentMentionsRegex = {\n  NAME,\n  PUNCTUATION,\n};\n\nconst CapitalizedNameMentionsRegex = new RegExp(\n  '(^|[^#])((?:' + DocumentMentionsRegex.NAME + '{' + 1 + ',})$)'\n);\n\nconst PUNC = DocumentMentionsRegex.PUNCTUATION;\n\nconst TRIGGERS = ['@'].join('');\n\n// Chars we expect to see in a mention (non-space, non-punctuation).\nconst VALID_CHARS = '[^' + TRIGGERS + PUNC + '\\\\s]';\n\n// Non-standard series of chars. Each series must be preceded and followed by\n// a valid char.\nconst VALID_JOINS =\n  '(?:' +\n  '\\\\.[ |$]|' + // E.g. \"r. \" in \"Mr. Smith\"\n  ' |' + // E.g. \" \" in \"Josh Duck\"\n  '[' +\n  PUNC +\n  ']|' + // E.g. \"-' in \"Salier-Hellendag\"\n  ')';\n\nconst LENGTH_LIMIT = 75;\n\nconst AtSignMentionsRegex = new RegExp(\n  '(^|\\\\s|\\\\()(' +\n    '[' +\n    TRIGGERS +\n    ']' +\n    '((?:' +\n    VALID_CHARS +\n    VALID_JOINS +\n    '){0,' +\n    LENGTH_LIMIT +\n    '})' +\n    ')$'\n);\n\n// 50 is the longest alias length limit.\nconst ALIAS_LENGTH_LIMIT = 50;\n\n// Regex used to match alias.\nconst AtSignMentionsRegexAliasRegex = new RegExp(\n  '(^|\\\\s|\\\\()(' +\n    '[' +\n    TRIGGERS +\n    ']' +\n    '((?:' +\n    VALID_CHARS +\n    '){0,' +\n    ALIAS_LENGTH_LIMIT +\n    '})' +\n    ')$'\n);\n\n// At most, 5 suggestions are shown in the popup.\nconst SUGGESTION_LIST_LENGTH_LIMIT = 5;\n\nconst mentionsCache = new Map();\n\nfunction useMentionLookupService<A>(\n  mentionString: string | null,\n  mentionData: SearchData<A>\n) {\n  const [results, setResults] = useState<Array<A>>([]);\n\n  useEffect(() => {\n    const cachedResults = mentionsCache.get(mentionString);\n\n    if (mentionString == null) {\n      setResults([]);\n      return;\n    }\n\n    if (cachedResults === null) {\n      return;\n    } else if (cachedResults !== undefined) {\n      setResults(cachedResults);\n      return;\n    }\n\n    mentionsCache.set(mentionString, null);\n\n    mentionData(mentionString).then((results) => {\n      mentionsCache.set(mentionString, results);\n      setResults(results);\n    });\n  }, [mentionString]);\n\n  return results;\n}\n\nfunction checkForCapitalizedNameMentions(\n  text: string,\n  minMatchLength: number\n): MenuTextMatch | null {\n  const match = CapitalizedNameMentionsRegex.exec(text);\n  if (match !== null) {\n    // The strategy ignores leading whitespace but we need to know it's\n    // length to add it to the leadOffset\n    const maybeLeadingWhitespace = match[1];\n\n    const matchingString = match[2];\n    if (matchingString != null && matchingString.length >= minMatchLength) {\n      return {\n        leadOffset: match.index + maybeLeadingWhitespace.length,\n        matchingString,\n        replaceableString: matchingString,\n      };\n    }\n  }\n  return null;\n}\n\nfunction checkForAtSignMentions(\n  text: string,\n  minMatchLength: number\n): MenuTextMatch | null {\n  let match = AtSignMentionsRegex.exec(text);\n\n  if (match === null) {\n    match = AtSignMentionsRegexAliasRegex.exec(text);\n  }\n  if (match !== null) {\n    // The strategy ignores leading whitespace but we need to know it's\n    // length to add it to the leadOffset\n    const maybeLeadingWhitespace = match[1];\n\n    const matchingString = match[3];\n    if (matchingString.length >= minMatchLength) {\n      return {\n        leadOffset: match.index + maybeLeadingWhitespace.length,\n        matchingString,\n        replaceableString: match[2],\n      };\n    }\n  }\n  return null;\n}\n\nfunction getPossibleMenuTextMatch(text: string): MenuTextMatch | null {\n  const match = checkForAtSignMentions(text, 1);\n  return match === null ? checkForCapitalizedNameMentions(text, 3) : match;\n}\n\nclass MentionMenuOption extends MenuOption {\n  name: string;\n  picture: JSX.Element;\n  url: string;\n  userCard: UserCard;\n\n  constructor(\n    name: string,\n    picture: JSX.Element,\n    url?: string,\n    userCard?: UserCard\n  ) {\n    super(name);\n    this.name = name;\n    this.picture = picture;\n    this.url = url;\n    this.userCard = userCard;\n  }\n}\n\nfunction MentionsTypeaheadMenuItem({\n  index,\n  isSelected,\n  onClick,\n  onMouseEnter,\n  option,\n}: {\n  index: number;\n  isSelected: boolean;\n  onClick: () => void;\n  onMouseEnter: () => void;\n  option: MentionMenuOption;\n}) {\n  let className = 'item';\n  if (isSelected) {\n    className += ' selected';\n  }\n  return (\n    <li\n      key={option.key}\n      tabIndex={-1}\n      className={className}\n      ref={option.setRefElement}\n      role=\"option\"\n      aria-selected={isSelected}\n      id={'typeahead-item-' + index}\n      onMouseEnter={onMouseEnter}\n      onClick={onClick}\n    >\n      {option.picture}\n      <span className=\"text\">{option.name}</span>\n    </li>\n  );\n}\n\nexport default function MentionsPlugin<A>(props: {\n  searchData: SearchData<A>;\n  getTypeaheadValues: GetTypeaheadValues<A>;\n}): JSX.Element | null {\n  const { searchData, getTypeaheadValues } = props;\n\n  const [editor] = useLexicalComposerContext();\n\n  const [queryString, setQueryString] = useState<string | null>(null);\n\n  const results = useMentionLookupService(queryString, searchData);\n\n  const checkForSlashTriggerMatch = useBasicTypeaheadTriggerMatch('/', {\n    minLength: 0,\n  });\n\n  const options = useMemo(\n    () =>\n      results\n        .map(\n          (result) =>\n            new MentionMenuOption(\n              getTypeaheadValues(result).value,\n              getTypeaheadValues(result).picture,\n              getTypeaheadValues(result).url,\n              {\n                card: getTypeaheadValues(result).popoverCard.card(result),\n                offset: {\n                  leftOffset:\n                    getTypeaheadValues(result).popoverCard.offset.leftOffset,\n                  topOffset:\n                    getTypeaheadValues(result).popoverCard.offset.topOffset,\n                },\n              }\n            )\n        )\n        .slice(0, SUGGESTION_LIST_LENGTH_LIMIT),\n    [results]\n  );\n\n  const onSelectOption = useCallback(\n    (\n      selectedOption: MentionMenuOption,\n      nodeToReplace: TextNode | null,\n      closeMenu: () => void\n    ) => {\n      editor.update(() => {\n        if (nodeToReplace) {\n          const popover = document.createElement('div');\n          const staticElement = renderToStaticMarkup(\n            selectedOption.userCard.card\n          );\n          popover.innerHTML = staticElement;\n\n          const mentionNode = $createMentionNode(`@${selectedOption.name}`, {\n            card: popover,\n            leftOffset: selectedOption.userCard.offset.leftOffset,\n            topOffset: selectedOption.userCard.offset.topOffset,\n          });\n          const linkNode = $createAutoLinkNode(selectedOption.url);\n          linkNode.append(mentionNode);\n          nodeToReplace.replace(linkNode);\n          linkNode.select();\n        }\n        closeMenu();\n      });\n    },\n    [editor]\n  );\n\n  const checkForMentionMatch = useCallback(\n    (text: string) => {\n      const mentionMatch = getPossibleMenuTextMatch(text);\n      const slashMatch = checkForSlashTriggerMatch(text, editor);\n      return !slashMatch && mentionMatch ? mentionMatch : null;\n    },\n    [checkForSlashTriggerMatch, editor]\n  );\n\n  return (\n    <LexicalTypeaheadMenuPlugin<MentionMenuOption>\n      onQueryChange={setQueryString}\n      onSelectOption={onSelectOption}\n      triggerFn={checkForMentionMatch}\n      options={options}\n      menuRenderFn={(\n        anchorElementRef,\n        { selectedIndex, selectOptionAndCleanUp, setHighlightedIndex }\n      ) =>\n        anchorElementRef && results.length\n          ? ReactDOM.createPortal(\n              <div className=\"typeahead-popover mentions-menu\">\n                <ul>\n                  {options.map((option, i: number) => (\n                    <MentionsTypeaheadMenuItem\n                      index={i}\n                      isSelected={selectedIndex === i}\n                      onClick={() => {\n                        setHighlightedIndex(i);\n                        selectOptionAndCleanUp(option);\n                      }}\n                      onMouseEnter={() => {\n                        setHighlightedIndex(i);\n                      }}\n                      key={option.key}\n                      option={option}\n                    />\n                  ))}\n                </ul>\n              </div>,\n              anchorElementRef.current\n            )\n          : null\n      }\n    />\n  );\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './ColorPicker.css';\n\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport * as React from 'react';\n\nimport DropDown from './DropDown';\n\ninterface ColorPickerProps {\n  buttonAriaLabel?: string;\n  buttonClassName: string;\n  buttonIconClassName?: string;\n  buttonLabel?: string;\n  color?: string;\n  children?: JSX.Element;\n  onChange?: (color: string) => void;\n  title?: string;\n}\n\nconst basicColors = [\n  '#d0021b',\n  '#f5a623',\n  '#f8e71c',\n  '#8b572a',\n  '#7ed321',\n  '#417505',\n  '#bd10e0',\n  '#9013fe',\n  '#4a90e2',\n  '#50e3c2',\n  '#b8e986',\n  '#000000',\n  '#4a4a4a',\n  '#9b9b9b',\n  '#ffffff',\n];\n\nconst WIDTH = 214;\nconst HEIGHT = 150;\n\nexport default function ColorPicker({\n  color,\n  children,\n  onChange,\n  ...rest\n}: Readonly<ColorPickerProps>): JSX.Element {\n  const [selfColor, setSelfColor] = useState(transformColor('hex', color));\n\n  const saturationPosition = useMemo(\n    () => ({\n      x: (selfColor.hsv.s / 100) * WIDTH,\n      y: ((100 - selfColor.hsv.v) / 100) * HEIGHT,\n    }),\n    [selfColor.hsv.s, selfColor.hsv.v]\n  );\n\n  const huePosition = useMemo(\n    () => ({\n      x: (selfColor.hsv.h / 360) * WIDTH,\n    }),\n    [selfColor.hsv]\n  );\n\n  const onMoveSaturation = ({ x, y }: Position) => {\n    const newHsv = {\n      ...selfColor.hsv,\n      s: (x / WIDTH) * 100,\n      v: 100 - (y / HEIGHT) * 100,\n    };\n    const newColor = transformColor('hsv', newHsv);\n    setSelfColor(newColor);\n  };\n\n  const onMoveHue = ({ x }: Position) => {\n    const newHsv = { ...selfColor.hsv, h: (x / WIDTH) * 360 };\n    const newColor = transformColor('hsv', newHsv);\n\n    setSelfColor(newColor);\n  };\n\n  useEffect(() => {\n    onChange(selfColor.hex);\n  }, [selfColor, onChange]);\n\n  useEffect(() => {\n    if (color === undefined) return;\n    setSelfColor(transformColor('hex', color));\n  }, [color]);\n\n  return (\n    <DropDown {...rest} stopCloseOnClickSelf={true}>\n      <div className=\"color-picker-wrapper\" style={{ width: WIDTH }}>\n        <div className=\"color-picker-basic-color\">\n          {basicColors.map((basicColor) => (\n            <button\n              className={basicColor === selfColor.hex ? ' active' : ''}\n              key={basicColor}\n              style={{ backgroundColor: basicColor }}\n              onClick={() => setSelfColor(transformColor('hex', basicColor))}\n              type=\"button\"\n            />\n          ))}\n        </div>\n        <MoveWrapper\n          className=\"color-picker-saturation\"\n          style={{ backgroundColor: `hsl(${selfColor.hsv.h}, 100%, 50%)` }}\n          onChange={onMoveSaturation}\n        >\n          <div\n            className=\"color-picker-saturation_cursor\"\n            style={{\n              backgroundColor: selfColor.hex,\n              left: saturationPosition.x,\n              top: saturationPosition.y,\n            }}\n          />\n        </MoveWrapper>\n        <MoveWrapper className=\"color-picker-hue\" onChange={onMoveHue}>\n          <div\n            className=\"color-picker-hue_cursor\"\n            style={{\n              backgroundColor: `hsl(${selfColor.hsv.h}, 100%, 50%)`,\n              left: huePosition.x,\n            }}\n          />\n        </MoveWrapper>\n        <div className=\"color-picker-info\">\n          <span>{selfColor.hex}</span>\n          <div\n            className=\"color-picker-color\"\n            style={{ backgroundColor: selfColor.hex }}\n          />\n        </div>\n      </div>\n      {children}\n    </DropDown>\n  );\n}\n\nexport interface Position {\n  x: number;\n  y: number;\n}\n\ninterface MoveWrapperProps {\n  className?: string;\n  style?: React.CSSProperties;\n  onChange: (position: Position) => void;\n  children: JSX.Element;\n}\n\nfunction MoveWrapper({\n  className,\n  style,\n  onChange,\n  children,\n}: MoveWrapperProps) {\n  const divRef = useRef<HTMLDivElement>(null);\n\n  const move = (e: React.MouseEvent | MouseEvent): void => {\n    if (divRef.current) {\n      const { current: div } = divRef;\n      const { width, height, left, top } = div.getBoundingClientRect();\n\n      const x = clamp(e.clientX - left, width, 0);\n      const y = clamp(e.clientY - top, height, 0);\n\n      onChange({ x, y });\n    }\n  };\n\n  const onMouseDown = (e: React.MouseEvent): void => {\n    if (e.button !== 0) return;\n\n    move(e);\n\n    const onMouseMove = (_e: MouseEvent): void => {\n      move(_e);\n    };\n\n    const onMouseUp = (_e: MouseEvent): void => {\n      document.removeEventListener('mousemove', onMouseMove, false);\n      document.removeEventListener('mouseup', onMouseUp, false);\n\n      move(_e);\n    };\n\n    document.addEventListener('mousemove', onMouseMove, false);\n    document.addEventListener('mouseup', onMouseUp, false);\n  };\n\n  return (\n    <div\n      ref={divRef}\n      className={className}\n      style={style}\n      onMouseDown={onMouseDown}\n    >\n      {children}\n    </div>\n  );\n}\n\nfunction clamp(value: number, max: number, min: number) {\n  return value > max ? max : value < min ? min : value;\n}\n\ninterface RGB {\n  b: number;\n  g: number;\n  r: number;\n}\ninterface HSV {\n  h: number;\n  s: number;\n  v: number;\n}\ninterface Color {\n  hex: string;\n  hsv: HSV;\n  rgb: RGB;\n}\n\nexport function toHex(value: string): string {\n  if (!value.startsWith('#')) {\n    const ctx = document.createElement('canvas').getContext('2d');\n\n    if (!ctx) {\n      throw new Error('2d context not supported or canvas already initialized');\n    }\n\n    ctx.fillStyle = value;\n\n    return ctx.fillStyle;\n  } else if (value.length === 4 || value.length === 5) {\n    value = value\n      .split('')\n      .map((v, i) => (i ? v + v : '#'))\n      .join('');\n\n    return value;\n  } else if (value.length === 7 || value.length === 9) {\n    return value;\n  }\n\n  return '#000000';\n}\n\nfunction hex2rgb(hex: string): RGB {\n  const rbgArr = hex\n    .replace(\n      /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i,\n      (m, r, g, b) => '#' + r + r + g + g + b + b\n    )\n    .substring(1)\n    .match(/.{2}/g)\n    .map((x) => parseInt(x, 16));\n\n  return {\n    b: rbgArr[2],\n    g: rbgArr[1],\n    r: rbgArr[0],\n  };\n}\n\nfunction rgb2hsv({ r, g, b }: RGB): HSV {\n  r /= 255;\n  g /= 255;\n  b /= 255;\n\n  const max = Math.max(r, g, b);\n  const d = max - Math.min(r, g, b);\n\n  const h = d\n    ? (max === r\n        ? (g - b) / d + (g < b ? 6 : 0)\n        : max === g\n        ? 2 + (b - r) / d\n        : 4 + (r - g) / d) * 60\n    : 0;\n  const s = max ? (d / max) * 100 : 0;\n  const v = max * 100;\n\n  return { h, s, v };\n}\n\nfunction hsv2rgb({ h, s, v }: HSV): RGB {\n  s /= 100;\n  v /= 100;\n\n  const i = ~~(h / 60);\n  const f = h / 60 - i;\n  const p = v * (1 - s);\n  const q = v * (1 - s * f);\n  const t = v * (1 - s * (1 - f));\n  const index = i % 6;\n\n  const r = Math.round([v, q, p, p, t, v][index] * 255);\n  const g = Math.round([t, v, v, q, p, p][index] * 255);\n  const b = Math.round([p, p, t, v, v, q][index] * 255);\n\n  return { b, g, r };\n}\n\nfunction rgb2hex({ b, g, r }: RGB): string {\n  return '#' + [r, g, b].map((x) => x.toString(16).padStart(2, '0')).join('');\n}\n\nfunction transformColor<M extends keyof Color, C extends Color[M]>(\n  format: M,\n  color: C\n): Color {\n  let hex: Color['hex'] = toHex('#121212');\n  let rgb: Color['rgb'] = hex2rgb(hex);\n  let hsv: Color['hsv'] = rgb2hsv(rgb);\n\n  if (format === 'hex') {\n    const value = color as Color['hex'];\n\n    hex = toHex(value);\n    rgb = hex2rgb(hex);\n    hsv = rgb2hsv(rgb);\n  } else if (format === 'rgb') {\n    const value = color as Color['rgb'];\n\n    rgb = value;\n    hex = rgb2hex(rgb);\n    hsv = rgb2hsv(rgb);\n  } else if (format === 'hsv') {\n    const value = color as Color['hsv'];\n\n    hsv = value;\n    rgb = hsv2rgb(hsv);\n    hex = rgb2hex(rgb);\n  }\n\n  return { hex, hsv, rgb };\n}\n","import React, { useCallback, useContext } from 'react';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport ColorPicker from '../../../ui/ColorPicker';\nimport { useTranslation } from 'react-i18next';\n\nconst BackgroundColorPicker = () => {\n  const { bgColor, applyStyleText } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  const onBgColorSelect = useCallback(\n    (value: string) => {\n      applyStyleText({ 'background-color': value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <ColorPicker\n      buttonClassName=\"toolbar-item color-picker\"\n      buttonAriaLabel={t('toolbar:backgroundColorPicker.Description')}\n      buttonIconClassName=\"icon bg-color\"\n      color={bgColor}\n      onChange={onBgColorSelect}\n      title=\"bg color\"\n    />\n  );\n};\n\nexport default BackgroundColorPicker;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst BoldButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isBold } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'bold');\n      }}\n      className={'toolbar-item spaced ' + (isBold ? 'active' : '')}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:boldButton.Title')} (B)`\n          : `${t('toolbar:boldButton.Title')} (Ctrl + B)`\n      }\n      aria-label={`${t('toolbar:boldButton.Description')} ${\n        IS_APPLE ? 'B' : 'Ctrl+B'\n      }`}\n      type=\"button\"\n    >\n      <i className=\"format bold\" />\n    </button>\n  );\n};\n\nexport default BoldButton;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\n\nconst CodeFormatButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isCode } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'code');\n      }}\n      className={'toolbar-item spaced ' + (isCode ? 'active' : '')}\n      title={t('toolbar:codeFormatButton.Description')}\n      aria-label={t('toolbar:codeFormatButton.Description')}\n      type=\"button\"\n    >\n      <i className=\"format code\" />\n    </button>\n  );\n};\n\nexport default CodeFormatButton;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './LinkPreview.css';\n\nimport * as React from 'react';\nimport { Suspense } from 'react';\n\n// Cached responses or running request promises\nconst PREVIEW_CACHE = {};\n\nconst URL_MATCHER =\n  /((https?:\\/\\/(www\\.)?)|(www\\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/;\n\nfunction useSuspenseRequest(url: string) {\n  let cached = PREVIEW_CACHE[url];\n\n  if (!url.match(URL_MATCHER)) {\n    return { preview: null };\n  }\n\n  if (!cached) {\n    cached = PREVIEW_CACHE[url] = fetch(\n      `/api/link-preview?url=${encodeURI(url)}`\n    )\n      .then((response) => response.json())\n      .then((preview) => {\n        PREVIEW_CACHE[url] = preview;\n        return preview;\n      })\n      .catch(() => {\n        PREVIEW_CACHE[url] = { preview: null };\n      });\n  }\n\n  if (cached instanceof Promise) {\n    throw cached;\n  }\n\n  return cached;\n}\n\nfunction LinkPreviewContent({\n  url,\n}: Readonly<{\n  url: string;\n}>): JSX.Element {\n  const { preview } = useSuspenseRequest(url);\n  if (preview === null) {\n    return null;\n  }\n  return (\n    <div className=\"LinkPreview__container\">\n      {preview.img && (\n        <div className=\"LinkPreview__imageWrapper\">\n          <img\n            src={preview.img}\n            alt={preview.title}\n            className=\"LinkPreview__image\"\n          />\n        </div>\n      )}\n      {preview.domain && (\n        <div className=\"LinkPreview__domain\">{preview.domain}</div>\n      )}\n      {preview.title && (\n        <div className=\"LinkPreview__title\">{preview.title}</div>\n      )}\n      {preview.description && (\n        <div className=\"LinkPreview__description\">{preview.description}</div>\n      )}\n    </div>\n  );\n}\n\nfunction Glimmer(props): JSX.Element {\n  return (\n    <div\n      className=\"LinkPreview__glimmer\"\n      {...props}\n      style={{\n        animationDelay: (props.index || 0) * 300,\n        ...(props.style || {}),\n      }}\n    />\n  );\n}\n\nexport default function LinkPreview({\n  url,\n}: Readonly<{\n  url: string;\n}>): JSX.Element {\n  return (\n    <Suspense\n      fallback={\n        <>\n          <Glimmer style={{ height: '80px' }} index={0} />\n          <Glimmer style={{ width: '60%' }} index={1} />\n          <Glimmer style={{ width: '80%' }} index={2} />\n        </>\n      }\n    >\n      <LinkPreviewContent url={url} />\n    </Suspense>\n  );\n}\n","import { $isLinkNode, TOGGLE_LINK_COMMAND } from '@lexical/link';\nimport { $isAtNodeEnd } from '@lexical/selection';\nimport { mergeRegister } from '@lexical/utils';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_LOW,\n  ElementNode,\n  LexicalEditor,\n  RangeSelection,\n  SELECTION_CHANGE_COMMAND,\n  TextNode,\n} from 'lexical';\nimport React from 'react';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport LinkPreview from '../../../ui/LinkPreview';\nimport { getSelectedNode } from '../../../utils/node.util';\n\nfunction positionEditorElement(editor, rect) {\n  if (rect === null) {\n    editor.style.opacity = '0';\n    editor.style.top = '-1000px';\n    editor.style.left = '-1000px';\n  } else {\n    editor.style.opacity = '1';\n    editor.style.top = `${rect.top + rect.height + window.pageYOffset + 10}px`;\n    editor.style.left = `${\n      rect.left + window.pageXOffset - editor.offsetWidth / 2 + rect.width / 2\n    }px`;\n  }\n}\n\nfunction FloatingLinkEditor({\n  editor,\n}: {\n  editor: LexicalEditor;\n}): JSX.Element {\n  const editorRef = useRef<HTMLDivElement | null>(null);\n  const inputRef = useRef(null);\n  const [linkUrl, setLinkUrl] = useState('');\n  const [isEditMode, setEditMode] = useState(false);\n  const [lastSelection, setLastSelection] = useState(null);\n\n  const updateLinkEditor = useCallback(() => {\n    const selection = $getSelection();\n    if ($isRangeSelection(selection)) {\n      const node = getSelectedNode(selection);\n      const parent = node.getParent();\n      if ($isLinkNode(parent)) {\n        setLinkUrl(parent.getURL());\n      } else if ($isLinkNode(node)) {\n        setLinkUrl(node.getURL());\n      } else {\n        setLinkUrl('');\n      }\n    }\n    const editorElem = editorRef.current;\n    const nativeSelection = window.getSelection();\n    const activeElement = document.activeElement;\n\n    if (editorElem === null) {\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n    if (\n      selection !== null &&\n      !nativeSelection.isCollapsed &&\n      rootElement !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const domRange = nativeSelection.getRangeAt(0);\n      let rect;\n      if (nativeSelection.anchorNode === rootElement) {\n        let inner = rootElement;\n        while (inner.firstElementChild != null) {\n          inner = inner.firstElementChild as HTMLElement;\n        }\n        rect = inner.getBoundingClientRect();\n      } else {\n        rect = domRange.getBoundingClientRect();\n      }\n\n      positionEditorElement(editorElem, rect);\n      setLastSelection(selection);\n    } else if (!activeElement || activeElement.className !== 'link-input') {\n      positionEditorElement(editorElem, null);\n      setLastSelection(null);\n      setEditMode(false);\n      setLinkUrl('');\n    }\n\n    return true;\n  }, [editor]);\n\n  useEffect(() => {\n    const onResize = () => {\n      editor.getEditorState().read(() => {\n        updateLinkEditor();\n      });\n    };\n    window.addEventListener('resize', onResize);\n\n    return () => {\n      window.removeEventListener('resize', onResize);\n    };\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerUpdateListener(({ editorState }) => {\n        editorState.read(() => {\n          updateLinkEditor();\n        });\n      }),\n\n      editor.registerCommand(\n        SELECTION_CHANGE_COMMAND,\n        () => {\n          updateLinkEditor();\n          return true;\n        },\n        COMMAND_PRIORITY_LOW\n      )\n    );\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      updateLinkEditor();\n    });\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    if (isEditMode && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [isEditMode]);\n\n  return (\n    <div ref={editorRef} className=\"link-editor\">\n      {isEditMode ? (\n        <input\n          ref={inputRef}\n          className=\"link-input\"\n          value={linkUrl}\n          onChange={(event) => {\n            setLinkUrl(event.target.value);\n          }}\n          onKeyDown={(event) => {\n            if (event.key === 'Enter') {\n              event.preventDefault();\n              if (lastSelection !== null) {\n                if (linkUrl !== '') {\n                  editor.dispatchCommand(TOGGLE_LINK_COMMAND, linkUrl);\n                }\n                setEditMode(false);\n              }\n            } else if (event.key === 'Escape') {\n              event.preventDefault();\n              setEditMode(false);\n            }\n          }}\n        />\n      ) : (\n        <>\n          <div className=\"link-input\">\n            <a href={linkUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n              {linkUrl}\n            </a>\n            <div\n              className=\"link-edit\"\n              role=\"button\"\n              tabIndex={0}\n              onMouseDown={(event) => event.preventDefault()}\n              onClick={() => {\n                setEditMode(true);\n              }}\n            />\n          </div>\n          <LinkPreview url={linkUrl} />\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default FloatingLinkEditor;\n","import React, { useCallback, useContext } from 'react';\nimport Select from '../../../ui/Select';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { FontOptions } from '../../../types';\n\nconst defaultFontFamilyOptions: FontOptions = [\n  ['Arial', 'Arial'],\n  ['Courier New', 'Courier New'],\n  ['Georgia', 'Georgia'],\n  ['Times New Roman', 'Times New Roman'],\n  ['Trebuchet MS', 'Trebuchet MS'],\n  ['Verdana', 'Verdana'],\n];\n\ninterface IFontFamilyDropdown {\n  fontOptions?: FontOptions;\n}\n\nconst FontFamilyDropdown = ({\n  fontOptions = defaultFontFamilyOptions,\n}: IFontFamilyDropdown) => {\n  const { fontFamily, applyStyleText } = useContext(ToolbarContext);\n\n  const onFontFamilySelect = useCallback(\n    (e) => {\n      applyStyleText({ 'font-family': e.target.value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <>\n      <Select\n        className=\"toolbar-item font-family\"\n        onChange={onFontFamilySelect}\n        options={fontOptions}\n        value={fontFamily}\n      />\n      <i className=\"chevron-down inside\" />\n    </>\n  );\n};\n\nexport default FontFamilyDropdown;\n","import React, { useCallback, useContext } from 'react';\nimport Select from '../../../ui/Select';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { FontOptions } from '../../../types';\n\nconst defaultFontSizeOptions: FontOptions = [\n  ['10px', '10px'],\n  ['11px', '11px'],\n  ['12px', '12px'],\n  ['13px', '13px'],\n  ['14px', '14px'],\n  ['15px', '15px'],\n  ['16px', '16px'],\n  ['17px', '17px'],\n  ['18px', '18px'],\n  ['19px', '19px'],\n  ['20px', '20px'],\n];\n\ninterface IFontSizeDropdown {\n  fontSizeOptions?: FontOptions;\n}\n\nconst FontSizeDropdown = ({\n  fontSizeOptions = defaultFontSizeOptions,\n}: IFontSizeDropdown) => {\n  const { fontSize, applyStyleText } = useContext(ToolbarContext);\n\n  const onFontSizeSelect = useCallback(\n    (e) => {\n      applyStyleText({ 'font-size': e.target.value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <>\n      <Select\n        className=\"toolbar-item font-size\"\n        onChange={onFontSizeSelect}\n        options={fontSizeOptions}\n        value={fontSize}\n      />\n      <i className=\"chevron-down inside\" />\n    </>\n  );\n};\n\nexport default FontSizeDropdown;\n","import React from 'react';\nimport { useContext } from 'react';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport FloatingLinkEditor from './FloatingLinkEditor';\nimport { createPortal } from 'react-dom';\nimport { useTranslation } from 'react-i18next';\n\nconst InsertLinkButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isLink, insertLink } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <>\n      <button\n        onClick={insertLink}\n        className={'toolbar-item spaced ' + (isLink ? 'active' : '')}\n        aria-label={t('toolbar:insertLinkButton.Description')}\n        title={t('toolbar:insertLinkButton.Description')}\n        type=\"button\"\n      >\n        <i className=\"format link\" />\n      </button>\n      {isLink &&\n        createPortal(\n          <FloatingLinkEditor editor={activeEditor} />,\n          document.body\n        )}\n    </>\n  );\n};\n\nexport default InsertLinkButton;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst ItalicButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isItalic } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'italic');\n      }}\n      className={'toolbar-item spaced ' + (isItalic ? 'active' : '')}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:italicButton.Title')} (I)`\n          : `${t('toolbar:italicButton.Title')} (Ctrl+I)`\n      }\n      aria-label={`${t('toolbar:italicButton.Description')} ${\n        IS_APPLE ? 'I' : 'Ctrl+I'\n      }`}\n      type=\"button\"\n    >\n      <i className=\"format italic\" />\n    </button>\n  );\n};\n\nexport default ItalicButton;\n","import React, { useCallback, useContext } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport ColorPicker from '../../../ui/ColorPicker';\n\nconst TextColorPicker = () => {\n  const { fontColor, applyStyleText } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  const onFontColorSelect = useCallback(\n    (value: string) => {\n      applyStyleText({ color: value });\n    },\n    [applyStyleText]\n  );\n\n  return (\n    <ColorPicker\n      buttonClassName=\"toolbar-item color-picker\"\n      buttonAriaLabel={t('toolbar:textColorPicker.Description')}\n      buttonIconClassName=\"icon font-color\"\n      color={fontColor}\n      onChange={onFontColorSelect}\n      title=\"text color\"\n    />\n  );\n};\n\nexport default TextColorPicker;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React, { useContext } from 'react';\nimport DropDown from '../../../ui/DropDown';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst TextFormatDropdown = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isStrikethrough, isSubscript, isSuperscript } =\n    useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n  return (\n    <DropDown\n      buttonClassName=\"toolbar-item spaced\"\n      buttonLabel=\"\"\n      buttonAriaLabel={t('toolbar:textFormatDropdown.Description')}\n      buttonIconClassName=\"icon dropdown-more\"\n    >\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'strikethrough');\n        }}\n        className={\n          'item ' + (isStrikethrough ? 'active dropdown-item-active' : '')\n        }\n        title={t('toolbar:textFormatDropdown.Options.Strikethrough.Label')}\n        aria-label={t(\n          'toolbar:textFormatDropdown.Options.Strikethrough.Description'\n        )}\n        type=\"button\"\n      >\n        <i className=\"icon strikethrough\" />\n        <span className=\"text\">\n          {t('toolbar:textFormatDropdown.Options.Strikethrough.Label')}\n        </span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'subscript');\n        }}\n        className={'item ' + (isSubscript ? 'active dropdown-item-active' : '')}\n        title={t('toolbar:textFormatDropdown.Options.Subscript.Label')}\n        aria-label={t(\n          'toolbar:textFormatDropdown.Options.Subscript.Description'\n        )}\n        type=\"button\"\n      >\n        <i className=\"icon subscript\" />\n        <span className=\"text\">\n          {t('toolbar:textFormatDropdown.Options.Subscript.Label')}\n        </span>\n      </button>\n      <button\n        onClick={() => {\n          activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'superscript');\n        }}\n        className={\n          'item ' + (isSuperscript ? 'active dropdown-item-active' : '')\n        }\n        title={t('toolbar:textFormatDropdown.Options.Superscript.Label')}\n        aria-label={t(\n          'toolbar:textFormatDropdown.Options.Superscript.Description'\n        )}\n        type=\"button\"\n      >\n        <i className=\"icon superscript\" />\n        <span className=\"text\">\n          {t('toolbar:textFormatDropdown.Options.Superscript.Label')}\n        </span>\n      </button>\n    </DropDown>\n  );\n};\n\nexport default TextFormatDropdown;\n","import { FORMAT_TEXT_COMMAND } from 'lexical';\nimport React from 'react';\nimport { useContext } from 'react';\nimport { IS_APPLE } from '../../../shared/src/environment';\nimport EditorContext from '../../../context/EditorContext';\nimport ToolbarContext from '../../../context/ToolbarContext';\nimport { useTranslation } from 'react-i18next';\n\nconst UnderlineButton = () => {\n  const { activeEditor } = useContext(EditorContext);\n  const { isUnderline } = useContext(ToolbarContext);\n  const { t } = useTranslation('toolbar');\n\n  return (\n    <button\n      onClick={() => {\n        activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'underline');\n      }}\n      className={'toolbar-item spaced ' + (isUnderline ? 'active' : '')}\n      title={\n        IS_APPLE\n          ? `${t('toolbar:underlineButton.Title')} (U)`\n          : `${t('toolbar:underlineButton.Title')} (Ctrl+U)`\n      }\n      aria-label={`${t('toolbar:underlineButton.Description')} ${\n        IS_APPLE ? 'U' : 'Ctrl+U'\n      }`}\n      type=\"button\"\n    >\n      <i className=\"format underline\" />\n    </button>\n  );\n};\n\nexport default UnderlineButton;\n","import {\n  $getSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n  LexicalCommand,\n} from 'lexical';\nimport {\n  $createCustomFieldNode,\n  CustomFieldNode,\n} from '../nodes/CustomFieldNode';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport * as React from 'react';\n\ntype Params = { text: string; id?: string };\n\nconst INSERT_CUSTOM_FIELD_COMMAND: LexicalCommand<Params> = createCommand();\n\nexport default function CustomFieldPlugin({\n  listStyle = {},\n  itemStyle = {},\n  record = {},\n}: {\n  listStyle: Record<string, any>;\n  itemStyle: Record<string, any>;\n  record?: Record<string, any>;\n}) {\n  const [editor] = useLexicalComposerContext();\n\n  React.useEffect(() => {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    if (!editor.hasNodes([CustomFieldNode])) {\n      throw new Error(\n        'CustomFieldPlugin: CustomFieldNode not registered on editor'\n      );\n    }\n\n    return editor.registerCommand(\n      INSERT_CUSTOM_FIELD_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n        const customFieldNode = $createCustomFieldNode(\n          payload.text,\n          payload.id\n        );\n\n        selection.insertNodes([customFieldNode]);\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR\n    );\n  }, [editor]);\n\n  const onClick = (params: Params) => {\n    editor.update(() => {\n      editor.dispatchCommand(INSERT_CUSTOM_FIELD_COMMAND, params);\n    });\n  };\n\n  const entries = Object.entries(record);\n\n  return (\n    <div style={listStyle}>\n      {entries.map(([key, value]) => (\n        <div\n          key={key}\n          style={itemStyle}\n          onClick={() => onClick({ text: value, id: key })}\n        >\n          {value}\n        </div>\n      ))}\n    </div>\n  );\n}\n","import type { LexicalEditor, NodeKey } from 'lexical';\n\nimport * as React from 'react';\nimport { Suspense, useRef } from 'react';\n\nconst imageCache = new Set();\n\nfunction useSuspenseImage(src: string) {\n  if (!imageCache.has(src)) {\n    throw new Promise((resolve) => {\n      const img = new Image();\n      img.src = src;\n      img.onload = () => {\n        imageCache.add(src);\n        resolve(null);\n      };\n    });\n  }\n}\n\nfunction LazyImage({\n  altText,\n  className,\n  imageRef,\n  src,\n  width,\n  height,\n  maxWidth,\n}: {\n  altText: string;\n  className: string | null;\n  height: 'inherit' | number;\n  imageRef: { current: null | HTMLImageElement };\n  maxWidth: number;\n  src: string;\n  width: 'inherit' | number;\n}): JSX.Element {\n  useSuspenseImage(src);\n  return (\n    <img\n      className={className || undefined}\n      src={src}\n      alt={altText}\n      ref={imageRef}\n      style={{\n        height,\n        maxWidth,\n        width,\n      }}\n    />\n  );\n}\n\nexport default function ImageComponent({\n  src,\n  altText,\n  width,\n  height,\n  maxWidth,\n}: {\n  altText: string;\n  caption: LexicalEditor;\n  height: 'inherit' | number;\n  maxWidth: number;\n  nodeKey: NodeKey;\n  resizable: boolean;\n  showCaption: boolean;\n  src: string;\n  width: 'inherit' | number;\n  captionsEnabled: boolean;\n}): JSX.Element {\n  const imageRef = useRef<null | HTMLImageElement>(null);\n\n  return (\n    <Suspense fallback={null}>\n      <>\n        <div>\n          <LazyImage\n            className=\"\"\n            src={src}\n            altText={altText}\n            imageRef={imageRef}\n            width={width}\n            height={height}\n            maxWidth={maxWidth}\n          />\n        </div>\n      </>\n    </Suspense>\n  );\n}\n"],"names":["__className","EmojiNode","TextNode","getType","clone","node","__text","__key","constructor","className","text","key","createDOM","config","dom","document","createElement","inner","appendChild","updateDOM","prevNode","firstChild","importJSON","serializedNode","$createEmojiNode","setFormat","format","setDetail","detail","setMode","mode","setStyle","style","exportJSON","getClassName","type","self","getLatest","emojiText","ImageComponent","React","convertImageElement","domNode","HTMLImageElement","alt","altText","src","width","height","$createImageNode","ImageNode","DecoratorNode","maxWidth","showCaption","caption","captionsEnabled","__src","__altText","__maxWidth","__width","__height","__showCaption","__caption","createEditor","__captionsEnabled","undefined","nestedEditor","editorState","parseEditorState","isEmpty","setEditorState","exportDOM","element","setAttribute","toString","importDOM","img","conversion","priority","getAltText","toJSON","getSrc","version","setWidthAndHeight","writable","getWritable","setShowCaption","span","theme","image","decorate","Suspense","fallback","nodeKey","getKey","resizable","$applyNodeReplacement","$isImageNode","KeywordNode","$createKeywordNode","cursor","canInsertTextBefore","canInsertTextAfter","isTextEntity","keyword","mentionStyle","MentionNode","mentionName","popover","existingPopover","getElementById","__popoverCard","card","id","parentElement","removeChild","__mention","position","removePopover","$createMentionNode","setTextContent","cssText","addEventListener","event","left","top","getBoundingClientRect","leftOffset","topOffset","body","mentionNode","toggleDirectionless","joinClasses","args","filter","Boolean","join","Button","dataTestId","children","onClick","disabled","small","title","createUID","Math","random","replace","substr","createPollOption","uid","votes","cloneOption","option","Array","from","getTotalVotes","options","reduce","totalVotes","next","length","PollOptionComponent","index","withPollNode","clientID","useCollaborationContext","checkboxRef","useRef","votesArray","checkedIndex","indexOf","checked","ref","onChange","e","toggleVote","value","setOptionText","target","placeholder","deleteOption","PollComponent","question","editor","useLexicalComposerContext","useMemo","cb","update","$getNodeByKey","$isPollNode","addOption","map","convertPollElement","getAttribute","$createPollNode","PollNode","__question","__options","forEach","push","splice","clonedOption","votesClone","voteIndex","hasAttribute","elem","display","CAN_USE_DOM","window","useLayoutEffectImpl","useLayoutEffect","useEffect","url","URL","location","href","params","URLSearchParams","search","WEBSOCKET_ENDPOINT","WEBSOCKET_SLUG","WEBSOCKET_ID","get","createWebsocketProvider","yjsDocMap","doc","Doc","set","load","WebsocketProvider","connect","Context","createContext","historyState","current","redoStack","undoStack","useSharedHistoryContext","useContext","characterLimit","code","codeHighlight","atrule","attr","boolean","builtin","cdata","char","class","comment","constant","deleted","doctype","entity","function","important","inserted","namespace","number","operator","prolog","property","punctuation","regex","selector","string","symbol","tag","variable","hashtag","heading","h1","h2","h3","h4","h5","link","list","listitem","listitemChecked","listitemUnchecked","nested","olDepth","ul","ltr","mark","markOverlap","paragraph","quote","rtl","table","tableCell","tableCellHeader","bold","italic","strikethrough","subscript","superscript","underline","underlineStrikethrough","baseTheme","LexicalContentEditable","ContentEditable","Placeholder","positionSticky","stickyElem","positioning","rootElementRect","rectLeft","rectTop","y","x","StickyComponent","color","stickyContainerRef","positioningRef","isDragging","offsetX","offsetY","isCollab","stickyContainer","resizeObserver","ResizeObserver","entries","i","entry","removeRootListener","registerRootListener","nextRootElem","prevRootElem","unobserve","observe","handleWindowResize","rootElement","getRootElement","removeEventListener","setTimeout","setProperty","handlePointerMove","pageX","pageY","handlePointerUp","classList","remove","$isStickyNode","setPosition","handleDelete","handleColorChange","toggleColor","onPointerDown","button","stickContainer","clientX","clientY","add","preventDefault","LexicalNestedComposer","initialEditor","initialTheme","StickyEditorTheme","CollaborationPlugin","providerFactory","shouldBootstrap","HistoryPlugin","externalHistoryState","PlainTextPlugin","contentEditable","ErrorBoundary","LexicalErrorBoundary","StickyNode","__x","__y","__color","xOffset","yOffset","div","$setSelection","createPortal","isIsolated","$createStickyNode","WIDGET_SCRIPT_URL","convertTweetElement","$createTweetNode","isTwitterScriptLoading","TweetComponent","loadingComponent","onError","onLoad","tweetID","containerRef","previousTweetIDRef","isTweetLoading","setIsTweetLoading","useState","createTweet","useCallback","twttr","widgets","error","String","script","async","onload","onerror","BlockWithAlignableContents","TweetNode","DecoratorBlockNode","__id","__format","getId","embedBlockTheme","embedBlock","base","focus","isTopLevel","$isTweetNode","TypeaheadNode","$createTypeaheadNode","YouTubeComponent","videoID","frameBorder","allow","allowFullScreen","YouTubeNode","$createYouTubeNode","_editor","CustomFieldNode","innerHTML","getText","$createCustomFieldNode","PlaygroundNodes","HeadingNode","ListNode","ListItemNode","QuoteNode","CodeNode","TableNode","TableCellNode","TableRowNode","HashtagNode","CodeHighlightNode","AutoLinkNode","LinkNode","OverflowNode","HorizontalRuleNode","MarkNode","resources","ar","de","en","EN","es","fr","FR","it","ja","nl","pl","pt","ptBr","PTBR","ru","RU","ukr","zh","languageDetector","detect","callback","language","navigator","substring","init","cacheUserLanguage","i18n","i18next","ns","fallbackLng","debug","interpolation","escapeValue","err","t","use","EditorComposer","initialEditorState","extraNodes","editable","initialConfig","nodes","PlaygroundEditorTheme","LexicalComposer","I18nextProvider","hostName","hostname","isDevPlayground","DEFAULT_SETTINGS","disableBeforeInput","emptyEditor","isAutocomplete","isCharLimit","isCharLimitUtf8","isRichText","measureTypingPerf","showNestedEditorTreeView","showTreeView","setOption","name","settings","useSettings","PortalImpl","onClose","closeOnClickOutside","modalRef","modalOverlayElement","handler","keyCode","clickOutsideHandler","contains","role","tabIndex","Modal","useModal","modalContent","setModalContent","modal","content","showModal","getContent","HR","dependencies","export","$isHorizontalRuleNode","regExp","parentNode","_1","_2","isImport","line","$createHorizontalRuleNode","getNextSibling","insertBefore","selectNext","IMAGE","exportChildren","exportFormat","importRegExp","textNode","match","imageNode","trigger","TWEET","tweetNode","TABLE_ROW_REG_EXP","TABLE","$isTableNode","output","row","getChildren","rowOutput","$isTableRowNode","cell","$isElementNode","matchCells","mapToTableCells","rows","sibling","getPreviousSibling","maxCells","$isParagraphNode","getChildrenSize","getFirstChild","$isTextNode","cells","getTextContent","max","unshift","previousSibling","$createTableNode","tableRow","$createTableRowNode","append","createTableCell","getTableColumnsSize","selectEnd","textContent","$createTableCellNode","TableCellHeaderStates","NO_STATUS","$createParagraphNode","$createTextNode","trim","split","PLAYGROUND_TRANSFORMERS","CHECK_LIST","ELEMENT_TRANSFORMERS","TEXT_FORMAT_TRANSFORMERS","TEXT_MATCH_TRANSFORMERS","getElement","fontSize","transform","padding","background","borderRadius","useReport","timer","cleanup","clearTimeout","console","log","SPEECH_TO_TEXT_COMMAND","createCommand","VOICE_COMMANDS","selection","insertParagraph","redo","dispatchCommand","REDO_COMMAND","undo","UNDO_COMMAND","SUPPORT_SPEECH_RECOGNITION","SpeechToTextPlugin","isEnabled","setIsEnabled","SpeechRecognition","webkitSpeechRecognition","recognition","report","continuous","interimResults","resultItem","results","item","resultIndex","transcript","isFinal","$getSelection","$isRangeSelection","command","toLowerCase","insertText","start","stop","registerCommand","_isEnabled","COMMAND_PRIORITY_EDITOR","ActionsPlugin","isEditable","setIsEditable","isSpeechToText","setIsSpeechToText","connected","setConnected","isEditorEmpty","setIsEditorEmpty","useTranslation","mergeRegister","registerEditableListener","CONNECTED_COMMAND","payload","isConnected","registerUpdateListener","getEditorState","read","root","$getRoot","paragraphChildren","handleMarkdownToggle","$isCodeNode","getLanguage","$convertFromMarkdownString","markdown","$convertToMarkdownString","clear","$createCodeNode","importFile","exportFile","fileName","Date","toISOString","source","ShowClearDialog","setEditable","TOGGLE_CONNECT_COMMAND","CLEAR_EDITOR_COMMAND","URL_MATCHER","EMAIL_MATCHER","MATCHERS","exec","LexicalAutoLinkPlugin","AutoLinkPlugin","matchers","INSERT_INLINE_COMMAND","setPopupPosition","rect","pageYOffset","pageXOffset","offsetWidth","bottom","opacity","FloatingCharacterStylesEditor","isLink","isBold","isItalic","isUnderline","isCode","isStrikethrough","isSubscript","isSuperscript","popupCharStylesEditorRef","mouseDownRef","insertLink","TOGGLE_LINK_COMMAND","insertComment","updateCharacterStylesEditor","popupCharStylesEditorElem","nativeSelection","getSelection","isCollapsed","anchorNode","domRange","getRangeAt","firstElementChild","onResize","SELECTION_CHANGE_COMMAND","COMMAND_PRIORITY_LOW","FORMAT_TEXT_COMMAND","getSelectedNode","anchor","getNode","focusNode","isBackward","$isAtNodeEnd","useCharacterStylesPopup","isText","setIsText","setIsLink","setIsBold","setIsItalic","setIsUnderline","setIsStrikethrough","setIsSubscript","setIsSuperscript","setIsCode","updatePopup","hasFormat","parent","getParent","$isLinkNode","$isCodeHighlightNode","CharacterStylesPopupPlugin","ClickableLinkPlugin","newTab","hasMoved","prevOffsetX","prevOffsetY","onPointerUp","hasMovedDuringClick","linkDomNode","getLinkDomNode","linkNode","maybeLinkNode","$getNearestNodeFromDOMNode","open","metaKey","ctrlKey","prevRootElement","isLinkDomNode","nodeName","CodeHighlightPlugin","registerCodeHighlighting","emojis","Map","findAndTransformEmoji","emojiData","slice","emojiStyle","targetNode","splitText","emojiNode","textNodeTransform","isSimpleText","useEmojis","hasNodes","Error","registerNodeTransform","EmojisPlugin","KEYWORDS_REGEX","KeywordsPlugin","createKeywordNode","getKeywordMatch","matchArr","hashtagLength","startOffset","endOffset","end","useLexicalTextEntity","getElementNodesInSelection","nodesInSelection","getNodes","Set","getParentOrThrow","n","isIndentPermitted","maxDepth","elementNodesInSelection","totalDepth","elementNode","$isListNode","$getListDepth","$isListItemNode","ListMaxIndentLevelPlugin","INDENT_CONTENT_COMMAND","COMMAND_PRIORITY_CRITICAL","MarkdownPlugin","MarkdownShortcutPlugin","transformers","TAB_TO_FOCUS_INTERVAL","lastTabKeyDownTimestamp","hasRegisteredKeyDownListener","registerKeyTimeStampTracker","timeStamp","TabFocusPlugin","FOCUS_COMMAND","EditorContext","FileInput","accept","label","files","TextInput","getDOMSelection","targetWindow","INSERT_IMAGE_COMMAND","ImagesPlugin","$insertNodes","$isRootOrShadowRoot","$wrapNodeInElement","DRAGSTART_COMMAND","onDragStart","COMMAND_PRIORITY_HIGH","DRAGOVER_COMMAND","onDragover","DROP_COMMAND","onDrop","TRANSPARENT_IMAGE","getImageNodeInSelection","dataTransfer","setData","setDragImage","JSON","stringify","data","canDropImage","getDragImageData","range","getDragSelection","rangeSelection","$createRangeSelection","applyDOMRange","$isNodeSelection","dragData","getData","parse","HTMLElement","closest","nodeType","defaultView","ownerDocument","domSelection","caretRangeFromPoint","rangeParent","collapse","rangeOffset","ACCEPTABLE_IMAGE_TYPES","DragDropPaste","DRAG_DROP_PASTE","filesResult","mediaFileReader","flatMap","file","result","isMimeType","Editor","hashtagsEnabled","autoLinkEnabled","emojisEnabled","actionsEnabled","listMaxIndent","locale","activeEditor","setActiveEditor","editorStateRef","placeholderComponent","changeLanguage","Provider","AutoFocusPlugin","ClearEditorPlugin","HashtagPlugin","RichTextPlugin","OnChangePlugin","ListPlugin","CheckListPlugin","LinkPlugin","ToolbarContext","DropDown","buttonLabel","buttonAriaLabel","buttonClassName","buttonIconClassName","stopCloseOnClickSelf","dropDownRef","buttonRef","showDropDown","setShowDropDown","dropDown","min","innerWidth","handle","Divider","AlignDropdown","isRTL","FORMAT_ELEMENT_COMMAND","OUTDENT_CONTENT_COMMAND","INSERT_POLL_COMMAND","PollPlugin","pollNode","$isRootNode","insertNodes","INSERT_TWEET_COMMAND","TwitterPlugin","getTopLevelElementOrThrow","insertAfter","paragraphNode","select","INSERT_YOUTUBE_COMMAND","YouTubePlugin","youTubeNode","MIN_ROW_HEIGHT","MIN_COLUMN_WIDTH","TableCellResizer","targetRef","resizerRef","tableRectRef","mouseStartPosRef","mouseCurrentPos","updateMouseCurrentPos","activeCell","updateActiveCell","isSelectingGrid","updateIsSelectingGrid","draggingDirection","updateDraggingDirection","isGridSelection","DEPRECATED_$isGridSelection","resetState","onMouseMove","getCellFromTarget","tableCellNode","tableNode","$getTableNodeFromLexicalNodeOrThrow","tableElement","getElementByKey","isHeightChanging","direction","updateRowHeight","newHeight","$isTableCellNode","tableRowIndex","$getTableRowIndexFromTableCellNode","tableRows","setHeight","updateColumnWidth","newWidth","tableColumnIndex","$getTableColumnIndexFromTableCellNode","r","tableCells","setWidth","toggleResize","stopPropagation","heightChange","abs","isShrinking","widthChange","getResizers","styles","backgroundColor","right","tableRect","resizerStyles","onMouseDown","onMouseUp","TableCellResizerPlugin","TableActionMenu","_tableCellNode","setIsMenuOpen","contextRef","updateTableCellNode","selectionCounts","updateSelectionCounts","columns","registerMutationListener","nodeMutations","nodeUpdated","selectionShape","getShape","toX","fromX","toY","fromY","menuButtonElement","dropDownElement","menuButtonRect","handleClickOutside","clearTableSelection","isAttached","tableSelection","getTableSelectionFromTableElement","clearHighlight","markDirty","insertTableRowAtSelection","shouldInsertAfter","grid","$getElementGridForTableNode","$insertTableRow","insertTableColumnAtSelection","$insertTableColumn","deleteTableRowAtSelection","$removeTableRowAtIndex","deleteTableAtSelection","deleteTableColumnAtSelection","$deleteTableColumn","toggleTableRowIsHeader","toggleHeaderStyle","ROW","toggleTableColumnIsHeader","COLUMN","__headerState","TableCellActionMenuContainer","menuButtonRef","menuRootRef","isMenuOpen","setTableMenuCellNode","moveMenu","menu","activeElement","tableCellNodeFromSelection","$getTableCellNodeFromLexicalNode","tableCellParentNodeDOM","menuButtonDOM","tableCellNodeDOM","tableCellRect","menuRect","prevTableCellDOM","TableActionMenuPlugin","HorizontalRulePlugin","INSERT_HORIZONTAL_RULE_COMMAND","horizontalRuleNode","YOUTUBE_ID_PARSER","parseYouTubeVideoID","urlMatches","InsertImageDialog","InsertImageUriDialogBody","InsertImageUploadedDialogBody","InsertTableDialog","setRows","setColumns","INSERT_TABLE_COMMAND","InsertPollDialog","setQuestion","VALID_TWITTER_URL","InsertTweetDialog","setText","isDisabled","setSrc","setAltText","loadImage","reader","FileReader","readAsDataURL","InsertYouTubeDialog","InsertDropdown","enableTable","enableImage","enable","enableYoutube","enableTwitter","enablePoll","enableHorizontalRule","enableStickyNote","TablePlugin","TableCellActionMenuPlugin","stickyNode","IS_APPLE","test","platform","UndoButton","canUndo","RedoButton","canRedo","Select","CODE_LANGUAGE_OPTIONS","CodeLanguageDropdown","selectedElementKey","codeLanguage","onCodeLanguageSelect","setLanguage","BlockFormatDropdown","blockType","formatParagraph","$wrapNodes","formatHeading","headingSize","$createHeadingNode","formatBulletList","INSERT_UNORDERED_LIST_COMMAND","REMOVE_LIST_COMMAND","formatCheckList","INSERT_CHECK_LIST_COMMAND","formatNumberedList","INSERT_ORDERED_LIST_COMMAND","formatQuote","$createQuoteNode","formatCode","codeNode","removeText","insertRawText","supportedBlockTypes","CODE_LANGUAGE_MAP","javascript","md","plaintext","python","ToolbarPlugin","defaultFontSize","defaultFontColor","defaultBgColor","defaultFontFamily","insertExists","InsertComponent","useChild","alignExists","AlignComponent","setBlockType","setSelectedElementKey","setFontSize","fontColor","setFontColor","bgColor","setBgColor","fontFamily","setFontFamily","setCanUndo","setCanRedo","setIsRTL","setCodeLanguage","updateToolbar","elementKey","elementDOM","$isParentElementRTL","parentList","$getNearestNodeOfType","getListType","$isHeadingNode","getTag","$getSelectionStyleValueForProperty","_payload","newEditor","CAN_UNDO_COMMAND","CAN_REDO_COMMAND","applyStyleText","$patchStyleText","has","PUNCTUATION","NAME","DocumentMentionsRegex","CapitalizedNameMentionsRegex","RegExp","PUNC","TRIGGERS","VALID_CHARS","VALID_JOINS","LENGTH_LIMIT","AtSignMentionsRegex","ALIAS_LENGTH_LIMIT","AtSignMentionsRegexAliasRegex","SUGGESTION_LIST_LENGTH_LIMIT","mentionsCache","useMentionLookupService","mentionString","mentionData","setResults","cachedResults","then","checkForCapitalizedNameMentions","minMatchLength","maybeLeadingWhitespace","matchingString","leadOffset","replaceableString","checkForAtSignMentions","getPossibleMenuTextMatch","MentionMenuOption","MenuOption","picture","userCard","MentionsTypeaheadMenuItem","isSelected","onMouseEnter","setRefElement","MentionsPlugin","props","searchData","getTypeaheadValues","queryString","setQueryString","checkForSlashTriggerMatch","useBasicTypeaheadTriggerMatch","minLength","popoverCard","offset","onSelectOption","selectedOption","nodeToReplace","closeMenu","staticElement","renderToStaticMarkup","$createAutoLinkNode","checkForMentionMatch","mentionMatch","slashMatch","LexicalTypeaheadMenuPlugin","onQueryChange","triggerFn","menuRenderFn","anchorElementRef","selectedIndex","selectOptionAndCleanUp","setHighlightedIndex","ReactDOM","basicColors","WIDTH","HEIGHT","ColorPicker","rest","selfColor","setSelfColor","transformColor","saturationPosition","hsv","s","v","huePosition","h","onMoveSaturation","newHsv","newColor","onMoveHue","hex","basicColor","MoveWrapper","divRef","move","clamp","_e","toHex","startsWith","ctx","getContext","fillStyle","hex2rgb","rbgArr","m","g","b","parseInt","rgb2hsv","d","hsv2rgb","f","p","q","round","rgb2hex","padStart","rgb","BackgroundColorPicker","onBgColorSelect","BoldButton","CodeFormatButton","PREVIEW_CACHE","useSuspenseRequest","cached","preview","fetch","encodeURI","response","json","catch","Promise","LinkPreviewContent","domain","description","Glimmer","animationDelay","LinkPreview","positionEditorElement","FloatingLinkEditor","editorRef","inputRef","linkUrl","setLinkUrl","isEditMode","setEditMode","lastSelection","setLastSelection","updateLinkEditor","getURL","editorElem","onKeyDown","rel","defaultFontFamilyOptions","FontFamilyDropdown","fontOptions","onFontFamilySelect","defaultFontSizeOptions","FontSizeDropdown","fontSizeOptions","onFontSizeSelect","InsertLinkButton","ItalicButton","TextColorPicker","onFontColorSelect","TextFormatDropdown","UnderlineButton","INSERT_CUSTOM_FIELD_COMMAND","CustomFieldPlugin","listStyle","itemStyle","record","customFieldNode","Object","imageCache","useSuspenseImage","resolve","Image","LazyImage","imageRef"],"mappings":"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"}